---
title: 監視ノードのテスト ユーザーと設定を構成する方法
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
ms.date: 2/13/2018
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
ms.localizationpriority: medium
ms.collection: IT_Skype16
ms.assetid: ab2e0d93-cf52-4a4e-b5a4-fd545df7a1a9
description: 代理トランザクションのテスト ユーザー アカウントと監視ノード設定を構成Skype for Business Server方法。
ms.openlocfilehash: 7e7c318f6e9176c46a7dbbab6c8d1833f74911e9
ms.sourcegitcommit: 556fffc96729150efcc04cd5d6069c402012421e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/26/2021
ms.locfileid: "58599942"
---
# <a name="how-to-configure-watcher-node-test-users-and-settings"></a>監視ノードのテスト ユーザーと設定を構成する方法
 
**概要:** 代理トランザクションのテスト ユーザー アカウントと監視ノードSkype for Business Server構成します。
  
監視ノードとして機能するコンピューターを構成したら、次の手順を実行する必要があります。
  
1. [これらの監視ノードで](test-users-and-settings.md#testuser) 使用するテスト ユーザー アカウントを構成します。 ネゴシエート認証方法を使用している場合は **、Set-CsTestUserCredential** コマンドレットを使用して、監視ノードでこれらのテスト アカウントを使用する必要があります。
    
2. 監視ノードの構成設定を更新します。
    
## <a name="configure-test-user-accounts"></a>テスト ユーザー アカウントの構成
<a name="testuser"> </a>

テスト アカウントは実際のユーザーを表す必要はありません。ただし、有効な Active Directory アカウントである必要があります。 さらに、これらのアカウントは Skype for Business Server に対して有効にする必要があります。有効な SIP アドレスを持っている必要があります。エンタープライズ VoIP (代理トランザクションを使用するには) Test-CsPstnPeerToPeerCall を有効にする必要があります。 
  
TrustedServer 認証方法を使用している場合は、これらのアカウントが存在し、これらのアカウントを構成する必要があります。 テストするプールごとに、少なくとも 2 人のテスト ユーザーを割り当てる。 Negotiate 認証方法を使用している場合は、Set-CsTestUserCredential コマンドレットと Skype for Business Server 管理シェルを使用して、これらのテスト アカウントが代理トランザクションで動作する必要があります。 これを行うには、次のようなコマンドを実行します (これらのコマンドでは、2 つの Active Directory ユーザー アカウントが作成され、これらのアカウントが有効になっているとSkype for Business Server。
  
```PowerShell
Set-CsTestUserCredential -SipAddress "sip:watcher1@litwareinc.com" -UserName "litwareinc\watcher1" -Password "P@ssw0rd"
Set-CsTestUserCredential -SipAddress "sip:watcher2@litwareinc.com" -UserName "litwareinc\watcher2" -Password "P@ssw0rd"
```

SIP アドレスだけでなく、ユーザー名とパスワードも含める必要があります。 パスワードを含めない場合は、Set-CsTestUserCredentialを入力するように求められます。 ユーザー名は、前のコード ブロックに示されているドメイン名\ユーザー名形式を使用して指定できます。
  
テスト ユーザー資格情報が作成されたと確認するには、次のコマンドを管理シェルSkype for Business Server実行します。
  
```PowerShell
Get-CsTestUserCredential -SipAddress "sip:watcher1@litwareinc.com"
Get-CsTestUserCredential -SipAddress "sip:watcher2@litwareinc.com"
```

次のような情報は、ユーザーごとに返されます。
  
|**UserName**|**Password**|
|:-----|:-----|
|Litwareinc\watcher1  <br/> |System.Security.SecureString  <br/> |
   
### <a name="configure-a-basic-watcher-node-with-the-default-synthetic-transactions"></a>既定の代理トランザクションを使用して基本監視ノードを構成する

テスト ユーザーが作成された後、次のようなコマンドを使用して監視ノードを作成できます。
  
```PowerShell
New-CsWatcherNodeConfiguration -TargetFqdn "atl-cs-001.litwareinc.com" -PortNumber 5061 -TestUsers @{Add= "sip:watcher1@litwareinc.com","sip:watcher2@litwareinc.com"}
```

このコマンドは、既定の設定を使用し、代理トランザクションの既定のセットを実行する新しい監視ノードを作成します。 また、新しい監視ノードでは、テスト ユーザーが watcher1@litwareinc.com、watcher2@litwareinc.com。 監視ノードが TrustedServer 認証を使用する場合、2 つのテスト アカウントには、Active Directory およびサーバー サーバーで有効になっている任意の有効なユーザー アカウントSkype for Business Server。 監視ノードでネゴシエート認証方法を使用する場合は、監視ノードに対してこれらのユーザー アカウントも有効にするSet-CsTestUserCredentialがあります。
  
プールを直接対象とするのではなく、サインインするターゲット プールの自動検出が正しく構成されていることを検証するには、代わりに次の手順を使用します。
  
```PowerShell
New-CsWatcherNodeConfiguration -UseAutoDiscovery $true -TargetFqdn "atl-cs-001.litwareinc.com" -PortNumber 5061 -TestUsers @{Add= "sip:watcher1@litwareinc.com","sip:watcher2@litwareinc.com"}
```

### <a name="configuring-extended-tests"></a>拡張テストの構成

公衆交換電話網との接続を確認する PSTN テストを有効にする場合は、監視ノードをセットアップするときに追加の構成を行う必要があります。 最初に、テスト ユーザーを PSTN テストの種類に関連付ける場合は、次のようなコマンドを管理シェルから実行Skype for Business Server必要があります。
  
```PowerShell
$pstnTest = New-CsExtendedTest -TestUsers "sip:watcher1@litwareinc.com", "sip:watcher2@litwareinc.com" -Name "Contoso Provider Test" -TestType PSTN
```

> [!NOTE]
> このコマンドの結果は変数に格納する必要があります。 この例では、変数の名前は $pstnTest。 
  
次に **、New-CsWatcherNodeConfiguration** コマンドレットを使用して、テストの種類 (変数 $pstnTest に格納されている) を Skype for Business Server プールに関連付けできます。 たとえば、次のコマンドは、プール atl-cs-001.litwareinc.com の新しい監視ノード構成を作成し、前に作成した 2 人のテスト ユーザーを追加し、PSTN テストの種類を追加します。
  
```PowerShell
New-CsWatcherNodeConfiguration -TargetFqdn "atl-cs-001.litwareinc.com" -PortNumber 5061 -TestUsers @{Add= "sip:watcher1@litwareinc.com","sip:watcher2@litwareinc.com"} -ExtendedTests @{Add=$pstnTest}
```

上記のコマンドは、監視ノード コンピューターに Skype for Business Server コア ファイルと RTCLocal データベースをインストールしていない場合に失敗します。 
  
複数の音声ポリシーをテストするには **、New-CsExtendedTest** コマンドレットを使用して、ポリシーごとに拡張テストを作成できます。 提供されるユーザーは、目的の音声ポリシーで構成する必要があります。 拡張テストは、次のようなコンマ区切り文字を使用して **New-CsWatcherNodeConfiguration** コマンドレットに渡されます。
  
-ExtendedTests @{Add=$pstnTest 1,$pstnTest 2,$pstnTest 3}
  
**New-CsWatcherNodeConfiguration** コマンドレットは Tests パラメーターを使用せずに呼び出されたため、新しい監視ノードでは既定の代理トランザクション (および指定した拡張代理トランザクション) だけが有効になります。 したがって、監視ノードは次のコンポーネントをテストします。
  
- 登録
    
- IM
    
- GroupIM
    
- P2PAV (ピアツーピアのオーディオ/ビデオ セッション)
    
- AvConference (電話/会議)
    
- プレゼンス
    
- ABS (アドレス帳サービス)
    
- ABWQ (アドレス帳 Web サービス)
    
既定では、次のコンポーネントはテストされません。
  
- ASConference
    
- AVEdgeConnectivity
    
- DataConference
    
- DialinConferencing
    
- ExumConnectivity (Exchange ユニファイド メッセージング)
    
- JoinLauncher
    
- MCXP2PIM (従来のモバイル デバイス インスタント メッセージング)
    
- P2PVideoInteropServerSipTrunkAV
    
- PersistentChatMessage
    
- PSTN (PSTN ゲートウェイ呼び出し、拡張テストとして指定)
    
- UcwaConference
    
- UnifiedContactStore
    
- XmppIM
    
### <a name="adding-and-removing-synthetic-transactions"></a>代理トランザクションの追加と削除

監視ノードが構成された後、Set-CsWatcherNodeConfiguration コマンドレットを使用して、ノードに代理トランザクションを追加または削除できます。 たとえば、PersistentChatMessage テストを監視ノードに追加するには、Add メソッドと次のようなコマンドを使用します。
  
```PowerShell
Set-CsWatcherNodeConfiguration -Identity "atl-cs-001.litwareinc.com" -Tests @{Add="PersistentChatMessage"}
```

複数のテストを追加するには、コンマを使用してテスト名を区切ります。 次に例を示します。
  
```PowerShell
Set-CsWatcherNodeConfiguration -Identity "atl-cs-001.litwareinc.com" -Tests @{Add="PersistentChatMessage","DataConference","UnifiedContactStore"}
```

これらのテストの 1 つ以上 (DataConference など) が監視ノードで既に有効になっている場合、エラーが発生します。 この場合、次のようなエラー メッセージが表示されます。
  
Set-CsWatcherNodeConfiguration : 'urn:schema:Microsoft.Rtc.Management" の重複キー シーケンス 'DataConference' があります。設定。WatcherNode.2010:TestName' キーまたは一意の ID 制約。
  
このエラーが発生すると、変更は適用されません。 このコマンドは、重複するテストを削除して再実行する必要があります。
  
監視ノードから代理トランザクションを削除するには、Remove メソッドを使用します。 たとえば、このコマンドは監視ノードから ABWQ テストを削除します。
  
```PowerShell
Set-CsWatcherNodeConfiguration -Identity "atl-cs-001.litwareinc.com" -Tests @{Remove="ABWQ"}
```

Replace メソッドを使用すると、現在有効なすべてのテストを 1 つ以上の新しいテストに置き換できます。 たとえば、監視ノードで IM テストのみを実行する場合は、次のコマンドを使用して構成できます。
  
```PowerShell
Set-CsWatcherNodeConfiguration -Identity "atl-cs-001.litwareinc.com" -Tests @{Replace="IM"}
```

このコマンドを実行すると、指定された監視ノード上のすべての代理トランザクションは、IM を除いて無効になります。
  
### <a name="viewing-and-testing-the-watcher-node-configuration"></a>監視ノード構成の表示とテスト

監視ノードに割り当てられているテストを表示する場合は、次のようなコマンドを使用します。
  
```PowerShell
Get-CsWatcherNodeConfiguration -Identity "atl-cs-001.litwareinc.com" | Select-Object -ExpandProperty Tests
```

このコマンドは、ノードに割り当てられている代理トランザクションに応じて、次のような情報を返します。
  
登録 IM GroupIM P2PAV AvConference Presence PersistentChatMessage DataConference
> [!TIP]
> 代理トランザクションをアルファベット順に表示するには、代わりに次のコマンドを使用します。 
  
```PowerShell
Get-CsWatcherNodeConfiguration -Identity "atl-cs-001.litwareinc.com" | Select-Object -ExpandProperty Tests | Sort-Object
```

監視ノードが作成されたと確認するには、管理シェルから次のコマンドSkype for Business Server入力します。
  
```PowerShell
Get-CsWatcherNodeConfiguration
```

次のような情報を取得します。
  
ID : atl-cs-001.litwareinc.com <br/>
TestUsers : {sip:watcher1@litwareinc.com,sip:watcher2@litwareinc.com ...}<br/>
ExtendedTests : {TestUsers=IList<System.String>;Name=PSTN Test;Te...}<br/>
TargetFqdn : atl-cs-001.litwareinc.com<br/>
PortNumber : 5061<br/>

監視ノードが正しく構成されていることを確認するには、管理シェルから次Skype for Business Server入力します。
  
```PowerShell
Test-CsWatcherNodeConfiguration
```

このコマンドは、展開内の各監視ノードをテストし、次のアクションが完了したかどうかを確認します。
  
- 必要なレジストラーの役割がインストールされます。
    
- 必要なレジストリ キーが作成されます (このコマンドレットを実行するとSet-CsWatcherNodeConfigurationされます。
    
- サーバーが正しいバージョンのサーバーを実行Skype for Business Server。
    
- ポートが正しく構成されています。
    
- 割り当てられたテスト ユーザーには、必要な資格情報があります。
    
## <a name="managing-watcher-nodes"></a>監視ノードの管理
<a name="testuser"> </a>

監視ノードで実行される代理トランザクションの変更に加えて **、Set-CsWatcherNodeConfiguration** コマンドレットを使用して、監視ノードの有効化と無効化、テストの実行中に内部 Web URL または外部 Web URL を使用する監視ノードの構成という 2 つの重要なタスクを実行することもできます。
  
既定では、監視ノードは、すべての有効な代理トランザクションを定期的に実行するように設計されています。 ただし、これらのトランザクションを中断する場合があります。 たとえば、監視ノードを一時的にネットワークから切り離す場合は、代理トランザクションを実行する理由がありません。 ネットワーク接続がない場合、これらのトランザクションは失敗します。 監視ノードを一時的に無効にするには、次のようなコマンドを管理シェルSkype for Business Server実行します。
  
```PowerShell
Set-CsWatcherNodeConfiguration -Identity "atl-watcher-001.litwareinc.com" -Enabled $False
```

このコマンドを実行すると、監視ノード atl 監視ノードでの代理トランザクションの実行が 001.litwareinc.com。 代理トランザクションの実行を再開するには、Enabled プロパティを True ($True) に戻します。
  
```PowerShell
Set-CsWatcherNodeConfiguration -Identity "atl-watcher-001.litwareinc.com" -Enabled $True
```

> [!NOTE]
> Enabled プロパティを使用して監視ノードをオンまたはオフにできます。監視ノードを完全に削除する場合は、**Remove-CsWatcherNodeConfiguration** コマンドレットを使用します。
  
```PowerShell
Remove-CsWatcherNodeConfiguration -Identity "atl-watcher-001.litwareinc.com"
```

このコマンドを実行すると、指定したコンピューターから監視ノード構成設定すべてが削除され、そのコンピューターが代理トランザクションを自動的に実行できません。 ただし、このコマンドは、エージェント ファイルSystem Centerシステム ファイルSkype for Business Serverアンインストールしない。
  
既定では、監視ノードはテストを実行するときに組織の外部 Web URL を使用します。 ただし、監視ノードは、組織の内部 Web URL を使用するように構成することもできます。 これにより、管理者は、境界ネットワーク内に配置されたユーザーの URL アクセスを検証できます。 外部 URL の代わりに内部 URL を使用する監視ノードを構成するには、UseInternalWebURls プロパティを True ($True) に設定します。
  
```PowerShell
Set-CsWatcherNodeConfiguration -Identity "atl-watcher-001.litwareinc.com" -UseInternalWebUrls $True
```

このプロパティを既定値の False ($False) にリセットすると、ウォッチャーは再び外部 URL を使用します。
  
```PowerShell
Set-CsWatcherNodeConfiguration -Identity "atl-watcher-001.litwareinc.com" -UseInternalWebUrls $False
```

## <a name="special-setup-instructions-for-synthetic-transactions"></a>代理トランザクションの特別なセットアップ指示
<a name="special_synthetictrans"> </a>

ほとんどの代理トランザクションは監視ノードで実行できます。 ほとんどの場合、代理トランザクションが監視ノード構成設定に追加されたとすぐに、監視ノードはテスト パス中に代理トランザクションの使用を開始できます。 ただし、次のセクションで説明したように、特別なセットアップ手順が必要な代理トランザクションがあります。
  
### <a name="data-conferencing-synthetic-transaction"></a>データ会議代理トランザクション

監視ノード コンピューターが境界ネットワークの外側にある場合、次の手順を実行してネットワーク サービス アカウントの Windows Internet Explorer® インターネット ブラウザー プロキシ設定を最初に無効にしない限り、データ会議代理トランザクションを実行できない可能性があります。
  
1. ウォッチャー ノード コンピューターで、[**スタート**] ボタンをクリックし、[**すべてのプログラム**]、[**アクセサリ**] の順にクリックします。次に、[**コマンド プロンプト**] を右クリックし、[**管理者として実行**] をクリックします。
    
2. コンソール ウィンドウで、次のコマンドを入力し、Enter キーを押します。 
    
    ```console
    bitsadmin /util /SetIEProxy NetworkService NO_PROXY
    ```

    コマンド ウィンドウに次のメッセージが表示されます。

    ```console
    BITSAdmin is deprecated and is not guaranteed to be available in future versions of Windows. Administration tools for the BITS service are now provided by BITS PowerShell cmdlets.
  
    Internet proxy settings for account NetworkService set to NO_PROXY. 
      
    (connection = default)
    ```
      
    このメッセージは、ネットワーク サービス アカウントInternet Explorerプロキシ設定を無効にしたかどうかを示します。
  
### <a name="exchange-unified-messaging-synthetic-transaction"></a>Exchangeユニファイド メッセージング代理トランザクション

このExchangeユニファイド メッセージング (UM) 代理トランザクションは、テスト ユーザーがボイスメール アカウントに接続できると確認Exchange。
  
テスト ユーザーは、ボイスメール アカウントで事前構成する必要があります。 
  
### <a name="persistent-chat-synthetic-transaction"></a>常設チャット代理トランザクション

常設チャット代理トランザクションを使用するには、まずチャネルを作成し、テスト ユーザーに使用許可を与える必要があります。
  
常設チャット代理トランザクションを使用して、次のチャネルを構成できます。 
  
```powershell
$cred1 = Get-Credential "contoso\testUser1"
$cred2 = Get-Credential "contoso\testUser2"

Test-CsPersistentChatMessage -TargetFqdn pool0.contoso.com -SenderSipAddress sip:testUser1@contoso.com -SenderCredential $cred1 -ReceiverSipAddress sip:testUser2@contoso.com -ReceiverCredential $cred2 -TestUser1SipAddress sip:testUser1@contoso.com -TestUser2SipAddress sip:testUser2@contoso.com -Setup $true
```

このセットアップ タスクを実行するには、エンタープライズ内から実行する必要があります。
  
- サーバー以外のコンピューターから実行する場合、コマンドレットを実行するユーザーは、Role-Based アクセス制御 (RBAC) の CsPersistentChatAdministrators 役割のメンバーである必要があります。
    
- サーバー自体から実行する場合、コマンドレットを実行するユーザーは RTCUniversalServerAdmins グループのメンバーである必要があります。
    
### <a name="pstn-peer-to-peer-call-synthetic-transaction"></a>PSTN ピアツーピア通話代理トランザクション

代理Test-CsPstnPeerToPeerCallは、公衆交換電話網 (PSTN) を介して通話を発信および受信する機能を確認します。
  
この代理トランザクションを実行するには、以下を構成する必要があります。
  
- UC が有効な 2 人のテスト ユーザー (発信者と受信者)。
    
- 各ユーザー アカウントのダイレクト インワード ダイヤリング (DID) 番号。
    
- VoIP ポリシーと音声ルートにより、受信者の番号への通話が PSTN ゲートウェイに到達できます。
    
- ダイヤルされた番号に基づいて、通話を受信者のホーム プールにルーティングする通話とメディアを受け入れる PSTN ゲートウェイ。
    
### <a name="unified-contact-store-synthetic-transaction"></a>統合連絡先ストア代理トランザクション

統合連絡先ストア代理トランザクションは、ユーザーの代理Skype for Business Serverに連絡先を取得する機能をExchange。
  
この代理トランザクションを使用するには、次の条件を満たす必要があります。
  
- Lyss-Exchangeサーバー間認証を構成する必要があります。
    
- テスト ユーザーには、有効なメールボックスExchangeがあります。
    
これらの条件が満たされた後、次のコマンドレットをWindows PowerShellして、テスト ユーザーの連絡先リストを次のユーザーに移行Exchange。
  
```PowerShell
Test-CsUnifiedContactStore -TargetFqdn pool0.contoso.com -UserSipAddress sip:testUser1@contoso.com -RegistrarPort 5061 -Authentication TrustedServer -Setup
```

テスト ユーザーの連絡先リストがユーザーの連絡先リストに移行するには、時間Exchange。 移行の進行状況を監視するには、-Setup フラグなしで同じコマンド ラインを実行できます。
  
```PowerShell
Test-CsUnifiedContactStore -TargetFqdn pool0.contoso.com -UserSipAddress sip:testUser1@contoso.com -RegistrarPort 5061 -Authentication TrustedServer
```

移行が完了すると、このコマンド ラインは成功します。
  
### <a name="xmpp-synthetic-transaction"></a>XMPP 代理トランザクション

拡張メッセージングとプレゼンス プロトコル (XMPP) IM 代理トランザクションでは、1 つ以上のフェデレーション ドメインを使用して XMPP 機能を構成する必要があります。
  
XMPP 代理トランザクションを有効にするには、ROUTABLE XMPP ドメインのユーザー アカウントに XmppTestReceiverMailAddress パラメーターを指定する必要があります。 次に例を示します。
  
```PowerShell
Set-CsWatcherNodeConfiguration -Identity pool0.contoso.com -Tests @{Add="XmppIM"} -XmppTestReceiverMailAddress user1@litwareinc.com
```

この例では、Skype for Business Serverのメッセージを XMPP ゲートウェイにルーティング litwareinc.com 必要があります。

> [!NOTE]
> XMPP ゲートウェイとプロキシは 2015 年Skype for Business Server使用できますが、2019 年Skype for Business Serverではサポートされていません。 詳細については [、「XMPP フェデレーションの移行」を参照してください](../../../SfBServer2019/migration/migrating-xmpp-federation.md)。
  
### <a name="video-interop-server-vis-synthetic-transaction"></a>ビデオ相互運用サーバー (VIS) 代理トランザクション

ビデオ相互運用サーバー (VIS) 代理トランザクションでは、代理トランザクション サポート ファイル (VISSTSupportPackage.msi) をダウンロードして[ インストールする必要があります ](https://www.microsoft.com/download/details.aspx?id=46921)。 
  
インストールするにはVISSTSupportPackage.msi msi の依存関係 ([システム要件] の下) が既にインストールされていることを確認します。 簡単VISSTSupportPackage.msiを実行するには、次の手順を実行します。 この.msiは、「%ProgramFiles%\VIS 代理トランザクション サポート パッケージ」というパス内のすべてのファイルをインストールします。
  
VIS 代理トランザクションを実行する方法の詳細については [、Test-CsP2PVideoInteropServerSipTrunkAV](/powershell/module/skype/Test-CsP2PVideoInteropServerSipTrunkAV) コマンドレットのドキュメントを参照してください。
  
## <a name="changing-the-run-frequency-for-synthetic-transactions"></a>代理トランザクションの実行頻度の変更
<a name="special_synthetictrans"> </a>

既定では、代理トランザクションは構成済みのユーザーと 15 分ごとに実行されます。 代理トランザクションは、2 つの代理トランザクションが互いに競合しないように、一連のユーザー内で順次実行されます。 すべての代理トランザクションが完了する時間を提供するには、より長い間隔が必要です。
  
代理トランザクションを頻繁に実行することが望ましい場合は、特定の一連のユーザーと一緒に実行される代理トランザクションの数を減らして、ネットワークの遅延が発生する可能性のあるバッファーを使用して、目的の時間範囲でテストを完了できる必要があります。 より多くの代理トランザクションを実行することが望ましい場合は、追加の代理トランザクションを実行するために、より多くのユーザー セットを作成します。
  
代理トランザクションを実行する頻度を変更するには、次の手順を実行します。
  
1. [操作System Center] を開きます。 [作成] セクションをクリックします。 [ルール] セクション ([作成] の下) をクリックします。
    
2. [ルール] セクションで、"Main Synthetic Transaction Runner Performance Collection Rule" という名前のルールを見つける。
    
3. ルールを右クリックし、[上書き] を選択し、[ルールの上書き] を選択し、[クラスのすべてのオブジェクト: プール ウォッチャー] を選択します。
    
4. [プロパティの上書き] ウィンドウで、[パラメーター名] "Frequency" を選択し、[上書き値] を目的の値に設定します。
    
5. 同じウィンドウで、この上書きを適用する必要がある管理パックを選択します。
    
## <a name="using-rich-logging-for-synthetic-transactions"></a>代理トランザクションのリッチ ログの使用
<a name="special_synthetictrans"> </a>

代理トランザクションは、システムの問題を特定するのに役立ちます。 たとえば、Test-CsRegistrationコマンドレットは、ユーザーがユーザーの登録が困難であるという事実を管理者に通知Skype for Business Server。 ただし、エラーの実際の原因を特定するために、詳細が必要になる場合があります。
  
このため、代理トランザクションは豊富なログを提供します。 リッチ ログでは、代理トランザクションが実行する各アクティビティに対して、次の情報が記録されます。
  
- アクティビティが開始した時刻。
    
- アクティビティが終了した時刻。
    
- 実行されたアクション (会議の作成、参加、退出、Skype for Business Server へのサインイン、インスタント メッセージの送信など)。
    
- アクティビティの実行時に生成される情報メッセージ、詳細メッセージ、警告メッセージ、またはエラー メッセージ。
    
- SIP 登録メッセージ。
    
- アクティビティの実行時に生成される例外レコードまたは診断コード。
    
- アクティビティを実行した結果。
    
この情報は、代理トランザクションが実行されるごとに自動的に生成されますが、ログ ファイルに自動的に表示または保存されません。 代理トランザクションを手動で実行している場合は、OutLoggerVariable パラメーターを使用して、情報が格納される Windows PowerShell変数を指定できます。 そこから、2 つの方法のいずれかを使用して、XML 形式または HTML 形式のリッチ ログにエラー メッセージを保存または表示できます。 
  
トラブルシューティング情報を取得するには、OutLoggerVariable パラメーターを指定し、その後に変数名を指定します。
  
```PowerShell
Test-CsRegistration -TargetFqdn atl-cs-001.litwareinc.com -OutLoggerVariable RegistrationTest
```

> [!NOTE]
> 変数名の前に $ 記号を付けないでください。 RegistrationTest などの変数名を使用します ($RegistrationTest)。 
  
このコマンドを実行すると、次のような出力が表示されます。
  
ターゲット Fqdn : atl-cs-001.litwareinc.com 結果 : エラー待機時間 : 00:00:00 エラー メッセージ : このコンピューターには、割り当てられた証明書が存在しない。 診断 :このエラーに関する詳細情報は、ここに示すエラー メッセージに比してはるかに詳細な情報にアクセスできます。

この情報に HTML 形式でアクセスするには、次のようなコマンドを使用して、変数 RegistrationTest に格納されている情報を HTML ファイルに保存します。
  
```PowerShell
$RegistrationTest.ToHTML() | Out-File C:\Logs\Registration.html
```

別の方法として、ToXML() メソッドを使用して、XML ファイルにデータを保存できます。
  
```PowerShell
$RegistrationTest.ToXML() | Out-File C:\Logs\Registration.xml
```

これらのファイルは、HTML/XML ファイルWindows Internet Explorer、Microsoft Visual Studio、または他のアプリケーションを使用して表示できます。
  
代理トランザクションは、Operations Manager がSystem Centerにこれらのログ ファイルを自動的に生成します。 これらのログは、PowerShell が代理トランザクションを読み込Skype for Business Server実行する前に実行が失敗した場合は生成されません。 
  
> [!IMPORTANT]
> 既定では、Skype for Business Server共有されていないフォルダーにログ ファイルを保存します。 これらのログに簡単にアクセスするには、このフォルダーを共有する必要があります。 例: \\ atl-watcher-001.litwareinc.com\WatcherNode。
