---
title: Skype for Business 2015 の集中ログ サービス
ms.author: jambirk
author: jambirk
manager: serdars
ms.date: 2/1/2018
ms.audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 975718a0-f3e3-404d-9453-6224e73bfdd0
description: '概要: をサービス コンポーネントとビジネス サーバー 2015 の Skype で集中ログ サービスの設定について説明します。'
ms.openlocfilehash: 922d1f24e2d57c4908744462eb1b3c8335255cfd
ms.sourcegitcommit: 7d819bc9eb63bfd85f5dada09f1b8e5354c56f6b
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/28/2018
---
# <a name="centralized-logging-service-in-skype-for-business-2015"></a>Skype for Business 2015 の集中ログ サービス
 
**の概要:**サービス コンポーネントとビジネス サーバー 2015 Skype で集中ログ サービスの構成設定について説明します。
  
集中ログ サービスを実行できます。 
  
- 起動またはコンピューターと中央の場所から 1 つのコマンドを使用してプールの 1 つまたは複数のログ記録を停止します。
    
- 1 つ以上のコンピューターとプールに関するログを検索します。 すべてのマシン上のすべてのログを取得する検索を調整したりより簡潔な結果を返します。
    
- ログ セッションの構成は次のとおりです。
    
  - **シナリオ**を定義するか、既定のシナリオを使用します。 ログ サービスの集中管理のシナリオで構成されたスコープ (グローバルまたはサイト)、シナリオ、および 1 つまたは複数のプロバイダーの目的を識別するシナリオの名前です。 コンピューターで任意の時点で、既定のシナリオと定義されているシナリオの 1 つを実行できます。
    
  - 既存のプロバイダーを使用するか、新しいプロバイダーを作成します。 Aprovider では、ロギング ・ セッションの収集、詳細のレベル、トレースするコンポーネント、どのようなフラグが適用されますを定義します。
    
    > [!TIP]
    >  OCSLogger に精通して場合、termproviders は、**ログのタイプ**(たとえば、WPP、イベント ログ、または IIS ログ ファイル)、**トレーシング ・ レベル**(たとえば、すべて、詳細、デバッグ用の)**コンポーネント**(たとえば、S4、SIPStack) のコレクションを参照します。、および**フラグ**(たとえば、TF_COMPONENT、TF_DIAG)。 これらの項目はプロバイダー (Windows PowerShell 変数) で定義されているし、ログ サービスの一元的なコマンドに渡されます。
  
  - ログの特定のコンピューターおよびプールを構成します。
    
  - ログ セッションの対象範囲を、**サイト** (そのサイトのコンピューターだけでログ キャプチャを実行します) または**グローバル** (展開のすべてのコンピューターでログ キャプチャを実行します) から定義します。
    
集中ログ サービスは、規模の大小、パフォーマンスの問題の根本原因の分析から、問題のトラブルシューティングの強力なツールです。 ビジネス サーバー管理シェルには、Skype を使用するすべての例が表示されます。 ツール自体にコマンドライン ツールのヘルプが用意されていますが、コマンド ラインから実行できる機能は限られています。 Skype ビジネス サーバー管理シェルを使用すると、常に、最初の選択をするはずですので非常に大きいとはるかに構成可能な一連の機能へのアクセスがあります。 
  
## <a name="logging-service-components"></a>ログ サービス コンポーネント

 集中ログ サービスは、配置内のすべてのサーバー上で実行しで構成された、次のエージェントとサービス。
  
- 一元的なログ記録サービス エージェント ClsAgent は、ビジネス サーバーの展開の Skype ですべてのコンピューターで実行されます。 WCF 経由で ClsController からのコマンド ( **50, 001-50003 の TCP**のポート) で待機し、コント ローラーに応答を送信します。 ログ セッション (開始/停止/更新) を管理し、ログを検索します。 ログのアーカイブのような単純な定型処理を実行し、ファイルをパージします。 
    
- 集中ログ サービス コント ローラーのコマンドレットの Skype ビジネス サーバー管理シェルの開始、停止、フラッシュ、および検索のコマンドを ClsAgent に送信します。 検索コマンドが送信されると、結果のログは、ClsControllerLib.dll に返され、集計します。 コント ローラーは、エージェントにコマンドを送信、これらのコマンドのステータスを受け取るし、検索のスコープ内の任意のコンピューター上のすべてのエージェントから返される出力の意味があり、順序付けされたセットにログ データを集計し、ログ ファイル データの検索を管理します。 次のトピックでは、Skype を使用してビジネス サーバー管理シェルを重視されています。
    
**ClsAgent ClsController 通信**

![CLSController と CLSAgent の間の関係](../../media/Ops_CLS_Architecture.jpg)
  
Windows サーバーのコマンド ライン インターフェイスを使用して、または、Skype を使用してビジネス サーバー管理シェルのコマンドを発行するとします。 コマンドは、コンピューターにログインしている ClsAgent をローカルでまたは送信する他のコンピューターとプールの展開で実行されます。
  
ClsAgent は、すべてのインデックス ファイルを保持します。ローカル マシン上にあるファイルをキャッシュします。 ClsAgent 割り当てることはありません (つまり、ローカル キャッシュの場所と、割合は、**を使用して構成可能な各ボリュームの 80% 以上を消費して、CacheFileLocalFolders オプションで定義されているボリュームの間で均等に配分するためSet-CsClsConfiguration**コマンドレット)。 ClsAgent は、ローカル マシンからの古いキャッシュされたイベント トレース ログ (.etl) ファイルのエージングを担当するもできます。 2 週間後 (つまり、時間枠が**セット CsClsConfiguration**コマンドレットを使用して構成可能な) これらのファイルがファイル共有にコピーされ、ローカル コンピューターから削除します。 詳細については、[一連の CsClsConfiguration](https://docs.microsoft.com/powershell/module/skype/set-csclsconfiguration?view=skype-ps)を参照してください。 検索要求を受信すると、エージェントが管理しているインデックスの値に基づいて検索を実行するキャッシュの .etl ファイルのセットを選択する検索条件が使用されます。
  
> [!NOTE]
> ローカル コンピューターからファイル共有に移動されたファイルを ClsAgent で検索できます。ClsAgent がファイルをファイル共有に移動すると、ファイルのエージングと削除は ClsAgent で管理されません。ファイル共有内のファイルのサイズを監視し、ファイルを削除またはアーカイブするための管理タスクを定義する必要があります。 
  
**Snooper.exe** や、テキスト ファイルを読み取ることのできるツール (**Notepad.exe** など) を含むさまざまなツールを使用して、結果のログ ファイルの読み取りと分析を行うことができます。 Snooper.exe は、ビジネス サーバー 2015 のデバッグ ツールの Skype の一部であり[Web ダウンロード](https://go.microsoft.com/fwlink/p/?LinkId=285257)として利用可能です。
  
同様に OCSLogger、一元的なログ記録サービスに対して、トレースするコンポーネントがいくつか TF_COMPONENT や TF_DIAG など、フラグを選択するオプションが用意されています。 集中ログ サービスでは、OCSLogger のレベルのログ記録オプションも保持します。
  
ビジネス サーバー管理シェルのコマンドラインの ClsController の上、Skype を使用する最も重要な利点は、構成および問題領域、ユーザー設定のフラグ、およびログ出力のレベルを対象とする選択したプロバイダーを使用して、新しいシナリオを定義できます。 ClsController で使用可能なシナリオは、実行可能ファイル用に定義されるシナリオに制限されます。
  
以前のバージョンでは、管理者とサポート担当者が展開内のコンピューターからトレース ファイルを収集できるようにするために OCSLogger.exe が提供されていました。OCSLogger には、長所と同時に短所も存在しました。ログは一度に 1 台のコンピューター上でしか収集できませんでした。OCSLogger のコピーを使用して複数のコンピューターにログオンすることは可能でしたが、最終的にログが複数作成され、結果を集計するのが容易ではありませんでした。
  
ユーザーがログの検索を要求すると、ClsController が (選択したシナリオに基づいて) 要求の送信先コンピューターを特定します。また、.etl ファイルが保存されているファイル共有に検索を送信する必要があるかどうかを判断します。検索結果が ClsController に返されると、コントローラーが結果をマージして時系列の 1 つの結果セットを作成し、ユーザーに提供します。ユーザーは、ローカル コンピューターに検索結果を保存して、以降の分析に使用できます。
  
ログ記録セッションを開始したら、解決しようとする問題に関連するシナリオを指定します。常に実行することのできるシナリオは 2 つあります。そのうちの 1 つは AlwaysOn シナリオにする必要があります。名前が示すとおり、このシナリオを展開内で常に実行し、すべてのコンピューター、プール、およびコンポーネントに関する情報を収集する必要があります。
  
> [!IMPORTANT]
> 既定では、AlwaysOn シナリオは展開内で実行されません。 このシナリオは明示的に開始する必要があります。 開始したシナリオは明示的に停止されるまで実行され、実行状態はコンピューターを再起動しても保持されます。 開始と停止のシナリオの詳細についてを参照してください[を起動または Skype のビジネス サーバー 2015 の CLS のログをキャプチャを停止する](start-or-stop-log-capture.md)です。 
  
問題が発生した場合は、報告された問題に関連する 2 つ目のシナリオを開始します。問題を再現し、2 つ目のシナリオのログ記録を停止します。報告された問題に関連するログの検索を開始します。集計されたログのコレクションによって、展開のサイト スコープまたはグローバル スコープ内のすべてのコンピューターからのトレース メッセージを含むログ ファイルが生成されます。分析可能なデータ以上のデータが検索から返された場合は (通常、信号対ノイズ比とも呼ばれ、この場合はノイズが多すぎる状態です)、パラメーターを絞り込んで別の検索を実行します。この時点で、問題を明確にするために役立つパターンの特定を開始できます。最終的には、いくつかの絞り込み検索を実行した後で問題に関連するデータが見つかり、根本原因を特定できます。
  
> [!TIP]
> ビジネス サーバーの Skype での問題のシナリオでが表示されたら、まず自分で「は既にについて何を理解の問題ですか?」 問題の境界を定量化する場合は、ビジネス サーバーの Skype での運用上のエンティティの大きな部分を除外できます。 
  
ユーザーが連絡先を検索するときに現在の結果を取得していないことがわかっているシナリオ例を検討します。 探しているメディア コンポーネント、エンタープライズ VoIP、会議、およびいくつかの他のコンポーネントでの問題はありません。 実際はどこに問題が存在するのか (クライアントなのか、サーバー側の問題なのか) がわからないためです。 連絡先はユーザー レプリケーターによって Active Directory から収集し、(ABServer) のアドレス帳サーバーを経由してクライアントに配信します。 ABServer では、(、ユーザー レプリケーターが書き込んだもの) RTC データベースからの更新を取得し、デフォルトの 1時 30分 AM でアドレス帳ファイルでは、それらを集めています。 Business Server クライアントの Skype では、ランダム化されたスケジュールに基づいて新しいアドレス帳を取得します。 ABServer のないを取得して、アドレス帳ファイル、またはクライアントを作成する場合、ユーザー レプリケーターによって Active Directory から収集されるデータに関連する問題を検索する原因になる可能性を減らすことができますプロセスのしくみを理解するためアドレス帳ファイルをダウンロードしています。
  
## <a name="current-configuration"></a>現在の構成

ログ サービスを定義する一元的なログ サービスが構成されている収集、それを収集する方法、場所を収集するのに、およびログの設定とは何を目的としています。 これらの設定は、グローバル (展開全体) またはサイト (展開内で指定されたサイト) に対して定義します。 定義するすべてのログで、ログを開始、停止、更新、および検索するコマンドに対して使用する ID に適した設定が使用されます。
  
### <a name="to-display-the-current-centralized-logging-service-configuration"></a>現在のログ サービスの一元的な構成を表示するには

1. Skype for Business Server 管理シェルを以下の手順で起動します。[**スタート**]、[**すべてのプログラム**]、[**Skype for Business 2015**]、[**Skype for Business Server 管理シェル**] の順にクリックします。
    
2. コマンド ライン プロンプトで、次のように入力します。
    
  ```
  Get-CsClsConfiguration
  ```

    > [!TIP]
    > 絞り込むかを定義することによって返される構成設定の適用範囲を広げて`-Identity`し、スコープは、「サイト: レドモンド」レドモンド サイトの CsClsConfiguration のみを取得するなど。 構成の指定された部分の詳細を設定する場合は、別の Windows PowerShell コマンドレットに出力をパイプできます。 たとえば、"Redmond" サイトの構成で定義されたシナリオに関する詳細を取得するには、「`Get-CsClsConfiguration -Identity "site:Redmond" | Select-Object -ExpandProperty Scenarios`」と入力します。
  
     ![Get-CsClsConfiguration からのサンプル出力](../../media/Ops_Get-CsClsConfiguration_Basic.jpg)
  
    コマンドレットの結果は、集中ログ サービスの現在の構成を表示します。
    
|**構成の設定**|**説明**|
|:-----|:-----|
|**Identity** <br/> |この構成のスコープと名前を識別します。存在するグローバル構成は 1 つのみで、サイトごとに 1 つの構成があります。  <br/> |
|**Scenarios** <br/> |この構成に対して定義されたシナリオの一覧。  <br/> |
|**SearchTerms** <br/> |構成の定義済み検索用語。 Office 365 では、設置型展開ではありません。  <br/> |
|**SecurityGroups** <br/> |コンピューターを確認できるユーザー (つまり、セキュリティ グループのメンバー) を、そのユーザーのサイトに基づいて制御する定義済みセキュリティ グループ。 サイトは、このコンテキストでは、トポロジ ビルダーで定義されているサイトです。  <br/> |
|**Regions** <br/> |SecurityGroups を地域にまとめる際に定義済み地域が使用されます。  <br/> |
|**EtlFileRolloverSizeMB** <br/> |パラメーターは、新しいイベント トレース ログ (.etl) ファイルが作成される前のログ ファイルの最大サイズを示します。定義したサイズに達すると、EtlFileRolloverMinutes で設定された最大時間に達していなくても、新しいログ ファイルが作成されます。  <br/> |
|**EtlFileRolloverMinutes** <br/> |新しい .etl ファイルが作成されるまでのログの定義済み最大経過時間 (分単位)。指定した時間が過ぎると、EtlFileRolloverSizeMBE で設定された最大サイズに達していなくても、新しいログ ファイルが作成されます。  <br/> |
|**TmfFileSearchPath** <br/> |トレース メッセージ形式のファイルを検索する場所。  <br/> |
|**CacheFileLocalFolders** <br/> |キャッシュ ファイルが書き込まれるコンピューター上の場所への定義済みパス。CLSAgent はキャッシュ ファイルを書き込み、ネットワーク サービスとの関連で実行されます。この場合は、%TEMP% が %WINDIR%\ServiceProfiles\NetworkService\AppData\Local に展開されます。既定では、キャッシュ ファイルとログ ファイルは同じディレクトリに書き込まれます。  <br/> |
|**CacheFileNetworkFolder** <br/> |汎用名前付け規則 (UNC) パスを定義すると、ログ操作中にキャッシュ ファイルを受け取ることができます。  <br/> |
|**CacheFileLocalRetentionPeriod** <br/> |キャッシュ ファイルが保持される最大時間 (日単位) として定義されます。  <br/> |
|**CacheFileMaxDiskUsage** <br/> |キャッシュ ファイルで使用できるディスク容量の割合として定義されます。  <br/> |
|**ComponentThrottleLimit** <br/> |自動調整制限がトリガーされるまでの、コンポーネントが生成できる秒あたりの最大トレース数として定義されます。  <br/> |
|**ComponentThrottleSample** <br/> |ComponentThrottleLimit を超えることができる 60 秒単位の回数。  <br/> |
|**MinimumClsAgentServiceVersion** <br/> |実行が許可されている CLSAgent の最小バージョン。 この要素は、Office 365 の対象としています。  <br/> |
   

