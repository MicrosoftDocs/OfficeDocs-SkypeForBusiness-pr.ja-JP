---
title: 電話会議、アプリケーション、および仲介サーバーのポート範囲とサービス品質ポリシーを構成する
ms.reviewer: ''
ms:assetid: 4d6eaa5d-0127-453f-be6a-e55384772d83
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ204872(v=OCS.15)
ms:contentKeyID: 48184074
mtps_version: v=OCS.15
ms.author: v-lanac
author: lanachin
manager: serdars
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
description: この記事では、会議、アプリケーション、および仲介サーバーのポート範囲とサービス品質ポリシーを構成する方法について説明します。
ms.openlocfilehash: 76373407a8087e3646668d7ce9952c83c500af97
ms.sourcegitcommit: e64c50818cac37f3d6f0f96d0d4ff0f4bba24aef
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2020
ms.locfileid: "41817446"
---
# <a name="configuring-port-ranges-and-a-quality-of-service-policy-for-your-conferencing-application-and-mediation-servers"></a>電話会議、アプリケーション、および仲介サーバーのポート範囲とサービス品質ポリシーを構成する

この記事では、会議、アプリケーション、および仲介サーバーのポート範囲とサービス品質ポリシーを構成する方法について説明します。

## <a name="configure-port-ranges"></a>ポート範囲を構成する

サービスの品質を実装するには、会議、アプリケーション、および仲介サーバー上で音声、ビデオ、およびアプリケーション共有用に同一のポート範囲を構成する必要があります。さらに、これらのポート範囲は、何らかの方法でオーバーラップすることはできません。 簡単な例を使用するには、電話会議サーバー上のビデオに 1万 ~ 10999 のポートを使用しているとします。 つまり、アプリケーションや仲介サーバー上のビデオ用に、1万 ~ 10999 のポートを予約する必要があります。 そうしないと、QoS は期待どおりに動作しません。

同様に、1万 ~ 10999 のビデオ用にポートを予約していて、オーディオ用にポート10500から11999を予約したとします。 これにより、ポートの範囲が重複するため、サービスの品質に関する問題が発生する可能性があります。 QoS では、各モダリティには固有のポートのセットが必要です。ビデオ用に 1万 ~ 10999 のポートを使用している場合は、別の範囲を使用する必要があります (たとえば、11000 ~ 11999、オーディオ用)。

既定では、Skype for Business Server では、オーディオポートとビデオポートの範囲は重複していません。ただし、アプリケーション共有に割り当てられているポート範囲は、オーディオポート範囲とビデオポート範囲の両方と重複しています。 (これにより、これらの範囲のいずれも一意ではないことを意味します)。Skype for Business Server 管理シェルで次の3つのコマンドを実行して、会議、アプリケーション、および仲介サーバーの既存のポート範囲を確認できます。

    Get-CsService -ConferencingServer | Select-Object Identity, AudioPortStart, AudioPortCount, VideoPortStart, VideoPortCount, AppSharingPortStart, AppSharingPortCount
    
    Get-CsService -ApplicationServer | Select-Object Identity, AudioPortStart, AudioPortCount
    
    Get-CsService -MediationServer | Select-Object Identity, AudioPortStart, AudioPortCount

> [!WARNING]  
> 上に示したように、各ポートの種類 (オーディオ、ビデオ、およびアプリケーションの共有) には、ポートの開始とポート数という2つの個別のプロパティ値が割り当てられています。 ポート start は、そのモダリティで使用される最初のポートを示します。たとえば、オーディオポートの start が5万に等しい場合、オーディオトラフィックに使われる最初のポートがポート5万であることを意味します。 オーディオポート数が 2 (有効な値ではありませんが、ここでは説明のために使用されています) の場合、オーディオには2つのポートのみが割り当てられていることを意味します。 第1のポートがポート5万であり、合計2つのポートがある場合は、2番目のポートがポート 50001 (ポート範囲は連続している必要があります) であることを意味します。 その結果、オーディオのポート範囲は、5万 ~ 50001 のポートになります。<BR><br>また、アプリケーションサーバーと仲介サーバーは、オーディオの場合にのみ QoS をサポートしていることに注意してください。アプリケーションサーバーまたは仲介サーバーで、ビデオまたはアプリケーションの共有ポートを変更する必要はありません。

上記の3つのコマンドを実行すると、Skype for Business Server の既定のポートの値が次のように構成されていることがわかります。

<table>
<colgroup>
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
<col style="width: 25%" />
</colgroup>
<thead>
<tr class="header">
<th>プロパティ</th>
<th>会議サーバー</th>
<th>アプリケーションサーバー</th>
<th>仲介サーバー</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>AudioPortStart</p></td>
<td><p>49152</p></td>
<td><p>49152</p></td>
<td><p>49152</p></td>
</tr>
<tr class="even">
<td><p>AudioPortCount</p></td>
<td><p>8348</p></td>
<td><p>8348</p></td>
<td><p>8348</p></td>
</tr>
<tr class="odd">
<td><p>VideoPortStart</p></td>
<td><p>57501</p></td>
<td><p>--</p></td>
<td><p>--</p></td>
</tr>
<tr class="even">
<td><p>VideoPortCount</p></td>
<td><p>8034</p></td>
<td><p>--</p></td>
<td><p>--</p></td>
</tr>
<tr class="odd">
<td><p>ApplicationSharingPortStart</p></td>
<td><p>49152</p></td>
<td><p>--</p></td>
<td><p>--</p></td>
</tr>
<tr class="even">
<td><p>ApplicationSharingPortCount</p></td>
<td><p>16383</p></td>
<td><p>--</p></td>
<td><p>--</p></td>
</tr>
</tbody>
</table>

前に説明したように、QoS のために Skype for Business Server ポートを構成する場合は、お客様の会議、アプリケーション、および仲介サーバーで、オーディオポートの設定が同じであることを確認する必要があります。and、2) ポート範囲は重なりません。 上記の表をよく見ると、3種類のサーバー間でポート範囲が同じであることがわかります。 たとえば、[開始オーディオ] ポートは各サーバーの種類で [port 49152] に設定されています。また、各サーバーのオーディオ用に予約されているポートの合計数も8348と同じです。 ただし、ポートの範囲が重複しています。オーディオポートはポート49152から始まりますが、アプリケーション共有用にポートが設定されています。 サービスの品質を最大限に活用するために、固有のポート範囲を使用するようにアプリケーション共有を再構成する必要があります。 たとえば、ポート40803で開始するようにアプリケーション共有を構成し、8348ポートを使用することができます。 (8348 ポートの理由 これらの値を一緒に追加した場合は 8348 40803、アプリケーションの共有でポート40803からポート49150が使用されることを意味します。 オーディオポートはポート49152まで開始されないため、重複するポート範囲はなくなります。)

アプリケーション共有用の新しいポート範囲を選んだら、CsConferencingServer コマンドレットを使用して変更を行うことができます。 この変更は、アプリケーションサーバーまたは仲介サーバーで行う必要はありません。これらのサーバーは、アプリケーション共有トラフィックを処理しないためです。 オーディオトラフィック用に使用されているポートを再割り当てする場合は、これらのサーバーでポートの値を変更する必要があります。

単一の会議サーバーでのアプリケーション共有のポート値を変更するには、Skype for Business Server 管理シェルで次のようなコマンドを実行します。

    Set-CsConferenceServer -Identity ConferencingServer:atl-cs-001.litwareinc.com -AppSharingPortStart 40803 -AppSharingPortCount 8348

このような変更をすべての会議サーバーで行う場合は、代わりに次のコマンドを実行します。

    Get-CsService -ConferencingServer | ForEach-Object {Set-CsConferenceServer -Identity $_.Identity -AppSharingPortStart 40803 -AppSharingPortCount 8348}

ポート設定を変更した後で、変更の影響を受ける各サービスを停止してから再起動する必要があります。

会議サーバー、アプリケーションサーバー、および仲介サーバーがまったく同じポート範囲を共有していることは必須ではありません。唯一の条件として、すべてのサーバーで固有のポート範囲を確保する必要があります。 ただし、すべてのサーバーで同じポートセットを使用すると、通常、管理が簡単になります。

## <a name="configure-a-quality-of-service-policy-in-skype-for-business-server-for-your-conferencing-application-and-mediation-servers"></a>会議、アプリケーション、および仲介サーバー用の Skype for Business Server のサービス品質ポリシーを構成する

ポート範囲を構成すると、指定した種類のすべてのトラフィック (たとえば、すべての音声トラフィック) が同じポートセットを通過するようにすることで、サービスの品質を活用できます。 これにより、特定のパケットをシステムで識別してマークすることが簡単になります。ポート49152が音声トラフィック用に予約されている場合は、ポート49152経由で移動したパケットは、オーディオパケットであることを示す DSCP コードでマークできます。 これにより、ルーターは、パケットをオーディオパケットとして識別し、マークされていないパケット (あるサーバーから別のサーバーにファイルをコピーするために使用されるパケットなど) よりも高い優先順位を与えることができます。

ただし、ポートのセットを特定の種類のトラフィックに制限するだけでは、適切な DSCP コードでマークされているポートを経由してパケットが移動されることはありません。 ポート範囲の定義に加えて、各ポート範囲に関連付ける DSCP コードを指定するサービス品質ポリシーも作成する必要があります。 Skype for Business Server の場合、通常は、オーディオ用とビデオ用の2つのポリシーを作成することになります。

サービス品質ポリシーは、グループポリシーを使って、最も簡単に作成、管理できます。 (これらのポリシーは、ローカルセキュリティポリシーを使用して作成することもできます。 ただし、そのためには、すべてのコンピューターで同じ手順を繰り返す必要があります。)最初の QoS ポリシーのセット (1 つはオーディオ用と1つ) を、会議サーバー、アプリケーションサーバー、または仲介サーバーサービスを実行している Skype for Business Server コンピューターにのみ適用する必要があります。 これらのすべてのコンピューターが同じ Active Directory OU に配置されている場合は、その OU に新しいグループポリシーオブジェクト (GPO) を割り当てるだけで済みます。 または、別の手順を実行して、指定したコンピューターに新しいポリシーを作成することもできます。たとえば、セキュリティグループに適切なコンピューターを配置し、グループポリシーセキュリティフィルターを使用して、そのセキュリティグループだけに GPO を適用することができます。

音声を管理するためのサービス品質ポリシーを作成するには、グループポリシー管理がインストールされているコンピューターにログオンします。 [グループポリシーの管理] を開き ([**スタート**] をクリックし、[**管理ツール**] をポイントして、[**グループポリシーの管理**] をクリックし)、次の手順を実行します。

1.  [グループポリシーの管理] で、新しいポリシーを作成するコンテナーを見つけます。 たとえば、すべての Skype for Business Server コンピューターが Skype for Business Server という名前の OU にある場合、新しいポリシーは Skype for Business Server OU で作成する必要があります。

2.  適切なコンテナーを右クリックし、[**このドメインに GPO を作成**] をクリックして、ここにリンクを設定します。

3.  [**新しい GPO** ] ダイアログボックスで、[**名前**] ボックスに新しいグループポリシーオブジェクトの名前を入力し (たとえば、 **Skype for business Server QoS**)、[ **OK]** をクリックします。

4.  新しく作成したポリシーを右クリックし、[**編集**] をクリックします。

5.  グループポリシー管理エディターで、[**コンピューターの構成**]、[**ポリシー**]、[ **Windows 設定**] の順に展開し、[**ポリシーベースの QoS**] を右クリックして、[**新しいポリシーの作成**] をクリックします。

6.  [**ポリシーベースの QoS** ] ダイアログボックスの [開く] ページで、[**名前**] ボックスに新しいポリシーの名前 (例: **Skype for business Server QoS**) を入力します。 [ **DSCP 値の指定**] を選択し、値を**46**に設定します。 [**送信スロットルの比率を指定する**] をオフにして、[**次へ**] をクリックします。

7.  次のページで、[すべての**アプリケーション**] が選択されていることを確認し、[**次へ**] をクリックします。 これにより、すべてのアプリケーションが指定のポート範囲のパケットを指定した DSCP コードに一致させるだけです。

8.  3番目のページで、[**ソース ip アドレス] と [宛先 ip アドレス**] の両方が選択されていることを確認し、[**次へ**] をクリックします。 この2つの設定では、どのコンピューター (IP アドレス) がそれらのパケットを送信したか、どのコンピューター (IP アドレス) がそれらのパケットを受信するかに関係なく、パケットが管理されるようにします。

9.  4ページ目で、[**この QoS ポリシーが適用されるプロトコルを選択**してください] ドロップダウンリストから [ **TCP および UDP** ] を選びます。 TCP (伝送制御プロトコル) と UDP (ユーザーデータグラムプロトコル) は、Skype for Business Server およびそのクライアントアプリケーションで最も一般的に使用される2つのネットワークプロトコルです。

10. 見出しの下で、**ソースポート番号を指定**して、[**このソースポートまたは範囲から**] を選択します。 [付随するテキスト] ボックスに、オーディオ送信用に予約されているポート範囲を入力します。 たとえば、ポート49152からオーディオトラフィック用にポート57500を予約した場合は、「 **49152:57500**」の形式でポート範囲を入力します。 [**完了**] をクリックします。

> [!NOTE]  
> 46の DSCP 値は、何らかの方法で行うことができます。 DSCP 46 はオーディオパケットをマークするために使われることが多いのですが、オーディオ通信には DSCP 46 を使う必要はありません。 既に QoS を実装していて、オーディオ用に別の DSCP コード (たとえば、DSCP 40) を使用している場合は、その同じコードを使用するようにサービスの品質ポリシーを構成する必要があります (例:40 for audio)。 現在、サービスの品質を実装している場合は、その値が一般的にオーディオパケットをマークするために使用されるため、オーディオには DSCP 46 を使うことをお勧めします。

オーディオトラフィックの QoS ポリシーを作成した後、ビデオトラフィック用の第2のポリシーを作成します (必要に応じて、アプリケーション共有トラフィックを管理するための第3のポリシーを作成する必要があります)。 ビデオのポリシーを作成するには、オーディオポリシーを作成する場合と同じ基本的な手順に従い、次のように置き換えます。

  - 別の (一意の) ポリシー名 (「 **Skype For Business Server のビデオ**」など) を使用します。

  - DSCP 値を46ではなく、 **34**に設定します。 (DSCP 値34は使う必要がないことに注意してください。 唯一の要件は、オーディオに使用したものとは異なる DSCP 値をビデオに使用することです。

  - 以前に構成されたポート範囲をビデオトラフィックに使用します。 たとえば、ビデオ用にポート 57501 ~ 65535 を予約している場合は、ポート範囲を次のよう**57501:65535**に設定します。

アプリケーション共有トラフィックを管理するためのポリシーを作成する場合は、3番目のポリシーを作成し、次のように置き換えます。

  - 別の (一意の) ポリシー名 (「 **Skype For Business Server アプリケーション共有**」など) を使用します。

  - DSCP 値を46の代わりに**24**に設定します。 (この場合も、DSCP 値24を使用する必要はありません)。 唯一の要件として、アプリケーション共有には、オーディオまたはビデオに使用したのとは異なる DSCP 値を使用します。

  - 以前に構成されたポート範囲をビデオトラフィックに使用します。 たとえば、アプリケーション共有用にポート 40803 ~ 49151 を予約している場合は、ポート範囲を " **40803:49151**" に設定します。

作成した新しいポリシーは、Skype for Business Server コンピューターのグループポリシーが更新されるまで有効になりません。 グループ ポリシーは定期的に自動更新されますが、グループ ポリシーを更新する必要がある各コンピューター上で次のコマンドを実行すると、即座に強制的に更新することができます。

    Gpupdate.exe /force

このコマンドは、Skype for Business Server 管理シェルから、または管理者の資格情報で実行されているコマンドウィンドウから実行できます。 管理者の資格情報のもとでコマンド ウィンドウを開くには、[**スタート**] メニューをクリックし、[**コマンド プロンプト**] を右クリックして、[**管理者として実行**] をクリックします。

新しい QoS ポリシーが適用されていることを確認するには、次の操作を行います。

1.  Skype for Business Server コンピューターで、[**スタート**] をクリックし、[**実行**] をクリックします。

2.  [**実行**] ダイアログボックスで、「 **regedit**」と入力し、enter キーを押します。

3.  レジストリエディターで、[**コンピューター**] を展開し、[ **\_HKEY ローカル\_コンピューター**]、[**ソフトウェア**]、[**ポリシー**]、[ **Microsoft**]、[ **Windows**]、[ **QoS**] の順に展開します。 [ **Qos** ] の下に、作成した各 qos ポリシーのレジストリキーが表示されます。 たとえば、2つの新しいポリシー (Skype for Business Server Audio QoS およびその他の Skype for business Server ビデオ QoS という名前) を作成した場合は、Skype for Business Server Audio QoS および Skype for Business server Video qos のレジストリエントリが表示されます。

ネットワークパケットが適切な DSCP 値でマークされていることを確認するには、次の手順に従って、各コンピューターに新しいレジストリエントリを作成する必要もあります。

1.  [**スタート**] ボタンをクリックし、[**ファイル名を指定して実行**] をクリックします。

2.  [**実行**] ダイアログボックスで、「 **regedit**」と入力し、enter キーを押します。

3.  レジストリエディターで、[ **\_HKEY ローカル\_コンピューター**]、[**システム**]、[ **CurrentControlSet**] の順に展開し、[**サービス**] を展開して、[ **Tcpip**] を展開します。

4.  [ **Tcpip**] を右クリックし、[**新規作成**] をポイントして、[**キー**] をクリックします。 新しいレジストリキーが作成されたら、「 **QoS**」と入力し、enter キーを押してキーの名前を変更します。

5.  [ **QoS**] を右クリックし、[**新規作成**] をポイントして、[**文字列値**] をクリックします。 新しいレジストリ値が作成されたら、[ **NLA を使用しない**] と入力し、enter キーを押して値の名前を変更します。

6.  [ **NLA を使わない**] をダブルクリックします。 [**文字列の編集**] ダイアログボックスで、[**値のデータ**] ボックスに「 **1** 」と入力して、[ **OK**] をクリックします。

7.  レジストリエディターを終了し、コンピューターを再起動します。
