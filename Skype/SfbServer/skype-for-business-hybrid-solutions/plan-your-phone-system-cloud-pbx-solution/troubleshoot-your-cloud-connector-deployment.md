---
title: Cloud Connector 展開をトラブルシューティングする
ms.reviewer: ''
ms.author: crowe
author: CarolynRowe
manager: serdars
ms.date: 12/5/2017
ms.audience: ITPro
ms.topic: conceptual
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection:
- Strat_SB_Hybrid
ms.custom: ''
ms.assetid: e6cf58cc-dbd9-4f35-a51a-3e2fea71b5a5
description: コネクタ Edition のクラウド展開のトラブルシューティングを行います。
ms.openlocfilehash: b9ade46f46898d22bab862c3044e045de441b007
ms.sourcegitcommit: b2acf18ba6487154ebb4ee46938e96dc56cb2c9a
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/09/2019
ms.locfileid: "33864919"
---
# <a name="troubleshoot-your-cloud-connector-deployment"></a>Cloud Connector 展開をトラブルシューティングする
 
コネクタ Edition のクラウド展開のトラブルシューティングを行います。
  
このトピックでは、Cloud Connector Edition の展開に関する一般的な問題の解決策について説明します。公衆交換電話網 (PSTN) による通話で問題が発生する場合は、このトピックで説明する手順に従って調査することができます。
  
クラウドのコネクタは、自動的にいくつかの問題を解決するための組み込みのメカニズムを提供します。 自動検出プロセスでは、クラウド コネクタ アプライアンスでは、潜在的な問題を探し、管理者の介入を必要とせず、それらの問題を解決するための是正措置は、可能であれば、です。 検出プロセスは次のように機能します。
  
- **検出シーケンス:** コネクタの管理をクラウド サービスでは、60 秒ごとに、アプライアンスがダウンするかどうかを検出するため、処理を実行します。 クラウド コネクタ バージョン 2.0 以降では、検出プロセスで、Skype のビジネスの社内ネットワークのスイッチの PowerShell へ接続するコネクタのクラウドのマシンです。2.0 より前のバージョンでは、検出プロセスは、クラウドのコネクタの管理スイッチを使用します。
    
    > [!NOTE]
    > 成功させるため、自動回復の必要があります、ホストと仮想マシン間のネットワーク接続ホストのネットワーク ・ スイッチ経由で。 自動検出されることを確認するのにはネットワーク接続を確認することを確認して、回復を成功させるためです。 
  
- **の監視:** クラウド コネクタ バージョン 2.0 以降では、次のサービスを監視します。
    
  - クラウド コネクタ企業またはインターネットの仮想スイッチには、仮想マシンは接続されていません。
    
  - 仮想マシンが保存されているか停止している状態では
    
  - 中央管理サーバーのサービス: レプリカ、マスター
    
  - 仲介サーバー サービス: レプリカ、RTCSRV と MEDSVC
    
  - エッジ サーバー サービス: レプリカ、RTCSRV、RTCDATAPROXY、RTCMRAUTH、RTCMEDIARELAY
    
  - エッジ サーバーでは、仲介サーバー上の CS RTCMEDSRV CS RTCSRV のルールが無効になってファイアウォールを受信します。
    
    クラウド コネクタ バージョン 1.4.2 では、次のサービスのみが監視されます。
    
  - 仲介サーバー サービス: RTCSRV と MEDSVC
    
  - エッジ サーバー サービス: RTCSRV
    
- **リカバリ ・ プロセス:** 監視対象サービスが停止した場合、アプライアンスが値下げを実行し、サービスが停止され、すべての問題を解決するまでに手動でマークを実行します。 これにより、呼び出しの失敗の原因となるアプライアンスへのルーティングからの呼び出しができなくなります。
    
    コネクタの管理をクラウド サービスとして次のように自動回復を再試行します。
    
  - 最初の再試行の間隔は、10 秒ごとに 1 時間の間隔の最大時間です。
    
  - 最初の 3 つの回復の試行間隔の時間は 10 秒です。 前の間隔の時間の 2 倍、4 つ目の再試行の開始、間隔の時間が増加します。 やなどの 4 つ目の再試行は 40 秒、5 分、20 秒間で発生するように。 
    
  - 1 時間の間隔を最大に達すると、1 時間あたり 1 回の再試行が続行されます。
    
  - 回復が成功した場合は、間隔、再試行カウントの初期値に設定されています。
    
  - 管理サービスを再起動すると、間隔、再試行カウントの初期値にリセットされます。
    
## <a name="troubleshooting"></a>トラブルシューティング

一般的に見られる問題の解決方法を次に示します。
  
- **問題: 展開スクリプトを実行すると、展開が失敗するか、応答しなくなる。各 VM にログインすると、管理/内部/外部 NIC の IP アドレスがないか、正しくない。**
    
    **の解像度:** 自動的にこの問題を解決することはできません。 実行中の Vm に Nic を追加できません。 シャット ダウンとハイパー v マネージャーでは、これらの Vm を削除、次のコマンドレットを実行してください。
    
  ```
  Uninstall-CcAppliance
  ```

  ```
  Install-CcAppliance
  ```

- 
    
    **問題: Active Directory とフォレストをインストールした後、CMS サーバーや仲介サーバーがドメインに正しく参加しない。**
    
    **解決策:** この問題を解決するには、次の手順を実行します。
    
  - Active Directory サーバーにログオンし、ドメインが正しく作成されていることを確認します。
    
  - CMS/仲介サーバーにログオンし、Corpnet NIC で有効な IP アドレスが割り当てられていることと、AD サーバーの IP アドレスとして有効な固定 IP アドレスと DNS が構成されていることを確認します。
    
  - CMS/仲介サーバーにログオンし、コマンド プロンプトを開きます。 Active Directory サーバーの FQDN と IP アドレスに対して ping を実行できることを確かめます。 実行できない場合は、IP アドレスの競合が考えられます。 Active Directory に新しい IP を割り当てて、CMS/仲介サーバーで DNS を更新することを試してください。
    
- **問題: 次のエラー メッセージを受信する"削除 VMSwitch: 仮想のイーサネット スイッチを削除中に失敗しました。'クラウド コネクタ管理スイッチ' 仮想スイッチの仮想マシンを実行することによって使用されているために、削除またはできない子のプールに割り当てられている。」**
    
    **の解像度:**「クラウド コネクタ管理スイッチ」は、配置後に削除されませんでした。 このエラーをヒットした場合は、hyper-v マネージャーにしてくださいがあることを確認してそれに接続されている仮想マシンがまだします。 まだ接続されている仮想マシンがある場合は、接続を切断し、管理スイッチを削除します。 管理スイッチも削除できない場合、ホスト サーバーを再起動してからやり直してください。
    
- **問題: 次のエラー メッセージを受信する、"サービス RTCMRAUTH は、開始に失敗しました。確認して、サービスが無効になっていないかどうかを確認してください。**
    
    > [!NOTE]
    > この問題にのみ適用されますクラウド コネクタ バージョン 1.4.2 より前です。 
  
    開始できない原因としては、このフロントエンド サーバーが (コンピューターのフェイルオーバーを使用して) 以前も失敗してやり直したことも考えられます。その場合は、(コンピューターのフェールバックアップを使用して) フェールバックを呼び出してください。
    
    **解決策:** この問題は、ルート CA 証明書または中間 CA 証明書がエッジ サーバーで信頼されていない場合に、エッジ サーバーで発生します。外部証明書をインポートできるとしても、証明書チェーンが破損しています。この状況では、RTCMRAUTH か RTCSRV、またはその両方のサービスが開始できません。
    
    ルート CA 証明書と、外部証明書の中間 CA 証明書をすべて手動でエッジ サーバーにをインポートしてから、エッジ サーバーを再起動します。エッジ サーバーで RTCMRAUTH サービスと RTCSRV サービスが開始したことを確認したら、ホスト サーバーに戻り、管理者として PowerShell コンソールを起動し、次のコマンドレットを実行して新しい展開に切り替えます。
    
  ```
  Switch-CcVersion
  ```

- 
    
    **問題: Windows Update の適用中にホスト サーバーが再起動され、サーバーによる呼び出しに失敗する。**
    
    **解決策:** 高可用性環境を展開した場合は、Windows Update を手動で確認およびインストールするときに、1 台のホスト マシン (展開インスタンス) を現在のトポロジに移動するか、またはそこから移動するのに役立つコマンドレットが用意されています。これを行うには、次の手順を実行します。
    
1. ホスト サーバーで、管理者として PowerShell コンソールを起動して、次を実行します。
    
   ```
   Enter-CcUpdate
   ```

2. 利用可能な更新をチェックしてインストールします。
    
3. PowerShell コンソールで、次のコマンドレットを実行します。
    
   ```
   Exit-CcUpdate
   ```

- 
    
    **問題: PSTN 番号を使って Skype for Business クライアントから通話を発信するとき、別の PSTN 番号を招待することで電話会議に通話をエスカレートできない。**
    
    **の解像度:** この問題を解決するのには、[オンライン ハイブリッド仲介サーバーの設定を構成する](configure-cloud-connector-integration-with-your-office-365-tenant.md#BKMK_ConfigureMediationServer)を参照してください。
    
- **問題: Active Directory サーバーのインストール中に、「Windows 自動更新が有効になっていません。新しくインストールした役割または機能が自動的に更新されるようにするには、[Windows Update] を有効にしてください」という Windows Update に関する警告メッセージが表示される。**
    
    **の解像度:** テナント管理者の資格情報をビジネスの Skype を使用してテナントのリモート PowerShell セッションを起動し、サイトの_EnableAutoUpdate_構成を確認するのには、次のコマンドレットを実行します。
    
  ```
  Get-CsHybridPSTNSite
  ```

    _EnableAutoUpdate_が**True**に設定されている場合をダウンロードして仮想マシンとホスト サーバーの両方の Windows の更新プログラムをインストールする CCEManagement サービスを処理するため、この警告メッセージ安全に無視できます。 _EnableAutoUpdate_は、 **False**に設定されている場合は、次のコマンドレットを**True**に設定する実行します。
    
  ```
  Set-CsHybridPSTNSite -EnableAutoUpdate $true
  ```

    または、更新プログラムを手動で確認してインストールすることができます。 次のセクションを参照してください。
    
- **問題: エラー メッセージが表示する: ために、アプライアンスを登録できません、現在の入力と構成\<サイト名\>または\<アプライアンス名\>または\<仲介サーバーの FQDN\>または\<仲介サーバーの IP アドレス\>既存のアプライアンスと競合しています。競合アプライアンスを削除し、入力と構成情報を更新または再登録します。' をオンラインの現在のアプライアンスを登録するのにはレジスタの CcAppliance を実行するとします。**
    
    **の解像度:** 値は、\<アプライアンス名\>、 \<、仲介サーバーの FQDN\>と\<仲介サーバーの IP アドレス\>1 つのアプライアンスの登録に使用される一意とする必要があります。 既定では、\<アプライアンス名\>ホスト名に由来します。 \<仲介サーバーの FQDN\>と\<、仲介サーバーの IP アドレス\>構成の ini ファイルで定義されています。
    
    たとえば、(ApplianceName= MyserverNew, Mediation Server FQDN=ms.contoso.com, Mediation Server IP Address=10.10.10.10) を使用して SiteName=MySite に登録しても、登録済みアプライアンス (ApplianceName= Myserver, Mediation Server FQDN=ms.contoso.com, Mediation Server IP Address=10.10.10.10) があると、競合が発生します。
    
    まず、ApplianceRoot ディレクトリ セクションで CloudConnector.ini ファイルを確認します。 表示されます\<サイト名\>、 \<、仲介サーバーの FQDN\>と\<、仲介サーバーの IP アドレス\>ファイル内の値です。 \<アプライアンス名\>は、ホスト サーバーの名前です。
    
    次に、起動テナント リモート PowerShell、Skype を使用してテナント管理者の資格情報をビジネスには、登録されているアプライアンスを確認するのには次のコマンドレットを実行してください。
    
  ```
  Get-CsHybridPSTNAppliance
  ```

    競合を特定したら、登録済みアプライアンスと一致する情報を CloudConnector.ini ファイルで更新するか、既存のアプライアンスを登録解除して、競合を解決します。
    
  ```
  Unregister-CsHybridPSTNAppliance -Force
  ```

    
- **問題: Get CcRunningVersion コマンドレットは、ホストで実行されている展開済みのアプライアンスがある場合に空の値を返します。**
    
  **の解像度:** 1.3.4 または 1.3.8 に 1.4.1 からアップグレードする場合に、発生することができます。 実行する必要があります、.msi を持つバージョン 1.4.1 をインストールした後`Register-CcAppliance`その他のすべてのコマンドレットを実行する前にします。 `Register-CcAppliance`%programdata%\cloudconnector に %UserProfile%\CloudConnector から module.ini ファイルを移行します。 その場合は、新しい module.ini は %ProgramData%\CloudConnector フォルダーに作成され、1.3.4 または 1.3.8 の実行中またはバックアップのバージョン情報を置き換えます。
    
  %UserProfile%\CloudConnector と %ProgramData%\CloudConnector フォルダーにある module.ini ファイルを比較します。 Module.ini ファイルに %ProgramData%\CloudConnector し、再実行を削除の違いがある場合は、 `Register-CcAppliance`。 正しい実行し、バックアップ ・ バージョンを手動でファイルを変更することも可能性があります。
    
- **問題: 現在のスクリプト ・ バージョンとは別の古いバージョンに切り替えるには、スイッチ CcVersion コマンドレットを実行した後はありませんこの古いバージョンの高可用性のサポート。**
    
    **の解像度:** たとえば、1.4.2 に 1.4.1 からアップグレードされました。 現在スクリプトのバージョンを実行することによって判断できます`Get-CcVersion`、および、実行中のバージョンを実行することによって判断できます`Get-CcRunningVersion`は、両方の 1.4.2。 実行する場合、この時点で`Switch-CcVersion`実行中のバージョンに戻るに 1.4.1、しなければこの古いバージョンの高可用性のサポート。
    
    高可用性を完全にサポートするには、1.4.2 に切り替えて、実行中のバージョンとスクリプト バージョンが同じになるようにします。1.4.2 展開で問題が発生している場合は、できるだけ早くアンインストールして、再インストールしてください。
    
- **問題: 証明機関の証明書、または中央管理ストア、仲介サーバー、エッジ サーバーに対して発行された内部証明書の有効期限が近づいているか、侵害された。**
    
    **解決策:** Skype for Business 証明機関の証明書は 5 年間有効です。中央管理ストア、仲介サーバー、エッジ サーバーに対して発行された内部証明書は 2 年間有効です。
    
    > [!NOTE]
    > クラウド バージョン 2.0 以降では、コネクタの更新 CcServerCertificate コマンドレットは、更新プログラム CcServerCertificate に変更し、更新 CcCACertificate コマンドレットは、更新プログラム CcCACertificate に変更します。 
  
    内部発行証明書を中央管理ストア、仲介サーバー、およびエッジ サーバーは、有効期限の近くや、証明書を更新する更新 CcServerCertificate または更新プログラム CcServerCertificate コマンドレットを実行する危険にさらされました。
    
    証明機関の証明書が有効期限の近くにある場合は、証明書を更新する更新 CcCACertificate または更新プログラム CcCACertificate コマンドレットを実行します。
    
    **証明機関の証明書が侵害され、サイトでは、アプライアンスが 1 つだけがある場合**は、次の手順を実行します。
    
1. Enter-CcUpdate コマンドレットを実行して、サービスをドレインし、アプライアンスをメンテナンス モードにします。
   
   ```
   Enter-CcUpdate
   ```
   
2. 次のコマンドレットを実行して、リセットし、新しい証明機関の証明書とすべての内部サーバー証明書を作成します。
    
    2.0 より前に、のリリースをクラウド コネクタ。
    
    ```
    Reset-CcCACertificate 
    Renew-CcServerCertificate 
    Remove-CcLegacyServerCertificate 
    ```

    またはクラウド コネクタ 2.0 以降のリリース。
    
    ```
    Reset-CcCACertificate 
    Update-CcServerCertificate 
    Remove-CcLegacyServerCertificate 
    ```
    
3. ゲートウェイと仲介サーバー間で TLS を使用する場合、アプライアンスからのエクスポート CcRootCertificate コマンドレットを実行し、PSTN ゲートウェイにエクスポートする証明書をインストールします。 ゲートウェイ上の証明書を再実行するにする必要があります。

   ```
   Export-CcRootCertificate
   ```

4. サービスを開始し、保守モードを終了する終了 CcUpdate コマンドレットを実行します。

   ```
   Exit-CcUpdate
   ```


    **証明機関の証明書が侵害され、は、サイト内の複数のアプライアンスのかどうか**は、サイト内には、各アプライアンスを次の一連のステップを実行します。
    
    非ピーク時間帯には、次の手順を実行することをお勧めします。
    
1. 最初のアプライアンスでは、CA をクリーンアップのバックアップ内のファイルを削除 CcCertificationAuthorityFile コマンドレットを実行します\<SiteRoot\>ディレクトリです。

     ```
     Remove-CcCertificationAuthorityFile
     ```
    
2. サービスと、各アプライアンスをメンテナンス モードにするのには Enter CcUpdate コマンドレットを実行します。

     ```
     Enter-CcUpdate
     ```
    
3. 最初のアプライアンスをリセットし、新しい証明機関の証明書およびすべての内部サーバーの証明書を作成するのには、次のコマンドレットを実行します。
    
     2.0 より前に、のリリースをクラウド コネクタ。
    
     ```
     Reset-CcCACertificate
     Renew-CcServerCertificate
     Remove-CcLegacyServerCertificate 
     ```

     またはクラウド コネクタ 2.0 以降のリリース。
    
     ```
     Reset-CcCACertificate
     Update-CcServerCertificate
     Remove-CcLegacyServerCertificate 
     ```

4. 最初のアプライアンスでは、CA のファイルのバックアップを作成するのには次のコマンドレットを実行します\<SiteRoot\>フォルダー。
    
     ```
     Backup-CcCertificationAuthority
     ```
   
5. すべての他のアプライアンス上の同じサイトに、アプライアンスを選択し、すべて、同じルート証明書を使用し、新しい証明書を要求するように CA のバックアップ ファイルを使用する次のコマンドを実行します。 
   
     ```
     Reset-CcCACertificate
     Update-CcServerCertificate
     Remove-CcLegacyServerCertificate 
     ```
     
6. ゲートウェイと仲介サーバー間で TLS を使用する場合サイトでは、いずれのアプライアンスからのエクスポート CcRootCertificate コマンドレットを実行し、PSTN ゲートウェイにエクスポートする証明書をインストールします。 ゲートウェイ上の証明書を再実行するにする必要があります。
  
     ```
     Export-CcRootCertificate
     ```
     
7. サービスを開始し、保守モードを終了する終了 CcUpdate コマンドレットを実行します。 

     ```
     Exit-CcUpdate
     ```
    
    
- **問題: クラウド コネクタ管理サービスのログに、"C:\Program Files\Skype のビジネス クラウド コネクタ Edition\ManagementService\CceManagementService.log"次のエラー メッセージが表示する: CceService エラー: 0: 予期しない例外とオンライン ステータスの報告: System.Management.Automation.CmdletInvocationException: ユーザーのログオンに失敗しました\<グローバル テナント管理\>。正しいユーザー名とパスワードを使用していることを確認する、新しい資格情報オブジェクトを作成してください。---\>**
    
    **の解像度:** クラウド コネクタ アプライアンスが登録されているために、Office 365 テナントのグローバル管理者の資格情報が変更されました。 クラウド コネクタ ・ アプライアンスのローカルに保存された資格情報を更新するには、ホスト ・ アプライアンスの PowerShell の管理者から、次を実行します。
    
  ```
  Set-CcCredential -AccountType TenantAdmin
  ```

- **問題: 展開に使用するホスト サーバーのアカウントのパスワードを変更すると後が表示されたら、次のエラー メッセージ:"寄せ SecureString: で使用できない無効なキーが指定されている状態です"ビジネス クラウド コネクタの %ProgramFiles%\Skype で。Edition\ManagementService\CceManagementService.log または Get CcCredential コマンドレットを実行しているとき。**
    
    **の解像度:** クラウド コネクタのすべての資格情報は、次のファイルに格納されます:"%systemdrive%\programdata\cloudconnector\credentials。\<CurrentUser\>.xml」です。 ホスト サーバーのパスワードを変更するときには、ローカルで格納されている資格情報を更新する必要があります。
    
    **Cloud Connector バージョン 1.4.2 を実行している場合は、** 次の手順を実行してすべての Cloud Connector パスワードを再生成します。
    
  1. ホスト サーバーを再起動します。
    
  2. 次のファイルを削除します。"% SystemDrive%\Programdata\Cloudconnector\credentials。\<CurrentUser\>.xml」です。
    
  3. 管理者として PowerShell コンソールを起動し、実行して"登録 CcAppliance-ローカル"次の説明、パスワードを再入力します。 Cloud Connector の展開で前回使用したパスワードと同じパスワードを入力します。
    
     **クラウド コネクタ バージョン 2.0 以降を実行している場合**は、次の手順でクラウドのコネクタのすべてのパスワードを再生成します。
    
  4. ホスト サーバーを再起動します。
    
  5. 次のファイルを削除します。"% SystemDrive%\Programdata\Cloudconnector\credentials。\<CurrentUser\>.xml」です。
    
  6. 管理者として PowerShell コンソールを起動し、実行して"登録 CcAppliance-ローカル"次の説明、パスワードを再入力します。 
    
     キャッシュされているファイルが Cloud Connector バージョン 1.4.2 で生成されたファイルである場合は、パスワードを求められたときに CceService パスワードの VMAdmin パスワードを使用します。その他すべてのアカウントについては、Cloud Connector の展開で前回使用したパスワードと同じパスワードを入力します。
    
     キャッシュされているパスワード ファイルが Cloud Connector バージョン 1.4.2 で生成されたファイルであり、DomainAdmin と VMAdmin のパスワードが異なる場合は、次の手順を実行する必要があります。
    
  7. Set-CcCredential -AccountType DomainAdmin を次のように実行します。
    
  8. 以前のアカウントの資格情報を求められた場合は、CceService パスワードに使用した資格情報を入力します。
    
  9. 新しいアカウントの資格情報を求められた場合は、以前使用していた DomainAdmin パスワードを入力します。
    
     クラウド コネクタ バージョン 2.0 またはそれ以降、デフォルトでキャッシュされたパスワード ファイルが生成された場合 VmAdmin と DomainAdmin パスワードを使用して、同じ CceService として。 DomainAdmin と VMAdmin のパスワードを変更した場合は、次の手順を実行する必要があります。
    
  10. Set-CcCredential -AccountType DomainAdmin を次のように実行します。
    
       1. 以前のアカウントの資格情報を求められた場合は、CceService パスワードに使用した資格情報を入力します。
    
       2. 新しいアカウントの資格情報を求められた場合は、以前使用していた DomainAdmin パスワードを入力します。
    
  11. Set-CcCredential -AccountType VmAdmin を次のように実行します。
    
       1. 以前のアカウントの資格情報を求められた場合は、CceService パスワードに使用した資格情報を入力します。
    
       2. 新しいアカウントの資格情報を求められた場合は、以前使用していた VmAdmin パスワードを入力します。 
    
- **問題: クラウド バージョン 2.1 以降では、コネクタで、アプライアンス上のレジスタ CcAppliance またはその他のコマンドレットを実行している場合、エラー メッセージが表示次のように:"の各オブジェクト: '共通' が見つかりませんこのオブジェクトのプロパティです。プロパティが存在することを確認します。14: C:\Program Files\WindowsPowerShell\Modules\CloudConnector\Internal\MtHostCommon.ps1:681 文字で」**
    
    **の解像度:** クラウド コネクタ 2.1 以降を必要と.NET Framework 4.6.1 以降。 アプライアンスのバージョン 4.6.1 の.NET Framework を更新してくださいまたはそれ以降、cmdlet(s) をもう一度実行するとします。

- **問題: クラウド コネクタ版 2.1 をインストール CcAppliance を実行している場合、エラー メッセージは、次のように:"エラーのための新しいインスタンスのインストールに失敗しました: XmlNode プロパティを設定する値として文字列のみを使用することができますので「状態」を設定することはできません」**

   **の解像度:** Cloudconnector.ini で [共通] のセクションでは、[追加してください「状態」の構成以下のよう: 市外 = 米国の州都市区町村 = レドモンド

   "State"行を Cloudconnector.ini ファイルから削除することはできませんが、"State"行の値を持つには必須ではありません。

- **問題: 次のエラー メッセージを受信する「ディス マウント WindowsImage: ディス マウント WindowsImage で失敗しました。エラー コード = 0xc1550115"をインストールするか、クラウドのコネクタのエディションをアップグレードするとします。**
    
    **の解像度:** PowerShell コンソールを実行して、管理者として起動"DISM のクリーンアップ-Wim'"です。 これが問題のあるすべてのイメージをクリーンアップします。 再インストール CcAppliance を実行するか、自動的にアップグレードするのにはビットを待ちます。
    
- **問題: 最初のコネクタのクラウド アプライアンス HA 環境での展開が失敗します。**
    
    **の解像度:** 手順は、展開が失敗した理由によって異なります。
    
  - 最初のコネクタのクラウド アプライアンスで障害が発生したエラーの原因を特定できない場合は、まで、展開が成功すると、アプライアンスを再インストールして他のアプライアンスをインストールしてください。
    
  - 軽微な問題が、外部の証明書の問題など、最初のコネクタのクラウド アプライアンスが失敗した場合は、アプライアンスを再インストールすることがなく問題を解決することができます。 使用してテナントの成功と展開を次のようにマークするためのリモート PowerShell できます。 (も使えます次の手順では、最初の展開が成功したが、成功としての展開を報告する何らかの理由では、クラウドのコネクタが失敗した場合です。)
    
  - 最初のコネクタのクラウド アプライアンスの Id (GUID) を取得するには、Get CsHybridPSTNAppliance コマンドレットを実行します。
    
  - 正常に展開するアプライアンスを設定するには、次のようにセットの CsCceApplianceDeploymentStatus を実行します。
    
  ```
  Set-CsCceApplianceDeploymentStatus -Identity <Appliance Identity GUID> -Action Deploy -Status Finished
  ```

- **問題: ホスト サーバーまたは仮想マシン上で Windows Update を手動で確認してインストールする必要がある。**
    
   **解決策:** Skype for Business Cloud Connector エディションが備える自動 OS 更新プログラムを活用することをお勧めします。アプライアンスをオンライン管理に登録して、自動 OS 更新を有効にすると、ホスト サーバーと仮想マシンが自動的に Windows Update を確認して、OS 更新の時間枠設定に従ってインストールします。
    
   Windows Update を手動で確認してインストールする必要がある場合は、展開の種類に該当する、このセクションに記載されている手順に従ってください。更新に必要なダウン タイムを最小限にするため、ホスト サーバーと、そこで動作する仮想マシンの両方の更新を計画する必要があります。
    
   また、Windows Server Update Services (WSUS) サーバーを使用して、Cloud Connector サーバーに更新プログラムを提供することもできます。Windows Update が自動的にインストール**されない**ように構成してください。
    
   Cloud Connector 展開を手動で更新する方法については、次のセクションを参照してください。
    
- **問題: クラウド コネクタは、新しいビルドに更新すると、クラウドのコネクタのコマンドレットが更新されません。** 場合があります、これは自動更新が発生した場合、PowerShell のウィンドウは開いたまま場合に発生します。
    
  **の解像度:** 更新されたコマンドレットを読み込むには、次の手順のいずれかの操作を行います。
    
   - クラウド コネクタ アプライアンスでは、PowerShell を閉じ、PowerShell をもう一度します。
    
     - または、インポート モジュール CloudConnector を実行することができます-強制します。 
 
-   **問題:「名前のコマンドレット、関数、スクリプト ファイルまたは実行可能なプログラムです。 としては、用語 ' Stop CsWindowsService' は認識されていません」エラーは、Enter CcUpdate コマンドレットを実行しようとしています。**

    **の解像度:**$HOME\AppData\Local\Microsoft\Windows\PowerShell\ModuleAnalysisCache ファイルを削除します。
PowerShell では、本当に時間がかかるものにするようにとするたびにすべてのモジュールを再分析する必要はありませんが検索され、そのモジュールのコマンドレットのキャッシュとしてこのファイルを作成します。 ほとんどの場合、そのキャッシュからの読み取りにすると、PowerShell に誤解を招く結果を提供するいくつかのファイルの破損が発生しました。

-   **問題:「インポート モジュール CloudConnector」エラーが生成されます"インポート モジュール: 指定されたモジュールのモジュール ディレクトリに有効なモジュール ファイルが見つからなかったため、"CloudConnector"は読み込まれませんでした」**

    **解決策:**
    - 本当に CloudConnector モジュールが存在する [c:\Program Files\WindowsPowerShell\Modules の検証します。
    
    - この場所が存在する CloudConnector モジュールを検証した後、モジュールの場所へのパスを格納する PSModulePath 環境変数を変更できます。
    
     a. 一時的な変更: 次のコマンドを実行、管理者として Powershell を開始: $env: psmodulepath 環境変数 = $env: psmodulepath 環境変数"; +C:\Program Files\WindowsPowerShell\Modules\"
        
     b. 永続的な変更、実行、管理者として PowerShell を開始の次のコマンド、1 つずつ: $CurrentValue = [環境]:: GetEnvironmentVariable("PSModulePath","Machine") SetEnvironmentVariable("PSModulePath", $CurrentValue +";C:\Program Files\WindowsPowerShell\Modules"、「コンピューター」)

    
## <a name="install-windows-updates-manually"></a>Windows の更新プログラムを手動でインストールします。

ご利用の環境で自動更新を使用しない場合は、次の手順に従って、Windows Update を手動で確認して適用します。 Windows Update の確認とインストールでは、サーバーの再起動が必要となる場合があります。 ホスト サーバーを再起動すると、ユーザーはクラウドのコネクタを使用して、開始、または呼び出しを受信することはできません。 更新プログラムを手動で確認してインストールすることにより更新の実行時期を制御してから、サービスの中断を回避するために選んだ期間中に必要に応じてコンピューターを再起動できます。
  
更新プログラムを手動で確認するには、各ホスト サーバーに接続し、[**コントロール パネル**] を開きます。 選択**システムとセキュリティ\>Windows の更新プログラム**、更新プログラムを管理し、必要に応じて、お客様の環境にサーバーを再起動します。
  
- サイトにアプライアンスが 1 台しかない場合は、各仮想マシンに接続し、[**コントロール パネル**] に接続します。 選択**システムとセキュリティ\>Windows の更新プログラム**、更新プログラムを構成し、サーバーを再起動する必要に応じてします。
    
- サイトに複数のアプライアンスがある場合、更新中、更新して再起動するインスタンスにはアクセスできません。更新が完了して、すべての仮想マシンと、仮想マシン上のすべての Skype for Business サービスが開始するまで、展開内の別のインスタンスに接続することになります。サービス中断の可能性を避けるため、更新プログラム適用中にインスタンスから HA を削除し、完了してから復元することができます。その手順は、次のとおりです。
    
1. ホスト サーバーごとに、管理者として PowerShell コンソールを開きます。
    
2. 次のコマンドレットを使用して、HA からインスタンスを削除します。
    
   ```
   Enter-CcUpdate
   ```

3. 
    
    単一インスタンスの手順に従い、更新を手動で適用し仮想マシンを再起動します。
    
4. 次のコマンドレットを使用して、HA にインスタンスを戻します。
    
   ```
   Exit-CcUpdate
   ```

マルチサイト展開の場合は、展開内の各サイトに対して 1 つのサイトの手順を実行し、一度に 1 つのサイトに対して更新プログラムを適用します。
  
## <a name="tips-when-installing-anti-virus-software-on-the-cloud-connector-host-machine"></a>クラウド コネクタのホスト コンピューターにウイルス対策ソフトウェアをインストールするときのヒントします。

クラウド コネクタのホスト コンピューターにウイルス対策ソフトウェアをインストールする場合は、次の除外を追加する必要があります。
  
- 各コンピューターでローカルのアプライアンスのディレクトリです。
    
- 各マシン上のリモート サイト ディレクトリです。
    
- コンピューターのローカル サイトのディレクトリは、共有サイトのルート フォルダーをホストします。
    
- ビジネス クラウド コネクタ ・ エディションの %ProgramFiles%\Skype
    
- %ALLUSERSPROFILE%\CloudConnector
    
- %ProgramFiles%\WindowsPowerShell\Modules\CloudConnector
    
- Microsoft.Rtc.CCE.ManagementService.exe プロセスです。
