---
title: Skype for Business Server での送信音声ルーティングの計画
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
audience: ITPro
ms.topic: conceptual
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection:
- IT_Skype16
- Strat_SB_Admin
ms.custom: ''
ms.assetid: fde45195-6eb4-403c-9094-57df7fc0bd2a
description: 通話ルーティング設定、ダイヤル プラン、正規化ルール、音声ポリシー、PSTN 使用法レコード、音声ルートなど、Skype for Business Server エンタープライズ VoIP での発信音声ルーティングについて説明します。
ms.openlocfilehash: 70681e995068a0999324694a78806421e0f2d129
ms.sourcegitcommit: 01087be29daa3abce7d3b03a55ba5ef8db4ca161
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/23/2021
ms.locfileid: "51101283"
---
# <a name="plan-for-outbound-voice-routing-in-skype-for-business-server"></a>Skype for Business Server での送信音声ルーティングの計画
 
通話ルーティング設定、ダイヤル プラン、正規化ルール、音声ポリシー、PSTN 使用法レコード、音声ルートなど、Skype for Business Server エンタープライズ VoIP での発信音声ルーティングについて説明します。
  
発信通話ルーティングはエンタープライズ VoIP交換電話網 (PSTN) ゲートウェイ、トランク、またはプライベート ブランチ 交換 (PBX) 宛ての通話に適用されます。 Skype for Business ユーザーが呼び出しを行う場合、サーバーは必要に応じて電話番号を E.164 形式に正規化し、SIP URI に一致します。 一致する SIP URI が見つからない場合は、指定されたダイヤル文字列に基づいて発信通話ルーティング ロジックが適用されます。 ユーザーは、次の表で説明するサーバー設定を構成することで、そのロジックを定義します。
  
**Skype for Business Server 送信通話ルーティング設定**

|**オブジェクト**|**説明**|
|:-----|:-----|
|ダイヤル プラン  <br/> |ダイヤル プランとは、電話番号の承認と通話のルーティングを目的として、特定の場所、個々のユーザー、または連絡先オブジェクトの電話番号を 1 つの標準形式 (E.164) に変換する正規化ルールのセットに名前を付けたものです。  <br/> |
|正規化ルール  <br/> |正規化ルールは、さまざまな形式で表現された電話番号を指定された各場所、ユーザー、または連絡先オブジェクトにルーティングする方法を定義します。ダイヤル元の場所および電話をかける人や連絡先オブジェクトによって、同じダイヤル文字列が異なる方法で解釈および変換される場合があります。特定の位置に関連付けられた正規化ルールをまとめたものが、ダイヤル プランです。  <br/> |
|音声ポリシー  <br/> |音声ポリシーでは、1 つ以上の PSTN 使用法レコードを 1 人のユーザーまたはユーザーのグループに関連付けます。 音声ポリシーも、ユーザーが有効と無効を切り替えできる通話機能のリストを提供します。  <br/> |
|PSTN 使用法レコード  <br/> |PSTN 使用法レコードは、組織内のさまざまなユーザーまたはグループが利用できる通話のクラス (内部、市内、長距離など) を指定します。  <br/> |
|通話ルート  <br/> |通話ルートでは、通話先の電話番号を特定のトランクおよび PSTN 使用法レコードに関連付けます。 PSTN ゲートウェイはトランクとみなされます。  <br/> |
   
## <a name="dial-plans-and-normalization-rules"></a>ダイヤル プランと正規化ルール

ダイヤル プランとは、電話番号の承認と通話のルーティングを目的として、特定の場所、個々のユーザー、または連絡先オブジェクトの電話番号を 1 つの標準形式 (E.164) に変換する正規化ルールのセットに名前を付けたものです。 
  
正規化ルールは、さまざまな形式で表現された電話番号を指定された各場所、ユーザー、または連絡先オブジェクトにルーティングする方法を定義します。 同じダイヤル文字列は、ダイヤルする場所と、通話を行う人物または連絡先オブジェクトに応じて、異なる方法で解釈および翻訳される場合があります。
  
### <a name="dial-plan-scope"></a>ダイヤル プランのスコープ

ダイヤル プランのスコープは、ダイヤル プランを適用できる階層レベルを決定します。 Skype for Business Server では、ユーザーに特定のユーザーごとのダイヤル プランを割り当てることができます。 ユーザー ダイヤル プランが割り当てられていない場合は、フロントエンド プールダイヤル プランが適用されます。 フロントエンド プールダイヤル プランがない場合は、サイト ダイヤル プランが適用されます。 ユーザーに適用可能な他のダイヤル プランがない場合は、最後にグローバル ダイヤル プランが適用されます。
  
クライアントは、ユーザーが Skype for Business にログオンするときに提供されるインバンド プロビジョニング設定を使用してダイヤル プランのスコープ レベルを取得します。 管理者は、Skype for Business Server コントロール パネルを使用してダイヤル プランのスコープ レベルを管理および割り当てできます。
  
> [!NOTE]
> サービス レベルの公衆交換電話網 (PSTN) ゲートウェイ ダイヤル プランは、特定のゲートウェイからの着信呼び出しに適用されます。 
  
ダイヤル プランのスコープ レベルは、次のように定義されます。
  
- **ユーザー ダイヤル プラン**: 個々のユーザー、グループ、または連絡先オブジェクトに割り当てることができます。 音声アプリケーションは、電話コンテキストがユーザー既定に設定された通話を受信すると、ユーザーごとのダイヤル プランを参照できます。 ダイヤル プランを割り当てる目的で、連絡先オブジェクトは個々のユーザーとして扱います。
    
- **プール ダイヤル プラン**: トポロジ内の PSTN ゲートウェイまたはレジストラーのサービス レベルで作成できます。 プール ダイヤル プランを定義するには、ダイヤル プランを適用する特定のサービス (PSTN ゲートウェイまたはレジストラー プール) を指定する必要があります。 
    
- **サイト ダイヤル プラン**: プール ダイヤル プランまたはユーザー ダイヤル プランが割り当てられているすべてのユーザー、グループ、または連絡先オブジェクトを除き、サイト全体に対して作成できます。 サイト ダイヤル プランを定義するには、ダイヤル プランを適用するサイトを指定する必要があります。
    
- **グローバル ダイヤル プラン**: 製品にインストールされている既定のダイヤル プラン。 グローバル ダイヤル プランは、編集はできますが削除することはできません。 このダイヤル プランは、エンタープライズ VoIPのユーザー、グループ、および連絡先オブジェクトに適用されます。より具体的なスコープを持つダイヤル プランを構成して割り当てない限りです。
    
### <a name="planning-for-dial-plans"></a>ダイヤル プランの計画

ダイヤル プランを計画するには、次の手順を実行します。
  
- 組織がオフィスを持つすべての地域を一覧表示します。
    
    リストは最新で完全である必要があります。 また、組織の変化に合わせて改訂する必要があります。 多数の小規模ブランチ オフィスを持つ大規模な多国籍企業では、これは時間のかかる作業になる可能性があります。
    
- 各サイトの有効な番号パターンを識別します。
    
    ダイヤル プランの計画で最も時間がかかるのは、それぞれのサイトの有効な番号パターンを特定することです。 あるダイヤル プラン用に記述した正規化ルールを他のダイヤル プランにコピーできる場合があります (特に、対応しているサイトが同じ国/地域または大陸にある場合)。 これ以外の場合でも、あるダイヤル プランの番号を少し変更すれば他のダイヤル プランに十分使用できる場合があります。
    
- ダイヤル プランに名前を付ける組織全体のスキームを開発します。
    
    標準の名前付けスキームを採用することで、組織間の一貫性を保ち、メンテナンスと更新を簡単に行うことができます。
    
- 1 つの場所に複数のダイヤル プランが必要かどうかを決定します。 
    
    組織が複数の場所で 1 つのダイヤル プランを維持している場合でも、プライベート ブランチ エクスチェンジ (PBX) から移行し、既存の内線番号を保持する必要がある エンタープライズ VoIP ユーザーに対して個別のダイヤル プランを作成する必要がある場合があります。
    
- ユーザーごとのダイヤル プランが必要かどうかを決定します。 たとえば、ブランチ サイトのユーザーが中央サイトに登録されている場合、または存続可能ブランチ アプライアンスに登録されているユーザーがある場合は、ユーザーごとのダイヤル プランと正規化ルールを使用して、そのようなユーザーに対して特別なダイヤル シナリオを検討できます。 詳細については [、「Plan for エンタープライズ VoIP Skype for Business Server」を参照してください](enterprise-voice-resiliency.md)。
    
- ダイヤル プランのスコープを決定します (このトピックで前述したように)。
    
ダイヤル プランを作成するには、Skype for Business Server コントロール パネルまたは Skype for Business Server 管理シェルを使用して、必要に応じて次のフィールドに値を指定します。
  
#### <a name="name-and-simple-name"></a>名前および簡単な名前

ユーザー ダイヤル プランの場合は、ダイヤル プランが割り当てられるユーザー、グループ、または連絡先オブジェクトを識別するわかりやすい名前を指定する必要があります。 サイト ダイヤル プランの場合、[名前] フィールドにはサイト名が事前入力され、変更できません。 プールダイヤル プランの場合、[名前] フィールドには PSTN ゲートウェイまたはフロントエンド プールの完全修飾ドメイン名 (FQDN) が事前に入力され、変更できません。
  
ダイヤル プランの簡易名には、ダイヤル プラン名から派生した文字列が事前に入力されます。 [簡易名] フィールドは編集可能で、ダイヤル プランのわかりやすい名前付け規則を作成できます。 [Simple Name] の値は空にすることはできません。一意である必要があります。 ベスト プラクティスは、組織全体の名前付け規則を開発し、この規則をすべてのサイトとユーザーで一貫して使用する方法です。
  
#### <a name="description"></a>説明

対応するダイヤル プランが適用される地理的な場所の、一般的でわかりやすい名前を入力することをお勧めします。 たとえば、ダイヤル プランの名前が London.Contoso.com である場合、説明を London とすることをお勧めします。 
  
#### <a name="dial-in-conferencing-region"></a>ダイヤルイン会議の地域

ダイヤルイン会議を展開している場合、ダイヤルイン会議の地域を指定し、ダイヤルイン会議のアクセス番号をダイヤル プランと関連付ける必要があります。 
  
#### <a name="external-access-prefix"></a>外部アクセス プレフィックス

ユーザーが外部行を取得するために 1 つ以上の先頭の数字 (9 など) をダイヤルする必要がある場合は、最大 4 文字 \* (#、、および 0- 9) の外部アクセス プレフィックスを指定できます。
  
> [!NOTE]
> 外部アクセス プレフィックスを指定する場合に、プレフィックスに対応するために追加の正規化ルールを作成する必要はありません。 
  
### <a name="normalization-rules"></a>正規化ルール

正規化ルールは、さまざまな形式で表される電話番号を名前付き場所にルーティングする方法を定義します。 同じ番号の文字列は、ダイヤルするロケールに応じて、解釈および翻訳が異なる場合があります。 正規化ルールは、ユーザーが連絡先リストに電話番号を入力するときにさまざまな形式を使用することができるため、通話ルーティングに必要です。
  
ユーザーが指定した電話番号を正規化すると、次のタスクを容易にする一貫性のある形式が提供されます。
  
- ダイヤルされた番号を、目的の受信者の SIP-URI と一致します。
    
- 発信側にダイヤル承認ルールを適用します。
    
次の番号フィールドでは、正規化ルールの考慮が必要になる可能性があります。
  
- ダイヤル プラン
    
- 国番号
    
- 市外局番
    
- 内線番号の長さ
    
- サイトのプレフィックス
    
#### <a name="creating-normalization-rules"></a>正規化ルールの作成

正規化ルールでは、.NET Framework 正規表現を使用して、逆引き番号参照を実行するために、サーバーがダイヤル文字列を E.164 形式に変換するために使用する数値の一致パターンを指定します。 Skype for Business Server コントロール パネルに正規化ルールを作成するには、式を手動で入力するか、開始数字と一致するダイヤル文字列の長さを入力し、Skype for Business Server コントロール パネルで対応する正規表現を生成します。 いずれの方法でも、終了したら、テスト番号を入力して、正規化ルールが期待通り動作するか確認できます。
  
正規表現の使用の.NET Frameworkについては [、「.NET Framework」を参照してください](/dotnet/standard/base-types/regular-expressions)。
  
#### <a name="sample-normalization-rules"></a>正規化ルールの例
<a name="BKMK_SampleNormalizationRules"> </a>

次の表は、.NET Framework 正規表現で記述された正規化ルールの例です。 ここに示すのは単なる例であり、ご自分の正規化ルールをこのとおりに作成する必要はありません。
  
**表 1. .NET Framework 正規表現を使用した正規化ルール**

|**ルール名**|**説明**|**番号パターン**|**翻訳**|**例**|
|:-----|:-----|:-----|:-----|:-----|
|4digitExtension  <br/> |4 桁の内線番号を変換します。  <br/> |^(\d{4})$  <br/> |+1425555$1  <br/> |0100 が +14255550100 に変換されます。  <br/> |
|5digitExtension  <br/> |5 桁の内線番号を変換します。  <br/> |^5(\d {4} )$  <br/> |+1425555$1  <br/> |50100 が +14255550100 に変換されます。  <br/> |
|7digitcallingRedmond  <br/> |7 桁の番号を Redmond の電話番号に変換します。  <br/> |^(\d{7})$  <br/> |+1425$1  <br/> |5550100 が +14255550100 に変換されます。  <br/> |
|7digitcallingDallas  <br/> |7 桁の番号を Dallas の電話番号に変換します。  <br/> |^(\d{7})$  <br/> |+1972$1  <br/> |5550100 が +19725550100 に変換されます。  <br/> |
|10digitcallingUS  <br/> |米国の 10 桁の番号を変換します。  <br/> |^(\d{10})$  <br/> |+1$1  <br/> |2065550100 が +12065550100 に変換されます。  <br/> |
|LDCallingUS  <br/> |米国の長距離プレフィックス付きの番号を変換します。  <br/> |^1(\d {10} )$  <br/> |+$1  <br/> |12145550100 が +2145550100 に変換されます。  <br/> |
|IntlCallingUS  <br/> |米国の国際プレフィックス付きの番号を変換します。  <br/> |^011(\d \* )$  <br/> |+$1  <br/> |01191445550100 が +91445550100 に変換されます。  <br/> |
|RedmondOperator  <br/> |0 を Redmond のオペレータ呼び出し番号に変換します。  <br/> |^0$  <br/> |+14255550100  <br/> |0 が +14255550100 に変換されます。  <br/> |
|RedmondSitePrefix  <br/> |ネットワーク内プレフィックス (6) および Redmond のサイト コード (222) 付きの番号を変換します。  <br/> |^6222(\d {4} )$  <br/> |+1425555$1  <br/> |62220100 が +14255550100 に変換されます。  <br/> |
|NYSitePrefix  <br/> |ネットワーク内プレフィックス (6) および NY のサイト コード (333) 付きの番号を変換します。  <br/> |^6333(\d {4} )$  <br/> |+1202555$1  <br/> |63330100 が +12025550100 に変換されます。  <br/> |
|DallasSitePrefix  <br/> |ネットワーク内プレフィックス (6) および Dallas のサイト コード (444) 付きの番号を変換します。  <br/> |^6444(\d {4} )$  <br/> |+1972555$1  <br/> |64440100 が +19725550100 に変換されます。  <br/> |
   
以下の表は、Redmond (Washington、米国) の場所のダイヤル プランの例です。これは、前の表に示す正規化ルールに基づいています。
  
**表 2. 表 1 の正規化ルールに基づく Redmond のダイヤル プラン**

|**Redmond.forestFQDN**|
|:-----|
|5digitExtension  <br/> |
|7digitcallingRedmond  <br/> |
|10digitcallingUS  <br/> |
|IntlCallingUS  <br/> |
|RedmondSitePrefix  <br/> |
|NYSitePrefix  <br/> |
|DallasSitePrefix  <br/> |
|RedmondOperator  <br/> |
   
> [!NOTE]
> 前の表に記載した正規化ルールの名前にはスペースが含まれていませんが、これは任意に設定できます。たとえば、この表の最初の名前は、「5 digit extension」または「5-digit Extension」のどちらで記述しても問題ありません。 
  
## <a name="voice-policies"></a>音声ポリシー

Skype for Business Server 音声ポリシーは、ポリシーが割り当てられているユーザー、サイト、または組織ごとに次を定義します。
  
- ユーザーが使用できる機能を特定するために有効または無効にできるエンタープライズ VoIP機能のセット。
    
- 承認される通話の種類を定義する一連の公衆交換電話網 (PSTN) 使用法レコード。 
    
次の手順は、展開に必要な音声ポリシーを計画エンタープライズ VoIPします。
  
- グローバル音声ポリシー (製品と共にインストールされる既定の音声ポリシー) の構成方法を決定する。 このポリシーは、サイト レベルエンタープライズ VoIPユーザーごとのポリシーが明示的に割り当てられていないすべてのユーザーに適用されます。
    
- 必要なサイトレベルの音声ポリシーをすべて識別する。
    
- 必要なユーザー単位の音声ポリシーをすべて識別する。
    
- 音声ポリシーごとに、有効にする通話機能を決定する。
    
- 音声ポリシーごとに、構成する PSTN 使用法レコードを決定する。
    
### <a name="voice-policy-scope"></a>音声ポリシー スコープ

音声ポリシー スコープにより、ポリシーを適用可能な階層レベルが決まります。 Skype for Business Server では、音声ポリシーを次のスコープ レベルで構成できます (最も具体的なレベルから最も一般的なレベルに一覧表示されます)。
  
- **ユーザー音声ポリシー** は、個々のユーザー、グループ、または連絡先オブジェクトに割り当てることができます。これは最下位レベルのポリシーです。ユーザー音声ポリシーを展開することにより、サイトの特定のユーザーまたはグループを対象に機能を有効にし、同じサイトの他のユーザーまたはグループに対しては有効にしないようにすることができます。たとえば、一部の従業員に対しては長距離ダイヤル機能を無効にすることができます。連絡先オブジェクトは、音声ポリシーを割り当てる目的で個々のユーザーとして扱われます。
    
    > [!NOTE]
    > ブランチ サイトのユーザー音声ポリシーを展開し、エンタープライズ VoIP展開に登録されているユーザー、または存続可能ブランチ アプライアンスに登録されているユーザーに展開することをお勧めします。 
  
- **サイト音声ポリシー** は、ユーザー音声ポリシーが割り当てられているユーザー、グループ、または連絡先オブジェクトを除いて、サイト全体に適用されます。サイト音声ポリシーを定義するには、ポリシーを適用するサイトを指定する必要があります。ユーザー音声ポリシーが割り当てられていない場合は、サイト音声ポリシーを使用します。
    
- **グローバル音声ポリシー** は、製品と一緒にインストールされる既定の音声ポリシーです。 グローバル音声ポリシーは、組織の具体的な必要性を満たすように編集できますが、名前を変更したり、削除したりすることはできません。 この音声ポリシーは、エンタープライズ VoIPを構成して割り当てない限り、展開内のすべてのユーザー、グループ、および連絡先オブジェクトに適用されます。 このポリシー全体を無効にする場合は、サイトおよびユーザーのすべてにカスタム ポリシーが割り当てられるようにしてください。
    
### <a name="call-features"></a>通話機能

音声ポリシーごとに、以下の通話機能を有効または無効にすることができます。
  
- [**着信の転送**] では、他の電話機やクライアント デバイスに通話を転送できます。既定では有効です。
    
- [**委任**] では、代わりに通話を送受信する他のユーザーを指定できます。既定では有効です。
    
- [**通話の転送**] では、他のユーザーに通話を転送できます。既定では有効です。
    
- [**コール パーク**] では、通話を保留し、別の電話機やクライアントで受けることができます。既定では無効です。
    
- **[同時呼び出し]** では、追加の電話機 (携帯電話など) や他のエンドポイント デバイスで、着信の呼び出し音を鳴らすことができます。既定では有効です。
    
- [**チーム呼び出し**] では、定義したチームのユーザーがチームの他のメンバーの呼び出しに応答できます。既定では有効です。
    
- **[PSTN 再ルート]** では、WAN が混雑していたり利用できない場合に、このポリシーを割り当てられているユーザーが他のエンタープライズ ユーザーに掛けた通話を、公衆交換電話網 (PSTN) で再ルートできます。既定では有効です。
    
- [**帯域幅ポリシーの上書き**] により管理者は、特定のユーザーに関する通話受付管理ポリシーによる決定を上書きできます。既定では無効です。
    
- **悪意のある呼び出** しトレースを使用すると、ユーザーは Skype for Business クライアントを使用して悪意のある呼び出しを報告し、通話詳細レコードでそのような呼び出しにフラグを設定できます。 既定では無効です。
    
- **ボイス** メール エスケープを使用すると、同時呼び出しが構成され、電話がオフ、バッテリ切れ、または範囲外のときに、通話がユーザーの携帯電話ボイスメール システムに直ちにルーティングされ、タイマー値に基づいて行うのを防ぐ。 この設定でタイマーを有効または無効にし、タイマーの値を設定します。 構成できるのは、Skype for Business Server 管理シェルを使用する場合のみです。 既定では無効です。
    
- 通話 **転送** と同時呼び出し PSTN 使用法を使用すると、管理者は、通話転送と同時呼び出しの音声ポリシーと同じ PSTN 使用法を指定したり、通話転送と同時呼び出しを内部の Skype for Business ユーザーにのみ制限したり、音声ポリシーの PSTN 使用法とは異なるカスタム PSTN 使用法を指定できます。 既定では、着信の転送および同時呼び出しに対して音声ポリシーと同じ PSTN 使用法を使用します。
    
### <a name="pstn-usage-records"></a>PSTN 使用法レコード

各音声ポリシーには、1 つ以上の PSTN 使用法レコードが関連付けられている必要があります。 PSTN 使用法は、同時呼び出しおよび着信の転送のみのための音声ポリシーと関連付けることができます。 
  
> [!NOTE]
> 発信ルーティング機能では、ユーザーとルートの照合時に PSTN 使用法を上位から下位の順に比較するため、PSTN 使用法の順序は重要です。 最初の使用法が通話ルートに一致した場合は、そのルートが使用されます。 一致しない場合、発信ルーティング機能はリスト内の次の PSTN 使用法との照合を、一致が検出されるまで続けます。 事実上、後続の PSTN 使用法は、リストの最初の使用法が使用できない場合のバックアップとなります。 
  
## <a name="pstn-usage-records"></a>PSTN 使用法レコード

PSTN 使用法レコードの計画では、主に、CEO から派遣社員、コンサルタント、および臨時スタッフに至る組織内のすべてのユーザーに現在適用されているすべての通話許可の一覧を作成します。 この作業を行うと、既存の通話許可を再度検証し、それらを修正することができます。 エンタープライズ VoIP の見込みユーザーに適用する通話許可のみに対応した PSTN 使用法レコードを作成することもできますが、現時点で通話許可がエンタープライズ VoIP で有効なユーザー グループのメンバーに適用されるかどうかに関係なく、すべての通話許可に対応した PSTN 使用法レコードを作成する方が、長期的には優れたソリューションになる場合があります。 通話許可の変更や、異なる通話許可を持つ新規ユーザーを追加する場合でも、必要な電話 PSTN 使用法レコードは既に作成済みであるため、新しく作成する必要がありません。
  
次の表に、一般的な PSTN 使用法テーブルを示します。
  
**PSTN 使用法レコード**

|**電話属性**|**説明**|
|:-----|:-----|
|ローカル  <br/> |市内通話  <br/> |
|Long-Distance  <br/> |長距離通話  <br/> |
|International  <br/> |国際通話  <br/> |
|デリー  <br/> |Delhi のフルタイム社員  <br/> |
|Redmond  <br/> |Redmond のフルタイム社員  <br/> |
|RedmondTemps  <br/> |Redmond の派遣社員  <br/> |
|チューリッヒ  <br/> |Zurich のフルタイム社員  <br/> |
   
PSTN 使用法レコードは単独では機能しません。 PSTN 使用法レコードは、以下と組み合わせて使用する必要があります。
  
- 音声ポリシー (ユーザーに割り当てる)
    
- ルート (電話番号に割り当てる)
    
## <a name="voice-routes"></a>音声ルート

通話ルートは、Skype for Business Server がユーザーが発信した発信呼び出しエンタープライズ VoIP指定します。 ユーザーが番号をダイヤルすると、フロント エンド サーバーは必要に応じてダイヤル文字列を E.164 形式に正規化し、SIP URI に一致します。 サーバーが一致できない場合は、番号に基づいて発信呼び出しルーティング ロジックが適用されます。 このロジックを定義する最後の手順は、各ダイヤル プランに記載されている宛先電話番号のセットごとに個別の名前付き通話ルートを作成します。
  
発信通話ルートを定義する前に、次の手順を実行する必要があります。
  
- 1 つ以上のトランクを展開します。
    
- サイト、個人、連絡先オブジェクトに必要に応じてダイヤル プランを作成します。
    
- 公衆交換電話網 (PSTN) 使用法レコードを作成します。
    
さらに、発信通話ルーティングを有効にするには、1 つ以上の音声ポリシーを作成して割り当てる必要があります。 これは、発信呼び出しルートを定義する前または定義した後に実行できます。
  
ルートごとに、次の値を指定する必要があります。
  
- ルートを簡単に識別できる名前。
    
- ルートを記述するのに名前だけでは十分でない場合のオプションの説明。
    
- ルートが適用される宛先電話番号を識別する正規表現照合パターンと、一致するパターンが適用されない例外。
    
- ルートに割り当てる 1 つ以上のトランク。
    
- 宛先電話番号の正規表現に一致する電話番号を呼び出す際に必要な PSTN 使用法レコード。
    
Skype for Business Server コントロール パネルで通話ルートを指定できます。 これらの呼び出しルートは、SKYPE for Business Server が PSTN 宛ての通話をルーティングするために使用するサーバー ルーティング テーブルを設定します。
  
### <a name="mn-trunk-support"></a>M:N トランクのサポート

Skype for Business Server は、PSTN への通話のルーティング方法を柔軟に提供します。 音声ルートは、特定の音声通話に使用できる PSTN へのトランクのセットを指定します。 トランクは仲介サーバーとポート番号を PSTN ゲートウェイとリスニング ポート番号に関連付ける。 この論理関連付けにより、仲介サーバーを複数のゲートウェイに関連付け、同じゲートウェイに複数の接続を持つ。 通話ルートを定義する場合は、そのルートに関連付けられているトランクを指定しますが、ルートに関連付けられている仲介サーバーは指定しません。 仲介サーバーと PSTN ゲートウェイ、IP-PBX、セッション ボーダー コントローラー (SBC) の間の関係を定義してトランクを作成するには、トポロジ ビルダーを使用します。
  
### <a name="least-cost-routing"></a>Least-Costルーティング

さまざまな番号がルーティングされるトランクを指定する機能を使用すると、最も低いコストで発生するルートを特定し、適切に実装できます。 トランクを選択する際の一般的なルールは、長距離料金を最小限に抑えるために、宛先番号の場所に最も近いゲートウェイを持つトランクを選択します。 たとえば、ニューヨークにいて、ローマで番号を呼び出している場合は、IP ネットワークを使用して、ローマのオフィスのゲートウェイを使用してトランクに通話を運ぶと、ローカル通話に対する料金が発生します。
  
最小コストのルーティングを使用する方法の例については、次の点を検討してください。Fabrikam は、ドイツのユーザーが米国のトランクを使用して米国の番号にダイヤルできます。 Fabrikam は、米国の Skype for Business Server ユーザーからドイツへのすべての呼び出しと、ドイツのゲートウェイを使用したトランク上の隣接する国/地域へのすべての呼び出しが終了するシステムを構成したいとします。 たとえば、ドイツからオーストリアへの呼び出しは、米国からオーストリアへの呼び出しよりも安価なので、このルーティングはコストを節約します。
  
### <a name="translating-outbound-dial-strings"></a>送信ダイヤル文字列の変換

Skype for Business Server では、逆引き番号参照 (RNL) を実行するために、すべてのダイヤル文字列を E.164 形式に正規化する必要があります。 ローカル ダイヤル形式で変換された番号を必要とするゲートウェイまたはプライベート ブランチ交換 (PBX) を使用するトランクの場合、Skype for Business Server では、呼び出し先の番号 (つまり、要求 URI) をトランクにルーティングする前に操作を支援する 1 つ以上のルールを作成できます。 たとえば、ダイヤル文字列の頭から +44 を削除し、それを 0144 に置き換えるルールを記述できます。
  
Skype for Business Server では、トランクにルーティングする前に呼び出し番号の操作を支援する 1 つ以上のルールを作成できます。
  
gateway:port ペアを仲介サーバー:ポート のペアに関連付けるトランクを計画する場合は、類似のローカル ダイヤル要件を持つトランクをグループ化して、必要な変換ルールの数と書き込みにかかる時間を短縮すると便利です。
  
### <a name="configuring-caller-id"></a>発信者 ID の構成

Skype for Business Server は、発信呼び出しの発信者 ID を操作する方法を提供します。 たとえば、組織が従業員のダイレクト ダイヤル内線番号をマスクし、一般的な会社番号または部署番号に置き換える場合、管理者は Skype for Business Server コントロール パネルを使用して発信者 ID を抑制し、指定した代替発信者 ID に置き換えます。 ルーティング ロジックを計画する際に、このオプションを必要とする個人、グループ、サイト (すべての従業員に対しても) を検討します。
  
> [!NOTE]
> PSTN を使用して再ルーティングされる呼び出しの場合、元の発信者 ID の代わりに汎用発信者 ID が表示されます。 これにより、呼び出し先が構成した可能性がある Do Not Disturb またはプライバシー設定をバイパスする呼び出しが発生する可能性があります。 
  
### <a name="additional-routing-logic"></a>追加のルーティング ロジック

発信通話ルートを作成する際には、ルーティング ロジックに影響を与える可能性がある次の要因に注意する必要があります。
  
- フェデレーション境界を越えた呼び出しが確立されている場合、URI のドメイン部分を使用して、発信ルーティング ロジックの適用を担当する企業に呼び出しをルーティングします。
    
- 要求 URI のドメイン部分に企業でサポートされているドメインが含まれている場合、サーバー上の送信ルーティング コンポーネントは呼び出しを処理しません。
    
- ユーザーがサーバーに対して有効になっていないエンタープライズ VoIP、必要に応じて他のルーティング ロジックが適用されます。
    
- 通話が完全に占有されているゲートウェイ (すべてのトランク 回線がビジー状態) にルーティングされる場合、ゲートウェイは通話を拒否し、発信ルーティング ロジックは呼び出しを次の最小コストのルートにリダイレクトします。 この点については、小規模なオフィス (たとえば、チューリッヒ) 用のゲートウェイが実際にスイスへの国際通話に対して大量の非現地トラフィックを運ぶ可能性があるため、注意深く検討してください。 この追加トラフィックのゲートウェイのサイズが正しく設定されていない場合、スイスへの呼び出しはドイツのゲートウェイを通じてルーティングされ、料金が大きくなる可能性があります。
