---
title: Skype for Business Server での送信ボイスルーティングの計画
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
audience: ITPro
ms.topic: conceptual
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection:
- IT_Skype16
- Strat_SB_Admin
ms.custom: ''
ms.assetid: fde45195-6eb4-403c-9094-57df7fc0bd2a
description: 通話ルーティング設定、ダイヤルプラン、正規化ルール、ボイスポリシー、PSTN 使用状況レコード、音声ルートなど、Skype for Business Server エンタープライズボイスの送信ボイスルーティングについて説明します。
ms.openlocfilehash: bb57d824d9d44886973f60b3061b2e86e949f071
ms.sourcegitcommit: ab47ff88f51a96aaf8bc99a6303e114d41ca5c2f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/20/2019
ms.locfileid: "34276583"
---
# <a name="plan-for-outbound-voice-routing-in-skype-for-business-server"></a>Skype for Business Server での送信ボイスルーティングの計画
 
通話ルーティング設定、ダイヤルプラン、正規化ルール、ボイスポリシー、PSTN 使用状況レコード、音声ルートなど、Skype for Business Server エンタープライズボイスの送信ボイスルーティングについて説明します。
  
発信通話のルーティングは、公衆交換電話網 (PSTN) ゲートウェイ、トランク、またはプライベート支店交換 (PBX) 向けのエンタープライズ音声通話に適用されます。 Skype for Business ユーザーが通話を発信すると、サーバーでは、必要に応じて、電話番号が E.i 形式に正規化され、SIP URI と照合されるようになります。 一致する SIP URI が見つからない場合は、指定されたダイヤル文字列に基づいて発信通話ルーティング ロジックが適用されます。 ユーザーは、次の表で説明するサーバー設定を構成することで、そのロジックを定義します。
  
**Skype for Business Server の送信通話ルーティングの設定**

|**オブジェクト**|**説明**|
|:-----|:-----|
|ダイヤル プラン  <br/> |ダイヤル プランとは、電話番号の承認と通話のルーティングを目的として、特定の場所、個々のユーザー、または連絡先オブジェクトの電話番号を 1 つの標準形式 (E.164) に変換する正規化ルールのセットに名前を付けたものです。  <br/> |
|正規化ルール  <br/> |正規化ルールは、さまざまな形式で表現された電話番号を指定された各場所、ユーザー、または連絡先オブジェクトにルーティングする方法を定義します。ダイヤル元の場所および電話をかける人や連絡先オブジェクトによって、同じダイヤル文字列が異なる方法で解釈および変換される場合があります。特定の位置に関連付けられた正規化ルールをまとめたものが、ダイヤル プランです。  <br/> |
|音声ポリシー  <br/> |音声ポリシーでは、1 つ以上の PSTN 使用法レコードを 1 人のユーザーまたはユーザーのグループに関連付けます。音声ポリシーも、ユーザーが有効と無効を切り替えられる通話機能のリストを提供します。  <br/> |
|PSTN 使用法レコード  <br/> |PSTN 使用法レコードは、組織内のさまざまなユーザーまたはグループが利用できる通話のクラス (内部、市内、長距離など) を指定します。  <br/> |
|通話ルート  <br/> |通話ルートでは、通話先の電話番号を特定のトランクおよび PSTN 使用法レコードに関連付けます。PSTN ゲートウェイはトランクとみなされます。  <br/> |
   
## <a name="dial-plans-and-normalization-rules"></a>ダイヤル プランと正規化ルール

ダイヤル プランとは、電話番号の承認と通話のルーティングを目的として、特定の場所、個々のユーザー、または連絡先オブジェクトの電話番号を 1 つの標準形式 (E.164) に変換する正規化ルールのセットに名前を付けたものです。 
  
正規化ルールは、さまざまな形式で表現された電話番号を指定された各場所、ユーザー、または連絡先オブジェクトにルーティングする方法を定義します。ダイヤル元の場所および電話をかける人や連絡先オブジェクトによって、同じダイヤル文字列が異なる方法で解釈および変換される場合があります。
  
### <a name="dial-plan-scope"></a>ダイヤル プランのスコープ

ダイヤル プランのスコープによって、ダイヤル プランを適用できる階層レベルが決まります。 Skype for Business Server では、ユーザーに特定のユーザーごとのダイヤルプランを割り当てることができます。 ユーザーダイヤルプランが割り当てられていない場合は、フロントエンドプールダイヤルプランが適用されます。 フロントエンドプールのダイヤルプランがない場合は、サイトダイヤルプランが適用されます。 ユーザーに適用可能な他のダイヤル プランがない場合は、最後にグローバル ダイヤル プランが適用されます。
  
クライアントは、ユーザーが Skype for Business にログインしたときに提供されるインバンドプロビジョニングの設定を通じて、ダイヤルプランのスコープレベルを取得します。 管理者は、Skype for Business Server コントロールパネルを使用して、ダイヤルプランの範囲レベルの管理と割り当てを行うことができます。
  
> [!NOTE]
> サービス レベルの公衆交換電話網 (PSTN) ゲートウェイのダイヤル プランは、特定のゲートウェイからの着信に適用されます。 
  
ダイヤル プランのスコープ レベルは、次のように定義されます。
  
- **ユーザー ダイヤル プラン**: 個々のユーザー、グループ、または連絡先オブジェクトに割り当てることができます。音声アプリケーションは、user-default に設定された電話コンテキストのコールを受信したとき、ユーザーごとのダイヤル プランを参照できます。連絡先オブジェクトは、ダイヤル プラン割り当ての際には個々のユーザーとして扱われます。
    
- **プール ダイヤル プラン**: トポロジ内の PSTN ゲートウェイまたはレジストラーのサービス レベルで作成できます。プール ダイヤル プランを定義するには、ダイヤル プランを適用する特定のサービス (PSTN ゲートウェイまたはレジストラー プール) を指定する必要があります。 
    
- **サイト ダイヤル プラン**: プール ダイヤル プランまたはユーザー ダイヤル プランに割り当てられているユーザー、グループ、または連絡先オブジェクトを除くサイト全体に作成できます。サイト ダイヤル プランを定義するには、ダイヤル プランを適用するサイトを指定する必要があります。
    
- **グローバル ダイヤル プラン**: 製品と一緒にインストールされる既定のダイヤル プランです。 グローバル ダイヤル プランは、編集することはできますが削除はできません。 このダイヤルプランは、より具体的なスコープのダイヤルプランを構成して割り当てる場合を除き、展開内のすべてのエンタープライズボイスユーザー、グループ、連絡先オブジェクトに適用されます。
    
### <a name="planning-for-dial-plans"></a>ダイヤル プランの計画

ダイヤル プランを計画するには、次の手順を実行します。
  
- 組織内のオフィスがあるすべてのロケールをリストアップします。
    
    このリストは、すべてを網羅した最新の情報である必要があります。また、組織の変化に合わせて改訂する必要があります。多数の小規模なブランチ オフィスを持つ大規模な多国籍企業の場合は、この作業に時間がかかる可能性があります。
    
- 各サイトにおける有効な番号パターンを特定します。
    
    ダイヤル プランの計画で最も時間がかかるのは、それぞれのサイトの有効な番号パターンを特定することです。あるダイヤル プラン用に記述した正規化ルールを他のダイヤル プランにコピーできる場合があります (特に、対応しているサイトが同じ国/地域または大陸にある場合)。これ以外の場合でも、あるダイヤル プランの番号を少し変更すれば他のダイヤル プランに十分使用できる場合があります。
    
- ダイヤル プランの名前付けのための、組織全体のスキームを開発します。
    
    標準の名前付けスキームを採用することで、組織間の一貫性を保ち、メンテナンスと更新を簡単に行うことができます。
    
- 1 つの場所で複数のダイヤル プランが必要かどうかを判断します。 
    
    組織が複数の場所で1つのダイヤルプランを管理している場合は、プライベートブランチ exchange (PBX) から移行している、または既存の拡張機能が保持されている必要があるエンタープライズボイスユーザーに対して、別のダイヤルプランを作成する必要があります。
    
- ユーザーごとのダイヤル プランが必要かどうかを決定します。 たとえば、セントラルサイトに登録されているブランチサイトにユーザーがいる場合、または Survivable Branch アプライアンスに登録されているユーザーがいる場合、ユーザーのダイヤルプランと正規化ルールを使用しているユーザーのために特別なダイヤルシナリオを検討することができます。. 詳細については、「[Plan for Enterprise Voice resiliency in Skype for Business Server](enterprise-voice-resiliency.md)」を参照してください。
    
- ダイヤル プランのスコープを決定します (このトピック内で前述)。
    
ダイヤルプランを作成するには、Skype for Business Server コントロールパネルまたは Skype for Business Server 管理シェルを使用して、必要に応じて次のフィールドに値を指定します。
  
#### <a name="name-and-simple-name"></a>名前および簡単な名前

ユーザー ダイヤル プランの場合、ダイヤル プランの割り当て先のユーザー、グループ、または連絡先オブジェクトを識別する説明的な名前を指定する必要があります。 サイト ダイヤル プランの場合、"名前" フィールドにサイト名が事前に入力されており、変更することはできません。 プールダイヤルプランの場合、[名前] フィールドには、PSTN ゲートウェイまたはフロントエンドプールの完全修飾ドメイン名 (FQDN) が事前に入力されているため、変更することはできません。
  
ダイヤルプランの簡易名には、ダイヤルプラン名から派生した文字列が事前に入力されています。 [単純名] フィールドは編集可能で、ダイヤル プラン用のより説明的な名前付け規則を作成することができます。 TheSimple Name の値は空にすることはできません。一意である必要があります。 組織全体の名前付け規則を開発し、この規則をすべてのサイトとユーザーで一貫して使用することをお勧めします。
  
#### <a name="description"></a>説明

対応するダイヤル プランが適用される地理的な場所の、一般的でわかりやすい名前を入力することをお勧めします。たとえば、ダイヤル プランの名前が London.Contoso.com である場合、説明を London とすることをお勧めします。 
  
#### <a name="dial-in-conferencing-region"></a>ダイヤルイン会議の地域

ダイヤルイン会議を展開している場合、ダイヤルイン会議の地域を指定し、ダイヤルイン会議のアクセス番号をダイヤル プランと関連付ける必要があります。 
  
#### <a name="external-access-prefix"></a>外部アクセス プレフィックス

ユーザーが1つまたは複数の追加の先頭の数字 (9 など) をダイヤルする必要がある場合は、最大 4 0-9 文字の外部アクセスプレフィックスを指定できます。
  
> [!NOTE]
> 外部アクセス プレフィックスを指定する場合に、プレフィックスに対応するために追加の正規化ルールを作成する必要はありません。 
  
### <a name="normalization-rules"></a>正規化ルール

正規化ルールは、さまざまな形式で表現された電話番号を指定の場所にルーティングする方法を定義します。同じ電話番号文字列が、その番号がダイヤルされたロケールに応じて、異なる方法で解釈および変換されることがあります。正規化ルールは通話のルーティングに不可欠です。これは、ユーザーが連絡先リストに電話番号を入力する際にさまざまな形式を使用する可能性があるためです。
  
ユーザーがダイヤルした電話番号を正規化することによって、形式の一貫性を確保できます。これは、次の処理に役立ちます。
  
- ダイヤルされた番号と、目的の受信者の SIP URI を一致させる。
    
- 発信者へのダイヤル承認ルールの適用
    
次の番号フィールドでは、正規化ルールの考慮が必要になる可能性があります。
  
- ダイヤル プラン
    
- 国番号
    
- 市外局番
    
- 内線番号の長さ
    
- サイトのプレフィックス
    
#### <a name="creating-normalization-rules"></a>正規化ルールの作成

正規化ルールでは、リバース番号検索でダイヤル文字列を E.164 形式に変換するためにサーバーによって使用される番号一致パターンを指定するために, .NET Framework の正規表現が使用されます。 Skype for Business Server コントロールパネルで正規化ルールを作成するには、式を手動で入力するか、対応する開始番号とダイヤル文字列の長さを入力して、Skype for Business Server コントロールパネルを表示します。対応する正規表現を生成します。 どちらの場合も、完了したら、テスト番号を入力して正規化ルールが期待どおりに動作することを確認できます。
  
.NET Framework の正規表現の使い方の詳細については、「 [.Net framework の正規表現](https://go.microsoft.com/fwlink/p/?linkId=140927)」を参照してください。
  
#### <a name="sample-normalization-rules"></a>正規化ルールの例
<a name="BKMK_SampleNormalizationRules"> </a>

次の表に, .NET Framework の正規表現として記述される正規化ルールのサンプルを示します。これらのサンプルは例示するためのもので、独自の正規化ルールを作成する際の規定リファレンスとして提示するものではありません。
  
**表 1. .NET Framework 正規表現を使用した正規化ルール**

|**ルール名**|**説明**|**番号パターン**|**変換**|**例**|
|:-----|:-----|:-----|:-----|:-----|
|4digitExtension  <br/> |4 桁の内線番号を変換します。  <br/> |^ (\d{4}) $  <br/> |+1425555$1  <br/> |0100 は +14255550100 に変換されます  <br/> |
|5digitExtension  <br/> |5 桁の内線番号を変換します。  <br/> |^ 5 (\d{4}) $  <br/> |+1425555$1  <br/> |50100 は +14255550100 に変換されます  <br/> |
|7digitcallingRedmond  <br/> |7 桁の番号を Redmond の電話番号に変換します。  <br/> |^ (\d{7}) $  <br/> |+1425$1  <br/> |5550100 が +14255550100 に変換されます。  <br/> |
|7digitcallingDallas  <br/> |7 桁の番号を Dallas の電話番号に変換します。  <br/> |^ (\d{7}) $  <br/> |+1972$1  <br/> |5550100 が +19725550100 に変換されます。  <br/> |
|10digitcallingUS  <br/> |米国の 10 桁の番号を変換します。  <br/> |^ (\d{10}) $  <br/> |+1$1  <br/> |2065550100 が +12065550100 に変換されます。  <br/> |
|LDCallingUS  <br/> |米国の長距離プレフィックス付きの番号を変換します。  <br/> |^ 1 (\d{10}) $  <br/> |+$1  <br/> |12145550100 が +2145550100 に変換されます。  <br/> |
|IntlCallingUS  <br/> |米国の国際プレフィックス付きの番号を変換します。  <br/> |^ 011 (\d\*) $  <br/> |+$1  <br/> |01191445550100 が +91445550100 に変換されます。  <br/> |
|RedmondOperator  <br/> |0 を Redmond のオペレーター呼び出し番号に変換します。  <br/> |^0$  <br/> |+14255550100  <br/> |0 は +14255550100 に変換されます  <br/> |
|RedmondSitePrefix  <br/> |ネットワーク内プレフィックス (6) および Redmond のサイト コード (222) 付きの番号を変換します。  <br/> |^ 6222 (\d{4}) $  <br/> |+1425555$1  <br/> |62220100 が +14255550100 に変換されます。  <br/> |
|NYSitePrefix  <br/> |ネットワーク内プレフィックス (6) および NY のサイト コード (333) 付きの番号を変換します。  <br/> |^ 6333 (\d{4}) $  <br/> |+1202555$1  <br/> |63330100 が +12025550100 に変換されます。  <br/> |
|DallasSitePrefix  <br/> |ネットワーク内プレフィックス (6) および Dallas のサイト コード (444) 付きの番号を変換します。  <br/> |^ 6444 (\d{4}) $  <br/> |+1972555$1  <br/> |64440100 が +19725550100 に変換されます。  <br/> |
   
以下の表は、Redmond (Washington、米国) の場所のダイヤル プランの例です。これは、前の表に示す正規化ルールに基づいています。
  
**表 2. 表 1 の正規化ルールに基づく Redmond のダイヤル プラン**

|**Redmond.forestFQDN**|
|:-----|
|5digitExtension  <br/> |
|7digitcallingRedmond  <br/> |
|10digitcallingUS  <br/> |
|IntlCallingUS  <br/> |
|RedmondSitePrefix  <br/> |
|NYSitePrefix  <br/> |
|DallasSitePrefix  <br/> |
|RedmondOperator  <br/> |
   
> [!NOTE]
> 前の表に記載した正規化ルールの名前にはスペースが含まれていませんが、これは任意に設定できます。たとえば、この表の最初の名前は、「5 digit extension」または「5-digit Extension」のどちらで記述しても問題ありません。 
  
## <a name="voice-policies"></a>音声ポリシー

Skype for Business Server のボイスポリシーは、ポリシーが割り当てられているユーザー、サイト、または組織ごとに次の内容を定義します。
  
- ユーザーが使用できるエンタープライズボイス機能を決定するために有効または無効にできる一連の通話機能。
    
- 承認される通話の種類を定義する一連の公衆交換電話網 (PSTN) 使用法レコード。 
    
エンタープライズ Voip の展開に必要な音声ポリシーを計画するには、次の手順を実行します。
  
- グローバル音声ポリシー (製品と共にインストールされる既定の音声ポリシー) の構成方法を決定する。 このポリシーは、サイトレベルまたはユーザーごとのポリシーを明示的に割り当てられていないすべてのエンタープライズボイスユーザーに適用されます。
    
- 必要なサイトレベルの音声ポリシーをすべて識別する。
    
- 必要なユーザー単位の音声ポリシーをすべて識別する。
    
- 音声ポリシーごとに、有効にする通話機能を決定する。
    
- 音声ポリシーごとに、構成する PSTN 使用法レコードを決定する。
    
### <a name="voice-policy-scope"></a>音声ポリシー スコープ

音声ポリシー スコープにより、ポリシーを適用可能な階層レベルが決まります。 Skype for Business Server では、次のスコープレベルでボイスポリシーを構成できます (最も限定的なものから最も一般的なものに一覧表示されています)。
  
- **ユーザー音声ポリシー**は、個々のユーザー、グループ、または連絡先オブジェクトに割り当てることができます。これは最下位レベルのポリシーです。ユーザー音声ポリシーを展開することにより、サイトの特定のユーザーまたはグループを対象に機能を有効にし、同じサイトの他のユーザーまたはグループに対しては有効にしないようにすることができます。たとえば、一部の従業員に対しては長距離ダイヤル機能を無効にすることができます。連絡先オブジェクトは、音声ポリシーを割り当てる目的で個々のユーザーとして扱われます。
    
    > [!NOTE]
    > セントラルサイト展開に登録されている支店サイトのエンタープライズ Voip ユーザー、または Survivable Branch アプライアンスに登録されているユーザーには、ユーザーの音声ポリシーを展開することをお勧めします。 
  
- **サイト音声ポリシー**は、ユーザー音声ポリシーが割り当てられているユーザー、グループ、または連絡先オブジェクトを除いて、サイト全体に適用されます。サイト音声ポリシーを定義するには、ポリシーを適用するサイトを指定する必要があります。ユーザー音声ポリシーが割り当てられていない場合は、サイト音声ポリシーを使用します。
    
- **グローバル音声ポリシー**は、製品と一緒にインストールされる既定の音声ポリシーです。 グローバル音声ポリシーは、組織の具体的な必要性を満たすように編集できますが、名前を変更したり、削除したりすることはできません。 このボイスポリシーは、より具体的なスコープでボイスポリシーを構成して割り当てる場合を除き、展開内のすべてのエンタープライズボイスユーザー、グループ、連絡先オブジェクトに適用されます。 このポリシー全体を無効にする場合は、サイトおよびユーザーのすべてにカスタム ポリシーが割り当てられるようにしてください。
    
### <a name="call-features"></a>通話機能

音声ポリシーごとに、以下の通話機能を有効または無効にすることができます。
  
- [**着信の転送**] では、他の電話機やクライアント デバイスに通話を転送できます。既定では有効です。
    
- [**委任**] では、代わりに通話を送受信する他のユーザーを指定できます。既定では有効です。
    
- [**通話の転送**] では、他のユーザーに通話を転送できます。既定では有効です。
    
- [**コール パーク**] では、通話を保留し、別の電話機やクライアントで受けることができます。既定では無効です。
    
- [**同時呼び出し**] では、追加の電話機 (携帯電話など) や他のエンドポイント デバイスで、着信の呼び出し音を鳴らすことができます。既定では有効です。
    
- [**チーム呼び出し**] では、定義したチームのユーザーがチームの他のメンバーの呼び出しに応答できます。既定では有効です。
    
- [**PSTN 再ルート**] では、WAN が混雑していたり利用できない場合に、このポリシーを割り当てられているユーザーが他のエンタープライズ ユーザーに発信した通話を、公衆交換電話網 (PSTN) で再ルートできます。既定では有効です。
    
- [**帯域幅ポリシーの上書き**] により管理者は、特定のユーザーに関する通話受付管理ポリシーによる決定を上書きできます。既定では無効です。
    
- **悪意のある通話トレース**を使用すると、ユーザーは Skype for business クライアントを使って悪意のある電話を報告し、通話の詳細レコード内のそのような呼び出しにフラグを付けることができます。 既定では無効です。
    
- **ボイスメールエスケープ**を使って、同時呼び出しが構成されていて、電話がオフになっている場合や、バッテリーが切れている場合や、タイマーの値に基づいている場合に、ユーザーの携帯電話のボイスメールシステムに直接通話がルーティングされないようにします。 この設定でタイマーを有効または無効にし、タイマーの値を設定します。 この構成は、Skype for Business Server 管理シェルを使用してのみ行うことができます。 既定では無効です。
    
- **着信の転送と同時**呼び出しの pstn の使用管理者は、着信の転送と同時呼び出しのボイスポリシーと同じ PSTN 使用を指定できます。着信の転送と同時呼び出しは、内部の Skype に限定されます。ビジネスユーザーのみ、またはボイスポリシーの PSTN 使用状況とは異なるカスタム PSTN 使用を指定します。 既定では、着信の転送および同時呼び出しに対して音声ポリシーと同じ PSTN 使用法を使用します。
    
### <a name="pstn-usage-records"></a>PSTN 使用法レコード

各音声ポリシーには、1 つ以上の PSTN 使用法レコードが関連付けられている必要があります。PSTN 使用法は、同時呼び出しおよび着信の転送のみのための音声ポリシーと関連付けることができます。 
  
> [!NOTE]
> 発信ルーティング機能では、ユーザーとルートの照合時に PSTN 使用法を上位から下位の順に比較するため、PSTN 使用法の順序は重要です。最初の使用法が通話ルートに一致した場合は、そのルートが使用されます。一致しない場合、発信ルーティング機能はリスト内の次の PSTN 使用法との照合を、一致が検出されるまで続けます。事実上、後続の PSTN 使用法は、リストの最初の使用法が使用できない場合のバックアップとなります。 
  
## <a name="pstn-usage-records"></a>PSTN 使用法レコード

PSTN 使用法レコードの計画では、主に、CEO から派遣社員、コンサルタント、および臨時スタッフに至る組織内のすべてのユーザーに現在適用されているすべての通話許可の一覧を作成します。 この作業を行うと、既存の通話許可を再度検証し、それらを修正することができます。 予想されるエンタープライズ Voip ユーザーに適用される通話のアクセス許可に対してのみ、PSTN 使用状況レコードを作成できますが、現在のところ一部ではない可能性があるかどうかにかかわらず、すべての通話アクセス許可について PSTN 使用状況レコードを作成することがあります。エンタープライズ Voip を有効にするユーザーのグループに適用します。 通話許可の変更や、異なる通話許可を持つ新規ユーザーを追加する場合でも、必要な電話 PSTN 使用法レコードは既に作成済みであるため、新しく作成する必要がありません。
  
次の表に、一般的な PSTN 使用法テーブルを示します。
  
**PSTN 使用法レコード**

|**電話属性**|**説明**|
|:-----|:-----|
|Local  <br/> |市内通話  <br/> |
|Long-Distance  <br/> |長距離通話  <br/> |
|International  <br/> |国際通話  <br/> |
|Delhi  <br/> |Delhi のフルタイム社員  <br/> |
|Redmond  <br/> |Redmond のフルタイム社員  <br/> |
|RedmondTemps  <br/> |Redmond の派遣社員  <br/> |
|Zurich  <br/> |Zurich のフルタイム社員  <br/> |
   
PSTN 使用法レコードは単独では機能しません。PSTN 使用法レコードは、以下と組み合わせて使用する必要があります。
  
- 音声ポリシー (ユーザーに割り当てる)
    
- ルート (電話番号に割り当てる)
    
## <a name="voice-routes"></a>音声ルート

通話ルートは、Skype for Business Server がエンタープライズボイスユーザーによる発信通話をどのように処理するかを指定します。 ユーザーが番号をダイヤルすると、フロントエンドサーバーは、必要に応じてダイヤル文字列を E.i 形式に正規化し、SIP URI と一致させようとします。 一致する SIP URI が見つからない場合は、番号に基づいて発信通話ルーティング ロジックが適用されます。 発信通話ルーティング ロジックを定義する最後のステップでは、ダイヤル プランごとの各相手電話番号に対して、個別の名前が付けられた通話ルートが作成されます。
  
発信通話ルートを定義する前に、次のステップを実行しておく必要があります。
  
- 1 つ以上のトランクの展開
    
- 必要に応じた、場所、個々のユーザー、および連絡先オブジェクトに対するダイヤル プランの作成
    
- 公衆交換電話網 (PSTN) の使用法レコードの作成
    
さらに、発信通話ルーティングを有効にするには、1 つ以上の音声ポリシーを作成して割り当てる必要があります。このステップは、発信通話ルートを定義する前および定義した後のどちらでも実行できます。
  
各ルートごとに、次の項目を指定する必要があります。
  
- 簡単に識別できる名前
    
- オプションの説明 (名前だけではルートの内容を十分に説明できない場合に使用)
    
- ルートを適用する対象となる、相手電話番号を識別する正規表現による一致パターンと、一致パターンを適用させない例外
    
- ルートに割り当てる 1 つ以上のトランク
    
- 相手電話番号の正規表現に一致する電話番号を発信するために、ユーザーに必要な PSTN 使用法レコード
    
通話ルートは、Skype for Business Server コントロールパネルで指定できます。 これらの通話ルートによって、Skype for Business Server が PSTN 宛ての通話をルーティングするために使用するサーバールーティングテーブルが設定されます。
  
### <a name="mn-trunk-support"></a>M:N トランクのサポート

Skype for Business Server では、通話を PSTN にルーティングするときの柔軟性が提供されています。 ボイス ルートは、特定の音声通話に対して使用できる PSTN へのトランクのセットを指定します。 トランクは、仲介サーバーとポート番号を PSTN ゲートウェイとリスニングポート番号と関連付けます。 この論理的な関連付けによって、仲介サーバーが複数のゲートウェイに関連付けられ、同じゲートウェイへの複数の接続が可能になります。 通話ルートを定義する場合は、そのルートに関連付けられている trunks を指定しますが、そのルートに関連付ける仲介サーバーを指定する必要はありません。 仲介サーバーと PSTN ゲートウェイ、IP-Pbx、およびセッション境界コントローラー (SBCs) 間の関係を定義して trunks を作成するには、トポロジビルダーを使用します。
  
### <a name="least-cost-routing"></a>最小コスト ルーティング

さまざまな番号のルーティング先であるトランクを指定する機能を使用すると、コストが最も低くなるルートを判断し、それに従ってルーティングできます。この機能は、長距離通話料金を最も少なくするために、宛先の番号の場所に最も近いゲートウェイを含むトランクを選択して指定します。たとえば、ニューヨークからローマの番号に発信する場合に、ローマの事務所のゲートウェイを含むトランクまで IP ネットワークを介して通話を中継すると、支払いが必要になるのは市内通話料金だけになります。
  
使用頻度の低いルーティング方法の例については、次の点を考慮してください。 Fabrikam は、ドイツのユーザーが米国トランクを使って米国の番号をダイヤルできるようにすることを決定しました。 Fabrikam は、米国の Skype for Business Server ユーザーからドイツの国/地域へのすべての通話がドイツのゲートウェイで終了するようにシステムを構成することも求めています。 たとえば、ドイツからオーストリアへの通話は、米国内からオーストリアへの通話よりも経費が安いためです。
  
### <a name="translating-outbound-dial-strings"></a>発信ダイヤル文字列の変換

Skype for Business Server では、逆引き数値参照 (RNL) を実行するために、すべてのダイヤル文字列が E.i 形式に正規化されている必要があります。 ローカルのダイヤル形式で数値を変換する必要があるゲートウェイまたは私的な支店 (Pbx) を使用する trunks の場合、Skype for Business Server では、ルーティング前の番号の操作を支援する1つまたは複数のルールを作成することができます。これを樹幹にします。 たとえば、+44 をダイヤル文字列の先頭から削除し、0144 に置き換えるルールを作成できます。
  
Skype for Business Server では、トランクにルーティングする前に、通話番号の操作を支援する1つまたは複数のルールを作成できます。
  
ゲートウェイ: ポートペアと仲介サーバーの組み合わせを関連付ける trunks を計画する際には、同様のローカルダイヤル要件を持つ trunks をグループ化することで、必要な翻訳ルールの数と書き込みにかかる時間を減らすことができます。
  
### <a name="configuring-caller-id"></a>発信者番号の構成

Skype for Business Server は、発信通話の発信者番号通知を操作するための手段を提供します。 たとえば、組織で従業員の直通ダイヤルの内線番号をマスクし、それを一般的な企業または部署の番号に置き換える場合は、管理者が Skype for Business Server コントロールパネルを使って発信者番号認識を抑制して置き換えることができます。別の発信者番号を指定します。 ルーティングロジックを計画する際には、このオプションを使用する個人、グループ、サイト (たとえば、すべての従業員について) を検討します。
  
> [!NOTE]
> PSTN を介して再ルーティングされる通話の場合、元の発信者番号ではなく、一般的な発信者番号が表示されます。これにより、通話の呼び出し先が構成した応答不可設定またはプライバシー設定がバイパスされる場合があります。 
  
### <a name="additional-routing-logic"></a>その他のルーティング ロジック

発信通話ルートを作成する際には、以下の要因がルーティング ロジックに作用することを認識しておく必要があります。
  
- フェデレーションの境界を越えて通話が確立される場合、URI のドメイン部分を使用して、発信ルーティング ロジックの適用を行うエンタープライズに通話をルーティングします。
    
- 要求 URI のドメイン部分にエンタープライズでサポートされているドメインが含まれていない場合、サーバーの発信ルーティング コンポーネントは通話の処理を行いません。
    
- ユーザーがエンタープライズ Voip を有効にしていない場合は、必要に応じて、サーバーが他のルーティングロジックを適用します。
    
- 空き回線のないゲートウェイ (すべてのトランク回線が使用中) に通話がルーティングされると、ゲートウェイによって通話が拒否されるため、発信ルーティング コンポーネントは次にコストの低いルートに通話をリダイレクトします。海外の小規模な支店 (たとえば、チューリヒ) に合わせて構成された小規模なゲートウェイが、実際にはスイス宛ての大量の国際通話を処理するような場合があるため、ルーティングには詳細な配慮が必要です。このような追加トラフィックに対応できるようにゲートウェイのサイズを適正に構成していない場合は、スイス宛ての通話がドイツにあるゲートウェイを経由してルーティングされ、多額の通話料金が発生する可能性があります。
    

