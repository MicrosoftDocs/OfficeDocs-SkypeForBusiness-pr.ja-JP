---
title: Skype for Business Server での発信音声ルーティングを計画する
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
audience: ITPro
ms.topic: conceptual
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection:
- IT_Skype16
- Strat_SB_Admin
ms.custom: ''
ms.assetid: fde45195-6eb4-403c-9094-57df7fc0bd2a
description: 通話ルーティング設定、ダイヤル プラン、正規化ルール、音声ポリシー、PSTN 使用法レコード、ボイス ルートなど、Skype for Business Server エンタープライズ VoIP での発信音声ルーティングについて説明します。
ms.openlocfilehash: f29feabe8ad13a38af3e3818936be7cfbcdf5f06
ms.sourcegitcommit: c528fad9db719f3fa96dc3fa99332a349cd9d317
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/12/2021
ms.locfileid: "49809917"
---
# <a name="plan-for-outbound-voice-routing-in-skype-for-business-server"></a>Skype for Business Server での発信音声ルーティングを計画する
 
通話ルーティング設定、ダイヤル プラン、正規化ルール、音声ポリシー、PSTN 使用法レコード、ボイス ルートなど、Skype for Business Server エンタープライズ VoIP での発信音声ルーティングについて説明します。
  
発信通話ルーティングは、公衆交換エンタープライズ VoIP (PSTN) ゲートウェイ、トランク、または PBX (Private Branch Exchange) 宛ての通話に適用されます。 Skype for Business ユーザーが通話を行う場合、サーバーは必要に応じて電話番号を E.164 形式に正規化し、SIP URI と一致します。 一致する SIP URI が見つからない場合は、指定されたダイヤル文字列に基づいて発信通話ルーティング ロジックが適用されます。 ユーザーは、次の表で説明するサーバー設定を構成することで、そのロジックを定義します。
  
**Skype for Business Server の発信通話ルーティング設定**

|**オブジェクト**|**説明**|
|:-----|:-----|
|ダイヤル プラン  <br/> |ダイヤル プランとは、電話番号の承認と通話のルーティングを目的として、特定の場所、個々のユーザー、または連絡先オブジェクトの電話番号を 1 つの標準形式 (E.164) に変換する正規化ルールのセットに名前を付けたものです。  <br/> |
|正規化ルール  <br/> |正規化ルールは、さまざまな形式で表現された電話番号を指定された各場所、ユーザー、または連絡先オブジェクトにルーティングする方法を定義します。ダイヤル元の場所および電話をかける人や連絡先オブジェクトによって、同じダイヤル文字列が異なる方法で解釈および変換される場合があります。特定の位置に関連付けられた正規化ルールをまとめたものが、ダイヤル プランです。  <br/> |
|音声ポリシー  <br/> |音声ポリシーでは、1 つ以上の PSTN 使用法レコードを 1 人のユーザーまたはユーザーのグループに関連付けます。 音声ポリシーも、ユーザーが有効と無効を切り替えできる通話機能のリストを提供します。  <br/> |
|PSTN 使用法レコード  <br/> |PSTN 使用法レコードは、組織内のさまざまなユーザーまたはグループが利用できる通話のクラス (内部、市内、長距離など) を指定します。  <br/> |
|通話ルート  <br/> |通話ルートでは、通話先の電話番号を特定のトランクおよび PSTN 使用法レコードに関連付けます。 PSTN ゲートウェイはトランクとみなされます。  <br/> |
   
## <a name="dial-plans-and-normalization-rules"></a>ダイヤル プランと正規化ルール

ダイヤル プランとは、電話番号の承認と通話のルーティングを目的として、特定の場所、個々のユーザー、または連絡先オブジェクトの電話番号を 1 つの標準形式 (E.164) に変換する正規化ルールのセットに名前を付けたものです。 
  
正規化ルールは、さまざまな形式で表現された電話番号を指定された各場所、ユーザー、または連絡先オブジェクトにルーティングする方法を定義します。 ダイヤルされた場所と、呼び出しを行うユーザーまたは連絡先オブジェクトに応じて、同じダイヤル文字列が異なる方法で解釈および変換される場合があります。
  
### <a name="dial-plan-scope"></a>ダイヤル プランのスコープ

ダイヤル プランのスコープは、ダイヤル プランを適用できる階層レベルを決定します。 Skype for Business Server では、ユーザーに特定のユーザーごとのダイヤル プランを割り当てることができます。 ユーザー ダイヤル プランが割り当てられていない場合は、フロントエンド プールのダイヤル プランが適用されます。 フロント エンド プールのダイヤル プランがない場合は、サイト ダイヤル プランが適用されます。 ユーザーに適用可能な他のダイヤル プランがない場合は、最後にグローバル ダイヤル プランが適用されます。
  
クライアントは、ユーザーが Skype for Business にログオンするときに提供されるインバンド プロビジョニング設定によってダイヤル プランのスコープ レベルを取得します。 管理者は、Skype for Business Server コントロール パネルを使用してダイヤル プランのスコープ レベルを管理および割り当てできます。
  
> [!NOTE]
> サービス レベルの公衆交換電話網 (PSTN) ゲートウェイ ダイヤル プランは、特定のゲートウェイからの着信呼び出しに適用されます。 
  
ダイヤル プランのスコープ レベルは、次のように定義されます。
  
- **ユーザー ダイヤル プラン**: 個々のユーザー、グループ、または連絡先オブジェクトに割り当てることができます。 音声アプリケーションは、電話コンテキストがユーザーの既定値に設定された通話を受信すると、ユーザーごとのダイヤル プランを参照できます。 ダイヤル プランを割り当てる目的で、連絡先オブジェクトは個々のユーザーとして扱います。
    
- **プール ダイヤル プラン**: トポロジ内の PSTN ゲートウェイまたはレジストラーのサービス レベルで作成できます。 プール ダイヤル プランを定義するには、ダイヤル プランを適用する特定のサービス (PSTN ゲートウェイまたはレジストラー プール) を指定する必要があります。 
    
- **サイト ダイヤル プラン**: プール ダイヤル プランまたはユーザー ダイヤル プランが割り当てられているユーザー、グループ、または連絡先オブジェクトを除き、サイト全体に対して作成できます。 サイト ダイヤル プランを定義するには、ダイヤル プランを適用するサイトを指定する必要があります。
    
- **グローバル ダイヤル プラン**: 製品と一緒にインストールされた既定のダイヤル プラン。 グローバル ダイヤル プランは、編集はできますが削除することはできません。 このダイヤル プランは、より具体的なスコープでダイヤル プランを構成して割り当てない限り、展開内のすべての エンタープライズ VoIP ユーザー、グループ、および連絡先オブジェクトに適用されます。
    
### <a name="planning-for-dial-plans"></a>ダイヤル プランの計画

ダイヤル プランを計画するには、次の手順を実行します。
  
- 組織がオフィスを持つすべてのローカルを一覧表示します。
    
    リストは最新の完全なリストである必要があります。 また、組織の変化に合わせて改訂する必要があります。 多数の小規模ブランチ オフィスを持つ大規模な多国籍企業では、これは時間のかかる作業になる可能性があります。
    
- 各サイトの有効な番号パターンを特定します。
    
    ダイヤル プランの計画で最も時間がかかるのは、それぞれのサイトの有効な番号パターンを特定することです。 あるダイヤル プラン用に記述した正規化ルールを他のダイヤル プランにコピーできる場合があります (特に、対応しているサイトが同じ国/地域または大陸にある場合)。 これ以外の場合でも、あるダイヤル プランの番号を少し変更すれば他のダイヤル プランに十分使用できる場合があります。
    
- ダイヤル プランに名前を付ける組織全体のスキームを開発します。
    
    標準の名前付けスキームを採用することで、組織間の一貫性を保ち、メンテナンスと更新を簡単に行うことができます。
    
- 1 つの場所に複数のダイヤル プランが必要かどうかを決定します。 
    
    組織が複数の場所にまたがって単一のダイヤル プランを維持している場合でも、プライベートブランチ 交換 (PBX) から移行し、既存の内線番号を保持する必要がある エンタープライズ VoIP ユーザーに対して個別のダイヤル プランを作成する必要がある場合があります。
    
- ユーザーごとのダイヤル プランが必要かどうかを決定します。 たとえば、中央サイトに登録されているブランチ サイトのユーザーや、存続可能ブランチ アプライアンスに登録されているユーザーがある場合は、ユーザーごとのダイヤル プランと正規化ルールを使用するこのようなユーザーに対して特別なダイヤル シナリオを検討できます。 詳細については [、「Plan for エンタープライズ VoIP resiliency in Skype for Business Server 」を参照してください](enterprise-voice-resiliency.md)。
    
- ダイヤル プランのスコープを決定します (このトピックで前述したとおり)。
    
ダイヤル プランを作成するには、Skype for Business Server コントロール パネルまたは Skype for Business Server 管理シェルを使用して、必要に応じて次のフィールドに値を指定します。
  
#### <a name="name-and-simple-name"></a>名前および簡単な名前

ユーザー ダイヤル プランの場合は、ダイヤル プランを割り当てるユーザー、グループ、または連絡先オブジェクトを識別するわかりやすい名前を指定する必要があります。 サイト ダイヤル プランの場合、[名前] フィールドにはサイト名が事前に入力され、変更できません。 プール ダイヤル プランの場合、[名前] フィールドには PSTN ゲートウェイまたはフロントエンド プールの完全修飾ドメイン名 (FQDN) が事前に入力され、変更できません。
  
ダイヤル プランの簡易名には、ダイヤル プラン名から派生した文字列が事前に入力されています。 [簡単な名前] フィールドは編集可能で、ダイヤル プランのわかりやすい名前付け規則を作成できます。 TheSimple Name value cannot be empty and must be unique. ベスト プラクティスは、組織全体の名前付け規則を作成し、その規則をすべてのサイトとユーザーで一貫して使用する方法です。
  
#### <a name="description"></a>説明

対応するダイヤル プランが適用される地理的な場所の、一般的でわかりやすい名前を入力することをお勧めします。 たとえば、ダイヤル プランの名前が London.Contoso.com である場合、説明を London とすることをお勧めします。 
  
#### <a name="dial-in-conferencing-region"></a>ダイヤルイン会議の地域

ダイヤルイン会議を展開している場合、ダイヤルイン会議の地域を指定し、ダイヤルイン会議のアクセス番号をダイヤル プランと関連付ける必要があります。 
  
#### <a name="external-access-prefix"></a>外部アクセス プレフィックス

ユーザーが外線を取得するために先頭に 1 つ以上の数字 (9 など) をダイヤルする必要がある場合は、最大 4 文字 (#、および 0 ~ 9) の外部アクセス プレフィックスを指定できます。 \*
  
> [!NOTE]
> 外部アクセス プレフィックスを指定する場合に、プレフィックスに対応するために追加の正規化ルールを作成する必要はありません。 
  
### <a name="normalization-rules"></a>正規化ルール

正規化ルールは、さまざまな形式で表された電話番号を名前付き場所にルーティングする方法を定義します。 ダイヤルするロケールによって、同じ番号文字列が異なる方法で解釈および変換される場合があります。 正規化ルールは、ユーザーが連絡先リストに電話番号を入力する際にさまざまな形式を使用し、使用することができるため、通話ルーティングに必要です。
  
ユーザーが指定した電話番号を正規化すると、一貫した形式が提供され、次のタスクが容易になります。
  
- ダイヤルされた番号を、目的の受信者の SIP-URI と一致します。
    
- 呼び出し元にダイヤルの承認ルールを適用します。
    
次の番号フィールドでは、正規化ルールの考慮が必要になる可能性があります。
  
- ダイヤル プラン
    
- 国番号
    
- 市外局番
    
- 内線番号の長さ
    
- サイトのプレフィックス
    
#### <a name="creating-normalization-rules"></a>正規化ルールの作成

正規化ルールでは、.NET Framework 正規表現を使用して、サーバーが逆引き番号検索を実行するためにダイヤル文字列を E.164 形式に変換するために使用する数値の一致パターンを指定します。 Skype for Business Server コントロール パネルで正規化ルールを作成するには、式を手動で入力するか、開始番号と一致するダイヤル文字列の長さを入力して、Skype for Business Server コントロール パネルで対応する正規表現を生成します。 どちらの方法でも、終了したら、テスト番号を入力して、正規化ルールが期待通り動作するか確認できます。
  
.NET Framework 正規表現の使用の詳細については [、「".NET Framework Regular Expressions"」を参照してください](https://go.microsoft.com/fwlink/p/?linkId=140927)。
  
#### <a name="sample-normalization-rules"></a>正規化ルールの例
<a name="BKMK_SampleNormalizationRules"> </a>

次の表は、.NET Framework 正規表現で記述された正規化ルールの例です。 ここに示すのは単なる例であり、ご自分の正規化ルールをこのとおりに作成する必要はありません。
  
**表 1. .NET Framework 正規表現を使用した正規化ルール**

|**ルール名**|**説明**|**番号パターン**|**翻訳**|**例**|
|:-----|:-----|:-----|:-----|:-----|
|4digitExtension  <br/> |4 桁の内線番号を変換します。  <br/> |^(\d{4})$  <br/> |+1425555$1  <br/> |0100 が +14255550100 に変換されます。  <br/> |
|5digitExtension  <br/> |5 桁の内線番号を変換します。  <br/> |^5(\d {4} )$  <br/> |+1425555$1  <br/> |50100 が +14255550100 に変換されます。  <br/> |
|7digitcallingRedmond  <br/> |7 桁の番号を Redmond の電話番号に変換します。  <br/> |^(\d{7})$  <br/> |+1425$1  <br/> |5550100 が +14255550100 に変換されます。  <br/> |
|7digitcallingDallas  <br/> |7 桁の番号を Dallas の電話番号に変換します。  <br/> |^(\d{7})$  <br/> |+1972$1  <br/> |5550100 が +19725550100 に変換されます。  <br/> |
|10digitcallingUS  <br/> |米国の 10 桁の番号を変換します。  <br/> |^(\d{10})$  <br/> |+1$1  <br/> |2065550100 が +12065550100 に変換されます。  <br/> |
|LDCallingUS  <br/> |米国の長距離プレフィックス付きの番号を変換します。  <br/> |^1(\d {10} )$  <br/> |+$1  <br/> |12145550100 が +2145550100 に変換されます。  <br/> |
|IntlCallingUS  <br/> |米国の国際プレフィックス付きの番号を変換します。  <br/> |^011(\d \* )$  <br/> |+$1  <br/> |01191445550100 が +91445550100 に変換されます。  <br/> |
|RedmondOperator  <br/> |0 を Redmond のオペレータ呼び出し番号に変換します。  <br/> |^0$  <br/> |+14255550100  <br/> |0 が +14255550100 に変換されます。  <br/> |
|RedmondSitePrefix  <br/> |ネットワーク内プレフィックス (6) および Redmond のサイト コード (222) 付きの番号を変換します。  <br/> |^6222(\d {4} )$  <br/> |+1425555$1  <br/> |62220100 が +14255550100 に変換されます。  <br/> |
|NYSitePrefix  <br/> |ネットワーク内プレフィックス (6) および NY のサイト コード (333) 付きの番号を変換します。  <br/> |^6333(\d {4} )$  <br/> |+1202555$1  <br/> |63330100 が +12025550100 に変換されます。  <br/> |
|DallasSitePrefix  <br/> |ネットワーク内プレフィックス (6) および Dallas のサイト コード (444) 付きの番号を変換します。  <br/> |^6444(\d {4} )$  <br/> |+1972555$1  <br/> |64440100 が +19725550100 に変換されます。  <br/> |
   
以下の表は、Redmond (Washington、米国) の場所のダイヤル プランの例です。これは、前の表に示す正規化ルールに基づいています。
  
**表 2. 表 1 の正規化ルールに基づく Redmond のダイヤル プラン**

|**Redmond.forestFQDN**|
|:-----|
|5digitExtension  <br/> |
|7digitcallingRedmond  <br/> |
|10digitcallingUS  <br/> |
|IntlCallingUS  <br/> |
|RedmondSitePrefix  <br/> |
|NYSitePrefix  <br/> |
|DallasSitePrefix  <br/> |
|RedmondOperator  <br/> |
   
> [!NOTE]
> 前の表に記載した正規化ルールの名前にはスペースが含まれていませんが、これは任意に設定できます。たとえば、この表の最初の名前は、「5 digit extension」または「5-digit Extension」のどちらで記述しても問題ありません。 
  
## <a name="voice-policies"></a>音声ポリシー

Skype for Business Server 音声ポリシーは、ポリシーが割り当てられているユーザー、サイト、または組織ごとに次を定義します。
  
- ユーザーが使用できる通話機能を決定するために有効または無効エンタープライズ VoIP機能のセット。
    
- 承認される通話の種類を定義する一連の公衆交換電話網 (PSTN) 使用法レコード。 
    
次の手順は、展開環境で必要な音声ポリシーを計画エンタープライズ VoIPします。
  
- グローバル音声ポリシー (製品と共にインストールされる既定の音声ポリシー) の構成方法を決定する。 このポリシーは、サイト レベルエンタープライズ VoIPユーザーごとのポリシーが明示的に割り当てられていないすべてのユーザーに適用されます。
    
- 必要なサイトレベルの音声ポリシーをすべて識別する。
    
- 必要なユーザー単位の音声ポリシーをすべて識別する。
    
- 音声ポリシーごとに、有効にする通話機能を決定する。
    
- 音声ポリシーごとに、構成する PSTN 使用法レコードを決定する。
    
### <a name="voice-policy-scope"></a>音声ポリシー スコープ

音声ポリシー スコープにより、ポリシーを適用可能な階層レベルが決まります。 Skype for Business Server では、次のスコープ レベル (最も具体的なレベルから最も一般的なレベルまで) を使用して音声ポリシーを構成できます。
  
- **ユーザー音声ポリシー** は、個々のユーザー、グループ、または連絡先オブジェクトに割り当てることができます。これは最下位レベルのポリシーです。ユーザー音声ポリシーを展開することにより、サイトの特定のユーザーまたはグループを対象に機能を有効にし、同じサイトの他のユーザーまたはグループに対しては有効にしないようにすることができます。たとえば、一部の従業員に対しては長距離ダイヤル機能を無効にすることができます。連絡先オブジェクトは、音声ポリシーを割り当てる目的で個々のユーザーとして扱われます。
    
    > [!NOTE]
    > ブランチ サイトのユーザー音声ポリシーは、中央サイト展開に登録されている エンタープライズ VoIP ユーザー、または存続可能ブランチ アプライアンスに登録されているユーザーに展開することをお勧めします。 
  
- **サイト音声ポリシー** は、ユーザー音声ポリシーが割り当てられているユーザー、グループ、または連絡先オブジェクトを除いて、サイト全体に適用されます。サイト音声ポリシーを定義するには、ポリシーを適用するサイトを指定する必要があります。ユーザー音声ポリシーが割り当てられていない場合は、サイト音声ポリシーを使用します。
    
- **グローバル音声ポリシー** は、製品と一緒にインストールされる既定の音声ポリシーです。 グローバル音声ポリシーは、組織の具体的な必要性を満たすように編集できますが、名前を変更したり、削除したりすることはできません。 この音声ポリシーは、展開内のすべての エンタープライズ VoIP ユーザー、グループ、および連絡先オブジェクトに適用されます。具体的なスコープを持つ音声ポリシーを構成して割り当てない限りです。 このポリシー全体を無効にする場合は、サイトおよびユーザーのすべてにカスタム ポリシーが割り当てられるようにしてください。
    
### <a name="call-features"></a>通話機能

音声ポリシーごとに、以下の通話機能を有効または無効にすることができます。
  
- [**着信の転送**] では、他の電話機やクライアント デバイスに通話を転送できます。既定では有効です。
    
- [**委任**] では、代わりに通話を送受信する他のユーザーを指定できます。既定では有効です。
    
- [**通話の転送**] では、他のユーザーに通話を転送できます。既定では有効です。
    
- [**コール パーク**] では、通話を保留し、別の電話機やクライアントで受けることができます。既定では無効です。
    
- **[同時呼び出し]** では、追加の電話機 (携帯電話など) や他のエンドポイント デバイスで、着信の呼び出し音を鳴らすことができます。既定では有効です。
    
- [**チーム呼び出し**] では、定義したチームのユーザーがチームの他のメンバーの呼び出しに応答できます。既定では有効です。
    
- **[PSTN 再ルート]** では、WAN が混雑していたり利用できない場合に、このポリシーを割り当てられているユーザーが他のエンタープライズ ユーザーに掛けた通話を、公衆交換電話網 (PSTN) で再ルートできます。既定では有効です。
    
- [**帯域幅ポリシーの上書き**] により管理者は、特定のユーザーに関する通話受付管理ポリシーによる決定を上書きできます。既定では無効です。
    
- **悪意のある呼び出** しトレースを使用すると、ユーザーは Skype for Business クライアントを使用して悪意のある呼び出しを報告し、通話詳細記録でそのような呼び出しにフラグを設定できます。 既定では無効です。
    
- **ボイス** メール エスケープは、同時呼び出しが構成され、電話がオフ、バッテリ切れ、または使用範囲外のときに、通話がユーザーの携帯電話ボイスメール システムにすぐにルーティングされるのを防ぎ、タイマー値に基づいて行います。 この設定でタイマーを有効または無効にし、タイマーの値を設定します。 Skype for Business Server 管理シェルを使用する場合にのみ構成できます。 既定では無効です。
    
- 管理者は、通話の転送と同時呼び出しの **PSTN** 使用法を使用して、通話の転送と同時呼び出しの音声ポリシーと同じ PSTN 使用法を指定したり、内部の Skype for Business ユーザーにのみ呼び出しの転送と同時呼び出しを制限したり、音声ポリシーの PSTN 使用法とは異なるカスタム PSTN 使用法を指定することができます。 既定では、着信の転送および同時呼び出しに対して音声ポリシーと同じ PSTN 使用法を使用します。
    
### <a name="pstn-usage-records"></a>PSTN 使用法レコード

各音声ポリシーには、1 つ以上の PSTN 使用法レコードが関連付けられている必要があります。 PSTN 使用法は、同時呼び出しおよび着信の転送のみのための音声ポリシーと関連付けることができます。 
  
> [!NOTE]
> 発信ルーティング機能では、ユーザーとルートの照合時に PSTN 使用法を上位から下位の順に比較するため、PSTN 使用法の順序は重要です。 最初の使用法が通話ルートに一致した場合は、そのルートが使用されます。 一致しない場合、発信ルーティング機能はリスト内の次の PSTN 使用法との照合を、一致が検出されるまで続けます。 事実上、後続の PSTN 使用法は、リストの最初の使用法が使用できない場合のバックアップとなります。 
  
## <a name="pstn-usage-records"></a>PSTN 使用法レコード

PSTN 使用法レコードの計画では、主に、CEO から派遣社員、コンサルタント、および臨時スタッフに至る組織内のすべてのユーザーに現在適用されているすべての通話許可の一覧を作成します。 この作業を行うと、既存の通話許可を再度検証し、それらを修正することができます。 エンタープライズ VoIP の見込みユーザーに適用する通話許可のみに対応した PSTN 使用法レコードを作成することもできますが、現時点で通話許可がエンタープライズ VoIP で有効なユーザー グループのメンバーに適用されるかどうかに関係なく、すべての通話許可に対応した PSTN 使用法レコードを作成する方が、長期的には優れたソリューションになる場合があります。 通話許可の変更や、異なる通話許可を持つ新規ユーザーを追加する場合でも、必要な電話 PSTN 使用法レコードは既に作成済みであるため、新しく作成する必要がありません。
  
次の表に、一般的な PSTN 使用法テーブルを示します。
  
**PSTN 使用法レコード**

|**電話属性**|**説明**|
|:-----|:-----|
|ローカル  <br/> |市内通話  <br/> |
|Long-Distance  <br/> |長距離通話  <br/> |
|International  <br/> |国際通話  <br/> |
|デリー  <br/> |Delhi のフルタイム社員  <br/> |
|Redmond  <br/> |Redmond のフルタイム社員  <br/> |
|RedmondTemps  <br/> |Redmond の派遣社員  <br/> |
|チューリヒ  <br/> |Zurich のフルタイム社員  <br/> |
   
PSTN 使用法レコードは単独では機能しません。 PSTN 使用法レコードは、以下と組み合わせて使用する必要があります。
  
- 音声ポリシー (ユーザーに割り当てる)
    
- ルート (電話番号に割り当てる)
    
## <a name="voice-routes"></a>音声ルート

通話ルートは、ユーザーが発信した通話を Skype for Business Server が処理エンタープライズ VoIPします。 ユーザーが番号をダイヤルすると、フロント エンド サーバーはダイヤル文字列を必要に応じて E.164 形式に正規化し、SIP URI と一致します。 サーバーが一致しない場合は、番号に基づいて発信通話ルーティング ロジックが適用されます。 このロジックを定義する最後の手順では、各ダイヤル プランに記載されている宛先電話番号のセットごとに個別の名前付き通話ルートを作成します。
  
発信通話ルートを定義する前に、次の手順を実行する必要があります。
  
- 1 つ以上のトランクを展開します。
    
- 必要に応じて、サイト、個人、および連絡先オブジェクトのダイヤル プランを作成します。
    
- 公衆交換電話網 (PSTN) 使用法レコードを作成します。
    
また、発信通話ルーティングを有効にするには、1 つ以上の音声ポリシーを作成して割り当てる必要があります。 これは、発信通話ルートを定義する前または後に行います。
  
ルートごとに、次の項目を指定する必要があります。
  
- ルートを簡単に識別できる名前。
    
- 名前だけではルートを記述できない場合のオプションの説明。
    
- 一致パターンが適用されない例外と共に、ルートが適用される宛先電話番号を識別する正規表現照合パターン。
    
- ルートに割り当てる 1 つ以上のトランク。
    
- 宛先電話番号の正規表現に一致する電話番号を呼び出す場合にユーザーが持っている必要がある PSTN 使用法レコード。
    
Skype for Business Server コントロール パネルで通話ルートを指定できます。 これらの通話ルートは、Skype for Business Server が PSTN 宛の通話をルーティングするために使用するサーバー ルーティング テーブルを設定します。
  
### <a name="mn-trunk-support"></a>M:N トランクのサポート

Skype for Business Server は、通話を PSTN にルーティングする方法を柔軟に提供します。 ボイス ルートは、特定の音声通話に使用できる PSTN へのトランクのセットを指定します。 トランクは、仲介サーバーとポート番号を PSTN ゲートウェイおよびリッスン ポート番号に関連付ける。 この論理関連付けにより、仲介サーバーを複数のゲートウェイに関連付け、同じゲートウェイへの複数の接続を持つ可能性があります。 通話ルートを定義する場合、そのルートに関連付けられているトランクを指定しますが、ルートに関連付けられている仲介サーバーは指定しません。 仲介サーバーと PSTN ゲートウェイ、IP-PBX、セッション ボーダー コントローラー (SBC) の間の関係を定義してトランクを作成するには、トポロジ ビルダーを使用します。
  
### <a name="least-cost-routing"></a>Least-Cost ルーティング

さまざまな番号がルーティングされるトランクを指定する機能を使用すると、コストが最も低いルートを特定し、そのルートを適切に実装できます。 トランクを選択する際の一般的なルールは、長距離料金を最小限に抑えるために、宛先番号の場所に最も近いゲートウェイを持つトランクを選択します。 たとえば、ニューヨークにいて、ローマで番号に電話を発信している場合、IP ネットワークを使用して、ローマのオフィスのゲートウェイを持つトランクに通話を引き継ぐと、ローカル通話の料金が発生します。
  
最小コストのルーティングを使用する方法の例については、次の点を考慮してください。Fabrikam は、ドイツのユーザーが米国のトランクを使用して米国の番号にダイヤルできる設定にしました。 Fabrikam では、米国の Skype for Business Server ユーザーからドイツへのすべての通話と、隣接する国/地域からのすべての通話がドイツのゲートウェイを使用するトランクで終了するシステムを構成する必要があります。 たとえば、ドイツからオーストリアへの通話は、米国からオーストリアへの通話よりも安価なので、このルーティングによって費用が節約されます。
  
### <a name="translating-outbound-dial-strings"></a>発信ダイヤル文字列の変換

Skype for Business Server では、逆引き番号検索 (RNL) を実行するために、すべてのダイヤル文字列を E.164 形式に正規化する必要があります。 ゲートウェイまたは PBX (PBX) を使用するトランクで、ローカルのダイヤル形式で変換された番号を必要とする場合、Skype for Business Server を使用すると、トランクにルーティングする前に、呼び出し先の番号 (要求 URI) の操作を支援する 1 つ以上のルールを作成できます。 たとえば、ダイヤル文字列の頭から +44 を削除して 0144 に置き換えるルールを作成できます。
  
Skype for Business Server では、トランクにルーティングする前に呼び出し番号の操作を支援する 1 つ以上のルールを作成できます。
  
ゲートウェイとポートのペアを仲介サーバーとポートのペアに関連付けるトランクを計画する際に、ローカル ダイヤル要件が類似しているトランクをグループ化すると便利な場合があります。そのため、必要な変換ルールの数と書き込みにかかる時間を短縮できます。
  
### <a name="configuring-caller-id"></a>発信者番号の構成

Skype for Business Server は、発信通話の発信者番号を操作する方法を提供します。 たとえば、組織が従業員のダイレクト ダイヤル内線番号をマスクし、それらを一般的な会社番号または部門番号に置き換える場合、管理者は Skype for Business Server コントロール パネルを使用して発信者番号を非表示にし、指定された代替発信者番号に置き換えます。 ルーティング ロジックを計画する際には、このオプションが必要な個人、グループ、サイト (たとえば、すべての従業員に対して) を検討します。
  
> [!NOTE]
> PSTN を使用して再ルーティングされた通話の場合、元の発信者番号の代わりに汎用の発信者番号が表示されます。 これにより、呼び出し先が構成した[通知不可] またはプライバシー設定がバイパスされる可能性があります。 
  
### <a name="additional-routing-logic"></a>その他のルーティング ロジック

発信通話ルートを作成する際には、ルーティング ロジックに影響を与える可能性がある次の要因に注意する必要があります。
  
- フェデレーション境界を越える呼び出しが確立された場合、URI のドメイン部分を使用して、発信ルーティング ロジックの適用を担当する企業に通話をルーティングします。
    
- 要求 URI のドメイン部分に企業でサポートされているドメインが含まれている場合、サーバー上の発信ルーティング コンポーネントは呼び出しを処理しません。
    
- ユーザーがサーバーに対して有効エンタープライズ VoIP、サーバーは必要に応じて他のルーティング ロジックを適用します。
    
- 通話が完全に占有されているゲートウェイ (すべてのトランク回線がビジー状態) にルーティングされる場合、ゲートウェイは通話を拒否し、発信ルーティング ロジックは通話を次の最小コストのルートにリダイレクトします。 この点は慎重に検討してください。これは、小規模なオフィスの本社 (たとえば、スイス) 用のゲートウェイは、実際にはスイスへの国際通話に対して大量の非国内トラフィックを持ち込む可能性があるためです。 ゲートウェイのサイズがこの追加トラフィックに対して適切に設定されていない場合、スイスへの通話はドイツのゲートウェイを通じてルーティングされ、その結果、より大きな有料料金が発生する可能性があります。
    

