---
title: Skype for Business Server のモビリティの計画
ms.reviewer: ''
ms.author: v-cichur
author: cichur
ms.date: 2/17/2018
manager: serdars
audience: ITPro
ms.topic: conceptual
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 7117eff5-6860-4673-b366-afe0756c4bb2
description: Skype for Business Server の Mobility の実装を計画します。
ms.openlocfilehash: 5c33c88d13dd3720d1526c1620f852fe176a9750
ms.sourcegitcommit: 01087be29daa3abce7d3b03a55ba5ef8db4ca161
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/23/2021
ms.locfileid: "51096643"
---
# <a name="plan-for-mobility-for-skype-for-business-server"></a>Skype for Business Server のモビリティの計画
 
Skype for Business Server の Mobility の実装を計画します。
  
Skype for Business Server を使用すると、モバイル デバイスに Skype for Business Server 機能を提供するモビリティ機能を展開できます。 この記事では、モビリティ機能の詳細を説明し、展開の計画に役立ちます。
  
Skype for Business Server のモビリティ機能は、Skype for Business のモバイル クライアントと、2010 年に戻る Lync クライアントをサポートできます。 展開後、ユーザーはサポートされている iOS、Android、Windows Phone モバイル デバイスを使用して Skype for Business Server 展開に接続し、エンタープライズ VoIP 機能を含むいくつかの異なる機能を利用できます。 以下に部分的な一覧が含まれています。また [、Skype for Business](clients-and-devices/desktop-feature-comparison.md) のデスクトップ クライアント機能の比較を確認して詳細を確認できます。
  
- メッセージの送受信
    
- プレゼンスの表示
    
- 連絡先の表示
    
- クリックして会議に参加する
    
- 仕事を通じて通話する
    
- 単一の番号のリーチ
    
- ボイス メール
    
- 呼び出しの通知が表示されません
    
- ボイス オーバー IP (VoIP)
    
- 出席者ビデオ (H.264)
    
- 会議コンテンツの表示 (PowerPoint とデスクトップ/アプリケーション共有)
    
このすべては、ユニファイド コミュニケーション Web API または UCWA を介して実行されます。 UCWA は Lync Server 2013 で初めて導入されましたが、Skype for Business Server では引き続き使用されています。 Lync 2010 クライアントと通信するための追加の機能があります。これはモビリティ サービス (MCX) です。 これらは無料のサービスであり、Lync Server 2010 および 2013 クライアント、および Skype for Business クライアントが Skype for Business Server 展開に正常にアクセスできます。
  
> [!NOTE]
> 従来のモバイル クライアントの MCX (モビリティ サービス) サポートは、Skype for Business Server 2019 では利用できなくなりました。 現在のすべての Skype for Business モバイル クライアントはUnified Communications Web API (UCWA) を使用して、インスタント メッセージング (IM)、プレゼンス、および連絡先をサポートしています。 MCX を使用している従来のクライアントを持っているユーザーは、現在のクライアントにアップグレードする必要があります。
  
Mobility を実装すると、これらの機能はすべて利用できる一方で、一部のデバイスでは動作が少し異なる場合があります。 Skype for Business のモバイル クライアント機能の比較で、どのデバイスでどのような機能が機能するのかを説明する [Web サイトがあります](clients-and-devices/mobile-feature-comparison.md)。 また、クライアントとデバイスの計画でいくつかの素晴らしいデバイスと OS [情報を持っています](clients-and-devices/clients-and-devices.md)。
  
モビリティは自動検出機能を使用します。これにより、クライアントは、ユーザーが URL を入力する必要がなくても、Skype for Business Server Web サービスを自動的に検索できます (ユーザーはそれらを知る必要はありません)。 トラブルシューティングを行う必要がある場合、URL の手動入力は引き続きサポートされます。
  
プッシュ通知は、Skype for Business アプリがバックグラウンドで実行されていない場合 (またはバックグラウンドで実行されているアプリケーションをサポートしないモバイル デバイス) でもサポートされます。 デバイスまたはアプリが非アクティブなときに発生するイベントに関するプッシュ通知がモバイル デバイスに送信されます。 たとえば、電話がアクティブではないときに IM メッセージが表示されない場合、プッシュ通知が送信されます (これは、アプリがバックグラウンドで実行されている場合など、トーストまたは通知として表示されます)。 プッシュ通知を使用すると、ユーザーは IM や音声通話を見逃す必要がありません。
  
詳細については、次のセクションを参照してください。
  
- [モビリティ コンポーネント](mobility.md#MobilityComponents)
    
- [サポートされるトポロジ](mobility.md#SupportedTopos)
    
- [技術的要件](mobility.md#TechRequirements)
    
- [モビリティのニーズを定義する](mobility.md#MobilityNeeds)
    
## <a name="mobility-components"></a>モビリティ コンポーネント
<a name="MobilityComponents"> </a>

Mobility for Skype for Business Server を構成する 4 つのサービスがあります。
  
- **ユニファイド コミュニケーション Web API (UCWA)**
    
    Skype for Business Server 用のモバイル クライアントおよび Web クライアントとのリアルタイム通信のためのサービスを提供します。 Skype for Business Server が展開されると、UCWA 仮想ディレクトリが内部および外部 Web サービスに作成されます。 UCWA が有効なクライアントからの呼び出しを受け入れる、この仮想ディレクトリ内の仮想コンポーネント。 クライアント アプリは、次の表形式の状態転送 (REST) インターフェイスを介して通信します。
    
  - プレゼンス
    
  - contacts
    
  - インスタント メッセージング (IM)
    
  - VoIP
    
  - ビデオ会議
    
  - コラボレーション
    
    UCWA は、P-GET ベースのチャネルを使用して、着信呼び出し、着信 IM、メッセージなどのイベントをクライアント アプリに送信します。
    
- **モビリティ サービス (MCX)**
    
    モバイル デバイスで、SKYPE for Business Server の機能 (IM、プレゼンス、連絡先など) をサポートします。 モビリティ サービスは、モバイル デバイス上の Skype for Business Server 機能をサポートすることを目的とした各プール内のすべてのフロント エンド サーバーにインストールされます。 Skype for Business Server 2015 をインストールすると、フロント エンド サーバーの内部 Web サイトと外部 Web サイトの両方の下に新しい仮想ディレクトリ (Mcx) が作成されます。
    
    > [!NOTE]
    > 従来のモバイル クライアントの MCX (モビリティ サービス) サポートは、Skype for Business Server 2019 では利用できなくなりました。 現在のすべての Skype for Business モバイル クライアントはUnified Communications Web API (UCWA) を使用して、インスタント メッセージング (IM)、プレゼンス、および連絡先をサポートしています。 MCX を使用している従来のクライアントを持っているユーザーは、現在のクライアントにアップグレードする必要があります。
  
- **自動検出サービス**
    
    ユーザーの場所を識別し、モバイル デバイスや他の Skype for Business クライアントが、ネットワークの場所に関係なくリソース (Skype for Business Server Web サービスの内部 URL および外部 URL、Mcx URL、UCWA URL など) を見つけることができます。 自動検出では、ハードコードされたホスト名 (ネットワーク内のユーザーの lyncdiscoverinternal、ネットワーク外のユーザーの lyncdiscover)、およびユーザーの SIP ドメインが使用されます。 HTTP または HTTPS を使用するクライアント接続をサポートします。 
    
    自動検出サービスは、モバイル デバイス上の Skype for Business Server 機能をサポートすることを目的とした、すべてのフロントエンド サーバーと各プールのすべてのディレクターにインストールされます。 サービスをインストールすると、フロント エンド サーバーとディレクターの内部 Web サイトと外部 Web サイトの両方の下に新しい仮想ディレクトリ (自動検出) が作成されます。
    
- **プッシュ通知サービス**
    
    Skype for Business Online データ センターにあるクラウドベースのサービス。 Skype for Business クライアントがバックグラウンドで実行されている電話では、新しいイベントが発生すると、欠落したイベント (プッシュ通知と呼ばれる) の通知がモバイル デバイスに送信されます。 Mobility Service はプッシュ通知サービス (MPNS) に通知を送信し、その通知をモバイル デバイスに送信します。 その後、ユーザーはモバイル デバイス上の通知に応答してアプリをアクティブ化できます。 この機能にはエッジ サーバーが必要です。
    
## <a name="supported-topologies"></a>サポートされるトポロジ
<a name="SupportedTopos"> </a>

トポロジ計画では、次の Skype for Business Server アプリケーションがサポートされています。
  
- Mobility Standard Edition
    
- Mobility Enterprise Edition
    
Skype for Business Server エッジ サーバーまたは Lync Server 2013 エッジ サーバーでこの機能を使用できる必要があります。
  
モビリティ サービスは、仲介サーバーの役割と 2 つのネットワーク インターフェイスを関連付けするときにフロント エンド サーバーでサポートされますが、これらのインターフェイスを構成するには適切な手順を実行する必要があります。 仲介サーバーとして通信する特定のインターフェイスと、フロントエンド サーバーとして通信するネットワーク IP インターフェイスに IP アドレスを割り当てる必要があります。 トポロジ ビルダーでは、既定の [構成済み IP アドレスのすべて使用] の選択を使用する代わりに、サービスごとに正しい IP アドレス **を選択** します。
  
## <a name="technical-requirements"></a>技術的要件
<a name="TechRequirements"> </a>

モバイル ユーザーが遭遇する可能性があるさまざまなモバイル アプリケーション シナリオを計画することが重要です。 たとえば、3G ネットワークを介して接続して、仕事以外のモバイル アプリの使用を開始し、仕事に到達すると企業の Wi-Fi ネットワークに切り替える場合があります。 建物を離れるときに 4G に切り替える場合があります。 ここで計画すると、これらのネットワーク移行をサポートし、一貫性のあるユーザー エクスペリエンスを保証できます。
  
### <a name="dns-configuration"></a>DNS の構成

モビリティ サービス Mcx と UCWA は、DNS を同じ方法で使用します。 自動検出では、モバイル デバイスは DNS を使用してリソースを検索します。 DNS 参照中に、内部 DNS レコードに関連付けられている FQDN への接続が試行されました (lyncdiscoverinternal.[内部ドメイン名])。 内部 DNS レコードを使用してその接続を確立できない場合は、2 つ目の接続が試行され、今回は外部 DNS レコード (lyncdiscover.[sipdomain])。 では、なぜ 2 つ持っているのでしょうか。 ネットワークの内部であるモバイル デバイスは、内部自動検出 URL を使用できます。 外部モバイル デバイスは、外部自動検出 URL を使用します。 いずれの場合も、自動検出サービスは、モビリティ サービス (Mcx と UCWA) を含む、ユーザーのホーム プールのすべての Web サービス URL を返します。
  
外部自動検出要求は、Skype for Business Server 用に構成したリバース プロキシを通過する必要があります。 ただし、内部モビリティ サービス URL と外部モビリティ サービス URL の両方が外部 Web サービスの FQDN に関連付けられている。 したがって、モバイル デバイスがネットワークの内部または外部のかどうかに関係なく、デバイスは常にリバース プロキシを介して Skype for Business Server Mobility サービスに外部で接続します。
  
> [!NOTE]
> 先ほどお知らせした通り、すべての Mobility Service トラフィック (内部および外部) はリバース プロキシを通過します。 しかし、内部トラフィックがインターフェイスを経由して離れるときに問題が発生する場合があります。その後、同じインターフェイスで試して戻ってきます。 これにより、スプーフィング (正式には TCP パケットスプーフィングと呼ばれる) セキュリティ ルールに違反する可能性があります。 ヘア ピンニングに Mobility **関数** を設定する必要があります。
  
> [!NOTE]
> これを行う準備ができている場合は、ファイアウォールとは別のリバース プロキシを使用できます (セキュリティ上、スプーフィング防止は常にファイアウォールで適用する必要があります)。 この方法では、ヘアピンはファイアウォールの外部インターフェイスではなく、リバース プロキシの外部インターフェイスで発生する可能性があります。 これにより、リバース プロキシでルールを緩め、モビリティ機能を取得しながら、ファイアウォールでスプーフィングを適切に検出できます。 
  
> [!NOTE]
> このルートに進む場合は、可能であれば、DNS ホストまたは CNAME レコードを使用してヘアピン動作 (ファイアウォールではなく) のリバース プロキシを定義してください。 
  
企業ネットワークの内部と外部のユーザーをサポートするために構成する必要があるものがあります。
  
内部および外部 Web FQDN のルールは次のとおりです。
  
- 自動検出用の新しい CNAME または A (ホスト (IPv6 の場合は AAAA) DNS レコード。
    
- 新しいファイアウォール ルール (ネットワーク経由でプッシュ通知をサポートする場合Wi-Fiします。
    
- 自動検出のために、内部サーバー証明書とリバース プロキシ証明書のサブジェクトの代替名。
    
- フロントエンド サーバーのハードウェア負荷分散構成は、ソースアフィニティを変更します。
    
モビリティ サービスと自動検出サービスをサポートするために必要なトポロジ要件は次のとおりです。
  
- フロントエンド プールの内部 Web FQDN は、フロントエンド プール外部 Web FQDN とは異なる必要があります。
    
- 内部 Web FQDN は、企業ネットワーク内でのみ解決し、アクセス可能である必要があります。
    
- 外部 Web FQDN は、インターネットにのみ解決し、インターネットからアクセスできる必要があります。
    
- 企業ネットワーク内のユーザーの場合、Mobility Service URL は外部 Web FQDN にアドレス指定する必要があります。 この要件は Mobility サービス用であり、この URL にのみ適用されます。
    
- 企業ネットワーク外のユーザーの場合、要求はフロントエンド プールまたはディレクターの外部 Web FQDN に移動する必要があります。
    
自動検出をサポートする場合は、SIP ドメインごとに次の DNS レコードを作成する必要があります。
  
- 組織のネットワーク内から接続するモバイル ユーザーをサポートする内部 DNS レコード。
    
- インターネットから接続するモバイル ユーザーをサポートする外部またはパブリックの DNS レコード。
    
内部自動検出 URL は、内部ネットワークの外部からアドレス指定できません。 外部自動検出 URL は、ネットワーク内からアドレス指定できません。 ただし、外部 URL でこれができない場合、内部 URL は常に最初に試用されますので、おそらくモバイル クライアントの機能に影響を与える可能性があります。
  
### <a name="port-and-firewall-requirements"></a>ポートとファイアウォールの要件

このほとんどについては、他のドキュメントで説明しましたが、特に Mobility の場合は、存続可能ブランチ アプライアンス (SBA) にユーザーが設定されている場合は、エンタープライズ Wi-Fi ネットワークで次のポートを開く必要があります。
  
- UcwaSipExternalListeningPort には 5088 が必要です。
    
- UcwaSipPrimaryListeningPort には 5089 が必要です。
    
### <a name="certificate-requirements"></a>証明書の要件

Skype for Business モバイル クライアントで自動検出を使用している場合は、証明書の SAN (サブジェクトの代替名) リストを変更して、モバイル クライアントからの安全な接続をサポートする必要があります。 既に証明書を一緒に使用している場合は、ここで説明する SAN エントリを使用して新しい証明書を要求して割り当てる必要があります。 これは、自動検出サービスを実行するフロントエンド サーバーとディレクター (環境内の場合) ごとに実行する必要があります。 リバース プロキシ証明書の SAN リストを変更し、組織内のすべての SIP ドメインに SAN エントリを追加することをお勧めします。
  
内部 CA (証明機関) から新しい証明書を要求する場合、これは簡単なプロセスである必要がありますが、パブリック証明書の方が複雑であり、新しいパブリック 証明書に多くの SIP ドメインを追加するコストが高い場合は言うまでもなく、再要求に多くのコストがかかる可能性があります。そのような状況では、サポートされているアプローチがありますが、推奨 **されません**。 リバース プロキシを構成して、最初の自動検出サービス要求をポート 80 経由で行い、HTTPS (および 443 が既定の構成) であるポート 443 ではなく HTTP を使用します。 その受信要求は、フロントエンド プールまたはディレクターのポート 8080 にリダイレクトされます。 これにより、このトラフィックは要求に HTTPS を使用しないので、証明書を変更する必要がなされません。 しかし、もう一度、これはお勧めしませんが、これはお勧めしません。
  
### <a name="windows-and-iis-requirements"></a>Windows および IIS の要件

Skype for Business Server 環境でサポートされている Windows Server バージョンが必要です。 その結果、モビリティのニーズに合った IIS 8 または IIS 8.5 も必要になります。 既定の設定に対していくつかの変更が ASP.NET 必要がありますが、Mobility サービス インストーラーによって自動的に行われます。
  
### <a name="hlb-requirements"></a>HLB の要件

フロントエンド プールの HLB を含む Skype for Business Server のトポロジ (複数のフロントエンド サーバーを含むトポロジ) を使用している場合は、Web サービス トラフィック用の外部 Web サービス仮想 IP (VIP) をソース用に構成する必要があります。 ソース アフィニティは、セッション状態を維持するために、1 つのクライアントからの複数の接続が同じサーバーに送信されるのを確実にするのに役立ちます。
  
Skype for Business モバイル クライアントを内部 Wi-Fi ネットワーク経由でのみサポートする予定の場合は、外部 Web サービスの VIP に関する説明に従って、内部 Web サービスの VIP をソース用に構成する必要があります。 この状況では、HLB source_addr Web サービスの内部 VIP に対して、このアフィニティ (または TCP) を使用する必要があります。
  
このすべてについて詳しくは、「Skype for Business の負荷分散要件 [」のドキュメントをご覧](network-requirements/load-balancing.md) ください。
  
### <a name="reverse-proxy-requirements"></a>リバース プロキシの要件

Skype for Business モバイル クライアントの自動検出をサポートするには、現在の発行ルールを次のように更新する必要があります。
  
- リバース プロキシ証明書の SAN リストを更新し、最初の自動検出サービス要求に HTTPS を使用している場合は、lyncdiscover の Web 発行ルールを更新する必要があります。 \<sipdomain\> これは通常、フロントエンド プールの外部 Web サービス URL の発行 rul と組み合わされます。
    
- リバース プロキシ証明書 (推奨しない) の SAN リストを更新する必要を回避するために、最初の自動検出サービス要求に HTTP を使用することを決定した場合は、ポート HTTP/TCP 80 用の新しい Web 発行ルールを作成する必要があります 。まだ存在しない場合は、新しい Web 発行ルールを作成する必要があります。 そのルールが存在する場合は、lyncdiscover を含むルールを更新します。\<sipdomain\> エントリ。
    
## <a name="defining-your-mobility-needs"></a>モビリティのニーズを定義する
<a name="MobilityNeeds"> </a>

トポロジ、コンポーネント、および技術的要件を確認したので、モビリティの実装に関して組織が必要とする可能性がある点について説明します。
  
### <a name="do-you-want-to-use-automatic-discovery-for-skype-for-business-mobile-clients"></a>Skype for Business モバイル クライアントの自動検出を使用しますか?

自動検出を使用することを強く推奨します。 上記の「技術要件」に記載されている新しい内部および外部 DNS レコードの作成が必要です。 自動検出を使用すると、Skype for Business クライアントは、手動で URL を入力する必要なく、任意の場所から Skype for Business Server Web サービスを自動的に検索できます。
  
必要に応じて手動設定を使用できます。 これらの URL は、ユーザーがモバイル デバイスに入力する必要があります。
  
- **https:// \<ExtPoolFQDN\> /Autodiscover/autodiscoverservice.svc/Root** を使用して外部アクセスを行います。
    
- **https:// \<IntPoolFQDN\> /Autodiscover/autodiscoverservice.svc/Root を** 使用して内部アクセスを行います。
    
繰り返しますが、自動検出の使用をお勧めします。 トラブルシューティングの目的で手動設定が役立つ場合があります。
  
### <a name="are-you-going-to-support-push-notifications"></a>プッシュ通知をサポートしますか?

プッシュ通知は、アプリがアクティブではないときにユーザーにイベントを通知するために、この機能をサポートするモバイル アプリケーションに使用されます。 エッジ サーバーは、Skype for Business Online データセンターにあるクラウドベースの Skype for Business Server プッシュ通知サービスとのフェデレーション関係を持っている必要があります。 プッシュ通知を有効にするには、コマンドレットを実行する必要があります。
  
> [!NOTE]
> Lync Server 2010 クライアントをまだ使用しているユーザーが存在する場合は、エンタープライズ WiFi ネットワーク上で TCP ポート 5223 open outbound が必要になります。 
  
### <a name="do-you-want-all-your-users-accessing-all-mobility-features-or-do-you-want-to-specify-the-users-who-can-access-these-features-instead"></a>すべてのユーザーがすべての Mobility 機能にアクセスするか、またはこれらの機能にアクセスできるユーザーを指定しますか。

すべてのユーザーが利用できる機能の一部と、ユーザーが既定でその方法で設定されているかどうかを示す表があります。 完全なリストについては [、New-CsMobilityPolicy を確認してください](/powershell/module/skype/new-csmobilitypolicy?view=skype-ps)。
  
> [!NOTE]
> これらのすべての機能のスコープは、グローバル/サイト/ユーザーです。 
  
|**機能**|**パラメーター名**|**説明**|**既定の設定**|
|:-----|:-----|:-----|:-----|
|モビリティの有効化  <br/> |EnableMobility  <br/> |Skype for Business モバイル クライアントがインストールされている特定のスコープ内のユーザーを制御します。 ポリシーが False に設定されている場合、ユーザーはクライアントでサインインできます。  <br/> |True  <br/> |
|外部音声  <br/> |EnableOutsideVoice  <br/> |ユーザーが[仕事を経由して通話] を使用できる機能を使用すると、ユーザーは携帯電話番号の代わりに自分の電話番号を使用して通話を送受信できます。 False に設定されている場合、ユーザーは仕事用電話番号を使用するときに携帯電話で通話を行う、または受信できない。  <br/> |True  <br/> |
|IP オーディオとビデオを有効にする  <br/> |EnableIPAudioVideo  <br/> |既定に設定すると、ユーザーは VoIP を使用して、モバイル デバイスで電話またはビデオ通話を行う、または受信できます。 False に設定すると、ユーザーはモバイル デバイスを使用してこれらの操作を実行できません。  <br/> |True  <br/> |
|IP オーディオに WiFi を要求する  <br/> |RequireWiFiForIPAudio  <br/> |モバイル データ ネットワークの代わりに、クライアントが WiFi で VoIP を使用して通話を行い、受信する必要があるかどうかを定義します。 True に設定されている場合、ユーザーは WiFi 経由で接続されている場合にのみ VoIP 呼び出しを行い、受信できます。  <br/> |False  <br/> |
|IP ビデオに WiFi を要求する  <br/> |RequireWiFiForIPVideo  <br/> |モバイル データ ネットワークの代わりに、クライアントが WiFi でビデオ通話を行い、受信する必要があるかどうかを定義します。 True に設定されている場合、ユーザーは WiFi 経由で接続されている場合にのみ VoIP 呼び出しを行い、受信できます。  <br/> |False  <br/> |
   
### <a name="should-users-who-arent-enabled-for-enterprise-voice-be-able-to-use-click-to-join-to-join-conferences"></a>会議に対して有効になっていないユーザーエンタープライズ VoIPクリックして会議に参加できますか?

モビリティ機能と仕事を通じて通話にアクセスするには、ユーザーがモバイル 機能を有効にするエンタープライズ VoIP。 ただし、有効になっていない場合でも、モバイル デバイス上のリンクをクリックして会議に参加できますが、適切な音声ポリシーが割り当てられている場合にのみ参加できます。 以下のどちらかの方法で実行できます。
  
- これらのユーザーに特定の音声ポリシーを割り当てるか、または、
    
- グローバル ポリシーまたはサイト レベルのポリシーが存在し、そのポリシーに適用される必要があります。
    
いずれにしろ、割り当てる音声ポリシーには、公衆交換電話網 (PSTN) 使用法レコードと、ユーザーが電話会議に参加するためにダイヤルアウトできる場所を定義するルートが必要です。
  
> [!NOTE]
> [クリックして参加する] を使用するモバイル ユーザーは、関連する PSTN 使用法レコードと音声ルートと共に音声ポリシーを必要とします。モバイル デバイス上のリンクをクリックすると、Skype for Business Server からの送信通話が結果になります。 
