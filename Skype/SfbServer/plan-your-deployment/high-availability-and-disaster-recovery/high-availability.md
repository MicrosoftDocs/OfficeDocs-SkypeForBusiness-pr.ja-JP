---
title: フロントエンド プールの高可用性と管理
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
audience: ITPro
ms.topic: conceptual
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 965041b7-3136-49f2-89c1-8b30417cb8ea
description: Skype for Business Server でのフロントエンドプールの管理について説明します。これには、プールの管理、クォーラムの損失、2つのフロントエンドサーバーのみを含むプールの特別な手順が含まれます。
ms.openlocfilehash: e42e192d224d509356203c059751624fc706707b
ms.sourcegitcommit: a6e44256c024fc3953cfd6a511ee024c4c7b8408
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/19/2019
ms.locfileid: "37047094"
---
# <a name="front-end-pool-high-availability-and-management"></a>フロントエンド プールの高可用性と管理
 
Skype for Business Server でのフロントエンドプールの管理について説明します。これには、プールの管理、クォーラムの損失、2つのフロントエンドサーバーのみを含むプールの特別な手順が含まれます。
  
Skype for Business Server では、フロントエンドプールのアーキテクチャによって分散システムモデルが使用され、各ユーザーのデータはプール内の3つのフロントエンドサーバーとして保存されます。 すべての Enterprise Edition フロントエンドプールには、少なくとも3台のフロントエンドサーバーが含まれていることをお勧めします。 
  
## <a name="planning-for-the-management-of-front-end-pools"></a>フロント エンド プール管理の計画

 Skype for Business Server は、Windows Fabric に基づく分散システムモデルを使用します。 このモデルでは、各ユーザーと会議の重要なデータは、フロントエンドプールの3台のフロントエンドサーバー上に格納されます。 これら3つのデータを格納するサーバーは、レプリカとして呼び出されます。
  
フロントエンドプールの分散モデルでは、プールを機能させるには、プールのサーバーの特定の数が実行されている必要があります。 プールには2つの損失モードがあります。
  
- 特定のルーティンググループの十分なレプリカサーバーがないために、ルーティンググループレベルのクォーラム損失が発生しました。 ルーティンググループは、プールに所属している一連のユーザーです。 各ルーティンググループのプールには、1つのプライマリレプリカと2つのセカンダリレプリカの3つの複製があります。
    
- プール レベル クォーラム損失。プールで十分な数のシード サーバーが実行されていない場合に発生します。 
    
### <a name="routing-group-level-quorum-loss"></a>ルーティング グループ レベル クォーラム損失

新しいフロント エンド プールを初めて起動するときには、次の表に示すように、サーバーの 85% が実行されていることが必要です。実行されているサーバーの数がそれより少ないと、サービスが起動状態で行き詰まり、プールが起動されないことがあります。
  
|プール内のサーバーの合計数  <br/> |プールを初めて起動させるために実行する必要があるサーバー数  <br/> |
|:-----|:-----|
|2  <br/> |1  <br/> |
|3  <br/> |3  <br/> |
|4  <br/> |3  <br/> |
|5  <br/> |4  <br/> |
|6  <br/> |5  <br/> |
|7  <br/> |5  <br/> |
|個  <br/> |6  <br/> |
|ファイブ  <br/> |7  <br/> |
|常用  <br/> |個  <br/> |
|折り  <br/> |ファイブ  <br/> |
|以内  <br/> |常用  <br/> |
   
その後もプールが起動されるたびに、サーバーの 85% が起動されている必要があります (前出の表を参照)。 この数のサーバーを開始できない場合 (ただし、プールレベルのクォーラムの損失を防ぐために十分なサーバーを起動できます)、 `Reset-CsPoolRegistrarState -ResetType QuorumLossRecovery`コマンドレットを使用して、このルーティンググループレベルのクォーラム損失からプールを回復し、進行状況を確認することができます。 このコマンドレットの使い方の詳細については、「 [CsPoolRegistrarState をリセット](https://docs.microsoft.com/powershell/module/skype/reset-cspoolregistrarstate?view=skype-ps)する」を参照してください。 
  
> [!NOTE]
> サーバー数が偶数のプールの場合、Skype for Business Server は監視にプライマリ SQL データベースを使います。 このようなプールでは、プライマリ データベースをシャットダウンしてミラー データベースに切り替え、前述の表の必要な実行数に足りなくなるまでフロント エンド サーバーをシャットダウンすると、プール全体がダウンします。 詳細については、「[データベースミラーリング監視](https://go.microsoft.com/fwlink/?LinkId=393672)」を参照してください。 
  
#### <a name="pool-level-quorum-loss"></a>プール レベル クォーラム損失

フロントエンドプールをまったく機能させるには、プールレベルのクォーラム損失にすることはできません。 実行中のサーバーの数が次の表に示す機能レベルを下回ると、プールに属する残りのサーバーがすべての Skype for Business Server サービスを停止します。 次の表の数値は、プール内のバックエンドサーバーが実行されていることを前提としています。
  
|プール内のフロントエンドサーバーの合計数  <br/> |プールを機能させるために実行する必要があるサーバーの数  <br/> |
|:-----|:-----|
|2  <br/> |1  <br/> |
|3 ～ 4  <br/> |任意の 2 台  <br/> |
|5 ～ 6  <br/> |任意の 3 台  <br/> |
|7  <br/> |任意の 4 台  <br/> |
|8 ～ 9  <br/> |最初の 7 台のうちの任意の 4 台  <br/> |
|10 ～ 12  <br/> |最初の 9 台のうちの任意の 5 台  <br/> |
   
上の表では、"first servers" は、プールが初めて開始されたときに最初に作成されたサーバーです。 これらのサーバーを確認するには、 `Get-CsComputer` `-PoolFqdn`オプションを指定してコマンドレットを使用します。 このコマンドレットはサーバーをトポロジ内に出現した順に表示するので、そのリストの先頭にある方が最初のサーバーです。
  
#### <a name="additional-steps-to-ensure-pools-are-functional"></a>プールが機能していることを確認するための追加手順

フロント エンド プールを確実に機能させておくために、他にもいくつかの要因を監視する必要があります。
  
- ユーザーをプールに初めて移動する場合は、少なくとも3台のフロントエンドサーバーが実行されていることを確認します。
    
- 障害復旧の目的でこのプールと別のプールの間にペアの関係を確立する場合は、データをバックアップ プールと正しく同期するために、関係を確立した後で、このプールの 3 台のフロントエンド サーバーがどこかのタイミングで同時に実行されることを確認する必要があります。 プールのペアリングと障害回復機能の詳細については、「 [Skype For Business Server で高可用性と障害回復を計画する](high-availability-and-disaster-recovery.md)」を参照してください。 
    
## <a name="front-end-pool-with-two-front-end-servers"></a>フロントエンド サーバーが 2 台のフロントエンド プール

2台のフロントエンドサーバーのみを含むフロントエンドプールの展開はお勧めしません。 このような小規模なプールでは、大規模なプールのように堅牢な高可用性は実現できないので、管理に余計な配慮が必要になります。 また、2つのサーバープールのバックエンドサーバーがダウンした場合は、プール自体全体もすぐに停止する可能性があります。 Skype for Business Server を実行している1台または2台のサーバーのみを展開する場合は、Standard Edition サーバーとして展開することをお勧めします。
  
2台のフロントエンドサーバーを持つプールを展開する必要がある場合は、次のガイドラインに従ってください。
  
- 2台のフロントエンドサーバーのいずれかがダウンしている場合は、可能な限り早く、障害が発生したサーバーをバックアップしておく必要があります。 同様に、2 台のサーバーのうち 1 台をアップグレードする必要がある場合は、アップグレードが終わり次第、オンラインにします。
    
- 何らかの理由で両方のサーバーを同時に停止する必要がある場合は、プールのダウンタイムが終わったら次のことをします。
    
  - ベストプラクティスとして、フロントエンドサーバーの両方を同時に再起動することをお勧めします。 
    
  - 2 台のサーバーを同時に再起動できない場合は、停止した順序とは逆の順序で復旧する必要があります。
    
  - この順序で元の状態に戻すことができない場合は、プールを復元する前に、次のコマンドレットを使用します。`Reset-CsPoolRegistrarState -ResetType QuorumLossRecovery -PoolFQDN <FQDN>`
    
## <a name="front-end-pool-configuration-failures-and-changes"></a>フロント エンド プール構成のエラーと変更

フロント エンド サーバーが故障し、数日以内に交換できそうにない場合は、そのサーバーをトポロジから削除します。再び使用できるようになったときに、新しいフロント エンド サーバーをトポロジに追加します。
  
サーバーの追加や削除など、フロント エンド プールの構成を変更するたびに、次のガイドラインに従う必要があります。
  
- 新しいトポロジが公開された後で、プール内の各フロント エンド サーバーを再起動する必要があります。1 台ずつ再起動してください。
    
- 構成の変更中にプール全体が停止している場合は、新しいトポロジが公開された後に次のコマンドレットを実行します。`Reset-CsPoolRegistrarState -PoolFQDN <PoolFQDN> -ResetType ServiceReset`
    

