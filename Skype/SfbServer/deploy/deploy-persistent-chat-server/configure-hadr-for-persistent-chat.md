---
title: Skype for Business Server 2015 での常設チャット サーバーの高可用性と障害復旧の構成
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
ms.date: 2/7/2018
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.assetid: 5fb5b189-56c1-49cf-92c8-e4fd6e2fdd5c
description: '概要: このトピックでは、Skype for Business Server 2015 で常設チャット サーバーの高可用性と障害復旧を構成する方法について説明します。'
ms.openlocfilehash: 10d9e2eb76873cedc82daea817a732b8feb379da
ms.sourcegitcommit: c528fad9db719f3fa96dc3fa99332a349cd9d317
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/12/2021
ms.locfileid: "49802137"
---
# <a name="configure-high-availability-and-disaster-recovery-for-persistent-chat-server-in-skype-for-business-server-2015"></a>Skype for Business Server 2015 での常設チャット サーバーの高可用性と障害復旧の構成
 
**概要:** このトピックでは、Skype for Business Server 2015 で常設チャット サーバーの高可用性と障害復旧を構成する方法について説明します。
  
Skype for Business Server は、データベース ミラーリングを含む、バック エンド サーバーの高可用性の複数のモードをサポートしています。 詳細については [、「Plan for high availability and disaster recovery in Skype for Business Server 2015」を参照](../../plan-your-deployment/high-availability-and-disaster-recovery/high-availability-and-disaster-recovery.md)してください。
  
> [!NOTE]
> AlwaysOn 可用性グループは、常設チャット サーバーではサポートされていません。 

> [!NOTE] 
> 常設チャットは Skype for Business Server 2015 で使用できますが、Skype for Business Server 2019 ではサポートされなくなりました。 Teams でも同じ機能を使用できます。 詳細については、「Microsoft Teams のアップグレード [の開始」を参照してください](/microsoftteams/upgrade-start-here)。 常設チャットを使用する必要がある場合は、この機能を必要とするユーザーを Teams に移行するか、Skype for Business Server 2015 を引き続き使用するかのどちらかを選択できます。
  
高可用性と障害復旧用に常設チャット展開を構成する前に [、「Plan for high availability and disaster recovery for Persistent Chat Server in Skype for Business Server 2015」](../../plan-your-deployment/persistent-chat-server/high-availability-and-disaster-recovery.md)の概念を理解している必要があります。 これらのトピックで説明されている常設チャット サーバーの障害復旧ソリューションは、拡大された常設チャット サーバー プール上に構築されています。 計画に関するコンテンツでは、リソース要件と、高可用性のための SQL Server ミラーリングの使用や障害復旧のための SQL Server ログ配布など、常設チャット サーバーの高可用性と障害復旧を可能にする拡大プール トポロジについて説明します。
  
## <a name="use-topology-builder-to-configure-high-availability-and-disaster-recovery"></a>トポロジ ビルダーを使用して高可用性と障害復旧を構成する

トポロジ ビルダー内で、以下の手順を実行して、常設チャット サーバーの高可用性と障害復旧を構成します。
  
1. ミラー データベースとログ配布セカンダリ データベースをストアにSQL Serverします。
    
2. 常設チャット サーバー サービスのプロパティを次の内容に編集します。
    
    a.  プライマリ データベースのミラーリングを有効にします。
    
    b. プライマリ ミラー サーバー ストアSQL Serverします。
    
    c. ログ配布SQL Server有効にする。
    
    d.  ログ配布SQL ServerストアにSQL Serverします。
    
    e.  セカンダリ データベースSQL Serverストア ミラーを追加します。
    
    f. トポロジを公開します。
    
## <a name="set-up-sql-server-log-shipping-for-the-persistent-chat-server-primary-database"></a>常設チャット SQL Serverデータベースのログ配布をセットアップする

このSQL Server Management Studio使用して、常設チャット サーバーのセカンダリ ログ配布データベース インスタンスに接続し、SQL Serverエージェントが実行されている必要があります。 次に、常設チャットプライマリ データベース インスタンスに接続し、次の手順を実行します。
  
1. mgc データベースを右クリックしてから、[**プロパティ**] をクリックします。
    
2. [**ページの選択**] で、[**トランザクション ログの配布**] をクリックします。
    
3. [**ログ配布構成のプライマリ データベースとして有効にする**] チェック ボックスをオンにします。
    
4. [**トランザクション ログのバックアップ**] で、[**バックアップの設定**] をクリックします。
    
5. [バックアップ **フォルダーのネットワーク パス** ] ボックスに、トランザクション ログ バックアップ フォルダー用に作成した共有へのネットワーク パスを入力します。
    
6. バックアップ フォルダーがプライマリ サーバーにある場合は、[バックアップ フォルダーがプライマリ サーバーにある場合] にバックアップ フォルダーへのローカル パスを入力し、フォルダーへのローカル パス **(例: c:\backup)** ボックスに入力します。 (バックアップ フォルダーがプライマリ サーバー上にない場合は、このボックスを空のままにできます)。
    
    > [!IMPORTANT]
    > プライマリ サーバーの SQL Server サービス アカウントがローカル システム アカウントで実行されている場合は、プライマリ サーバーにバックアップ フォルダーを作成し、そのフォルダーへのローカル パスを指定する必要があります。 
  
7. [**次の期間を経過したファイルを削除する**] パラメーターと [**バックアップが次の期間内に行われない場合は警告する**] パラメーターを構成します。
    
8. [**バックアップ ジョブ**] の [**スケジュール**] ボックスに一覧表示されるバックアップ スケジュールを確認してください。 インストールのスケジュールをカスタマイズするには、[スケジュール] **をクリックし**、必要に応SQL Serverエージェントのスケジュールを調整します。
    
9. [ **圧縮] で**、[既定の **サーバー設定を使用する**] を選択し **、[OK] をクリックします**。
    
10. [**セカンダリ サーバー インスタンスとデータベース**] で、[**追加**] をクリックします。
    
11. [ **接続** ] をクリックし、セカンダリ サーバー SQL Server構成したサーバーのインスタンスに接続します。
    
12. [**セカンダリ データベース**] ボックスで、一覧から [**mgc**] データベースを選択します。
    
13. [セカンダリデータベースの初期化] タブで、[はい] オプションを選択し、プライマリ データベースの完全バックアップを生成し、セカンダリ データベースに復元 **します (** 存在しない場合はセカンダリ データベースを作成します)。
    
14. [ファイル **のコピー** ] タブの[コピー先のファイル] フォルダーボックスに、トランザクション ログのバックアップをコピーするフォルダーのパスを入力します。 多くの場合、このフォルダーは、セカンダリ サーバー上にあります。
    
15. [ジョブのコピー] の [スケジュール] ボックスに **表示** されるコピー スケジュール **をメモします**。 インストールのスケジュールをカスタマイズするには、[スケジュール] **をクリックし**、必要に応SQL Serverエージェントのスケジュールを調整します。 このスケジュールは、バックアップ スケジュールとほぼ同じにしてください。
    
16. [復元 **] タブ** の [バックアップ復元時 **のデータベース** の状態] で、[回復モードなし] **オプションを選択** します。
    
17. [**バックアップの復元の遅延] で、少なくとも [0****分] を選択します**。
    
18. Choose an alert threshold under **Alert if no restore occurs within**.
    
19. [復元ジョブ] の [スケジュール] ボックスに **一** 覧表示されている復元スケジュール **を確認します**。 インストールのスケジュールをカスタマイズするには、[スケジュール]をクリックし、必要に応じて SQL Server エージェントのスケジュールを調整し **、[OK]** をクリックします。 このスケジュールは、バックアップ スケジュールとほぼ同じにしてください。
    
20. [データベースの **プロパティ] ダイアログ** ボックスで **、[OK]** をクリックして構成プロセスを開始します。
    
## <a name="set-up-sql-server-log-shipping-between-the-primary-mirror-and-the-secondary-database"></a>プライマリ ミラー SQL Serverセカンダリ データベース間のログ配布をセットアップする

プライマリ常設チャット データベースがミラー データベースにフェールオーバーされた場合にログ配布を続行するには、次の手順を実行します。
  
1. プライマリ 常設チャット データベースを手動でミラーにフェールオーバーします。 これは、Skype for Business Server 管理シェルと **Invoke-CsDatabaseFailover コマンドレットを使用して行** います。
    
2. 新しいSQL Server Management Studio使用して、プライマリ常設チャット サーバー ミラー インスタンスに接続します。
    
3. エージェントが実行SQL Server確認します。
    
4. mgc データベースを右クリックしてから、[**プロパティ**] をクリックします。
    
5. [**ページの選択**] で、[**トランザクション ログの配布**] をクリックします。
    
6. [**ログ配布構成のプライマリ データベースとして有効にする**] チェック ボックスをオンにします。
    
7. [**トランザクション ログのバックアップ**] で、[**バックアップの設定**] をクリックします。
    
8. [**バックアップ フォルダーのネットワーク パスを指定する**] ボックスに、トランザクション ログのバックアップ フォルダーとして作成した共有場所へのネットワーク パスを入力します。
    
9. バックアップ フォルダーがプライマリ サーバーに存在する場合は、[**バックアップ フォルダーがプライマリ サーバーに存在する場合は、バックアップ フォルダーのローカル パスを入力**] ボックスにバックアップ フォルダーへのローカル パスを入力します (バックアップ フォルダーがプライマリ サーバーに存在しない場合は、このボックスを空のままにします)。
    
    > [!IMPORTANT]
    > プライマリ サーバーの SQL Server サービス アカウントがローカル システム アカウントで実行されている場合は、プライマリ サーバーにバックアップ フォルダーを作成し、そのフォルダーへのローカル パスを指定する必要があります。 
  
10. [**次の期間を経過したファイルを削除する**] パラメーターと [**バックアップが次の期間内に行われない場合は警告する**] パラメーターを構成します。
    
11. [**バックアップ ジョブ**] の [**スケジュール**] ボックスに一覧表示されるバックアップ スケジュールを確認してください。 インストールのスケジュールをカスタマイズするには、[スケジュール] **をクリックし**、必要に応SQL Serverエージェントのスケジュールを調整します。
    
    > [!IMPORTANT]
    > プライマリ データベースと同じ設定を使用します。 
  
12. [**圧縮**] で、[**既定のサーバー設定を使用する**] をクリックして、[**OK**] をクリックします。
    
13. [**セカンダリ サーバー インスタンスとデータベース**] で、[**追加**] をクリックします。
    
14. [**接続**] をクリックして、セカンダリ サーバーとして構成した SQL Server のインスタンスに接続します。
    
15. [**セカンダリ データベース**] ボックスで、一覧から [**mgc**] データベースを選択します。
    
16. [**セカンダリ データベースの初期化**] タブで、[**いいえ、セカンダリ データベースは初期化されています**] オプションをクリックします。
    
17. [**ファイルのコピー**] タブの [**ファイルのコピー先フォルダー**] に、トランザクション ログのバックアップをコピーするフォルダーのパスを入力して、[**OK**] をクリックします。多くの場合、このフォルダーは、セカンダリ サーバー上にあります。
    
18. [**スクリプトの構成**] ドロップダウン リストを開き、[**スクリプト構成を新規クエリ ウィンドウに保存**] をクリックします。
    
19. [**データベースのプロパティ**] に表示された新規クエリ ウィンドウで [**OK**] をクリックして、構成プロセスを開始します。
    
20. クエリの前半 (手順 18 を参照) を選択して実行します。-- End: プライマリで実行する \* \* \* \* \* \* スクリプト: \* \* \* \* \* \*
    
    > [!IMPORTANT]
    > このスクリプトを手動で実行するSQL Server Management Studioログ配布構成で複数のプライマリ データベースをサポートSQL Server必要です。 
  
21. [**キャンセル**] をクリックして、ログ配布構成パネルを閉じ、(フェールオーバー時に) プライマリ データベースとミラー化されたデータベース両方でログ配布を適切に実装する実用的なセットアップを確立します。
    
22. プライマリ常設チャット データベースをプライマリに手動でフェールバックします。 これは、Skype for Business Server 管理シェルと **Invoke-CsDatabaseFailover** コマンドレットを使用して行います。
    

