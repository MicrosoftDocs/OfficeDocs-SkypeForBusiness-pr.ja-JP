---
title: Skype for Business Server のバックエンドサーバーに Always On 可用性グループを展開する
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: c93c01e6-626c-40ad-92dd-373b0fe9189f
description: Skype for Business Server の展開で Always On 可用性グループを展開 (インストール) します。
ms.openlocfilehash: 2cfc75aecd53a82e146feefd944134a4695c21fe
ms.sourcegitcommit: e1c8a62577229daf42f1a7bcfba268a9001bb791
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/07/2019
ms.locfileid: "36240128"
---
# <a name="deploy-an-always-on-availability-group-on-a-back-end-server-in-skype-for-business-server"></a>Skype for Business Server のバックエンドサーバーに Always On 可用性グループを展開する
 
Skype for Business Server の展開で Always On 可用性グループ (AG) を展開 (インストール) します。
  
AG を展開する方法は、新しいプール、ミラーリングを使用する既存のプール、または現在バックエンドデータベースに対して高可用性を持たない既存のプールのどちらに展開するかによって異なります。
  
> [!NOTE]
> 常設チャットサーバーロールでの AG の使用はサポートされていません。 
  
- [新しいフロントエンドプールに Always On 可用性グループを展開する](alwayson-availability-group.md#BKMK_NewPool_CreateAlwaysOnGroup)
    
- [データベースのミラーリングを使用している既存のプールに Always On 可用性グループを展開する](alwayson-availability-group.md#BKMK_MirroredPool_CreateAlwaysOnGroup)
    
- [データベースミラーリングを使用していない既存のプールに Always On 可用性グループを展開する](alwayson-availability-group.md#BKMK_NoHAPool_CreateAlwaysOnGroup)
    
## <a name="deploy-an-always-on-availability-group-on-a-new-front-end-pool"></a>新しいフロントエンドプールに Always On 可用性グループを展開する
<a name="BKMK_NewPool_CreateAlwaysOnGroup"> </a>

1. AG の一部となるすべてのデータベースサーバーでフェールオーバークラスタリング機能を有効にします。 各サーバーで、以下の作業を行います。
    
   - サーバー マネージャーを開き、[**役割と機能の追加**] をクリックします。
    
   - [**機能の選択**] ボックスが表示されるまで [**次へ**] をクリックします。このボックスで、[**フェールオーバー クラスタリング**] チェック ボックスをオンにします。
    
   - [**フェールオーバー クラスタリングに必要な機能を追加しますか?**] ボックスで、[**機能の追加**] をクリックします。
    
   - [**インストール**] をクリックします。
    
2. クラスター構成を検証します。
    
   - サーバー マネージャーで、[**ツール**] メニューをクリックし、[**フェールオーバー クラスター マネージャー**] をクリックします。
    
   - 画面右側の [**操作**] で、[**構成の検証**] をクリックします。
    
   - [**開始する前に**] ページで、[**次へ**] をクリックします。
    
   - クラスターに追加するサーバーを選択し、[**すべてのテストを実行**] をクリックします。
    
   - [**概要**] ボックスで、ウィザードにより報告されたすべてのエラーを確認します。確認したら、[**完了**] をクリックして検証を完了します。
    
     特に、共有ストレージを使用していない場合、通常はウィザードにより複数の警告が報告されます。共有ストレージを使用する必要はありませんが、[**エラー**] でメッセージが表示されている場合は、作業を続行する前にこれらの問題を修正する必要があります。
    
3. Windows Server フェールオーバークラスター (WSFC) を作成します。
    
   - [**フェールオーバー クラスター管理**] ウィザードで、[**フェールオーバー クラスター管理**]、[**クラスターの作成**] の順にクリックします。
    
   - [**開始する前に**] ページで、[**次へ**] をクリックします。
    
   - クラスター名と IP アドレスを追加します。設定が検証されたら、[**次へ**] をクリックします。
    
   - [確認] ページで、[**次へ**] をクリックします。
    
   - クラスターが作成されたら、[**完了**] をクリックします。
    
4. ファイル共有監視を使用するようにクラスター クォーラム設定を構成することをお勧めします。このためには、以下の手順を行います。
    
   - クラスター名を右クリックし、[**他の操作**]、[**クラスター クォーラム設定の構成**] の順にクリックします。
    
   - [**クォーラム構成オプションの選択**] ページで、[**クォーラム監視を選択する**] をクリックします。
    
   - [**クォーラム監視の選択**] ページで、[**ファイル共有監視を構成する**] をクリックします。
    
   - [**ファイル共有監視の構成**] ページで、使用するファイル共有のパスを入力し、[**次へ**] をクリックします。
    
   - [**確認**] ページで、[**次へ**] をクリックします。
    
5. クラスターの各サーバーで、SQL Server 構成マネージャーの AG 機能を有効にします。
    
   - SQL Server 構成マネージャーを開きます。画面左側のツリーで、[**SQL Server のサービス**] をクリックし、SQL Server サービスをダブルクリックします。 
    
   - [**プロパティ**] ボックスで、[**AlwaysOn 高可用性**] タブを選択します。[**AlwaysOn 可用性グループを有効にする**] チェック ボックスをオンにします。SQL Server サービスを再開するよう求めるメッセージが表示されたら、サービスを再開します。
   
6. 「トポロジビルダーを使用して、 [Skype For Business Server での新しいトポロジの作成と公開](../../deploy/install/create-and-publish-new-topology.md)」で説明されているように、フロントエンドプールを作成します。 その場合は、プールの SQL ストアとして AG を指定します。
    
7. 可用性グループを作成します。
    
   - SQL Server Management Studio を開き、SQL Server インスタンスに接続します。
    
   - オブジェクトエクスプローラーで、 **[常に高可用性**] フォルダーを展開します。 [**可用性グループ**] フォルダーを右クリックし、[**新しい可用性グループ ウィザード**] をクリックします。
    
   - [**説明**] ページが表示されたら、[**次へ**] をクリックします。
    
   - [**可用性グループ名の指定**] ページで、可用性グループの名前を入力し、[**次へ**] をクリックします。
    
   - [データベースの選択] ページで、AlwaysOn 可用性グループに含めるデータベースを選びます。 続いて [ **次へ**] をクリックします。
    
     このシナリオではサポートされていないため、 **ReportServer**、 **reportservertempdb**、または常設チャットデータベースは、AlwaysOn の可用性グループに含めないでください。 他のすべての Skype for Business Server データベースを AlwaysOn 可用性グループに含めることができます。
    
   - [**レプリカの指定**] ページで、[**レプリカ**] タブをクリックします。続いて [**レプリカの追加**] ボタンをクリックし、Windows Server フェールオーバー クラスターのノードとして参加させた他の SQL インスタンスに接続します。
    
   - 各インスタンスの [**自動フェールオーバー**] オプションと [**同期コミット**] オプションをオンにします。[**読み取り可能なセカンダリ**] オプションはオンにしないでください。
    
   - [**エンドポイント**] タブをクリックし、[**ポート番号**] が "5022" に設定されていることを確認します。
    
   - [**リスナー**] タブをクリックし、[**可用性グループ リスナーの作成**] オプションをオンにします。そのオプションの下で、リスナーの名前を入力し、[**ポート**] を "1433" (他のポートはこのオプションではサポートされません) に設定します。
    
   - [**追加**] をクリックし、[**IPv4 アドレス**] ボックスに優先させる仮想 IP アドレスを入力して、[**OK**] をクリックします。
    
   - [**最初のデータの同期を選択**] ページで [完全] を選択します。レプリカがアクセスでき、両方のレプリカにより使用される SQL Server サービス アカウントが書き込みアクセス許可を持っているフォルダーを指定します。続いて、[**次へ**] をクリックします。
    
     このファイル共有は、データベースを初期化した時点で一時的に使用されます。大きなデータベースを扱う場合、使用するネットワーク帯域幅でデータベース バックアップのサイズに対応できない場合に備えて、データベースを手動で初期化することを推奨します。
    
   - [検証] ページで、すべての検証チェックが成功したことを確認し、[**次へ**] をクリックします。
    
   - [**概要**] ページで、すべての設定を確認し、[完了] をクリックします。
      
8. プールと AG が展開されたら、最後の手順を実行して、SQL ログインが AlwaysOn 可用性グループの各レプリカに含まれていることを確認します。 
    
   - トポロジビルダーを開き、[**既存の展開からトポロジをダウンロード**] を選択して、[ **OK]** をクリックします。
    
   - [Skype for Business Server]、使用するトポロジ、[**SQL Server ストア**] の順に展開します。 新しい AlwaysOn 可用性グループの SQL ストアを右クリックし、[プロパティの**編集**] をクリックします。
    
     - ページの下部にある [ **SQL SERVER FQDN** ] ボックスで、値を AG のリスナーの fqdn に変更します。
    
   - トポロジを公開します。[**操作**] メニューから、[**トポロジ**]、[**公開**] の順にクリックします。続いて、確認ページで [**次へ**] をクリックします。新しいトポロジがレプリケートされるまで数分待ちます。
    
   - SQL Server Management Studio を開き、AG に移動します。 AlwaysOn 可用性グループのセカンダリ レプリカへのフェールオーバーを行います。
    
   - Skype for Business Server 管理シェルを開き、次のコマンドレットを入力してこの複製物の SQL ログインを作成します。
    
   ```
   Install-CsDatabase -Update
   ```

   - 前の2つの手順を繰り返します (グループをセカンダリレプリカにフェイルオーバー `Install-CsDatabase -Update`してから、グループ内の各レプリカに対して使用します)。
    
## <a name="deploy-an-always-on-availability-group-on-an-existing-pool-that-uses-database-mirroring"></a>データベースのミラーリングを使用している既存のプールに Always On 可用性グループを展開する
<a name="BKMK_MirroredPool_CreateAlwaysOnGroup"> </a>

> [!NOTE]
> AG にアップグレードするプールが組織の中央管理ストアをホストしている場合は、このプールをアップグレードする前に、まず CMS を別のプールに移動する必要があります。 プールを移動するには、Move-CsManagementServer コマンドレットを使用します。 組織内に別のプールがない場合は、プールを AG にアップグレードする前に、Standard Edition サーバーを一時的に展開し、このサーバーに CMS を移動することができます。 
  
1. Skype for Business Server 管理シェルを開き、次のコマンドレットを入力して、ミラーからプリンシパルノードにすべてのデータをフェールオーバーします。
    
   ```
   Invoke-CsDatabaseFailover -PoolFqdn <Pool FQDN> -DatabaseType <DatabaseType> -NewPrincipal "Primary"
   ```

    プール内の各データベースの種類に対してこのコマンドレットを繰り返します。次のコマンドレットを使用すると、このプールに格納されているすべてのデータベースの種類を見つけることができます。
     
   ```
   Get-CsPool -Identity <Pool FQDN>
   ```

2. トポロジビルダーを使用して、プールからデータベースのミラーリングを削除します。
    
   - トポロジビルダーを開きます。 トポロジで [**Enterprise Edition フロントエンド プール**] を展開し、プール名を右クリックし、[**プロパティの編集**] をクリックします。
    
   - プール内の各種類の SQL ストアに対して、[**SQL ストアのミラーリングを有効にする**] チェック ボックスをオフにします。
    
3. 変更したトポロジを公開します。[**操作**] メニューから、[**トポロジ**]、[**公開**] の順にクリックします。続いて確認ページで [**次へ**] をクリックします。
    
4. SQL Server Management Studio を使用して、ミラーを解除します。
    
   - SQL Server Management Studio を開き、使用しているデータベースに移動し、[**タスク**] を右クリックし、[**ミラー**] をクリックします。続いて [**ミラーリングの削除**] をクリックし、[**OK**] をクリックします。
    
   - プール内のすべてのデータベースに対してこの手順を繰り返します。これは、AG に変換されます。
    
5. AG の一部となるすべてのデータベースサーバーでフェールオーバークラスタリング機能をセットアップします。 各サーバーで、以下の作業を行います。
    
   - サーバー マネージャーを開き、[**役割と機能の追加**] をクリックします。
    
   - [**機能の選択**] ボックスが表示されるまで [**次へ**] をクリックします。このボックスで、[**フェールオーバー クラスタリング**] チェック ボックスをオンにします。
    
   - [**フェールオーバー クラスタリングに必要な機能を追加しますか?**] ボックスで、[**機能の追加**] をクリックします。
    
   - [**インストール**] をクリックします。
    
6. クラスター構成を検証します。
    
   - サーバー マネージャーで、[**ツール**] メニューをクリックし、[**フェールオーバー クラスター マネージャー**] をクリックします。
    
   - 画面右側の [**操作**] で、[**構成の検証**] をクリックします。
    
   - [**開始する前に**] ページで、[**次へ**] をクリックします。
    
   - クラスターに追加するサーバーを選択し、[**すべてのテストを実行**] をクリックします。
    
   - [**概要**] ボックスで、ウィザードにより報告されたすべてのエラーを確認します。確認したら、[**完了**] をクリックして検証を完了します。
    
     特に、共有ストレージを使用していない場合、通常はウィザードにより複数の警告が報告されます。共有ストレージを使用する必要はありませんが、[**エラー**] でメッセージが表示されている場合は、作業を続行する前にこれらの問題を修正する必要があります。
    
7. Windows Server フェールオーバークラスターを作成します。
    
   - [**フェールオーバー クラスター管理**] ウィザードで、[**フェールオーバー クラスター管理**]、[**クラスターの作成**] の順にクリックします。
    
   - [**開始する前に**] ページで、[**次へ**] をクリックします。
    
   - クラスター名と IP アドレスを追加します。設定が検証されたら、[**次へ**] をクリックします。
    
   - [確認] ページで、[**次へ**] をクリックします。
    
   - クラスターが作成されたら、[**完了**] をクリックします。
    
8. ファイル共有監視を使用するようにクラスター クォーラム設定を構成することをお勧めします。このためには、以下の手順を行います。
    
   - クラスター名を右クリックし、[**他の操作**]、[**クラスター クォーラム設定の構成**] の順にクリックします。
    
   - [**クォーラム構成オプションの選択**] ページで、[**クォーラム監視を選択する**] をクリックします。
    
   - [**クォーラム監視の選択**] ページで、[**ファイル共有監視を構成する**] をクリックします。
    
   - [**ファイル共有監視の構成**] ページで、使用するファイル共有のパスを入力し、[**次へ**] をクリックします。
    
   - [**確認**] ページで、[**次へ**] をクリックします。
    
9. クラスターの各サーバーで、SQL Server 構成マネージャーの AG 機能を有効にします。
    
   - SQL Server 構成マネージャーを開きます。画面左側のツリーで、[**SQL Server のサービス**] をクリックし、SQL Server サービスをダブルクリックします。 
    
   - [**プロパティ**] ボックスで、[**AlwaysOn 高可用性**] タブを選択します。[**AlwaysOn 可用性グループを有効にする**] チェック ボックスをオンにします。SQL Server サービスを再開するよう求めるメッセージが表示されたら、サービスを再開します。
    
10. 可用性グループを作成します。
    
    - SQL Server Management Studio を開き、SQL Server インスタンスに接続します。
    
    - オブジェクトエクスプローラーで、 **[常に高可用性**] フォルダーを展開します。 [**可用性グループ**] フォルダーを右クリックし、[**新しい可用性グループ ウィザード**] をクリックします。
    
    - [**説明**] ページが表示されたら、[**次へ**] をクリックします。
    
    - [**可用性グループ名の指定**] ページで、可用性グループの名前を入力し、[**次へ**] をクリックします。
    
    - [データベースの選択] ページで、AlwaysOn 可用性グループに含めるデータベースを選びます。 続いて [ **次へ**] をクリックします。
    
    このシナリオではサポートされていないため、 **ReportServer**、 **reportservertempdb**、または常設チャットデータベースは、AlwaysOn の可用性グループに含めないでください。 他のすべての Skype for Business Server データベースを AlwaysOn 可用性グループに含めることができます。
    
    - [**レプリカの指定**] ページで、[**レプリカ**] タブをクリックします。続いて [**レプリカの追加**] ボタンをクリックし、Windows Server フェールオーバー クラスターのノードとして参加させた他の SQL インスタンスに接続します。
    
    - 各インスタンスの [**自動フェールオーバー**] オプションと [**同期コミット**] オプションをオンにします。[**読み取り可能なセカンダリ**] オプションはオンにしないでください。
    
    - [**エンドポイント**] タブをクリックし、[**ポート番号**] が "5022" に設定されていることを確認します。
    
      - [**リスナー**] タブをクリックし、[**可用性グループ リスナーの作成**] オプションをオンにします。そのオプションの下で、リスナーの名前を入力し、[**ポート**] を "1433" (他のポートはこのオプションではサポートされません) に設定します。
    
    - [**追加**] をクリックし、[**IPv4 アドレス**] ボックスに優先させる仮想 IP アドレスを入力して、[**OK**] をクリックします。
    
    - [**最初のデータの同期を選択**] ページで [完全] を選択します。レプリカがアクセスでき、両方のレプリカにより使用される SQL Server サービス アカウントが書き込みアクセス許可を持っているフォルダーを指定します。続いて、[**次へ**] をクリックします。
    
    このファイル共有は、データベースを初期化した時点で一時的に使用されます。大きなデータベースを扱う場合、使用するネットワーク帯域幅でデータベース バックアップのサイズに対応できない場合に備えて、データベースを手動で初期化することを推奨します。
    
    - [検証] ページで、すべての検証チェックが成功したことを確認し、[**次へ**] をクリックします。
    
    - [**概要**] ページで、すべての設定を確認し、[完了] をクリックします。
    
11. AG リスナーを指定し、古いミラーのプリンシパルを AG のプライマリノードとして指定して、新しいストアを作成します。
    
    - トポロジビルダーを開きます。 トポロジで、[**共有コンポーネント**] を展開し、[**SQL Server ストア**] を右クリックして、[**新しい SQL Server ストア**] をクリックします。
    
    - [**新しい SQL ストアの定義**] ページで、まず [**高可用性の設定**] チェック ボックスをオンにしてから、SQL AlwaysOn 可用性グループがドロップダウン ボックスに表示されていることを確認します。
    
    - [**SQL Server の可用性グループのリスナーの FQDN**] ボックスに、可用性グループを作成したときに作成したリスナーの FQDN を入力します。
    
    - [ **SQL SERVER fqdn** ] ボックスに、AG のプライマリノードの fqdn を入力し、[ **OK**] をクリックします。 これは、このストアの古いミラーのプリンシパルである必要があります。
    
12. 新しい AG をフロントエンドプールに関連付けます。
    
    - Topology Builder で、AG に関連付けるプールを右クリックし、[**プロパティの編集**] をクリックします。
    
    - [**関連付け**] の [ **SQL Server ストア**] ボックスで、AG を選択します。 AG に移動する他のすべてのデータベースについて、同じグループを選択します。
    
    - 必要なすべてのデータベースが AG に設定されていることを確認したら、[ **OK]** をクリックします。
    
13. トポロジを公開します。 [**操作**] メニューから、[**トポロジ**]、[**公開**] の順にクリックします。 続いて、確認ページで [**次へ**] をクリックします。
    
14. 最後の手順を実行して、SQL ログインが AlwaysOn 可用性グループの各レプリカに含まれていることを確認します。
    
    - トポロジビルダーを開き、[**既存の展開からトポロジをダウンロード**] を選択して、[ **OK]** をクリックします。
    
    - [Skype for Business Server]、使用するトポロジ、[**SQL Server ストア**] の順に展開します。 新しい AG の SQL ストアを右クリックし、[プロパティの**編集**] をクリックします。
    
    - ページの下部にある [ **SQL SERVER FQDN** ] ボックスで、値を AG のリスナーの fqdn に変更します。
    
    - トポロジを公開します。[**操作**] メニューから、[**トポロジ**]、[**公開**] の順にクリックします。続いて、確認ページで [**次へ**] をクリックします。新しいトポロジがレプリケートされるまで数分待ちます。
    
    - SQL Server Management Studio を開き、AG に移動します。 AlwaysOn 可用性グループのセカンダリ レプリカへのフェールオーバーを行います。
    
    - Skype for Business Server 管理シェルを開き、次のコマンドレットを入力してこの複製物の SQL ログインを作成します。
    
    ```
    Install-CsDatabase -Update
    ```

    - 前の2つの手順を繰り返します (グループをセカンダリレプリカにフェイルオーバー `Install-CsDatabase -Update`してから、グループ内の各レプリカに対して使用します)。
    
## <a name="deploy-an-always-on-availability-group-on-an-existing-pool-that-does-not-use-database-mirroring"></a>データベースミラーリングを使用していない既存のプールに Always On 可用性グループを展開する
<a name="BKMK_NoHAPool_CreateAlwaysOnGroup"> </a>

> [!NOTE]
> AG にアップグレードするプールが組織の中央管理ストアをホストしている場合は、このプールをアップグレードする前に、まず CMS を別のプールに移動する必要があります。 プールを移動するには、Move-CsManagementServer コマンドレットを使用します。 組織内に別のプールがない場合は、プールを AG にアップグレードする前に、Standard Edition サーバーを一時的に展開し、このサーバーに CMS を移動することができます。 
  
1. AG の一部となるすべてのデータベースサーバーでフェールオーバークラスタリング機能をセットアップします。 各サーバーで、以下の作業を行います。
    
   - サーバー マネージャーを開き、[**役割と機能の追加**] をクリックします。
    
   - [**機能の選択**] ボックスが表示されるまで [**次へ**] をクリックします。このボックスで、[**フェールオーバー クラスタリング**] チェック ボックスをオンにします。
    
   - [**フェールオーバー クラスタリングに必要な機能を追加しますか?**] ボックスで、[**機能の追加**] をクリックします。
    
   - [**インストール**] をクリックします。
    
2. クラスター構成を検証します。
    
   - サーバー マネージャーで、[**ツール**] メニューをクリックし、[**フェールオーバー クラスター マネージャー**] をクリックします。
    
   - 画面右側の [**操作**] で、[**構成の検証**] をクリックします。
    
   - [**開始する前に**] ページで、[**次へ**] をクリックします。
    
   - クラスターに追加するサーバーを選択し、[**すべてのテストを実行**] をクリックします。
    
   - [**概要**] ボックスで、ウィザードにより報告されたすべてのエラーを確認します。確認したら、[**完了**] をクリックして検証を完了します。
    
     特に、共有ストレージを使用していない場合、通常はウィザードにより複数の警告が報告されます。共有ストレージを使用する必要はありませんが、[**エラー**] でメッセージが表示されている場合は、作業を続行する前にこれらの問題を修正する必要があります。
    
3. Windows Server フェールオーバークラスター (WSFC) を作成します。
    
   - [**フェールオーバー クラスター管理**] ウィザードで、[**フェールオーバー クラスター管理**]、[**クラスターの作成**] の順にクリックします。
    
   - [**開始する前に**] ページで、[**次へ**] をクリックします。
    
   - クラスター名と IP アドレスを追加します。設定が検証されたら、[**次へ**] をクリックします。
    
   - [確認] ページで、[**次へ**] をクリックします。
    
   - クラスターが作成されたら、[**完了**] をクリックします。
    
4. ファイル共有監視を使用するようにクラスター クォーラム設定を構成することをお勧めします。このためには、以下の手順を行います。
    
   - クラスター名を右クリックし、[**他の操作**]、[**クラスター クォーラム設定の構成**] の順にクリックします。
    
   - [**クォーラム構成オプションの選択**] ページで、[**クォーラム監視を選択する**] をクリックします。
    
   - [**クォーラム監視の選択**] ページで、[**ファイル共有監視を構成する**] をクリックします。
    
   - [**ファイル共有監視の構成**] ページで、使用するファイル共有のパスを入力し、[**次へ**] をクリックします。
    
   - [**確認**] ページで、[**次へ**] をクリックします。
    
5. クラスターの各サーバーで、SQL Server 構成マネージャーで AG を有効にします。
    
   - SQL Server 構成マネージャーを開きます。画面左側のツリーで、[**SQL Server のサービス**] をクリックし、SQL Server サービスをダブルクリックします。 
    
   - [**プロパティ**] ボックスで、[**AlwaysOn 高可用性**] タブを選択します。[**AlwaysOn 可用性グループを有効にする**] チェック ボックスをオンにします。SQL Server サービスを再開するよう求めるメッセージが表示されたら、サービスを再開します。
    
6. 可用性グループを作成します。
    
   - SQL Server Management Studio を開き、SQL Server インスタンスに接続します。
    
   - オブジェクトエクスプローラーで、 **[常に高可用性**] フォルダーを展開します。 [**可用性グループ**] フォルダーを右クリックし、[**新しい可用性グループ ウィザード**] をクリックします。
    
   - [**説明**] ページが表示されたら、[**次へ**] をクリックします。
    
   - [**可用性グループ名の指定**] ページで、可用性グループの名前を入力し、[**次へ**] をクリックします。
    
   - [データベースの選択] ページで、AG に含めるデータベースを選択します。 続いて [ **次へ**] をクリックします。
    
     AG では、 **ReportServer**、 **Reportservertempdb**、常設チャットデータベースは含めません。このシナリオではサポートされていません。 AG には、その他のすべての Skype for Business Server データベースを含めることができます。
    
   - [**レプリカの指定**] ページで、[**複製**] タブをクリックします。次に、[**レプリカの追加**] ボタンをクリックして、WSFC のノードとして参加した他の SQL インスタンスに接続します。
    
   - 各インスタンスの [**自動フェールオーバー**] オプションと [**同期コミット**] オプションをオンにします。[**読み取り可能なセカンダリ**] オプションはオンにしないでください。
    
   - [**エンドポイント**] タブをクリックし、[**ポート番号**] が "5022" に設定されていることを確認します。
    
   - [**リスナー**] タブをクリックし、[**可用性グループ リスナーの作成**] オプションをオンにします。そのオプションの下で、リスナーの名前を入力し、[**ポート**] を "1433" (他のポートはこのオプションではサポートされません) に設定します。
    
   - [**追加**] をクリックし、[**IPv4 アドレス**] ボックスに優先させる仮想 IP アドレスを入力して、[**OK**] をクリックします。
    
   - [**最初のデータの同期を選択**] ページで [完全] を選択します。レプリカがアクセスでき、両方のレプリカにより使用される SQL Server サービス アカウントが書き込みアクセス許可を持っているフォルダーを指定します。続いて、[**次へ**] をクリックします。
    
     このファイル共有は、データベースを初期化した時点で一時的に使用されます。大きなデータベースを扱う場合、使用するネットワーク帯域幅でデータベース バックアップのサイズに対応できない場合に備えて、データベースを手動で初期化することを推奨します。
    
     - [検証] ページで、すべての検証チェックが成功したことを確認し、[**次へ**] をクリックします。
    
   - [**概要**] ページで、すべての設定を確認し、[完了] をクリックします。
    
7. AG リスナーを指定して、新しいストアを作成します。
    
   - トポロジビルダーを開きます。 トポロジで、[**共有コンポーネント**] を展開し、[**SQL Server ストア**] を右クリックして、[**新しい SQL Server ストア**] をクリックします。
    
   - [**新しい SQL ストアの定義**] ページで、まず [**高可用性の設定**] チェック ボックスをオンにしてから、SQL AlwaysOn 可用性グループがドロップダウン ボックスに表示されていることを確認します。
    
   - [**SQL Server の可用性グループのリスナーの FQDN**] ボックスに、可用性グループを作成したときに作成したリスナーの FQDN を入力します。
    
   - [ **SQL SERVER fqdn** ] ボックスに、AG のプライマリノードの fqdn を入力し、[ **OK**] をクリックします。
    
8. 新しい Always On 可用性グループをフロントエンドプールに関連付けます。
    
   - Topology Builder で、AG に関連付けるプールを右クリックし、[**プロパティの編集**] をクリックします。
    
   - [**関連付け**] の [ **SQL Server ストア**] ボックスで、AG を選択します。 AG に移動する他のすべてのデータベースについて、同じグループを選択します。
    
   - 必要なすべてのデータベースが AG に設定されていることを確認したら、[ **OK]** をクリックします。
    
9. トポロジを公開します。 [**操作**] メニューから、[**トポロジ**]、[**公開**] の順にクリックします。 続いて、確認ページで [**次へ**] をクリックします。
    
10. 最終的な手順を実行して、AG の各レプリカに SQL ログインが含まれていることを確認します。
    
    - トポロジビルダーを開き、[**既存の展開からトポロジをダウンロード**] を選択して、[ **OK]** をクリックします。
    
    - [Skype for Business Server]、使用するトポロジ、[**SQL Server ストア**] の順に展開します。 新しい AG の SQL ストアを右クリックし、[プロパティの**編集**] をクリックします。
    
    - ページの下部にある [ **SQL SERVER FQDN** ] ボックスで、値を AG のリスナーの fqdn に変更します。
    
    - トポロジを公開します。[**操作**] メニューから、[**トポロジ**]、[**公開**] の順にクリックします。続いて、確認ページで [**次へ**] をクリックします。新しいトポロジがレプリケートされるまで数分待ちます。
    
    - SQL Server Management Studio を開き、AG に移動します。 AlwaysOn 可用性グループのセカンダリ レプリカへのフェールオーバーを行います。
    
    - Skype for Business Server 管理シェルを開き、次のコマンドレットを入力してこの複製物の SQL ログインを作成します。
    
      ```
      Install-CsDatabase -Update
      ```

      - 前の2つの手順を繰り返します (グループをセカンダリレプリカにフェイルオーバー `Install-CsDatabase -Update`してから、グループ内の各レプリカに対して使用します)。
