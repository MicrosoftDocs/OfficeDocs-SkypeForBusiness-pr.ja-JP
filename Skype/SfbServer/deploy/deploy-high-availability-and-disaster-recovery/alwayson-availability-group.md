---
title: Skype for Business Server のバック エンド サーバーに Always On 可用性グループを展開する
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: c93c01e6-626c-40ad-92dd-373b0fe9189f
description: Skype for Business Server 展開に Always On 可用性グループを展開 (インストール) します。
ms.openlocfilehash: 83565efe850570ac5ab9a0695757e708f3eae566
ms.sourcegitcommit: c528fad9db719f3fa96dc3fa99332a349cd9d317
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/12/2021
ms.locfileid: "49830657"
---
# <a name="deploy-an-always-on-availability-group-on-a-back-end-server-in-skype-for-business-server"></a>Skype for Business Server のバック エンド サーバーに Always On 可用性グループを展開する
 
Skype for Business Server 展開に Always On 可用性グループ (AG) を展開 (インストール) します。
  
AG の展開方法は、新しいプール、ミラーリングを使用する既存のプール、または現在、バック エンド データベースの高可用性がない既存のプールに展開するかどうかによって異なります。
  
> [!NOTE]
> 常設チャット サーバーの役割で AG を使用する方法はサポートされていません。 
  
- [新しいフロントエンド プールに Always On 可用性グループを展開する](alwayson-availability-group.md#BKMK_NewPool_CreateAlwaysOnGroup)
    
- [データベース ミラーリングを使用する既存のプールに Always On 可用性グループを展開する](alwayson-availability-group.md#BKMK_MirroredPool_CreateAlwaysOnGroup)
    
- [データベース ミラーリングを使用しない既存のプールに Always On 可用性グループを展開する](alwayson-availability-group.md#BKMK_NoHAPool_CreateAlwaysOnGroup)
    
## <a name="deploy-an-always-on-availability-group-on-a-new-front-end-pool"></a>新しいフロントエンド プールに Always On 可用性グループを展開する
<a name="BKMK_NewPool_CreateAlwaysOnGroup"> </a>

1. AG の一部になるすべてのデータベース サーバーでフェールオーバー クラスタリング機能を有効にします。 各サーバーで、次の操作を行います。
    
   - サーバー マネージャーを開き、[役割と **機能の追加] をクリックします**。
    
   - [機能 **の選択** ] ボックスが表示されるまで 、[ **次へ] をクリック** します。 ここで、[フェールオーバー クラスタリング **] チェック ボックスを** オンにします。
    
   - [フェールオーバー **クラスタリングに必要な機能の追加** ] ボックスで、[機能の追加] **をクリックします**。
    
   - **[インストール]** をクリックします。
    
2. クラスター構成を検証します。
    
   - サーバー マネージャーで、[ツール] メニュー **をクリック** し、[フェールオーバー クラスター マネージャー] **をクリックします**。
    
   - 画面 **の右側** にある [操作] で、[構成の検証] **をクリックします**。
    
   - **[始める前に]** ページで、 **[次へ]** をクリックします。
    
   - クラスターに追加するサーバーを選択し、[すべてのテストを実行] **をクリックします**。
    
   - [概要 **] ボックス** で、ウィザードによって報告されるエラーを確認します。 次に、[ **完了]** をクリックして検証を完了します。
    
     特に共有ストレージを使用していない場合は、ウィザードによっていくつかの警告が報告される可能性があります。 共有ストレージを使用する必要はありません。 ただし、エラー メッセージが表示 **された場合** は、続行する前にそれらの問題を修正する必要があります。
    
3. Windows Server フェールオーバー クラスター (WSFC) を作成します。
    
   - フェールオーバー クラスター **管理ウィザードで、[** フェールオーバー クラスター管理] を **右クリックし**、[クラスターの作成] **をクリックします**。
    
   - **[始める前に]** ページで、 **[次へ]** をクリックします。
    
   - クラスター名と IP アドレスを追加します。 設定が検証された後、[次へ] を **クリックします**。
    
   - [確認] ページで、 **[次へ]** をクリックします。
    
   - クラスターが作成された後、[完了] を **クリックします**。
    
4. ファイル共有監視を使用するクラスター クォーラム設定を構成することをお勧めします。 これを行うには、次の手順を使用します。
    
   - クラスター名を右クリックし、[その他の操作 **] を** クリックして、[クラスター クォーラム設定の構成 **] をクリックします**。
    
   - [クォー **ラム構成オプションの選択] ページ** で、[クォーラム監視 **の選択] をクリックします**。
    
   - [クォー **ラム監視の選択]** ページで、[ファイル共有監視 **の構成] をクリックします**。
    
   - [ファイル **共有監視の** 構成] ページで、使用するファイル共有のパスを入力し、[次へ] をクリック **します**。
    
   - **[確認]** ページで、 **[次へ]** をクリックします。
    
5. クラスター内の各サーバーで、Configuration Manager で AG SQL Server有効にします。
    
   - SQL Server 構成マネージャーを開きます。 画面の左側のツリーで、[SQL Server **サービス**] をクリックし、SQL Serverします。 
    
   - [プロパティ **] ボックス** で **、[AlwaysOn 高可用性] タブを選択** します。 **[AlwaysOn 可用性グループを有効にする]** チェック ボックスをオンにします。 メッセージが表示されたらSQL Serverサービスを再起動します。
   
6. 「Skype for Business Server での新しいトポロジの作成と公開」で説明されている方法で、トポロジ ビルダーを使用してフロントエンド プール [を作成します](../../deploy/install/create-and-publish-new-topology.md)。 その場合は、AG をプールのSQLストアとして指定します。
    
7. 可用性グループを作成します。
    
   - 新SQL Server Management Studio開き、新しいインスタンスSQL Serverします。
    
   - オブジェクト エクスプローラーで **、Always On 高可用性フォルダーを展開** します。 可用性グループ フォルダーを **右クリックし** 、新しい可用性グループ **ウィザードをクリックします**。
    
   - [概要] **ページが** 表示されたら、[次へ] を **クリックします**。
    
   - [可用性 **グループ名の指定** ] ページで、可用性グループの名前を入力し、[次へ] をクリック **します**。
    
   - [データベースの選択] ページで、AlwaysOn 可用性グループに含めるデータベースを選択します。 次に、[**次へ**] をクリックします。
    
     このシナリオではサポートされていないので **、AlwaysOn** 可用性グループには ReportServer データベース **、ReportServerTempDB** データベース、または常設チャット データベースを含めずにしてください。 AlwaysOn 可用性グループには、他のすべての Skype for Business Server データベースを含めできます。
    
   - [レプリカ **の指定] ページ** で、[レプリカ] **タブをクリック** します。次に、[ **レプリカ** の追加] ボタンをクリックし、Windows Server フェールオーバー クラスターのノードとして参加SQL他のインスタンスに接続します。
    
   - インスタンスごとに、[自動フェールオーバーと **同期コミット** ] **オプションを選択** します。 [読み取り可能な **セカンダリ] オプションは選択** できません。
    
   - [エンドポイント **] タブを** クリックし、 **ポート** 番号が 5022 に設定されています。
    
   - [リスナー **] タブを** クリックし、[可用性グループ リスナー **の作成] オプションを選択** します。 このオプションの下にリスナーの名前を入力し、 **ポート** を 1433 に設定します (他のポートは、このオプションではサポートされていません)。
    
   - [ **追加]** をクリックし **、[IPv4 アドレス** ] ボックスに希望する仮想 IP アドレスを入力し **、[OK]** をクリックします。
    
   - [初期データ同期の選択] ページで [完全] を選択し、レプリカからアクセス可能なフォルダーを指定します。また、両方のレプリカで使用される SQL Server サービス アカウントに書き込みアクセス許可が付与されます。 次に、[**次へ**] をクリックします。
    
     このファイル共有は、データベースを初期化するときに一時的に使用されます。 大規模なデータベースを扱う場合は、ネットワーク帯域幅がデータベース バックアップのサイズに対応できない場合に備え、手動で初期化することをお勧めします。
    
   - [検証] ページで、すべての検証チェックが成功したと確認し、[次へ] をクリック **します**。
    
   - [概要 **] ページで** 、すべての設定を確認し、[完了] をクリックします。
      
8. プールと AG を展開した後、最後の手順を実行して、SQL ログインが AlwaysOn 可用性グループ内の各レプリカ上に配置されている必要があります。 
    
   - トポロジ ビルダーを開き、[既存の展開から **トポロジ** をダウンロードする] を選択し **、[OK] をクリックします**。
    
   - [Skype for Business Server] を展開し、トポロジを展開し、[ストア] **SQL Server展開します**。 新しい AlwaysOn 可用性SQLストアを右クリックし、[プロパティの編集] を **クリックします**。
    
     - ページの下部にある [ SQL Server **FQDN]** ボックスで、値を AG のリスナーの FQDN に変更します。
    
   - トポロジを公開します。 [操作 **] メニューの** [ **トポロジ] をクリックし、[公開]** を **クリックします**。 次に、確認ページで [次へ] を **クリックします**。 その後、新しいトポロジがレプリケートされるのを数分待ちます。
    
   - ファイルSQL Server Management Studio開き、AG に移動します。 セカンダリ レプリカにフェールオーバーします。
    
   - Skype for Business Server 管理シェルを開き、次のコマンドレットを入力して、このレプリカSQLログインを作成します。
    
   ```powershell
   Install-CsDatabase -Update
   ```

   - グループ内の各レプリカについて、前の 2 つの手順を繰り返します (グループをセカンダリ レプリカにフェールオーバーし、次に  `Install-CsDatabase -Update` 使用します)。
    
## <a name="deploy-an-always-on-availability-group-on-an-existing-pool-that-uses-database-mirroring"></a>データベース ミラーリングを使用する既存のプールに Always On 可用性グループを展開する
<a name="BKMK_MirroredPool_CreateAlwaysOnGroup"> </a>

> [!NOTE]
> AG にアップグレードするプールが組織の中央管理ストアをホストしている場合は、このプールをアップグレードする前に、まず CMS を別のプールに移動する必要があります。 次のコマンドレットMove-CsManagementServer使用して、プールを移動します。 組織内に別のプールを持たしていない場合は、プールを AG にアップグレードする前に、Standard Edition サーバーを一時的に展開し、CMS をこのサーバーに移動できます。 
  
1. Skype for Business Server 管理シェルを開き、次のコマンドレットを入力して、ミラーからプリンシパル ノードにすべてのデータをフェールオーバーします。
    
   ```powershell
   Invoke-CsDatabaseFailover -PoolFqdn <Pool FQDN> -DatabaseType <DatabaseType> -NewPrincipal "Primary"
   ```

    プール内のデータベースの種類ごとに、このコマンドレットを繰り返します。 次のコマンドレットを使用して、このプールに格納されているデータベースの種類を検索できます。
     
   ```powershell
   Get-CsPool -Identity <Pool FQDN>
   ```

2. トポロジ ビルダーを使用して、プールからデータベース ミラーリングを削除します。
    
   - トポロジ ビルダーを開きます。 トポロジで **、Enterprise Edition** フロントエンド プールを展開し、プールの名前を右クリックして、[プロパティの編集] **をクリックします**。
    
   - プール内のストアのSQL種類ごとに、[ストア ミラーリングの有効化] SQL **オフ** にします。
    
3. 変更されたトポロジを公開します。 [操作 **] メニューの** [ **トポロジ] をクリックし、[公開]** を **クリックします**。 次に、確認ページで [次へ] を **クリックします。**
    
4. ミラー SQL Server Management Studioを壊す場合は、このコマンドを使用します。
    
   - データベースSQL Server Management Studio開き、データベースに移動し、[タスク] を右クリックして **、[ミラー** ] をクリック **します**。 次に、[**ミラーリングの削除] をクリックし****、[OK] をクリックします**。
    
   - AG に変換されるプール内のすべてのデータベースについて、この手順を繰り返します。
    
5. AG の一部になるすべてのデータベース サーバーでフェールオーバー クラスタリング機能をセットアップします。 各サーバーで、次の操作を行います。
    
   - サーバー マネージャーを開き、[役割と **機能の追加] をクリックします**。
    
   - [機能 **の選択** ] ボックスが表示されるまで 、[ **次へ] をクリック** します。 ここで、[フェールオーバー クラスタリング **] チェック ボックスを** オンにします。
    
   - [フェールオーバー **クラスタリングに必要な機能の追加** ] ボックスで、[機能の追加] **をクリックします**。
    
   - **[インストール]** をクリックします。
    
6. クラスター構成を検証します。
    
   - サーバー マネージャーで、[ツール] メニュー **をクリック** し、[フェールオーバー クラスター マネージャー] **をクリックします**。
    
   - 画面 **の右側** にある [操作] で、[構成の検証] **をクリックします**。
    
   - **[始める前に]** ページで、 **[次へ]** をクリックします。
    
   - クラスターに追加するサーバーを選択し、[すべてのテストを実行] **をクリックします**。
    
   - [概要 **] ボックス** で、ウィザードによって報告されるエラーを確認します。 次に、[ **完了]** をクリックして検証を完了します。
    
     特に共有ストレージを使用していない場合は、ウィザードによっていくつかの警告が報告される可能性があります。 共有ストレージを使用する必要はありません。 ただし、エラー メッセージが表示 **された場合** は、続行する前にそれらの問題を修正する必要があります。
    
7. Windows Server フェールオーバー クラスターを作成します。
    
   - フェールオーバー クラスター **管理ウィザードで、[** フェールオーバー クラスター管理] を **右クリックし**、[クラスターの作成] **をクリックします**。
    
   - **[始める前に]** ページで、 **[次へ]** をクリックします。
    
   - クラスター名と IP アドレスを追加します。 設定が検証された後、[次へ] を **クリックします**。
    
   - [確認] ページで、 **[次へ]** をクリックします。
    
   - クラスターが作成された後、[完了] を **クリックします**。
    
8. ファイル共有監視を使用するクラスター クォーラム設定を構成することをお勧めします。 これを行うには、次の手順を使用します。
    
   - クラスター名を右クリックし、[その他の操作 **] を** クリックして、[クラスター クォーラム設定の構成 **] をクリックします**。
    
   - [クォー **ラム構成オプションの選択] ページ** で、[クォーラム監視 **の選択] をクリックします**。
    
   - [クォー **ラム監視の選択]** ページで、[ファイル共有監視 **の構成] をクリックします**。
    
   - [ファイル **共有監視の** 構成] ページで、使用するファイル共有のパスを入力し、[次へ] をクリック **します**。
    
   - **[確認]** ページで、 **[次へ]** をクリックします。
    
9. クラスター内の各サーバーで、Configuration Manager で AG SQL Server有効にします。
    
   - SQL Server 構成マネージャーを開きます。 画面の左側のツリーで、[SQL Server **サービス**] をクリックし、SQL Serverします。 
    
   - [プロパティ **] ボックス** で **、[AlwaysOn 高可用性] タブを選択** します。 **[AlwaysOn 可用性グループを有効にする]** チェック ボックスをオンにします。 メッセージが表示されたらSQL Serverサービスを再起動します。
    
10. 可用性グループを作成します。
    
    - 新SQL Server Management Studio開き、新しいインスタンスSQL Serverします。
    
    - オブジェクト エクスプローラーで **、Always On 高可用性フォルダーを展開** します。 可用性グループ フォルダーを **右クリックし** 、新しい可用性グループ **ウィザードをクリックします**。
    
    - [概要] **ページが** 表示されたら、[次へ] を **クリックします**。
    
    - [可用性 **グループ名の指定** ] ページで、可用性グループの名前を入力し、[次へ] をクリック **します**。
    
    - [データベースの選択] ページで、AlwaysOn 可用性グループに含めるデータベースを選択します。 次に、[**次へ**] をクリックします。
    
    このシナリオではサポートされていないので **、AlwaysOn** 可用性グループには ReportServer データベース **、ReportServerTempDB** データベース、または常設チャット データベースを含めずにしてください。 AlwaysOn 可用性グループには、他のすべての Skype for Business Server データベースを含めできます。
    
    - [レプリカ **の指定] ページ** で、[レプリカ] **タブをクリック** します。次に、[ **レプリカ** の追加] ボタンをクリックし、Windows Server フェールオーバー クラスターのノードとして参加SQL他のインスタンスに接続します。
    
    - インスタンスごとに、[自動フェールオーバーと **同期コミット** ] **オプションを選択** します。 [読み取り可能な **セカンダリ] オプションは選択** できません。
    
    - [エンドポイント **] タブを** クリックし、 **ポート** 番号が 5022 に設定されています。
    
      - [リスナー **] タブを** クリックし、[可用性グループ リスナー **の作成] オプションを選択** します。 このオプションの下にリスナーの名前を入力し、 **ポート** を 1433 に設定します (他のポートは、このオプションではサポートされていません)。
    
    - [ **追加]** をクリックし **、[IPv4 アドレス** ] ボックスに希望する仮想 IP アドレスを入力し **、[OK]** をクリックします。
    
    - [初期データ同期の選択] ページで [完全] を選択し、レプリカからアクセス可能なフォルダーを指定します。また、両方のレプリカで使用される SQL Server サービス アカウントに書き込みアクセス許可が付与されます。 次に、[**次へ**] をクリックします。
    
    このファイル共有は、データベースを初期化するときに一時的に使用されます。 大規模なデータベースを扱う場合は、ネットワーク帯域幅がデータベース バックアップのサイズに対応できない場合に備え、手動で初期化することをお勧めします。
    
    - [検証] ページで、すべての検証チェックが成功したと確認し、[次へ] をクリック **します**。
    
    - [概要 **] ページで** 、すべての設定を確認し、[完了] をクリックします。
    
11. AG リスナーを指定し、古いミラーのプリンシパルを AG のプライマリ ノードとして指定する新しいストアを作成します。
    
    - トポロジ ビルダーを開きます。 トポロジで、[共有コンポーネント]を展開し、[ストア] を右SQL Server **して**、[新しいストア] **SQL Serverします**。
    
    - [新しい SQL ストアの定義] ページで、最初に [高可用性の設定] チェック ボックスをオンにし、ドロップダウン ボックスに SQL AlwaysOn 可用性グループが表示されます。
    
    - [可用性 **SQL Server FQDN]** ボックスに、可用性グループの作成時に作成したリスナーの FQDN を入力します。
    
    - [次 **SQL Server FQDN]** ボックスに、AG のプライマリ ノードの FQDN を入力し **、[OK]** をクリックします。 これは、このストアの古いミラーのプリンシパルである必要があります。
    
12. 新しい AG をフロントエンド プールに関連付ける。
    
    - トポロジ ビルダーで、AG に関連付けるプールを右クリックし、[プロパティの編集] **をクリックします**。
    
    - [ **関連付け]** の [ストア] **ボックスSQL Server AG** を選択します。 AG に移動するプール内の他のデータベースに同じグループを選択します。
    
    - 必要なすべてのデータベースが AG に設定されているのが確実な場合は **、[OK]** をクリックします。
    
13. トポロジを公開します。 [操作 **] メニューの** [ **トポロジ] をクリックし、[公開]** を **クリックします**。 次に、確認ページで [次へ] を **クリックします**。
    
14. 最後の手順を実行して、SQL AlwaysOn 可用性グループ内の各レプリカにログインを実行します。
    
    - トポロジ ビルダーを開き、[既存の展開から **トポロジ** をダウンロードする] を選択し **、[OK] をクリックします**。
    
    - [Skype for Business Server] を展開し、トポロジを展開し、[ストア] **SQL Server展開します**。 新しい AG のSQLを右クリックし、[プロパティの編集] を **クリックします**。
    
    - ページの下部にある [ SQL Server **FQDN]** ボックスで、値を AG のリスナーの FQDN に変更します。
    
    - トポロジを公開します。 [操作 **] メニューの** [ **トポロジ] をクリックし、[公開]** を **クリックします**。 次に、確認ページで [次へ] を **クリックします**。 その後、新しいトポロジがレプリケートされるのを数分待ちます。
    
    - ファイルSQL Server Management Studio開き、AG に移動します。 セカンダリ レプリカにフェールオーバーします。
    
    - Skype for Business Server 管理シェルを開き、次のコマンドレットを入力して、このレプリカSQLログインを作成します。
    
    ```powershell
    Install-CsDatabase -Update
    ```

    - グループ内の各レプリカについて、前の 2 つの手順を繰り返します (グループをセカンダリ レプリカにフェールオーバーし、次に  `Install-CsDatabase -Update` 使用します)。
    
## <a name="deploy-an-always-on-availability-group-on-an-existing-pool-that-does-not-use-database-mirroring"></a>データベース ミラーリングを使用しない既存のプールに Always On 可用性グループを展開する
<a name="BKMK_NoHAPool_CreateAlwaysOnGroup"> </a>

> [!NOTE]
> AG にアップグレードするプールが組織の中央管理ストアをホストしている場合は、このプールをアップグレードする前に、まず CMS を別のプールに移動する必要があります。 次のコマンドレットMove-CsManagementServer使用して、プールを移動します。 組織内に別のプールを持たしていない場合は、プールを AG にアップグレードする前に、Standard Edition サーバーを一時的に展開し、CMS をこのサーバーに移動できます。 
  
1. AG の一部になるすべてのデータベース サーバーでフェールオーバー クラスタリング機能をセットアップします。 各サーバーで、次の操作を行います。
    
   - サーバー マネージャーを開き、[役割と **機能の追加] をクリックします**。
    
   - [機能 **の選択** ] ボックスが表示されるまで 、[ **次へ] をクリック** します。 ここで、[フェールオーバー クラスタリング **] チェック ボックスを** オンにします。
    
   - [フェールオーバー **クラスタリングに必要な機能の追加** ] ボックスで、[機能の追加] **をクリックします**。
    
   - **[インストール]** をクリックします。
    
2. クラスター構成を検証します。
    
   - サーバー マネージャーで、[ツール] メニュー **をクリック** し、[フェールオーバー クラスター マネージャー] **をクリックします**。
    
   - 画面 **の右側** にある [操作] で、[構成の検証] **をクリックします**。
    
   - **[始める前に]** ページで、 **[次へ]** をクリックします。
    
   - クラスターに追加するサーバーを選択し、[すべてのテストを実行] **をクリックします**。
    
   - [概要 **] ボックス** で、ウィザードによって報告されるエラーを確認します。 次に、[ **完了]** をクリックして検証を完了します。
    
     特に共有ストレージを使用していない場合は、ウィザードによっていくつかの警告が報告される可能性があります。 共有ストレージを使用する必要はありません。 ただし、エラー メッセージが表示 **された場合** は、続行する前にそれらの問題を修正する必要があります。
    
3. Windows Server フェールオーバー クラスター (WSFC) を作成します。
    
   - フェールオーバー クラスター **管理ウィザードで、[** フェールオーバー クラスター管理] を **右クリックし**、[クラスターの作成] **をクリックします**。
    
   - **[始める前に]** ページで、 **[次へ]** をクリックします。
    
   - クラスター名と IP アドレスを追加します。 設定が検証された後、[次へ] を **クリックします**。
    
   - [確認] ページで、 **[次へ]** をクリックします。
    
   - クラスターが作成された後、[完了] を **クリックします**。
    
4. ファイル共有監視を使用するクラスター クォーラム設定を構成することをお勧めします。 これを行うには、次の手順を使用します。
    
   - クラスター名を右クリックし、[その他の操作 **] を** クリックして、[クラスター クォーラム設定の構成 **] をクリックします**。
    
   - [クォー **ラム構成オプションの選択] ページ** で、[クォーラム監視 **の選択] をクリックします**。
    
   - [クォー **ラム監視の選択]** ページで、[ファイル共有監視 **の構成] をクリックします**。
    
   - [ファイル **共有監視の** 構成] ページで、使用するファイル共有のパスを入力し、[次へ] をクリック **します**。
    
   - **[確認]** ページで、 **[次へ]** をクリックします。
    
5. クラスター内の各サーバーで、Configuration Manager で AG SQL Server有効にします。
    
   - SQL Server 構成マネージャーを開きます。 画面の左側のツリーで、[SQL Server **サービス**] をクリックし、SQL Serverします。 
    
   - [プロパティ **] ボックス** で **、[AlwaysOn 高可用性] タブを選択** します。 **[AlwaysOn 可用性グループを有効にする]** チェック ボックスをオンにします。 メッセージが表示されたらSQL Serverサービスを再起動します。
    
6. 可用性グループを作成します。
    
   - 新SQL Server Management Studio開き、新しいインスタンスSQL Serverします。
    
   - オブジェクト エクスプローラーで **、Always On 高可用性フォルダーを展開** します。 可用性グループ フォルダーを **右クリックし** 、新しい可用性グループ **ウィザードをクリックします**。
    
   - [概要] **ページが** 表示されたら、[次へ] を **クリックします**。
    
   - [可用性 **グループ名の指定** ] ページで、可用性グループの名前を入力し、[次へ] をクリック **します**。
    
   - [データベースの選択] ページで、AG に含めるデータベースを選択します。 次に、[**次へ**] をクリックします。
    
     ReportServer データベース **、ReportServerTempDB** データベース、または常設チャット データベースは、このシナリオではサポートされていないので、AG に含めさせはありません。  その他すべての Skype for Business Server データベースを AG に含めできます。
    
   - [レプリカ **の指定] ページ** で、[レプリカ] **タブをクリック** します。次に、[ **レプリカの** 追加] ボタンをクリックし、WSFC のノードとして参加SQL他のインスタンスに接続します。
    
   - インスタンスごとに、[自動フェールオーバーと **同期コミット** ] **オプションを選択** します。 [読み取り可能な **セカンダリ] オプションは選択** できません。
    
   - [エンドポイント **] タブを** クリックし、 **ポート** 番号が 5022 に設定されています。
    
   - [リスナー **] タブを** クリックし、[可用性グループ リスナー **の作成] オプションを選択** します。 このオプションの下にリスナーの名前を入力し、 **ポート** を 1433 に設定します (他のポートは、このオプションではサポートされていません)。
    
   - [ **追加]** をクリックし **、[IPv4 アドレス** ] ボックスに希望する仮想 IP アドレスを入力し **、[OK]** をクリックします。
    
   - [初期データ同期の選択] ページで [完全] を選択し、レプリカからアクセス可能なフォルダーを指定します。また、両方のレプリカで使用される SQL Server サービス アカウントに書き込みアクセス許可が付与されます。 次に、[**次へ**] をクリックします。
    
     このファイル共有は、データベースを初期化するときに一時的に使用されます。 大規模なデータベースを扱う場合は、ネットワーク帯域幅がデータベース バックアップのサイズに対応できない場合に備え、手動で初期化することをお勧めします。
    
     - [検証] ページで、すべての検証チェックが成功したと確認し、[次へ] をクリック **します**。
    
   - [概要 **] ページで** 、すべての設定を確認し、[完了] をクリックします。
    
7. AG リスナーを指定する新しいストアを作成します。
    
   - トポロジ ビルダーを開きます。 トポロジで、[共有コンポーネント]を展開し、[ストア] を右SQL Server **して**、[新しいストア] **SQL Serverします**。
    
   - [新しい SQL ストアの定義] ページで、最初に [高可用性の設定] チェック ボックスをオンにし、ドロップダウン ボックスに SQL AlwaysOn 可用性グループが表示されます。
    
   - [可用性 **SQL Server FQDN]** ボックスに、可用性グループの作成時に作成したリスナーの FQDN を入力します。
    
   - [次 **SQL Server FQDN]** ボックスに、AG のプライマリ ノードの FQDN を入力し **、[OK]** をクリックします。
    
8. 新しい Always On 可用性グループをフロントエンド プールに関連付ける。
    
   - トポロジ ビルダーで、AG に関連付けるプールを右クリックし、[プロパティの編集] **をクリックします**。
    
   - [ **関連付け]** の [ストア] **ボックスSQL Server AG** を選択します。 AG に移動するプール内の他のデータベースに同じグループを選択します。
    
   - 必要なすべてのデータベースが AG に設定されているのが確実な場合は **、[OK]** をクリックします。
    
9. トポロジを公開します。 [操作 **] メニューの** [ **トポロジ] をクリックし、[公開]** を **クリックします**。 次に、確認ページで [次へ] を **クリックします**。
    
10. 最後の手順を実行して、SQLが AG 内の各レプリカ上に表示されます。
    
    - トポロジ ビルダーを開き、[既存の展開から **トポロジ** をダウンロードする] を選択し **、[OK] をクリックします**。
    
    - [Skype for Business Server] を展開し、トポロジを展開し、[ストア] **SQL Server展開します**。 新しい AG のSQLを右クリックし、[プロパティの編集] を **クリックします**。
    
    - ページの下部にある [ SQL Server **FQDN]** ボックスで、値を AG のリスナーの FQDN に変更します。
    
    - トポロジを公開します。 [操作 **] メニューの** [ **トポロジ] をクリックし、[公開]** を **クリックします**。 次に、確認ページで [次へ] を **クリックします**。 その後、新しいトポロジがレプリケートされるのを数分待ちます。
    
    - ファイルSQL Server Management Studio開き、AG に移動します。 セカンダリ レプリカにフェールオーバーします。
    
    - Skype for Business Server 管理シェルを開き、次のコマンドレットを入力して、このレプリカSQLログインを作成します。
    
      ```powershell
      Install-CsDatabase -Update
      ```

      - グループ内の各レプリカについて、前の 2 つの手順を繰り返します (グループをセカンダリ レプリカにフェールオーバーし、次に  `Install-CsDatabase -Update` 使用します)。
