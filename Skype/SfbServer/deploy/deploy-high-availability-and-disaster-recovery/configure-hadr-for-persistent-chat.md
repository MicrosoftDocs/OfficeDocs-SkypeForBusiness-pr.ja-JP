---
title: Skype for Business Server 2015 での常設チャット サーバーの高可用性および障害復旧の構成
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
ms.date: 2/7/2018
audience: ITPro
ms.topic: get-started-article
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.assetid: 5fb5b189-56c1-49cf-92c8-e4fd6e2fdd5c
description: '概要: このトピックでは、Skype for Business Server 2015 で常設チャットサーバーの高可用性と障害回復を構成する方法について説明します。'
ms.openlocfilehash: a771479eccc88c6ff30864a44649fe3d309a7ca2
ms.sourcegitcommit: ab47ff88f51a96aaf8bc99a6303e114d41ca5c2f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/20/2019
ms.locfileid: "34298487"
---
# <a name="configure-high-availability-and-disaster-recovery-for-persistent-chat-server-in-skype-for-business-server-2015"></a>Skype for Business Server 2015 での常設チャット サーバーの高可用性および障害復旧の構成
 
**概要:** このトピックでは、Skype for Business Server 2015 で常設チャットサーバーの高可用性と障害回復を構成する方法について説明します。
  
Skype for Business Server では、データベースミラーリングなど、バックエンドサーバーでの高可用性の複数のモードがサポートされています。 詳細については、「[Plan for high availability and disaster recovery in Skype for Business Server 2015](../../plan-your-deployment/high-availability-and-disaster-recovery/high-availability-and-disaster-recovery.md)」を参照してください。
  
> [!NOTE]
> AlwaysOn 可用性グループは、常設チャットサーバーではサポートされていません。 
  
高可用性と障害回復のための常設チャットの展開を構成する前に、「 [Skype For Business server 2015 の常設チャットサーバーの高可用性と障害回復の計画](../../plan-your-deployment/persistent-chat-server/high-availability-and-disaster-recovery.md)」の概念に精通していることを確認してください。 これらのトピックで説明する常設チャットサーバーの障害回復ソリューションは、ストレッチされた常設チャットサーバープールに基づいています。 計画コンテンツでは、リソース要件と、SQL Server ミラーリングを使用して高可用性と障害回復を実現している、常設チャットサーバーの高可用性と災害復旧を可能にする拡張プールトポロジを示しています。障害回復。
  
## <a name="use-topology-builder-to-configure-high-availability-and-disaster-recovery"></a>トポロジ ビルダーを使用して高可用性と障害復旧を構成する

トポロジ ビルダーで、次の手順に従って常設チャット サーバーのための高可用性と障害復旧を構成します。
  
1. ミラーデータベースとログ配布のセカンダリデータベース SQL Server ストアを追加します。
    
2. 常設チャットサーバーサービスのプロパティを編集するには、次の操作を行います。
    
    a. プライマリ データベースのミラーリングを有効にします。
    
    b. プライマリミラー SQL Server ストアを追加します。
    
    c. SQL Server のログ配布データベースを有効にします。
    
    d. SQL Server ログ配布のセカンダリ SQL Server ストアを追加します。
    
    •. セカンダリデータベースの SQL Server ストアミラーを追加します。
    
    f. トポロジを公開します。
    
## <a name="set-up-sql-server-log-shipping-for-the-persistent-chat-server-primary-database"></a>常設チャット サーバーのプライマリ データベースの SQL Server ログ配布を設定する

SQL Server Management Studio を使用して、常設チャットサーバーセカンダリログ配布データベースインスタンスに接続し、SQL Server エージェントが実行されていることを確認します。 次に、常設チャットプライマリデータベースインスタンスに接続し、次の手順を実行します。
  
1. mgc データベースを右クリックし、[**プロパティ**] をクリックします。
    
2. [**ページの選択**] で、[**トランザクション ログの配布**] をクリックします。
    
3. [**ログ配布構成のプライマリ データベースとして有効にする**] チェック ボックスをオンにします。
    
4. [**トランザクション ログのバックアップ**] で、[**バックアップの設定**] をクリックします。
    
5. [**バックアップ フォルダーのネットワーク パスを指定する**] ボックスに、トランザクション ログのバックアップ用に作成した共有フォルダーへのネットワーク パスを入力します。
    
6. バックアップ フォルダーがプライマリ サーバーに存在する場合は、[**バックアップ フォルダーがプライマリ サーバーに存在する場合は、バックアップ フォルダーのローカル パスを入力 (例: c:\backup)**] ボックスにバックアップ フォルダーのローカル パスを入力します (バックアップ フォルダーがプライマリ サーバーに存在しない場合は、このボックスを空のままにします)。
    
    > [!IMPORTANT]
    > プライマリサーバーの SQL Server サービスアカウントがローカルシステムアカウントで実行されている場合は、プライマリサーバー上にバックアップフォルダーを作成し、そのフォルダーへのローカルパスを指定する必要があります。 
  
7. [**次の期間を経過したファイルを削除する**] パラメーターと [**バックアップが次の期間内に行われない場合は警告する**] パラメーターを構成します。
    
8. [**バックアップ ジョブ**] の [**スケジュール**] ボックスに一覧表示されるバックアップ スケジュールを確認してください。 インストールのスケジュールをカスタマイズするには、[**スケジュール**] をクリックし、必要に応じて SQL Server エージェントのスケジュールを調整します。
    
9. [**圧縮**] の [**既定のサーバー設定を使用する**] を選択し、[**OK**] をクリックします。
    
10. [**セカンダリ サーバー インスタンスとデータベース**] で、[**追加**] をクリックします。
    
11. [**接続**] をクリックし、セカンダリサーバーとして構成した SQL Server のインスタンスに接続します。
    
12. [**セカンダリ データベース**] ボックスで、一覧から [**mgc**] データベースを選択します。
    
13. [**セカンダリ データベースの初期化**] タブで、[**はい、プライマリ データベースの完全バックアップを生成して、セカンダリ データベースに復元します**] オプションを選択します (また、セカンダリ データベースが存在しない場合は作成します)。
    
14. [**ファイルのコピー**] タブの [**ファイルのコピー先フォルダー**] ボックスに、トランザクション ログのバックアップのコピー先フォルダーのパスを入力します。このフォルダーは通常はセカンダリ サーバー上にあります。
    
15. [**コピー ジョブ**] の [**スケジュール**] ボックスに一覧表示されるコピー スケジュールを確認します。 インストールのスケジュールをカスタマイズするには、[**スケジュール**] をクリックし、必要に応じて SQL Server エージェントのスケジュールを調整します。 このスケジュールは、バックアップ スケジュールとよく似た内容にする必要があります。
    
16. [**復元**] タブの [**バックアップ復元時のデータベース状態**] で、[**復旧モードなし**] オプションを選択します。
    
17. [**バックアップの復元を最低限次の期間遅延する**] で [**0 分**] を選択します。
    
18. [**復元が次の期間内に行われない場合は警告する**] で警告のしきい値を選択します。
    
19. [**復元ジョブ**] の [**スケジュール**] ボックスに一覧表示される復元スケジュールを確認します。 インストールのスケジュールをカスタマイズするには、[**スケジュール**] をクリックし、必要に応じて SQL Server エージェントのスケジュールを調整して、[ **OK]** をクリックします。 このスケジュールは、バックアップ スケジュールとよく似た内容にする必要があります。
    
20. [**データベースのプロパティ**] ダイアログ ボックスで、[**OK**] をクリックして構成のプロセスを開始します。
    
## <a name="set-up-sql-server-log-shipping-between-the-primary-mirror-and-the-secondary-database"></a>プライマリ ミラーとセカンダリ データベースとの間の SQL Server ログ配布をセットアップする

プライマリ常設チャットデータベースがミラーデータベースにフェールオーバーされた場合は、次の手順に従ってログの配布を続行します。
  
1. プライマリ永続的チャットデータベースをミラーに手動でフェールオーバーします。 これを行うには、Skype for Business Server 管理シェルと**Invoke-CsDatabaseFailover**コマンドレットを使用します。
    
2. SQL Server Management Studio を使用して、プライマリ常設チャットサーバーのミラーインスタンスに接続します。
    
3. SQL Server エージェントが実行されていることを確認します。
    
4. mgc データベースを右クリックし、[**プロパティ**] をクリックします。
    
5. [**ページの選択**] で、[**トランザクション ログの配布**] をクリックします。
    
6. [**ログ配布構成のプライマリ データベースとして有効にする**] チェック ボックスをオンにします。
    
7. [**トランザクション ログのバックアップ**] で、[**バックアップの設定**] をクリックします。
    
8. [**バックアップ フォルダーのネットワーク パスを指定する**] ボックスに、トランザクション ログのバックアップ フォルダーとして作成した共有場所へのネットワーク パスを入力します。
    
9. バックアップ フォルダーがプライマリ サーバーに存在する場合は、[**バックアップ フォルダーがプライマリ サーバーに存在する場合は、バックアップ フォルダーのローカル パスを入力**] ボックスにバックアップ フォルダーのローカル パスを入力します (バックアップ フォルダーがプライマリ サーバーに存在しない場合は、このボックスを空のままにします)。
    
    > [!IMPORTANT]
    > プライマリサーバーの SQL Server サービスアカウントがローカルシステムアカウントで実行されている場合は、プライマリサーバー上にバックアップフォルダーを作成し、そのフォルダーへのローカルパスを指定する必要があります。 
  
10. [**次の期間を経過したファイルを削除する**] パラメーターと [**バックアップが次の期間内に行われない場合は警告する**] パラメーターを構成します。
    
11. [**バックアップ ジョブ**] の [**スケジュール**] ボックスに一覧表示されるバックアップ スケジュールを確認してください。 インストールのスケジュールをカスタマイズするには、[**スケジュール**] をクリックし、必要に応じて SQL Server エージェントのスケジュールを調整します。
    
    > [!IMPORTANT]
    > プライマリ データベースと同じ設定を使用します。 
  
12. [**圧縮**] で、[**既定のサーバー設定を使用する**] をクリックし、[**OK**] をクリックします。
    
13. [**セカンダリ サーバー インスタンスとデータベース**] で、[**追加**] をクリックします。
    
14. [**接続**] をクリックして、セカンダリ サーバーとして構成した SQL Server のインスタンスに接続します。
    
15. [**セカンダリ データベース**] ボックスで、一覧から [**mgc**] データベースを選択します。
    
16. [**セカンダリ データベースの初期化**] タブで、[**いいえ、セカンダリ データベースは初期化されています**] オプションをクリックします。
    
17. [**ファイルのコピー**] タブの [**ファイルのコピー先フォルダー**] に、トランザクション ログのバックアップをコピーするフォルダーのパスを入力して、[**OK**] をクリックします。多くの場合、このフォルダーは、セカンダリ サーバー上にあります。
    
18. [**スクリプトの構成**] ボックスの一覧を開き、[**スクリプト構成を新規クエリ ウィンドウに保存**] をクリックします。
    
19. [**データベースのプロパティ**] に表示された新規クエリ ウィンドウで [**OK**] をクリックして、構成プロセスを開始します。
    
20. クエリの最初の半分 (手順18を参照) を選んで実行します。--- \* \* \* \* \* \* --------- \* \* \* \* \* \*---------------------------
    
    > [!IMPORTANT]
    > Sql Server Management Studio では、SQL Server のログ配布構成で複数のプライマリデータベースがサポートされていないため、このスクリプトを手動で実行する必要があります。 
  
21. [**キャンセル**] をクリックして、ログ配布構成パネルを閉じ、プライマリ データベースとミラー化されたデータベース (フェールオーバー時) の両方でログ ファイルの配布を適切に実装する実用的なセットアップを確立します。 
    
22. プライマリ常設チャットデータベースを手動でプライマリにフェールバックします。 これを行うには、Skype for Business Server 管理シェルと**Invoke-CsDatabaseFailover**コマンドレットを使用します。
    

