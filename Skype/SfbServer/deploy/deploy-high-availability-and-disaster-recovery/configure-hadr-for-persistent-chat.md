---
title: 'Business Server 2015: 常設チャット サーバーの高可用性と障害復旧を構成する'
ms.reviewer: ''
ms.author: v-mahoffman
author: cichur
manager: serdars
ms.date: 2/7/2018
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
ms.localizationpriority: medium
ms.assetid: 5fb5b189-56c1-49cf-92c8-e4fd6e2fdd5c
description: 2015 年に常設チャット サーバーの高可用性と障害復旧を構成するSkype for Business Serverします。
ms.openlocfilehash: ce69159126a134893e03ca97e6ac3c2fc20bfda5
ms.sourcegitcommit: 65a10f80e5dfd67b2778e09f5f92c21ef09ce36a
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/04/2021
ms.locfileid: "60738893"
---
# <a name="business-server-2015-configure-high-availability-and-disaster-recovery-for-persistent-chat-server"></a>Business Server 2015: 常設チャット サーバーの高可用性と障害復旧を構成する
 
**概要:** このトピックでは、2015 年に常設チャット サーバーの高可用性と障害復旧を構成するSkype for Business Serverしてください。
  
Skype for Business Server、データベース ミラーリングを含む、バック エンド サーバーの高可用性の複数のモードをサポートしています。 詳細については、「Plan for high availability and disaster recovery in Skype for Business Server [2015」を参照](../../plan-your-deployment/high-availability-and-disaster-recovery/high-availability-and-disaster-recovery.md)してください。
  
> [!NOTE]
> AlwaysOn 可用性グループは、常設チャット サーバーではサポートされていません。 
  
高可用性と障害復旧用に常設チャット展開を構成する前に、「Plan for high availability and disaster recovery for Persistent Chat Server for [Skype for Business Server 2015」の概念](../../plan-your-deployment/persistent-chat-server/high-availability-and-disaster-recovery.md)を理解してください。 これらのトピックで説明されている常設チャット サーバーの障害復旧ソリューションは、ストレッチされた常設チャット サーバー プール上に構築されています。 計画コンテンツでは、リソース要件と、高可用性に対する SQL Server ミラーリングの使用、障害復旧のための SQL Server ログ配布など、常設チャット サーバーの高可用性と障害復旧を可能にするストレッチ プール トポロジについて説明します。
  
## <a name="use-topology-builder-to-configure-high-availability-and-disaster-recovery"></a>トポロジ ビルダーを使用して高可用性と障害復旧を構成する

トポロジ ビルダー内で、次の手順を実行して、常設チャット サーバーの高可用性と障害復旧を構成します。
  
1. ミラー データベースとログ配布セカンダリ データベースをSQL Serverします。
    
2. 常設チャット サーバー サービスのプロパティを編集して、次の内容を実行します。
    
    a. プライマリ データベースのミラーリングを有効にします。
    
    b. プライマリ ミラー をストアSQL Serverします。
    
    c. [ログ配布SQL Server有効にする] をクリックします。
    
    d. ログ配布SQL Serverを追加SQL Serverします。
    
    e. セカンダリ データベースSQL Serverミラーを追加します。
    
    f. トポロジを公開します。
    
## <a name="set-up-sql-server-log-shipping-for-the-persistent-chat-server-primary-database"></a>常設チャット SQL Serverデータベースのログ配布の設定

このSQL Server Management Studio、常設チャット サーバーのセカンダリ ログ配布データベース インスタンスに接続し、エージェントがSQL Serverしてください。 次に、常設チャット プライマリ データベース インスタンスに接続し、次の手順を実行します。
  
1. mgc データベースを右クリックしてから、[**プロパティ**] をクリックします。
    
2. [**ページの選択**] で、[**トランザクション ログの配布**] をクリックします。
    
3. [**ログ配布構成のプライマリ データベースとして有効にする**] チェック ボックスをオンにします。
    
4. [**トランザクション ログのバックアップ**] で、[**バックアップの設定**] をクリックします。
    
5. [バックアップ **フォルダーへのネットワーク パス** ] ボックスに、トランザクション ログ バックアップ フォルダー用に作成した共有へのネットワーク パスを入力します。
    
6. バックアップ フォルダーがプライマリ サーバー上にある場合は、[バックアップ フォルダーがプライマリ サーバーにある場合] ボックスに、バックアップ フォルダーへのローカル パスを入力します **(例: c:\backup)** ボックスに、バックアップ フォルダーへのローカル パスを入力します。 (バックアップ フォルダーがプライマリ サーバー上にない場合は、このボックスを空のままにできます)。
    
    > [!IMPORTANT]
    > プライマリ サーバー SQL Serverサービス アカウントがローカル システム アカウントで実行されている場合は、プライマリ サーバーにバックアップ フォルダーを作成し、そのフォルダーへのローカル パスを指定する必要があります。 
  
7. [**次の期間を経過したファイルを削除する**] パラメーターと [**バックアップが次の期間内に行われない場合は警告する**] パラメーターを構成します。
    
8. [**バックアップ ジョブ**] の [**スケジュール**] ボックスに一覧表示されるバックアップ スケジュールを確認してください。 インストールのスケジュールをカスタマイズするには、[スケジュール]をクリックし、必要にSQL Serverエージェント のスケジュールを調整します。
    
9. [ **圧縮] で**、[ **既定のサーバー設定を使用する**] を選択し **、[OK] をクリックします**。
    
10. [**セカンダリ サーバー インスタンスとデータベース**] で、[**追加**] をクリックします。
    
11. **[Connect]** をクリックし、セカンダリ サーバー SQL Server構成したサーバーのインスタンスに接続します。
    
12. [**セカンダリ データベース**] ボックスで、一覧から [**mgc**] データベースを選択します。
    
13. [セカンダリ データベースの **初期化**] タブで、[はい] オプションを選択し、プライマリ データベースの完全バックアップを生成し、セカンダリ データベースに復元します (存在しない場合はセカンダリ データベースを **作成します)。**
    
14. [ファイル **のコピー]** タブの[コピー先のファイルフォルダー] ボックスに、トランザクション ログのバックアップをコピーするフォルダーのパスを入力します。 多くの場合、このフォルダーは、セカンダリ サーバー上にあります。
    
15. [ジョブのコピー] の [スケジュール] **ボックスに一** 覧表示されているコピー スケジュール **に注意してください**。 インストールのスケジュールをカスタマイズするには、[スケジュール]をクリックし、必要にSQL Serverエージェント のスケジュールを調整します。 このスケジュールは、バックアップ スケジュールとほぼ同じにしてください。
    
16. [復元] **タブの** [バックアップ **の復元時** のデータベース状態] で、[回復モードなし] **オプションを選択** します。
    
17. [ **バックアップの復元を遅らせる]** で **、0 分を選択します**。
    
18. [アラート] の下の **[復元が発生しない場合はアラートのしきい値を選択します**。
    
19. [復元ジョブ] の [スケジュール] ボックス **に一覧表示** されている復元スケジュール **を確認します**。 インストールのスケジュールをカスタマイズするには、[スケジュール]をクリックし、必要にSQL Serverエージェント のスケジュールを調整し **、[OK] をクリックします**。 このスケジュールは、バックアップ スケジュールとほぼ同じにしてください。
    
20. [データベースの **プロパティ] ダイアログ** ボックスで **、[OK]** をクリックして構成プロセスを開始します。
    
## <a name="set-up-sql-server-log-shipping-between-the-primary-mirror-and-the-secondary-database"></a>プライマリ ミラー SQL Serverセカンダリ データベース間のログ配布のセットアップ

プライマリ 常設チャット データベースがミラー データベースにフェールオーバーされた場合にログ配布を続行するには、次の手順を実行します。
  
1. プライマリ 常設チャット データベースを手動でミラーにフェールオーバーします。 これは、管理シェルと **Invoke-CsDatabaseFailover** コマンドレットSkype for Business Server使用して行います。
    
2. サーバー を使用SQL Server Management Studio、プライマリ常設チャット サーバー ミラー インスタンスに接続します。
    
3. エージェントが実行SQL Serverしてください。
    
4. mgc データベースを右クリックしてから、[**プロパティ**] をクリックします。
    
5. [**ページの選択**] で、[**トランザクション ログの配布**] をクリックします。
    
6. [**ログ配布構成のプライマリ データベースとして有効にする**] チェック ボックスをオンにします。
    
7. [**トランザクション ログのバックアップ**] で、[**バックアップの設定**] をクリックします。
    
8. [**バックアップ フォルダーのネットワーク パスを指定する**] ボックスに、トランザクション ログのバックアップ フォルダーとして作成した共有場所へのネットワーク パスを入力します。
    
9. バックアップ フォルダーがプライマリ サーバーに存在する場合は、[**バックアップ フォルダーがプライマリ サーバーに存在する場合は、バックアップ フォルダーのローカル パスを入力**] ボックスにバックアップ フォルダーへのローカル パスを入力します (バックアップ フォルダーがプライマリ サーバーに存在しない場合は、このボックスを空のままにします)。
    
    > [!IMPORTANT]
    > プライマリ サーバー SQL Serverサービス アカウントがローカル システム アカウントで実行されている場合は、プライマリ サーバーにバックアップ フォルダーを作成し、そのフォルダーへのローカル パスを指定する必要があります。 
  
10. [**次の期間を経過したファイルを削除する**] パラメーターと [**バックアップが次の期間内に行われない場合は警告する**] パラメーターを構成します。
    
11. [**バックアップ ジョブ**] の [**スケジュール**] ボックスに一覧表示されるバックアップ スケジュールを確認してください。 インストールのスケジュールをカスタマイズするには、[スケジュール]をクリックし、必要にSQL Serverエージェント のスケジュールを調整します。
    
    > [!IMPORTANT]
    > プライマリ データベースと同じ設定を使用します。 
  
12. [**圧縮**] で、[**既定のサーバー設定を使用する**] をクリックして、[**OK**] をクリックします。
    
13. [**セカンダリ サーバー インスタンスとデータベース**] で、[**追加**] をクリックします。
    
14. [**接続**] をクリックして、セカンダリ サーバーとして構成した SQL Server のインスタンスに接続します。
    
15. [**セカンダリ データベース**] ボックスで、一覧から [**mgc**] データベースを選択します。
    
16. [**セカンダリ データベースの初期化**] タブで、[**いいえ、セカンダリ データベースは初期化されています**] オプションをクリックします。
    
17. [**ファイルのコピー**] タブの [**ファイルのコピー先フォルダー**] に、トランザクション ログのバックアップをコピーするフォルダーのパスを入力して、[**OK**] をクリックします。多くの場合、このフォルダーは、セカンダリ サーバー上にあります。
    
18. [**スクリプトの構成**] ドロップダウン リストを開き、[**スクリプト構成を新規クエリ ウィンドウに保存**] をクリックします。
    
19. [**データベースのプロパティ**] に表示された新規クエリ ウィンドウで [**OK**] をクリックして、構成プロセスを開始します。
    
20. クエリの前半を選択して実行します (手順 18 を参照)。 -- End: Script to run to \* \* \* \* \* \* Primary: \* \* \* \* \* \* .
    
    > [!IMPORTANT]
    > このスクリプトを手動で実行する必要SQL Server Management Studioログ配布構成で複数のプライマリ データベースSQL Serverサポートしていないためです。 
  
21. [**キャンセル**] をクリックして、ログ配布構成パネルを閉じ、(フェールオーバー時に) プライマリ データベースとミラー化されたデータベース両方でログ配布を適切に実装する実用的なセットアップを確立します。
    
22. プライマリ 常設チャット データベースをプライマリに手動でフェールバックします。 これは、管理シェルのSkype for Business Server **Invoke-CsDatabaseFailover コマンドレットを使用して実行** します。
    

