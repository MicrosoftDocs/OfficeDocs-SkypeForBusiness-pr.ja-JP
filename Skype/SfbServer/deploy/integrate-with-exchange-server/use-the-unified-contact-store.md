---
title: 統合連絡先ストアを使用するために Skype for Business Server を構成する
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
ms.date: 2/7/2018
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 6aa17ae3-764e-4986-a900-85a3cdb8c1fc
description: '概要: 統合連絡先ストアを Exchange Server Skype for Business Server 用に構成します。'
ms.openlocfilehash: 4b96a0c4f3294146c987794ffce083c46d94bb48
ms.sourcegitcommit: c528fad9db719f3fa96dc3fa99332a349cd9d317
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/12/2021
ms.locfileid: "49833867"
---
# <a name="configure-skype-for-business-server-to-use-the-unified-contact-store"></a><span data-ttu-id="7e160-103">統合連絡先ストアを使用するために Skype for Business Server を構成する</span><span class="sxs-lookup"><span data-stu-id="7e160-103">Configure Skype for Business Server to use the unified contact store</span></span>
 
<span data-ttu-id="7e160-104">**概要:** Exchange Server 2016 または Exchange Server 2013 および Skype for Business Server の統合連絡先ストアを構成します。</span><span class="sxs-lookup"><span data-stu-id="7e160-104">**Summary:** Configure the unified contacts store for Exchange Server 2016 or Exchange Server 2013 and Skype for Business Server.</span></span>
  
<span data-ttu-id="7e160-105">統合連絡先ストアを使用すると、ユーザーは 1 つの連絡先リストを保持し、それらの連絡先を Skype for Business、Microsoft Outlook 2013、および Microsoft Outlook Web App 2013 などの複数のアプリケーションで使用できます。</span><span class="sxs-lookup"><span data-stu-id="7e160-105">Using the unified contact store, users maintain a single contacts list and then have those contacts available in multiple applications, including Skype for Business, Microsoft Outlook 2013, and Microsoft Outlook Web App 2013.</span></span> <span data-ttu-id="7e160-106">ユーザーの統合連絡先ストアを有効にした場合、そのユーザーの連絡先は Skype for Business Server に保存され、必要に応じて取得されません。</span><span class="sxs-lookup"><span data-stu-id="7e160-106">When you enable the unified contact store for a user, that user's contacts are not stored in Skype for Business Server and retrieved as needed.</span></span> <span data-ttu-id="7e160-107">代わりに、連絡先は Exchange Server 2016 または Exchange Server 2013 に保存され、Exchange Web サービスを使用して取得されます。</span><span class="sxs-lookup"><span data-stu-id="7e160-107">Instead, his or her contacts are stored in Exchange Server 2016 or Exchange Server 2013 and are retrieved by using Exchange Web Services.</span></span>
  
> [!NOTE]
> <span data-ttu-id="7e160-108">技術的には、連絡先情報は、ユーザーの Exchange メールボックスにある 2 つのフォルダーに格納されます。</span><span class="sxs-lookup"><span data-stu-id="7e160-108">Technically, contact information is stored in a pair of folders found in the user's Exchange mailbox.</span></span> <span data-ttu-id="7e160-109">連絡先自体は、エンド ユーザーに表示される Skype for Business 連絡先という名前のフォルダーに格納されます。連絡先に関するメタデータは、エンド ユーザーに表示されないサブフォルダーに格納されます。</span><span class="sxs-lookup"><span data-stu-id="7e160-109">The contacts themselves are stored in a folder named Skype for Business Contacts which is visible to end users; metadata about the contacts are stored in a subfolder that is not visible to end users.</span></span> 
  
## <a name="enabling-the-unified-contact-store-for-a-user"></a><span data-ttu-id="7e160-110">ユーザーに対して統合連絡先ストアを有効にする</span><span class="sxs-lookup"><span data-stu-id="7e160-110">Enabling the Unified Contact Store for a User</span></span>

<span data-ttu-id="7e160-111">Skype for Business Server と Exchange Server の間のサーバー間認証が既に構成されている場合は、統合連絡先ストアも有効にしています。追加のサーバー構成は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="7e160-111">If server-to-server authentication between Skype for Business Server and Exchange Server is already configured, then you have also enabled the unified contact store; no additional server configuration is required.</span></span> <span data-ttu-id="7e160-112">ただし、ユーザーの連絡先を統合連絡先ストアに移動するために、追加のユーザー アカウント構成を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="7e160-112">However, additional user account configuration is required in order to move a user's contacts into the unified contact store.</span></span> <span data-ttu-id="7e160-113">既定では、ユーザーの連絡先は、統合連絡先ストアではなく Skype for Business Server に保持されます。</span><span class="sxs-lookup"><span data-stu-id="7e160-113">By default, user contacts are kept in Skype for Business Server and not in the unified contact store.</span></span>
  
<span data-ttu-id="7e160-114">統合連絡先ストアへのアクセスは、Skype for Business Server ユーザー サービス ポリシーを使用して管理されます。</span><span class="sxs-lookup"><span data-stu-id="7e160-114">Access to the unified contact store is managed by using Skype for Business Server user services policies.</span></span> <span data-ttu-id="7e160-115">ユーザー サーバー ポリシーには 1 つのプロパティ (UcsAllowed) のみがあります。このプロパティは、ユーザーの連絡先が格納されている場所を決定するために使用されます。</span><span class="sxs-lookup"><span data-stu-id="7e160-115">User server policies have only a single property (UcsAllowed); this property is used to determine the location where a user's contacts are stored.</span></span> <span data-ttu-id="7e160-116">UcsAllowed が True ($True) に設定されているユーザー サービス ポリシーによってユーザーが管理されている場合、ユーザーの連絡先は統合連絡先ストアに格納されます。</span><span class="sxs-lookup"><span data-stu-id="7e160-116">If a user is managed by a user services policy where UcsAllowed has been set to True ($True) then the user's contacts will be stored in the unified contact store.</span></span> <span data-ttu-id="7e160-117">UcsAllowed が False ($False) に設定されているユーザー サービス ポリシーによってユーザーが管理されている場合、ユーザーの連絡先は Skype for Business Server に保存されます。</span><span class="sxs-lookup"><span data-stu-id="7e160-117">If the user is managed by a user services policy where UcsAllowed has been set to False ($False) then his or her contacts will be stored in Skype for Business Server.</span></span>
  
<span data-ttu-id="7e160-118">Skype for Business Server をインストールすると、(グローバル スコープで構成された) 1 つのユーザー サービス ポリシーもインストールされます。</span><span class="sxs-lookup"><span data-stu-id="7e160-118">When you install Skype for Business Server, a single user services policy (configured at the global scope) is installed as well.</span></span> <span data-ttu-id="7e160-119">このポリシーの UcsAllowed 値は True に設定されています。つまり、既定では、ユーザーの連絡先は統合連絡先ストアに保存されます (これが展開および構成されている場合)。</span><span class="sxs-lookup"><span data-stu-id="7e160-119">The UcsAllowed value in this policy is set to True, meaning that, by default, user contacts will be stored in the unified contact store (assuming this has been deployed and configured).</span></span> <span data-ttu-id="7e160-120">すべてのユーザー連絡先を統合連絡先ストアに移行する場合は、何もする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="7e160-120">If you want to migrate all of your user contacts to the unified contact store you do not have to do anything at all.</span></span> 
  
<span data-ttu-id="7e160-121">すべての連絡先を統合連絡先ストアに移行しない場合は、グローバル ポリシーの UcsAllowed プロパティを False に設定して、すべてのユーザーの統合連絡先ストアを無効にできます。</span><span class="sxs-lookup"><span data-stu-id="7e160-121">If you would prefer not to migrate all your contacts to the unified contact store you can disable the unified contact store for all users by setting the UcsAllowed property in the global policy to False:</span></span>
  
```powershell
Set-CsUserServicesPolicy -Identity global -UcsAllowed $False
```

<span data-ttu-id="7e160-122">グローバル ポリシーで統合連絡先ストアを無効にした後、統合連絡先ストアの使用を有効にするユーザーごとのポリシーを作成できます。これにより、一部のユーザーは連絡先を統合連絡先ストアに保持し、他のユーザーは引き続き連絡先を Skype for Business Server に保持できます。</span><span class="sxs-lookup"><span data-stu-id="7e160-122">After you have disabled the unified contact store in the global policy you can then create a per-user policy that enables the use of the unified contact store; this allows you to have some users keep their contacts in the unified contact store while other users continue to keep their contacts in Skype for Business Server.</span></span> <span data-ttu-id="7e160-123">次のようなコマンドを使用して、ユーザーごとのユーザー サービス ポリシーを作成できます。</span><span class="sxs-lookup"><span data-stu-id="7e160-123">You can create a per-user user services policy by using a command similar to this:</span></span>
  
```powershell
New-CsUserServicesPolicy -Identity "AllowUnifiedContactStore" -UcsAllowed $True
```

<span data-ttu-id="7e160-p107">新しいポリシーを作成した後、そのポリシーを、統合連絡先ストアへのアクセス権を必要とするすべてのユーザーに割り当てる必要があります。ユーザーごとのポリシーをユーザーに割り当てるには、次のようなコマンドを使用します。</span><span class="sxs-lookup"><span data-stu-id="7e160-p107">After you have created the new policy you must then assign that policy to any user who should have access to the unified contact store. Per-user policies can be assigned to users by using commands similar to this:</span></span>
  
```powershell
Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName "AllowUnifiedContactStore"
```

<span data-ttu-id="7e160-126">ポリシーが割り当てられると、Skype for Business Server はユーザーの連絡先を統合連絡先ストアに移行し始める。</span><span class="sxs-lookup"><span data-stu-id="7e160-126">After the policy has been assigned, Skype for Business Server will begin to migrate the user's contacts to the unified contact store.</span></span> <span data-ttu-id="7e160-127">移行が完了すると、ユーザーは自分の連絡先を Skype for Business Server ではなく Exchange に保存します。</span><span class="sxs-lookup"><span data-stu-id="7e160-127">After migration is complete, the user will then have his or her contacts stored in Exchange rather than Skype for Business Server.</span></span> <span data-ttu-id="7e160-128">移行が完了した時点でユーザーが Lync 2013 にログオンすると、メッセージ ボックスが表示され、プロセスを完了するために Skype for Business からログオフしてからログオンし戻すよう求めるメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="7e160-128">If the user happens to be logged on to Lync 2013 at the time migration completes, a message box will appear and he or she will be asked to log off of Skype for Business and then log back on in order to finalize the process.</span></span> <span data-ttu-id="7e160-129">このユーザーごとのポリシーが割り当てられていないユーザーは、連絡先を統合連絡先ストアに移行されません。</span><span class="sxs-lookup"><span data-stu-id="7e160-129">Users who have not been assigned this per-user policy will not have their contacts migrated to the unified contact store.</span></span> <span data-ttu-id="7e160-130">これは、これらのユーザーがグローバル ポリシーによって管理され、統合連絡先ストアの使用がグローバル ポリシーで無効になっているためです。</span><span class="sxs-lookup"><span data-stu-id="7e160-130">That's because those users are being managed by the global policy, and use of the unified contact store has been disabled in the global policy.</span></span>
  
<span data-ttu-id="7e160-131">ユーザーの連絡先が統合連絡先ストアに正常に移行されたことを確認するには、Skype for Business Server 管理シェルから [Test-CsUnifiedContactStore](https://docs.microsoft.com/powershell/module/skype/test-csunifiedcontactstore?view=skype-ps) コマンドレットを実行します。</span><span class="sxs-lookup"><span data-stu-id="7e160-131">You can verify that a user's contacts have successfully been migrated to the unified contact store by running the [Test-CsUnifiedContactStore](https://docs.microsoft.com/powershell/module/skype/test-csunifiedcontactstore?view=skype-ps) cmdlet from within the Skype for Business Server Management Shell:</span></span>
  
```powershell
Test-CsUnifiedContactStore -UserSipAddress "sip:kenmyer@litwareinc.com" -TargetFqdn "atl-cs-001.litwareinc.com"
```

<span data-ttu-id="7e160-132">成功Test-CsUnifiedContactStore、ユーザー sip:kenmyer@ <span></span> litwareinc .com の連絡先が統合連絡先ストアに移行されたという意味 <span></span> です。</span><span class="sxs-lookup"><span data-stu-id="7e160-132">If Test-CsUnifiedContactStore succeeds that means that the contacts for the user sip:kenmyer@<span></span>litwareinc<span></span>.com have been migrated to the unified contact store.</span></span>
  
## <a name="rolling-back-the-unified-contact-store"></a><span data-ttu-id="7e160-133">統合連絡先ストアのロールバック</span><span class="sxs-lookup"><span data-stu-id="7e160-133">Rolling Back the Unified Contact Store</span></span>

<span data-ttu-id="7e160-134">統合連絡先ストアからユーザーの連絡先を削除する必要がある場合 (たとえば、ユーザーを Microsoft Lync Server 2010 に再ホームする必要がある場合、統合連絡先ストアを使用できなくなった場合など)、2 つの操作を行う必要があります。</span><span class="sxs-lookup"><span data-stu-id="7e160-134">If you need to remove a user's contacts from the unified contact store (for example, if the user needs to be rehomed on Microsoft Lync Server 2010 and thus can no longer use the unified contact store) you must do two things.</span></span> <span data-ttu-id="7e160-135">最初に、統合連絡先ストアへの連絡先の格納を禁止する新しいユーザー サービス ポリシーをユーザーに割り当てる必要があります。</span><span class="sxs-lookup"><span data-stu-id="7e160-135">First, you must assign the user a new user services policy, one that prohibits storing contacts in the unified contact store.</span></span> <span data-ttu-id="7e160-136">(つまり、UcsAllowed プロパティが有効に設定されている$False)。このようなポリシーが設定されていない場合は、次のようなコマンドを使用してポリシーを作成できます。</span><span class="sxs-lookup"><span data-stu-id="7e160-136">(That is, a policy where the UcsAllowed property has been set to $False.) If you do not have such a policy you can create one using a command similar to this:</span></span>
  
```powershell
New-CsUserServicesPolicy -Identity NoUnifiedContactStore -UcsAllowed $False
```

<span data-ttu-id="7e160-137">その後、次のようなコマンドを使用して、この新しいユーザーごとのポリシー (NoUnifiedContactStore) を割り当てます。</span><span class="sxs-lookup"><span data-stu-id="7e160-137">You can then assign this new per-user policy (NoUnifiedContactStore) by using a command like this:</span></span>
  
```powershell
Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName NoUnifiedContactStore
```

<span data-ttu-id="7e160-138">上記のコマンドは、ユーザー Ken Myer に新しいポリシーを割り当てると共に、Ken の連絡先が統合連絡先ストアに移行されないようにします。</span><span class="sxs-lookup"><span data-stu-id="7e160-138">The preceding command assigns the new policy to the user Ken Myer, and also prevents Ken's contacts from being migrated to the unified contact store.</span></span>
  
> [!NOTE]
> <span data-ttu-id="7e160-139">場合によっては、ユーザーの現在のユーザー サービス ポリシーを割り当て解除するだけで、同じ効果を得られます。</span><span class="sxs-lookup"><span data-stu-id="7e160-139">In some cases you can achieve the same net effect by simply un-assigning the user's current user services policy.</span></span> <span data-ttu-id="7e160-140">たとえば、統合連絡先ストアを有効にするユーザーごとのユーザー サービス ポリシーが Ken Myer に割り当てられているが、グローバル ポリシーでは統合連絡先ストアの使用が禁止されているとします。</span><span class="sxs-lookup"><span data-stu-id="7e160-140">For example, suppose Ken Myer has a per-user user services policy the enables the unified contact store, but your global policy prohibits the use of the unified contact store.</span></span> <span data-ttu-id="7e160-141">その場合は、Ken のユーザーごとのサービス ポリシーを割り当て解除できます。</span><span class="sxs-lookup"><span data-stu-id="7e160-141">In that case, you could un-assign Ken's per-user services policy.</span></span> <span data-ttu-id="7e160-142">それにより、Ken は自動的にグローバル ポリシーによって管理されるようになるため、統合連絡先ストアにはアクセスできなくなります。</span><span class="sxs-lookup"><span data-stu-id="7e160-142">When you do that, Ken will automatically be managed by the global policy, and thus will no longer have access to the unified contact store.</span></span> <span data-ttu-id="7e160-143">以前に割り当てられたユーザーごとのポリシーを割り当て解除するには、前に示したコマンドと同じコマンドを使用しますが、今回は PolicyName パラメーターを null 値に設定します。Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName $Null</span><span class="sxs-lookup"><span data-stu-id="7e160-143">To un-assign a previously-assigned per-user policy, use the same command as shown before, but this time set the PolicyName parameter to a null value: Grant-CsUserServicesPolicy -Identity "Ken Myer" -PolicyName $Null</span></span> 
  
<span data-ttu-id="7e160-144">統合連絡先ストアを操作する際には、"Ken の連絡先が統合連絡先ストアに移行されないようにする" という点に注意することが重要です。</span><span class="sxs-lookup"><span data-stu-id="7e160-144">The terminology "prevents Ken's contacts from being migrated to the unified contact store" is important to keep in mind when working with the unified contact store.</span></span> <span data-ttu-id="7e160-145">単純に新しいユーザー サービス ポリシーを Ken に割り当てるだけでは、Ken の連絡先は統合連絡先ストアから移動されません。</span><span class="sxs-lookup"><span data-stu-id="7e160-145">Simply assigning Ken a new user services policy will not move his contacts out of the unified contact store.</span></span> <span data-ttu-id="7e160-146">ユーザーが Skype for Business Server にログオンすると、システムはユーザーのユーザー サービス ポリシーをチェックして、連絡先を統合連絡先ストアに保持する必要があるかどうかを確認します。</span><span class="sxs-lookup"><span data-stu-id="7e160-146">When a user logs on to Skype for Business Server, the system checks the user's user services policy to see whether his or her contacts should be kept in the unified contact store.</span></span> <span data-ttu-id="7e160-147">答えが「はい」である (つまり、UcsAllowed プロパティが $True に設定されている) 場合は、連絡先が統合連絡先ストアに移行されます (連絡先がまだ統合連絡先ストアに移動されていないと仮定します)。</span><span class="sxs-lookup"><span data-stu-id="7e160-147">If the answer is yes (that is, if the UcsAllowed property is set to $True) then those contacts will be migrated to the unified contact store (assuming that those contacts are not already in the unified contact store).</span></span> <span data-ttu-id="7e160-148">回答がいいえの場合、Skype for Business Server はユーザーの連絡先を無視して次のタスクに進むだけになります。</span><span class="sxs-lookup"><span data-stu-id="7e160-148">If the answer is no, then Skype for Business Server simply ignores the user's contacts and moves on to its next task.</span></span> <span data-ttu-id="7e160-149">つまり、UcsAllowed プロパティの値に関係なく、Skype for Business Server は統合連絡先ストアからユーザーの連絡先を自動的に移動しません。</span><span class="sxs-lookup"><span data-stu-id="7e160-149">That means that Skype for Business Server will not automatically move a user's contacts from out of the unified contact store, regardless of the value of the UcsAllowed property.</span></span>
  
<span data-ttu-id="7e160-150">つまり、ユーザーに新しいユーザー サービス ポリシーを割り当て後 [、Invoke-CsUcsRollback](https://docs.microsoft.com/powershell/module/skype/invoke-csucsrollback?view=skype-ps) コマンドレットを実行して、ユーザーの連絡先を Exchange Server から Skype for Business Server に戻す必要があります。</span><span class="sxs-lookup"><span data-stu-id="7e160-150">That also means that, after assigning the user a new user services policy, you must then run the [Invoke-CsUcsRollback](https://docs.microsoft.com/powershell/module/skype/invoke-csucsrollback?view=skype-ps) cmdlet in order to move the user's contacts out of Exchange Server and back to Skype for Business Server.</span></span> <span data-ttu-id="7e160-151">たとえば、Ken Myer に新しいユーザー サービス ポリシーを割り当てた後、次のコマンドを使用して Ken の連絡先を統合連絡先ストアから移動できます。</span><span class="sxs-lookup"><span data-stu-id="7e160-151">For example, after assigning Ken Myer a new user services policy you can then move his contacts out of the unified contact store by using the following command:</span></span>
  
```powershell
Invoke-CsUcsRollback -Identity "Ken Myer"
```

<span data-ttu-id="7e160-152">ユーザー サービス ポリシーを変更したが、コマンドレット Invoke-CsUcsRollback実行しない場合、Ken の連絡先は統合連絡先ストアから削除されません。</span><span class="sxs-lookup"><span data-stu-id="7e160-152">If you change the user services policy but do not run the Invoke-CsUcsRollback cmdlet Ken's contacts will not be removed from the unified contact store.</span></span> <span data-ttu-id="7e160-153">Ken Myer のユーザー Invoke-CsUcsRollback変更しない場合は、どうしますか。</span><span class="sxs-lookup"><span data-stu-id="7e160-153">What if you run Invoke-CsUcsRollback but do not change Ken Myer's user services policy?</span></span> <span data-ttu-id="7e160-154">その場合、Ken の連絡先は統合連絡先ストアから一時的に削除されます。</span><span class="sxs-lookup"><span data-stu-id="7e160-154">In that case, Ken's contacts will be temporarily removed from the unified contact store.</span></span> <span data-ttu-id="7e160-155">この削除は一時的なものですが、念頭に置いておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="7e160-155">The fact that this removal is temporary is important to keep in mind.</span></span> <span data-ttu-id="7e160-156">Ken の連絡先が統合連絡先ストアから削除された後、Skype for Business Server は 7 日間待機し、Ken に割り当てられているユーザー サービス ポリシーを確認します。</span><span class="sxs-lookup"><span data-stu-id="7e160-156">After Ken's contacts have been removed from the unified contact store, Skype for Business Server will wait 7 days and then check to see which user services policy has been assigned to Ken.</span></span> <span data-ttu-id="7e160-157">統合連絡先ストアのユーザーを有効にするポリシーが Ken に引き続き割り当てられている場合、Ken の連絡先は自動的に連絡先ストアに戻されます。</span><span class="sxs-lookup"><span data-stu-id="7e160-157">If Ken is still assigned a policy that enables the user of the unified contact store, then his contacts will automatically be moved back to into the contact store.</span></span> <span data-ttu-id="7e160-158">統合連絡先ストアから連絡先を完全に削除するには、統合連絡先ストアコマンドレットの実行に加えて、ユーザー サービス ポリシーInvoke-CsUcsRollbackがあります。</span><span class="sxs-lookup"><span data-stu-id="7e160-158">To permanently remove contacts from the unified contact store you must change the user services policy in addition to running the Invoke-CsUcsRollback cmdlet.</span></span>
  
<span data-ttu-id="7e160-159">移行に影響を与える可能性がある変数の数が多く、アカウントが統合連絡先ストアに完全に移行される前にかかる時間を見積もるのは困難です。</span><span class="sxs-lookup"><span data-stu-id="7e160-159">Due to the large number of variables that can affect migration, it is difficult to estimate how long it will take before accounts are fully migrated to the unified contact store.</span></span> <span data-ttu-id="7e160-160">ただし、一般に、移行はすぐに有効になるわけではありません。連絡先の数が少ない場合でも、移行が完了する前に 10 分以上かかる場合があります。</span><span class="sxs-lookup"><span data-stu-id="7e160-160">As a general rule, however, migration does not take effect immediately: even when migrating a small number of contacts it might take 10 minutes or more before the move is complete.</span></span>
  

