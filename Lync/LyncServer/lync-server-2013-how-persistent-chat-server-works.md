---
title: 'Lync Server 2013: 常設チャットサーバーのしくみ'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: How Persistent Chat Server works
ms:assetid: 3d04e9a1-3f0c-458e-bcbe-d27c8c464276
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ683096(v=OCS.15)
ms:contentKeyID: 49684643
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 4a88bdad2a73022468297d73dd10bff0d26a3fee
ms.sourcegitcommit: 831d141dfc5a49dd764cb296b73b63e5a9f8e599
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/21/2020
ms.locfileid: "42214753"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="https://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">

# <a name="how-persistent-chat-server-works-in-lync-server-2013"></a>Lync Server 2013 での常設チャットサーバーの動作

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**トピックの最終更新日:** 2012-11-21_

Lync Server 2013、常設チャットサーバーを使用すると、時間の経過と共に持続するマルチパーティのトピックベースの会話に参加することができます。 常設チャットサーバーは、組織が次のことを行えるように支援します。

  - 地理的に分散されたチームや職能上の枠を越えたチーム間でのコミュニケーションを深めます。

  - 情報を広めて参加の輪を広げます。

  - 組織外の人間とのコミュニケーションを深めます。

  - 情報過多を緩和します。

  - 情報の認知を高めます。

  - 重要な知識と情報の分散を促進します。

Lync Server 2013 では、オプションの役割として常設チャットサーバーを展開できます。 常設チャットサービスは専用プール上で実行され、常設チャットサーバープールは Lync Server プールによってメッセージをルーティングします。 クライアントは、XCCOS (eXtensible Chat Communication Over SIP) を使用します。 Lync Server フロントエンドサーバーは、トラフィックを常設チャットサーバープールにルーティングするように構成されます。

<div>

## <a name="high-level-architecture"></a>アーキテクチャの概要

次の図は、常設チャットサーバーのアーキテクチャとサービスの大まかな視点を示しています。

**常設チャット サーバーのアーキテクチャの概要**

![常設チャットサーバーのアーキテクチャ。](images/JJ683096.5db6f36f-4461-4d87-ba77-463b7ffe609b(OCS.15).jpg "常設チャットサーバーのアーキテクチャ。")

**常設チャット サーバーのサービスの概要**

![常設チャットサーバーのコンポーネント。](images/JJ683096.b6d743aa-3a86-4081-aaef-4fe3257db4e7(OCS.15).jpg "常設チャットサーバーのコンポーネント。")

常設チャットサーバーのフロントエンドサーバーでは、次の2つのサービスが実行されます。

  - 常設チャット (チャネル)

  - コンプライアンス

<div>

## <a name="persistent-chat-channel-service"></a>常設チャット (チャネル) サービス

常設チャット (チャネル) サービスは、常設チャットサーバーを担うコアサービスです。 このサービスには、次の機能が用意されています。

  - 受信メッセージを受け入れます。

  - 常設チャットルーム内のオンライン参加者を登録して一覧表示する

  - メッセージを他のチャネル サブスクライバーに再送信します。

  - チャネル管理、チャット ルームへの招待、検索、および新しいコンテンツ通知のロジックを実装します。

常設チャット (チャネル) サービスは、常設チャットストアを使用して、チャットルームのコンテンツや他のシステムメタデータ (承認ルールなど) を格納し、アクセスします。 このサービスは、常設チャットファイルストア内のチャットルームにアップロードされるファイルを格納します。

</div>

<div>

## <a name="compliance-service"></a>コンプライアンス サービス

コンプライアンスサービスは、常設チャットサーバーのオプションコンポーネントであり、チャットのコンテンツとイベントを常設チャットコンプライアンスストアにアーカイブする役割を担います。 常設チャットのアクティビティをアーカイブする必要がある規制が組織にある場合は、オプションの常設チャットコンプライアンスサービスを展開できます。 コンプライアンスサービスは、常設チャットプールの各常設チャットサーバーにインストールされます。 構成されている場合、常設チャットサーバーのコンプライアンスは、ルームへの参加や退室、メッセージの投稿と読み取りなどのユーザーアクティビティを記録します。 コンプライアンスサービスは、常設チャットコンプライアンスファイルストアにアーカイブする必要があるファイルを格納します。

</div>

<div>

## <a name="persistent-chat-web-services"></a>常設チャット Web サービス

Lync Server フロントエンドサーバーでは、インターネットインフォメーションサービス (IIS) に依存し、web コンポーネントとして実装されている2つのサービスが実行されます。

  - **ファイルのアップロード/ダウンロード用の常設チャット Web サービス**チャットルームからファイルを投稿および取得する責任があります。

  - **チャットルーム管理用の常設チャット Web サービス**ユーザーにチャットルームを管理する機能を提供し、新しいチャットルームを作成する責任を負います。

</div>

</div>

<div>

## <a name="how-do-i-start-using-persistent-chat-server"></a>常設チャットサーバーの使用を開始するにはどうすればよいですか?

常設チャットサーバーは、Lync Server 2013 インフラストラクチャ内のオプションのサーバーの役割です。 常設チャットサーバーの役割をインストールすると、管理者によってポリシーによって有効にされたすべてのユーザーは、Lync 2013 クライアントで常設チャットを使用できるようになります。

常設チャットサーバーを展開する方法、およびユーザーがポリシーによって機能を活用できるようにする方法の詳細については、「 [Lync server 2013 に常設チャットサーバーを展開](lync-server-2013-deploying-persistent-chat-server.md)する」を参照してください。

常設チャットサーバーの展開で設定を構成する方法の詳細については、「 [Lync server 2013 の常設チャットサーバーの展開](lync-server-2013-deploying-persistent-chat-server.md)」および「 [lync Server 2013、常設チャットサーバーの管理](managing-lync-server-2013-persistent-chat-server.md)」を参照してください。

Lync 2013 クライアントで常設チャットの機能を利用できるように、ポリシーによってユーザーを有効にする方法の詳細については、「 [Lync server 2013 に常設チャットサーバーを展開](lync-server-2013-deploying-persistent-chat-server.md)する」および「 [lync Server 2013、常設チャットサーバーを管理](managing-lync-server-2013-persistent-chat-server.md)する」を参照してください。

常設チャットのコンプライアンスを展開した場合は、コンプライアンスの設定を構成する方法の詳細について「 [Lync server 2013、常設チャットサーバーの管理](managing-lync-server-2013-persistent-chat-server.md)」を参照してください。

</div>

<div>

## <a name="persistent-chat-call-flows"></a>常設チャットの通話フロー

常設チャットクライアントは、XCCOS を使用して常設チャットサービスと通信します。 次の手順では、サインイン プロセス、および標準のルームのサブスクリプションとメッセージ投稿シナリオについて説明します。

<div>

## <a name="sign-in"></a>サインイン

次のコールフロー図と手順は、サインインプロセスについて説明しています。

**常設チャットクライアントサインインの呼び出しフロー**

![常設チャットサーバーの呼び出しフローの図。](images/JJ683096.9b3b3c61-caca-42b6-853c-6a09e6ff5c44(OCS.15).jpg "常設チャットサーバーの呼び出しフローの図。")

1.  常設チャットクライアントは、まず SIP サブスクライブを送信して、サーバーからインバンドプロビジョニングドキュメントを取得します。 このドキュメントは、ユーザーに対して常設チャットが有効または無効になっているかどうか、および常設チャットサーバープールの SIP Uri の一覧を示します。

2.  常設チャットクライアントは、前の手順で取得した常設チャットサーバーの SIP URI に SIP INVITE メッセージを送信します。 招待のシーケンスの後には、200 OK と ACK が続き、常設チャットクライアントは常設チャットサーバーエンドポイントを使用して SIP セッションを開いたことになりました。 その結果、常設チャットクライアントは、アクションを実行するようにサーバーに要求するチャットメッセージまたはコマンドのいずれかが含まれる SIP 情報メッセージを送信することによって、常設チャットサーバーと通信します。 これらのメッセージはすべて、200 OK または503サービスを利用できない (つまりサーバー負荷が重い場合)、応答されます。 クライアントが503応答を受信した場合は、メッセージを再試行します。 (この例では、503応答は含まれません)。サーバーがメッセージまたはコマンドを受け入れ、200 OK を送信した場合は、別の SIP INFO メッセージの形式でクライアントに応答を提供します。 この応答には、元のコマンドへの参照が含まれています。

3.  常設チャットクライアントは、XCCOS **getserverinfo**コマンドを含む SIP 情報メッセージを送信します。 常設チャットサーバーは、常設チャットサービスの構成に関する情報を含む新しい SIP 情報メッセージで応答します。

4.  常設チャットクライアントは、XCCOS **getassociations**コマンドを含む SIP 情報メッセージを送信します。 常設チャットサーバーは、ユーザーがメンバーになっている会議室のリストを含む新しい SIP INFO メッセージで応答します。 常設チャットクライアントは、ユーザーが上司となっている会議室の一覧を取得するコマンドを繰り返します。

5.  常設チャットクライアントは、「プレゼンス」ドキュメントからフォローされているルームのリストを取得します。ここでは、各後の部屋は、「roomSetting」カテゴリで表されます。 すべてのフォロー対象ルームは、ルーム Uri のリストを含む XCCOS **bjoin**コマンドを含む1つの SIP INFO メッセージによって参加します。 フォロー対象ルームの一覧はサーバー上に保持されるので、任意のコンピューター上のすべてのクライアントは、指定されたユーザー URI に対してフォローしているルームのリストと同じです。 また、常設チャットクライアントは、ローカルコンピューターのレジストリで開いているルームのリストを保持し (このオプションがユーザーによって有効になっている場合)、開いている各ルームの XCCOS **join**コマンドを含む SIP 情報メッセージを送信することによって、これらの各ルームをサインイン時に結合します。 このリストはレジストリに保持されるため、異なるコンピューター上で実行されている2台の常設チャットクライアントで異なる場合があります。

6.  参加している各会議室に対して、常設チャットクライアントは XCCOS **bccontext**コマンドを含む SIP 情報メッセージを送信します。 常設チャットサーバーは、ルーム内の最新のチャットメッセージを含む新しい SIP 情報メッセージで応答します。

7.  常設チャットクライアントは、XCCOS **getinv** (つまり、招待を取得) コマンドを含む SIP 情報メッセージを送信して、クライアントがまだ表示されていない新しい会議室の招待を要求します。 別の SIP 情報メッセージでは、常設チャットサーバーはこれらのルームの一覧を返します。

</div>

<div>

## <a name="subscribe-to-a-room-and-post-a-message"></a>ルームを購読し、メッセージを投稿する

次のコールフロー図と手順は、一般的な会議室のサブスクリプションとメッセージ投稿シナリオについて説明しています。

**常設チャットクライアントルームのサブスクリプションとメッセージ投稿の通話フロー**

![ルームのサブスクリプションとメッセージ投稿シナリオ。](images/JJ683096.2d3c417e-c91b-42bd-964e-285b72bb2e44(OCS.15).jpg "ルームのサブスクリプションとメッセージ投稿シナリオ。")

1.  常設チャットクライアントから、User1 が [**チャットルームに参加する**] をクリックし、[**検索**] をクリックして、いくつかの検索条件を入力します。 常設チャットクライアントは、XCCOS **chansrch** (ルーム検索) コマンドを含む SIP 情報メッセージを検索条件と共に送信します。 常設チャットサーバーは、バックエンドデータベースに対してクエリを行い、検索条件を満たす利用可能なルームの一覧が含まれる新しい SIP 情報メッセージで応答します。

2.  User1 が自身が参加するチャット ルームを選択し、[**このルームをフォロー**] をクリックします。 常設チャットクライアントは、常設チャットサーバーに、XCCOS **join**コマンドと、ユーザーが選択したチャットルームのルーム ID を含む SIP 情報メッセージを送信します。 常設チャットサーバーは、プロビジョニングデータを含む SIP 情報メッセージで応答します。

3.  常設チャットクライアントは、常設チャットサーバーに、XCCOS **bccontext** (backchat コンテキスト) コマンドを含む SIP 情報メッセージを送信します。 常設チャットサーバーはチャットの履歴を取得し、それを別の SIP 情報メッセージで常設チャットクライアントに返します。 この時点で、ユーザーはチャット ルームに入り、いつでも参加することができます。

4.  User1 が新しいメッセージを入力し、[**送信**] をクリックします。 常設チャットクライアントは、SIP INFO XCCOS **grpchat**コマンドでチャットルームにメッセージを投稿します。 常設チャットサーバーは、この新しいメッセージのコピーを常設チャットのバックエンドデータベースに格納します。

5.  常設チャットサーバーは、既にチャットルームに入っている SIP INFO XCCOS **grpchat**メッセージのコピーを User2 に送信します。

</div>

</div>

<div>

## <a name="persistent-chat-compliance-call-flows"></a>常設チャットコンプライアンスの通話フロー

常設チャットサーバーは、メッセージキュー (MSMQ とも呼ばれます) と、コンプライアンスデータを処理するための追加のコンプライアンスデータベース (メンバー) を使用します。 コンプライアンス イベントの処理方法の例として、次のイベントの手順では、メッセージ投稿イベントの処理方法について説明します。

1.  ユーザーがメッセージをルームに投稿します。

2.  常設チャットサーバーは、イベントに関する情報をプライベートメッセージキューのキューに格納します。

3.  常設チャットコンプライアンスサーバーは、キューからこのイベントを読み取って、後で処理するために、このイベントをこのデータベースに格納します。

4.  永続的なチャットコンプライアンスサーバーは、定期的にデータベース内の一連のイベントを処理し、そのイベントを常設チャットコンプライアンスアダプターに送信して処理します。

5.  アダプターがデータを正常に処理すると、常設チャットのコンプライアンスサーバーは、そのイベントを、このデータベースから削除します。

</div>

</div>

<span> </span>

</div>

</div>

</div>

