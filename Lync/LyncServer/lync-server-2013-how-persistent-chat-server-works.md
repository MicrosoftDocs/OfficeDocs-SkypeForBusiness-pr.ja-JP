---
title: Lync Server 2013 での常設チャット サーバーのしくみ
TOCTitle: Lync Server 2013 での常設チャット サーバーのしくみ
ms:assetid: 3d04e9a1-3f0c-458e-bcbe-d27c8c464276
ms:mtpsurl: https://technet.microsoft.com/ja-jp/library/JJ683096(v=OCS.15)
ms:contentKeyID: 49886922
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Lync Server 2013 での常設チャット サーバーのしくみ

 

_**トピックの最終更新日:** 2012-11-21_

Lync Server 2013、常設チャット サーバーでは、永続的な、マルチパーティのトピックベースの会話に参加できます。常設チャット サーバーは、組織で次のことを行う場合に役立ちます。

  - 地理的に分散されたチームや職能上の枠を越えたチーム間でのコミュニケーションを深めます。

  - 情報を広めて参加の輪を広げます。

  - 組織外の人間とのコミュニケーションを深めます。

  - 情報過多を緩和します。

  - 情報の認知を高めます。

  - 重要な知識と情報の分散を促進します。

Lync Server 2013 では常設チャット サーバーをオプションの役割として展開できます。常設チャット サービスは専用プールで実行され、常設チャット サーバー プールは、Lync Server プールを使用してここにメッセージをルーティングします。クライアントは、XCCOS (eXtensible Chat Communication Over SIP) を使用します。Lync Serverフロント エンド サーバーは、トラフィックを常設チャット サーバー プールにルーティングするように構成されています。

## アーキテクチャの概要

次の図は、常設チャット サーバー アーキテクチャおよびサービスの概要を示しています。

**常設チャット サーバーのアーキテクチャの概要**

![常設チャット サーバーのアーキテクチャ](images/JJ683096.5db6f36f-4461-4d87-ba77-463b7ffe609b(OCS.15).jpg "常設チャット サーバーのアーキテクチャ")

**常設チャット サーバーのサービスの概要**

![常設チャット サーバーのコンポーネント](images/JJ683096.b6d743aa-3a86-4081-aaef-4fe3257db4e7(OCS.15).jpg "常設チャット サーバーのコンポーネント")

2 つのサービスが 常設チャット サーバーフロント エンド サーバーで実行されています。

  - 常設チャット (チャネル)

  - コンプライアンス

## 常設チャット (チャネル) サービス

常設チャット (チャネル) サービスは、常設チャット サーバー用のコア サービスです。このサービスには、次の機能が用意されています。

  - 受信メッセージを受け入れます。

  - 常設チャット ルーム内のオンライン参加者を登録し、参加者の一覧を表示します。

  - メッセージを他のチャネル サブスクライバーに再送信します。

  - チャネル管理、チャット ルームへの招待、検索、および新しいコンテンツ通知のロジックを実装します。

常設チャット (チャネル) サービスは、常設チャット ストアを使用して、チャット ルームのコンテンツおよびその他のシステム メタデータ (承認規則など) を格納し、この情報にアクセスします。このサービスには、チャット ルームで常設チャット ファイル ストアにアップロードされたファイルが格納されます。

## コンプライアンス サービス

常設チャット サーバーのオプションのコンポーネントであるコンプライアンス サービスは、常設チャット コンプライアンス ストアに、チャット コンテンツとイベントをアーカイブします。常設チャット アクティビティをアーカイブするように組織の規制で要求されている場合、このオプションの常設チャット コンプライアンス サービスを展開できます。コンプライアンス サービスは、常設チャット プールの各常設チャット サーバーにインストールされます。また、ルームへの参加、ルームからの退出、メッセージの投稿、メッセージの読み取りなどのユーザー アクティビティを記録するように構成した場合は、これらのアクティビティが常設チャット サーバー コンプライアンスによって記録されます。アーカイブする必要があるファイルは、常設チャット コンプライアンス ファイル ストアに格納されます。

## 常設チャット Web サービス

Lync Serverフロント エンド サーバーでは、インターネット インフォメーション サービス (IIS) に依存する 2 つのサービスが実行され、Web コンポーネントとして実装されています。

  - **ファイルのアップロード/ダウンロード用常設チャット Web サービス** チャット ルームでファイルを投稿および取得します。

  - **チャット ルーム管理用常設チャット Web サービス** ユーザーがチャット ルームを管理したり、新しいチャット ルームを作成したりできるようにします。

## 常設チャット サーバーの使用を開始する方法

常設チャット サーバーは、Lync Server 2013 インフラストラクチャにおけるオプションのサーバーの役割です。常設チャット サーバーの役割をインストールしたら、ポリシーを介して管理者によって有効になっているすべてのユーザーが、Lync 2013 クライアントで常設チャットを使用できます。常設チャット サーバーを展開し、ポリシーによってユーザーが機能を利用できるようにする方法の詳細については、「[Lync Server 2013 での常設チャット サーバーの展開](lync-server-2013-deploying-persistent-chat-server.md)」を参照してください。

常設チャット サーバーの展開で設定を構成する方法の詳細については、「[Lync Server 2013 での常設チャット サーバーの展開](lync-server-2013-deploying-persistent-chat-server.md)」および「[Lync Server 2013、常設チャット サーバーの管理](managing-lync-server-2013-persistent-chat-server.md)」を参照してください。

ユーザーが Lync 2013 クライアントで常設チャット機能を利用できるように、ポリシーによってそのユーザーを有効にする方法の詳細については、「[Lync Server 2013 での常設チャット サーバーの展開](lync-server-2013-deploying-persistent-chat-server.md)」および「[Lync Server 2013、常設チャット サーバーの管理](managing-lync-server-2013-persistent-chat-server.md)」を参照してください。

常設チャット コンプライアンスを展開した場合、コンプライアンスの設定を構成する方法の詳細については、「[Lync Server 2013、常設チャット サーバーの管理](managing-lync-server-2013-persistent-chat-server.md)」を参照してください。

## 常設チャット通話の流れ

Lync クライアントは、XCCOS を使用して常設チャット サービスと通信します。次の手順では、サインイン プロセス、および標準のルームのサブスクリプションとメッセージ投稿シナリオについて説明します。

## サインインする

次の手順では、サインイン プロセスについて説明します。

1.  Lync クライアントは最初に SIP SUBSCRIBE を送信し、インバンド プロビジョニング ドキュメントをサーバーから取得します。このドキュメントは、常設チャットがユーザーに対して有効になっているか無効になっているか、および常設チャット サーバー プールの SIP URI の一覧を示します。

2.  Lync クライアントは SIP INVITE メッセージを、前の手順で取得した常設チャット サーバーの SIP URI に送信します。INVITE 手順には 200 OK と ACK が続き、Lync クライアントは、常設チャット サーバー エンドポイントで SIP セッションを開きました。その結果、クライアントは、サーバーにアクションを実行するように要求するコマンドまたはチャット メッセージが含まれる SIP INFO メッセージを送信することで、常設チャット サーバーと通信します。これらのすべてのメッセージに対して、"200 OK" または "503 サービスを利用できません" (つまり、サーバー の負荷が高い) のどちらかの確認応答が返されます。クライアントが 503 応答を受け取った場合、そのクライアントはメッセージを再試行します (この例には 503 応答は含まれません)。メッセージまたはコマンドを受け入れ、200 OK を送信したサーバーは、応答を別の SIP INFO メッセージの形式でクライアントに提供します。この応答には、発信コマンドへの参照が含まれます。

3.  Lync クライアントは、XCCOS **getserverinfo** コマンドが含まれる SIP INFO メッセージを送信します。常設チャット サーバーは、常設チャット サービス構成に関する情報が含まれる新しい SIP INFO メッセージで応答します。

4.  Lync クライアントは、XCCOS **getassociations** コマンドが含まれる SIP INFO メッセージを送信します。常設チャット サーバーは、ユーザーがメンバーになっているルームの一覧が含まれる新しい SIP INFO メッセージで応答します。Lync クライアントは、コマンドを繰り返して、ユーザーがマネージャーになっているルームの一覧を取得します。

5.  Lync クライアントは、フォローされたルームの一覧を "プレゼンス" ドキュメントから取得します。このドキュメントでは、フォローされた各ルームが "roomSetting" カテゴリによって表されています。フォローされたすべてのルームに 1 つの SIP INFO メッセージで参加します。このメッセージには、ルーム URI の一覧を含む XCCOS **bjoin** コマンドが含まれます。フォローされたルームの一覧はサーバー上に保持されるので、指定したユーザー URI のフォローされたルームの一覧は、どのコンピューターのどのクライアントでも同じになります。Lync クライアントは、開いているルームの一覧もローカル コンピューターのレジストリに保持しており (このオプションがユーザーによって有効になっている場合)、開いているルームごとに XCCOS **join** コマンドが含まれる SIP INFO メッセージを送信することで、サインイン時にこれらのルームそれぞれに参加します。この一覧はレジストリに保持されるので、異なるコンピューターで実行される 2 つの Lync クライアントでは異なる場合があります。

6.  参加したルームごとに、Lync クライアントは、XCCOS **bccontext** コマンドが含まれる SIP INFO メッセージを送信します。常設チャット サーバーは、ルームの最新のチャット メッセージが含まれる新しい SIP INFO メッセージで応答します。

7.  Lync クライアントは、XCCOS **getinv** (つまり、招待の取得) コマンドが含まれる SIP INFO メッセージを送信し、クライアントがまだ確認していない新しいルーム招待を要求します。別の SIP INFO メッセージでは、常設チャット サーバーがこれらのルームの一覧を返します。

## ルームを購読し、メッセージを投稿する

次の手順では、標準のルームのサブスクリプションとメッセージ投稿シナリオについて説明します。

1.  Lync クライアントで、User1 が \[**チャット ルームに参加**\] をクリックし、\[**検索**\] をクリックして、検索条件を入力します。クライアントは、XCCOS **chansrch** (ルームの検索) コマンドが含まれる SIP INFO メッセージと、検索条件を送信します。常設チャット サーバーは、バックエンド データベースに対してクエリを実行し、検索条件を満たす使用可能なルームの一覧が含まれる新しい SIP INFO で応答します。

2.  User1 が自身が参加するチャット ルームを選択し、\[**このルームをフォロー**\] をクリックします。クライアントは、常設チャット サーバーに、XCCOS **join** コマンド、およびユーザーが選択したチャット ルームのルーム ID が含まれる SIP INFO メッセージを送信します。常設チャット サーバーは、プロビジョニング データが含まれる SIP INFO メッセージで応答します。

3.  Lync クライアントは、常設チャット サーバーに、XCCOS **bccontext** (バックチャット コンテキスト) コマンドが含まれる SIP INFO メッセージを送信します。常設チャット サーバーは、チャット履歴を取得し、別の SIP INFO メッセージでクライアントに返します。この時点で、ユーザーはチャット ルームに入り、いつでも参加することができます。

4.  User1 が新しいメッセージを入力し、\[**送信**\] をクリックします。Lync クライアントは、SIP INFO XCCOS **grpchat** コマンドでメッセージをチャット ルームに投稿します。常設チャット サーバーは、この新しいメッセージのコピーを常設チャット バックエンド データベースに格納します。

5.  常設チャット サーバーは、SIP INFO XCCOS **grpchat** メッセージの別のコピーを、既にチャット ルームに入っている User2 に送信します。

## 常設チャット コンプライアンス通話の流れ

常設チャット サーバーは、メッセージ キュー (MSMQ とも呼ばれる) および追加コンプライアンス データベース (mgccomp) を使用して、コンプライアンス データを処理します。コンプライアンス イベントの処理方法の例として、次のイベントの手順では、メッセージ投稿イベントの処理方法について説明します。

1.  ユーザーがメッセージをルームに投稿します。

2.  常設チャット サーバーは、プライベート メッセージ キューのイベントに関連する情報を配置します。

3.  常設チャット コンプライアンス サーバーは、このイベントをキューから読み取り、後で処理できるように mgccomp データベースに配置します。

4.  常設チャット コンプライアンス サーバーは、定期的にデータベースで一連のイベントを処理し、さらに処理するために常設チャット コンプライアンス アダプターに送信します。

5.  アダプターによってデータが適切に処理されたら、イベントは常設チャット コンプライアンス サーバーによって mgccomp データベースから削除されます。

