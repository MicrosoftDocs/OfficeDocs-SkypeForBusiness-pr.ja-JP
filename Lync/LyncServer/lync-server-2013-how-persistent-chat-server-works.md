---
title: 'Lync Server 2013: 常設チャットサーバーのしくみ'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: How Persistent Chat Server works
ms:assetid: 3d04e9a1-3f0c-458e-bcbe-d27c8c464276
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ683096(v=OCS.15)
ms:contentKeyID: 49684643
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 692f9a40bc2c0fd885fc251a4a792d480a69c57d
ms.sourcegitcommit: b693d5923d6240cbb865241a5750963423a4b33e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/04/2020
ms.locfileid: "41722397"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/en-us/">

<div data-asp="http://msdn2.microsoft.com/asp">

# <a name="how-persistent-chat-server-works-in-lync-server-2013"></a>Lync Server 2013 での常設チャットサーバーの動作方法

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**最終更新日:** 2012-11-21_

Lync Server 2013 の常設チャットサーバーでは、時間の経過に伴う、トピックベースの会話に参加することができます。 常設チャットサーバーは、組織が次のことを行うのに役立ちます。

  - 地理的に分散したチームと部門間のチーム間のコミュニケーションを向上させる

  - 情報の認識と参加を広げる

  - 拡張組織とのコミュニケーションを向上させる

  - 情報過多の削減

  - 情報認識の向上

  - 重要な知識と情報の分散を増やす

Lync Server 2013 を使用すると、オプションの役割として常設チャットサーバーを展開できます。 常設チャットサービスは専用のプールで実行され、常設チャットサーバープールは、Lync サーバープールによってメッセージがルーティングされます。 クライアントは、SIP (XCCOS) 経由の拡張チャット通信を使用します。 Lync Server フロントエンドサーバーは、トラフィックを常設チャットサーバープールにルーティングするように構成されています。

<div>

## <a name="high-level-architecture"></a>高レベルのアーキテクチャ

次の図は、常設チャットサーバーのアーキテクチャとサービスの大まかな視点を示しています。

**常設チャット サーバーのアーキテクチャの概要**

![常設チャット サーバーのアーキテクチャ](images/JJ683096.5db6f36f-4461-4d87-ba77-463b7ffe609b(OCS.15).jpg "常設チャット サーバーのアーキテクチャ")

**常設チャット サーバーのサービスの概要**

![常設チャット サーバーのコンポーネント](images/JJ683096.b6d743aa-3a86-4081-aaef-4fe3257db4e7(OCS.15).jpg "常設チャット サーバーのコンポーネント")

常設チャットサーバーフロントエンドサーバーでは、次の2つのサービスが実行されます。

  - 常設チャット (チャネル)

  - コン

<div>

## <a name="persistent-chat-channel-service"></a>常設チャット (チャネル) サービス

常設チャット (チャネル) サービスは、常設チャットサーバーを担当するコアサービスです。 このサービスは次の機能を提供します。

  - 受信メッセージを受け入れます。

  - 常設チャット ルーム内のオンライン参加者を登録し、参加者の一覧を表示します。

  - メッセージを他のチャネル サブスクライバーに再送信します。

  - チャネル管理、チャットルームの招待状、検索、新しいコンテンツ通知のロジックを実装します。

常設チャット (チャネル) サービスは、常設チャットストアを使用して、チャットルームのコンテンツやその他のシステムメタデータ (承認ルールなど) を保存およびアクセスします。 このサービスは、常設チャットファイルストアのチャットルームにアップロードされたファイルを保存します。

</div>

<div>

## <a name="compliance-service"></a>コンプライアンスサービス

コンプライアンスサービスは、常設チャットサーバーのオプションコンポーネントであり、チャットのコンテンツとイベントを常設チャットのコンプライアンスストアにアーカイブする責任を負います。 常設チャットのアクティビティのアーカイブを求める規制が組織に存在する場合、オプションの常設チャット コンプライアンス サービスを展開できます。 コンプライアンスサービスは、常設チャットプールの常設チャットサーバーごとにインストールされます。 構成されている場合、常設チャットサーバーのコンプライアンスは、会議室への参加や退室、メッセージの投稿と読み取りなどのユーザーアクティビティを記録します。 コンプライアンスサービスは、常設チャットのコンプライアンスファイルストアにアーカイブする必要があるファイルを保存します。

</div>

<div>

## <a name="persistent-chat-web-services"></a>常設チャット Web サービス

Lync Server のフロントエンドサーバーでは、2つのサービスがインターネットインフォメーションサービス (IIS) に依存し、web コンポーネントとして実装されています。

  - **ファイルアップロード/ダウンロード用の常設チャット Web サービス**チャットルームからファイルを投稿および取得する責任を負います。

  - **チャットルーム管理用の常設チャット Web サービス**ユーザーがチャットルームを管理し、新しいチャットルームを作成できるようにする責任を負います。

</div>

</div>

<div>

## <a name="how-do-i-start-using-persistent-chat-server"></a>常設チャットサーバーの使用を開始するにはどうすればよいですか?

常設チャットサーバーは、Lync Server 2013 インフラストラクチャ内のオプションのサーバーロールです。 常設チャットサーバーの役割をインストールした場合、管理者によって有効になったすべてのユーザーは、常設チャットを Lync 2013 クライアントと共に使用できます。

常設チャットサーバーを展開して、ユーザーがポリシーによって機能を活用できるようにする方法について詳しくは、「 [Lync server 2013 での常設チャットサーバーの展開](lync-server-2013-deploying-persistent-chat-server.md)」をご覧ください。

常設チャットサーバーの展開時に設定を構成する方法の詳細については、「 [Lync server 2013 での常設チャットサーバーの展開](lync-server-2013-deploying-persistent-chat-server.md)」および「 [lync Server 2013、常設チャットサーバーの管理](managing-lync-server-2013-persistent-chat-server.md)」を参照してください。

ユーザーが Lync 2013 クライアントの常設チャット機能を利用できるようにする方法について詳しくは、「 [Lync server 2013 での常設チャットサーバーの展開](lync-server-2013-deploying-persistent-chat-server.md)と「 [lync Server 2013、常設チャットサーバーの管理](managing-lync-server-2013-persistent-chat-server.md)」をご覧ください。

常設チャットのコンプライアンスを展開した場合は、コンプライアンスの設定を構成する方法の詳細について「 [Lync server 2013、常設チャットサーバーを管理](managing-lync-server-2013-persistent-chat-server.md)する」を参照してください。

</div>

<div>

## <a name="persistent-chat-call-flows"></a>常設チャットの通話フロー

常設チャットクライアントは、XCCOS を使用して常設チャットサービスと通信します。 次のシーケンスでは、サインインプロセスと、一般的な会議室のサブスクリプションとメッセージの投稿のシナリオについて説明します。

<div>

## <a name="sign-in"></a>サインイン

次のコールフロー図と手順では、サインインプロセスについて説明します。

**常設チャットクライアントのサインインコールフロー**

![常設チャット サーバーの通話フロー図](images/JJ683096.9b3b3c61-caca-42b6-853c-6a09e6ff5c44(OCS.15).jpg "常設チャット サーバーの通話フロー図")

1.  常設チャットクライアントは、最初に SIP サブスクライブを送信して、サーバーから帯域内プロビジョニングドキュメントを取得します。 このドキュメントは、常設チャットが有効または無効になっているかどうかを示します。また、常設チャットサーバープールの SIP Uri の一覧が表示されます。

2.  常設チャットクライアントから、前の手順で取得した常設チャットサーバーの SIP URI に SIP INVITE メッセージが送信されます。 招待状の後には、200 OK と ACK が続いて、常設チャットクライアントでは、常設チャットサーバーのエンドポイントを使用して SIP セッションが開かれました。 そのため、常設チャットクライアントは、チャットメッセージまたはアクションを実行するように要求するコマンドのいずれかを含む SIP 情報メッセージを送信することによって、常設チャットサーバーと通信します。 これらのメッセージはすべて、200 OK または503サービスを利用できません (つまり、サーバーの負荷が重い場合)。 クライアントが503応答を受信した場合は、メッセージを再試行します。 (この例では、503応答は含まれていません)。サーバーがメッセージまたはコマンドを受け入れ、200を送信した場合は、別の SIP 情報メッセージの形式でクライアントへの応答を提供します。 この応答には、元のコマンドへの参照が含まれます。

3.  常設チャットクライアントから、XCCOS **getserverinfo**コマンドを含む SIP 情報メッセージが送信されます。 常設チャットサーバーは、常設チャットサービスの構成に関する情報を含む新しい SIP 情報メッセージで返信します。

4.  常設チャットクライアントから、XCCOS **getassociations**コマンドを含む SIP 情報メッセージが送信されます。 常設チャットサーバーは、ユーザーがメンバーである会議室の一覧を含む新しい SIP 情報メッセージで返信します。 常設チャットクライアントは、ユーザーがマネージャーである会議室の一覧を取得するためにコマンドを繰り返します。

5.  常設チャットクライアントは、"プレゼンス" ドキュメントからフォローしているルームの一覧を取得します。ここでは、それぞれの部屋は "roomSetting" カテゴリで表されます。 すべてのフォローされたルームは、room uri のリストを含む XCCOS **bskype**コマンドを含む SIP 情報メッセージの1つによって結合されます。 フォローされているルームの一覧はサーバー上に保持されるため、任意のコンピューターのすべてのクライアントには、指定したユーザー URI のフォローしているルームの一覧が含まれます。 常設チャットクライアントでは、ローカルコンピューターのレジストリで、開いているルームの一覧も (ユーザーによって有効になっている場合)、サインイン時に、開いている各ルームの XCCOS **join**コマンドを含む SIP 情報メッセージが送信されます。 この一覧はレジストリに保存されているため、別のコンピューターで実行されている2つの常設チャットクライアントで異なる場合があります。

6.  常設チャットクライアントは、参加した各部屋の XCCOS **bccontext**コマンドを含む SIP 情報メッセージを送信します。 常設チャットサーバーは、会議室の最新のチャットメッセージを含む新しい SIP 情報メッセージに返信します。

7.  常設チャットクライアントは、XCCOS **getinv** (つまり、招待を取得) コマンドを含む SIP 情報メッセージを送信し、クライアントがまだ表示されていない新しい会議室の招待を要求します。 別の SIP 情報メッセージでは、常設チャットサーバーはこれらのルームの一覧を返します。

</div>

<div>

## <a name="subscribe-to-a-room-and-post-a-message"></a>会議室を購読し、メッセージを投稿する

次のコールフロー図と手順では、一般的な会議室のサブスクリプションとメッセージの投稿のシナリオについて説明します。

**常設チャットクライアントルームのサブスクリプションとメッセージ投稿のコールフロー**

![ルームのサブスクリプションとメッセージ投稿シナリオ](images/JJ683096.2d3c417e-c91b-42bd-964e-285b72bb2e44(OCS.15).jpg "ルームのサブスクリプションとメッセージ投稿シナリオ")

1.  常設チャットクライアントでは、User1 が「**チャットルームに参加**」、「**検索**」をクリックして、検索条件を入力します。 常設チャットクライアントは、検索条件と共に、XCCOS **chansrch** (ルーム検索) コマンドを含む SIP 情報メッセージを送信します。 常設チャットサーバーは、バックエンドデータベースを照会し、検索条件を満たす利用可能な会議室の一覧を含む新しい SIP 情報メッセージで返信します。

2.  User1 は、参加したいチャットルームを選択し、「**このルームをフォロー**」をクリックします。 常設チャットクライアントは、常設チャットサーバーに、XCCOS **join**コマンドと、ユーザーが選択したチャットルームのルーム ID を含む SIP 情報メッセージを送信します。 常設チャットサーバーは、プロビジョニングデータを含む SIP 情報メッセージと共に応答します。

3.  常設チャットクライアントは、XCCOS **bccontext** (backchat コンテキスト) コマンドを含む SIP 情報メッセージを常設チャットサーバーに送信します。 常設チャットサーバーは、チャット履歴を取得して、別の SIP 情報メッセージで常設チャットクライアントに返します。 この時点で、ユーザはチャットルームに入り、参加する準備ができました。

4.  User1 が新しいメッセージを入力し、[**送信**] をクリックします。 常設チャットクライアントは、SIP INFO XCCOS **grpchat**コマンドのチャットルームにメッセージを投稿します。 常設チャットサーバーは、この新しいメッセージのコピーを永続的なチャットバックエンドデータベースに保存します。

5.  常設チャットサーバーは、既にチャットルームに入っている SIP INFO XCCOS **grpchat**メッセージのコピーを User2 に送信します。

</div>

</div>

<div>

## <a name="persistent-chat-compliance-call-flows"></a>常設チャットのコンプライアンスのコールフロー

常設チャットサーバーでは、メッセージキュー (MSMQ とも呼ばれます) と追加のコンプライアンスデータベース (管理用組織) を使用して、コンプライアンスデータを処理します。 コンプライアンスイベントが処理される方法の例として、次の一連のイベントは、メッセージ投稿イベントが処理される方法を示しています。

1.  ユーザーがメッセージを会議室に投稿します。

2.  常設チャットサーバーは、プライベートメッセージキューのキューにイベントに関連する情報を配置します。

3.  常設チャットのコンプライアンスサーバーは、キューからこのイベントを読み取り、後で処理するために、このイベントを使用しているデータベースに配置します。

4.  定期的に、常設チャットのコンプライアンスサーバーはデータベース内の一連のイベントを処理し、それを処理のために常設チャットコンプライアンスアダプターに送信します。

5.  アダプターがデータを正常に処理した場合は、常設チャットのコンプライアンスサーバーによって、イベントが、このデータベースから削除されます。

</div>

</div>

<span> </span>

</div>

</div>

</div>

