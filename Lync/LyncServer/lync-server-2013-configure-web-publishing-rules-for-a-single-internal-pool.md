---
title: 'Lync Server 2013: 単一内部プールの Web 公開ルールの構成'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
TOCTitle: Configure web publishing rules for a single internal pool
ms:assetid: 86ff4b2a-1ba9-46a2-a175-8b19e00a49dd
ms:mtpsurl: https://technet.microsoft.com/en-us/library/Gg429712(v=OCS.15)
ms:contentKeyID: 48184725
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 6ffe61072df14e28c20c45eb72302905986c6357
ms.sourcegitcommit: bb53f131fabb03a66f0d000f8ba668fbad190778
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/11/2019
ms.locfileid: "34840335"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/en-us/">

<div data-asp="http://msdn2.microsoft.com/asp">

# <a name="configure-web-publishing-rules-for-a-single-internal-pool-in-lync-server-2013"></a>Lync Server 2013 での単一内部プールの Web 公開ルールの構成

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**最終更新日:** 2014-07-07_

Microsoft Forefront Threat Management Gateway 2010 and Internet Information Server アプリケーション要求ルーティング (IIS ARR) では、web 発行ルールを使用して、会議 URL などの内部リソースをインターネット上のユーザーに公開します。

仮想ディレクトリの Web サービスの Url に加えて、単純な Url、LyncDiscover URL、Office Web Apps サーバーの公開ルールも作成する必要があります。 各単純 URL について、その単純な URL を参照する個別のルールを逆プロキシに作成する必要があります。

モビリティを展開し、自動検出を使用している場合は、外部自動検出サービス URL 用の公開ルールを作成する必要があります。 自動検出では、ディレクタープールとフロントエンドプールの外部 Lync Server Web サービス URL に対する公開ルールも必要となります。 自動検出用の web 公開ルールの作成について詳しくは、「 [Lync Server 2013 でのモビリティのリバースプロキシの構成](lync-server-2013-configuring-the-reverse-proxy-for-mobility.md)」をご覧ください。

Web 公開ルールを作成するには、次の手順を使用します。

<div>


> [!NOTE]  
> 次の手順では、標準エディションの Forefront Threat Management Gateway (TMG) 2010 をインストールしているか、アプリケーション要求ルーティング (IIS ARR) 拡張機能を使用してインターネットインフォメーションサーバーをインストールして構成していることを前提としています。 TMG または IIS のいずれかの ARR を使用します。



</div>

<div>

## <a name="to-create-a-web-server-publishing-rule-on-the-computer-running-tmg-2010"></a>TMG 2010 を実行しているコンピューターで web サーバーの公開ルールを作成するには

1.  [**スタート**] をクリックし、[**プログラム**]、[ **Microsoft Forefront TMG**]、[ **forefront tmg 管理**] の順にクリックします。

2.  左側のウィンドウで、[ **ServerName**] を展開して、[**ファイアウォールポリシー**] を右クリックし、[**新規作成**]、[ **Web サイト発行ルール**] の順にクリックします。

3.  [**新しい Web 公開ルールへようこそ**] ページで、公開ルールの表示名 (たとえば、LyncServerWebDownloadsRule) を入力します。

4.  **[ルールアクションの選択**] ページで、[**許可**] を選びます。

5.  [**発行の種類**] ページで、[**単一の Web サイトまたはロードバランサーを発行する**] を選択します。

6.  [**サーバー接続セキュリティ**] ページで、[ **SSL を使用して公開された Web サーバーまたはサーバーファームに接続する**] を選びます。

7.  [**内部発行の詳細**] ページで、会議コンテンツとアドレス帳のコンテンツをホストする内部 web ファームの完全修飾ドメイン名 (FQDN) を [**内部サイト名**] ボックスに入力します。
    
    <div>
    

    > [!NOTE]  
    > 内部サーバーが Standard Edition サーバーの場合、この FQDN は Standard Edition server FQDN です。 内部サーバーがフロントエンドプールの場合、この FQDN は、内部の web ファームサーバーのバランスを読み込むハードウェアロードバランサー仮想 IP (VIP) です。 TMG サーバーは、FQDN を内部 web サーバーの IP アドレスに解決できる必要があります。 TMG サーバーが FQDN を適切な IP アドレスに解決できない場合は、[<STRONG>コンピューター名または ip アドレスを使用して公開されたサーバーに接続する</STRONG>] を選択し、[<STRONG>コンピューター名または</STRONG> <STRONG>ip アドレス</STRONG>] ボックスに、内部の w の IP アドレスを入力します。eb サーバー。 この操作を行う場合は、TMG サーバーでポート53が開かれていて、境界ネットワークに存在する DNS サーバーに到達できることを確認する必要があります。 また、ローカルの hosts ファイルのエントリを使って、名前の解決を提供することもできます。

    
    </div>

8.  [**内部発行の詳細**] ページの [ **Path (オプション)** ] ボックスに** / ** 、公開するフォルダーのパスを入力します。
    
    <div>
    

    > [!NOTE]  
    > Web サイト発行ウィザードでは、1つのパスのみを指定できます。 追加のパスを追加するには、ルールのプロパティを変更します。

    
    </div>

9.  [**パブリック名の詳細**] ページで、[**許可する要求**] で**このドメイン名**が選択されていることを確認し、[**パブリック名**] ボックスに外部 Web サービス FQDN を入力します。

10. [ **Web リスナーの選択**] ページで [**新規**] をクリックして、新しい Web リスナー定義ウィザードを開きます。

11. [**新しい Web リスナーウィザードへようこそ**] ページで、[web**リスナー名**] ボックスに web リスナーの名前を入力します (たとえば、LyncServerWebServers)。

12. [**クライアント接続セキュリティ**] ページで、[**クライアントとの SSL セキュリティで保護された接続を要求する**] を選択します。

13. [ **Web リスナー IP アドレス**] ページで、[**外部**] を選択し、[ **IP アドレスの選択**] をクリックします。

14. [**外部リスナー IP 選択**] ページで、**選択したネットワークの Forefront TMG コンピューターで、[指定した ip アドレス**] を選択し、適切な ip アドレスを選択して、[**追加**] をクリックします。

15. [**リスナー SSL 証明書**] ページで、[**各 IP アドレスに対して証明書を割り当てる**] を選択し、外部 web FQDN に関連付けられている IP アドレスを選択して、[**証明書の選択**] をクリックします。

16. [**証明書の選択**] ページで、手順9で指定したパブリック名と一致する証明書を選択し、[**選択**] をクリックします。

17. [**認証の設定**] ページで、[**認証なし**] を選択します。

18. [**シングルサインオンの設定**] ページで、[**次へ**] をクリックします。

19. [ **Web リスナーウィザードの完了**] ページで、 **web リスナー**の設定が正しいことを確認し、[**完了**] をクリックします。

20. [**認証の委任**] ページで、[委任しない] を選択します。クライアントは、直接認証を行う**ことができ**ます。

21. [**ユーザー設定**] ページで、[**次へ**] をクリックします。

22. [**新しい Web 公開ルールウィザードの完了**] ページで、web 公開ルールの設定が正しいことを確認し、[**完了**] をクリックします。

23. [詳細] ウィンドウの [**適用**] をクリックして、変更を保存し、構成を更新します。

</div>

<div>

## <a name="to-create-a-web-server-publishing-rule-on-the-computer-running-iis-arr"></a>IIS ARR を実行しているコンピューターで web サーバーの公開ルールを作成するには

1.  リバースプロキシに使用する証明書を HTTPS プロトコルにバインドします。 [**スタート**] をクリックし、[**プログラム**]、[**管理ツール**]、[**インターネットインフォメーションサービス (IIS) マネージャー**] の順にクリックします。
    
    <div>
    

    > [!NOTE]  
    > IIS の展開と構成に関する追加のヘルプ、スクリーンショット、およびガイダンスについては、「NextHop の記事」で、「 <A href="http://go.microsoft.com/fwlink/?linkid=293391">Lync Server 2013 のリバースプロキシとして Iis を使用する</A>」を参照してください。

    
    </div>

2.  リバースプロキシに使用する証明書をまだインポートしていない場合は、インポートします。 **インターネットインフォメーションサービス (IIS) マネージャー**で、本体の左側のサイズにある逆プロキシサーバー名をクリックします。 [ **IIS** ] のコンソールの中央にある [**サーバー証明書**] を探します。 [**サーバー証明書**] を右クリックし、[**機能を開く**] を選択します。

3.  コンソールの右側で、[**インポート.**..] をクリックします。 拡張子を持つ証明書のパスとファイル名を入力するか、[.. **.** ] をクリックします。 を選び、証明書を参照します。 証明書を選択し、[**開く**] をクリックします。 秘密キーを保護するために使用するパスワードを指定します (証明書と秘密キーをエクスポートするときにパスワードを割り当てた場合)。 **[OK]** をクリックします。 証明書のインポートが成功した場合、証明書は、**サーバー証明書**のエントリとしてコンソールの中央にエントリとして表示されます。

4.  HTTPS で使用する証明書を割り当てます。 コンソールの左側で、IIS サーバーの**既定の Web サイト**を選びます。 右側の [**バインド**] をクリックします。 [**サイトバインド**] ダイアログボックスの [**追加**] をクリックします。 [**サイトバインドの追加**] ダイアログボックスの [**種類**] で、[ **https**] を選びます。 [Https] を選択すると、https に使用する証明書を選ぶことができます。 [ **SSL 証明書:**] で、リバースプロキシ用にインポートした証明書を選びます。 **[OK]** をクリックします。 次に、[**閉じる**] をクリックします。 これで、証明書が secure socket layer (SSL) とトランスポート層セキュリティ (TLS) のリバースプロキシにバインドされます。
    
    <div>
    

    > [!IMPORTANT]  
    > 中間証明書がないバインドダイアログを閉じるときに警告が表示される場合は、公開 CA ルート機関証明書と中間 CA 証明書を見つけてインポートする必要があります。 証明書を要求したパブリック CA の指示に従い、指示に従って証明書チェーンを要求してインポートします。 エッジサーバーから証明書をエクスポートした場合は、ルート CA 証明書と、エッジサーバーに関連付けられた中間 CA 証明書をエクスポートすることができます。 [信頼されたルート証明機関] ストアと中間証明書をコンピューターの中間証明機関ストアにインポートします (ユーザーストアと混同しないでください)。

    
    </div>

5.  IIS サーバー名の下にあるコンソールの左側で、[**サーバーファーム**] を右クリックし、[**サーバーファームの作成**] をクリックします。
    
    <div>
    

    > [!NOTE]  
    > [<STRONG>サーバーファーム</STRONG>] ノードが表示されない場合は、アプリケーション要求ルーティングをインストールする必要があります。 詳細については、「 <A href="lync-server-2013-setting-up-reverse-proxy-servers.md">Lync Server 2013 でリバースプロキシサーバー</A>をセットアップする」を参照してください。

    
    </div>
    
    **サーバーファーム名**の [**サーバーファームの作成**] ダイアログボックスに、最初の URL の名前 (識別のためのフレンドリ名) を入力します。 [ **次へ**] をクリックします。

6.  サーバー**アドレス**の [**サーバーの追加**] ダイアログボックスに、フロントエンドサーバー上の外部 web サービスの完全修飾ドメイン名 (FQDN) を入力します。 ここで使用される名前は、「リバースプロキシ、[証明書の概要-Lync Server 2013 のリバースプロキシ](lync-server-2013-certificate-summary-reverse-proxy.md)」の計画セクションで使用されているものと同じです。 リバースプロキシ計画を参照して、FQDN `webext.contoso.com`を入力します。 [**オンライン**] の横にあるチェックボックスがオンになっていることを確認します。 [**追加**] をクリックして、この構成の web サーバーのプールにサーバーを追加します。
    
    <div>
    

    > [!WARNING]  
    > Lync Server は、ハードウェアロードバランサーを使って、HTTP トラフィックと HTTPS トラフィック用のディレクターとフロントエンドサーバーをプールします。 IIS ARR Server ファームにサーバーを追加するときは、FQDN を1つだけ指定します。 FQDN は、プールされていないサーバー構成のフロントエンドサーバーまたはディレクター、またはサーバープール用に構成されたハードウェアロードバランサーの FQDN のいずれかになります。 HTTP トラフィックと HTTPS トラフィックの負荷を分散するためにサポートされるメソッドは、ハードウェアロードバランサーを使うことだけです。

    
    </div>

7.  [**サーバーの追加**] ダイアログボックスで、[**詳細設定**] をクリックします。 これにより、構成済みの FQDN への要求に対するアプリケーション要求ルーティングを定義するためのダイアログが開きます。 目的は、要求が IIS の ARR によって処理されるときに使用されるポートを再定義することです。
    
    既定では、送信先の HTTP ポートは8080として定義されている必要があります。 現在の**Httpport 80**の横にあるをクリックして、値を**8080**に設定します。 現在の**Httpsport 443**の横にあるをクリックして、値を**4443**に設定します。 **Weight**パラメーターは、100のままにします。 必要に応じて、基準計画の統計情報を取得した後で、特定のルールの重みを再定義することができます。 [**完了**] をクリックして、ルールの構成のこの部分を完了します。

8.  IIS マネージャーが、すべての受信要求をサーバーファームに自動的にルーティングするために、URL 書き換えルールを作成できることを通知するダイアログリライトルールが表示される場合があります。 [**はい]** をクリックします。 ルールは手動で調整しますが、[はい] を選択すると、初期構成が設定されます。

9.  作成したサーバーファームの名前をクリックします。 [IIS マネージャーの機能] ビューの [**サーバーファーム**] で、[**キャッシュ**] をダブルクリックします。 「**ディスクキャッシュを有効にする」をオフに**します。 右側の [**適用**] をクリックします。

10. サーバーファームの名前をクリックします。 [IIS マネージャーの機能] ビューの [**サーバーファーム**] で、[**プロキシ**] をダブルクリックします。 [プロキシ設定] ページで、[**タイムアウト (秒)** ] の値を展開に適した値に変更します。 [**適用**] をクリックして変更内容を保存します。
    
    <div>
    

    > [!IMPORTANT]  
    > プロキシのタイムアウト値は、展開から展開までのさまざまな数値です。 クライアントに最適なエクスペリエンスを実現するには、展開を監視して、値を変更する必要があります。 この値は、200に設定することができます。 環境で Lync モバイルクライアントをサポートしている場合は、タイムアウト値が900である Office 365 からのプッシュ通知のタイムアウトを許可するように、値を960に設定する必要があります。 クライアントの切断を回避するためにタイムアウト値を大きくする必要があります。また、クライアントの接続が切断された後、プロキシ経由の接続が切断されている場合は、この値が小さくなることがあります。 監視とベースによる並び合わせ環境に適した方法は、この値の適切な設定がどこにあるかを判断するための唯一の正確な手段です。

    
    </div>

11. サーバーファームの名前をクリックします。 [IIS マネージャーの機能] ビューの [**サーバーファーム**] で、[**ルーティングルール**] をダブルクリックします。 [ルーティングルール] ダイアログボックスの [ルーティング] で、[SSL オフロードを有効にする] の横にあるチェックボックスをオフにします。 このチェックボックスをオフにする機能を使用できない場合は、[ **URL の書き換えを使用して着信要求を検査する**] チェックボックスをオンにします。 [**適用**] をクリックして変更内容を保存します。
    
    <div>
    

    > [!WARNING]  
    > リバースプロキシによる SSL オフロードはサポートされていません。

    
    </div>

12. リバースプロキシを通過する必要がある各 URL について、手順5-11 を繰り返します。 共通の一覧は、次のようになります。
    
      - フロントエンドサーバー Web サービス外部: webext.contoso.com (最初のウォークスルーで既に構成されています)
    
      - 監督に外部のディレクター Web サービス: webdirext.contoso.com (ディレクターが展開されている場合は省略可能)
    
      - 簡単な URL 会議: meet.contoso.com
    
      - シンプルな URL のダイヤルイン: dialin.contoso.com
    
      - Lync の自動検出 URL: lyncdiscover.contoso.com
    
      - Office Web Apps サーバーの URL: officewebapps01.contoso.com
        
        <div>
        

        > [!IMPORTANT]  
        > Office Web Apps サーバーの URL には、別の httpsPort アドレスが使用されます。 手順7では、 <STRONG>Httpsport</STRONG>を<STRONG>443</STRONG>として、 <STRONG>httpsport</STRONG>をポート<STRONG>80</STRONG>として定義します。 その他のすべての構成設定は同じです。

        
        </div>

13. コンソールの左側で、[IIS サーバー名] をクリックします。 コンソールの中央で、[ **IIS**] の [ **URL の書き換え**] を見つけます。 [URL の上書き] をダブルクリックして、URL 書き換えルールの構成を開きます。 前の手順で作成した各サーバーファームのルールが表示されます。 この操作を行わない場合は、Internet Information Server Manager コンソールの [**スタートページ]** ノードのすぐ下にある**IIS サーバー**名をクリックしたことを確認します。

14. 例として webext.contoso.com を使用して、[ **URL リライト**] ダイアログでは、表示されるルールの完全な名前が**ARR\_\_webext.contoso.com loadbalance\_SSL**です。
    
      - ルールをダブルクリックして、[**受信ルールの編集**] ダイアログボックスを開きます。
    
      - [**追加] をクリックします。** [**条件**] ダイアログ。
    
      - [**条件入力**の条件を**追加**します: **{\_HTTP HOST}**"と入力します。 (入力すると、条件を選択できるダイアログが表示されます。 [**入力文字列のチェック**] で **、[パターンと一致**] を選択します。 **パターン入力**の種類**\***。 **ケースを無視**するように選択します。 **[OK]** をクリックします。
    
      - [**受信ルールの編集**] ダイアログボックスを下にスクロールして、[**操作**] ダイアログを探します。 **アクションの種類:** **サーバーファームにルーティング**するように設定する必要があります。**スキーム:** **https://** に設定されている [**サーバーファーム]:** このルールが適用される URL に設定します。 この例では、 **webext.contoso.com**に設定する必要があります。 **Path:** is **/{R: 0}** に設定されています。
    
      - [**適用**] をクリックして変更内容を保存します。 [**ルールに戻る**] をクリックして、URL 書き換えルールに戻ります。

15. 定義した各 SSL 書き換えルールについて、手順14で定義されている手順を、サーバーファーム URL ごとに1回繰り返します。
    
    <div>
    

    > [!WARNING]  
    > 既定では、HTTP ルールも作成され、SSL ルールの名前が似た形式で示されます。 現在の例では、HTTP ルールは<STRONG>ARR_webext _loadbalance</STRONG>という名前になっています。 これらのルールに変更は必要ありません。また、無視しても問題ありません。

    
    </div>

</div>

<div>

## <a name="to-modify-the-properties-of-the-web-publishing-rule-in-tmg-2010"></a>TMG 2010 で web 公開ルールのプロパティを変更するには

1.  [**スタート**] をクリックし、[**プログラム**]、[ **Microsoft Forefront TMG**]、[ **forefront tmg 管理**] の順にクリックします。

2.  左側のウィンドウで、[ **ServerName**] を展開し、[**ファイアウォールポリシー**] をクリックします。

3.  [詳細] ウィンドウで、前の手順で作成した web サーバー発行ルール (LyncServerExternalRule など) を右クリックし、[**プロパティ**] をクリックします。

4.  [**プロパティ**] ページの [**差出人**] タブで、次の操作を行います。
    
      - このルールは、[**これらのソースからのトラフィックに適用さ**れます] リストで、**任意の場所**をクリックし、[**削除**] をクリックします。
    
      - [**追加**] をクリックします。
    
      - [**ネットワークエンティティの追加**] で [**ネットワーク**] を展開し、[**外部**] をクリックし、[**追加**]、[**閉じる**] の順にクリックします。

5.  [**宛先**] タブで、[**実際のホストヘッダーではなく、元のホストヘッダーを転送**する] チェックボックスがオンになっていることを確認します。

6.  [**ブリッジ**] タブで、[ **SSL ポートに要求をリダイレクトする**] チェックボックスをオンにして、[port **4443**] を指定します。

7.  [**パブリック名**] タブで、単純な url (たとえば、meet.contoso.com と dialin.contoso.com) を追加します。

8.  [**適用**] をクリックして変更を保存し、[ **OK]** をクリックします。

9.  [詳細] ウィンドウの [**適用**] をクリックして、変更を保存し、構成を更新します。

</div>

<div>

## <a name="to-modify-the-properties-of-the-web-publishing-rule-in-iis-arr"></a>IIS の [web 公開ルール] のプロパティを変更するには

1.  [**スタート**] をクリックし、[**プログラム**]、[**管理ツール**]、[**インターネットインフォメーションサービス (IIS) マネージャー**] の順にクリックします。

2.  コンソールの左側で、[IIS サーバー名] をクリックします。

3.  コンソールの中央で、[ **IIS**] の [ **URL の書き換え**] を見つけます。 [URL の上書き] をダブルクリックして、URL 書き換えルールの構成を開きます。

4.  変更する必要があるルールをダブルクリックします。 必要に応じて、[URL、**条件**、**サーバー変数**、または**アクション**に**一致**] に変更を加えます。

5.  [**適用**] をクリックして変更をコミットします。 [**ルールに戻る**] をクリックして他のルールを変更するか、変更を完了したら、 **IIS マネージャー**コンソールを閉じます。

</div>

</div>

<span> </span>

</div>

</div>

</div>

