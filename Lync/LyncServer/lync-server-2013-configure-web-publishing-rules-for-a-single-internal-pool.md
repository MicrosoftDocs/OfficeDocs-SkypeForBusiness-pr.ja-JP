---
title: 'Lync Server 2013: 単一内部プールの Web 公開ルールの構成'
TOCTitle: 単一内部プールの Web 公開ルールの構成
ms:assetid: 86ff4b2a-1ba9-46a2-a175-8b19e00a49dd
ms:mtpsurl: https://technet.microsoft.com/ja-jp/library/Gg429712(v=OCS.15)
ms:contentKeyID: 48272732
ms.date: 12/10/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Lync Server 2013 での単一内部プールの Web 公開ルールの構成

 

_**トピックの最終更新日:** 2016-12-08_

Microsoft Forefront Threat Management Gateway 2010 および Internet Information Server のアプリケーション要求ルーティング処理 (IIS ARR) では Web 公開ルールを使用して、ミーティング URL などの内部リソースをインターネット上のユーザーに公開します。

仮想ディレクトリの Web サービス URL のほかに、簡易 URL、LyncDiscover URL、Office Web Apps サーバーの公開ルールも作成する必要があります。簡易 URL ごとに、その簡易 URL をポイントするリバース プロキシ上に個々のルールを作成する必要があります。

モビリティを展開し、自動検出を使用する場合、自動検出サービスの外部 URL に対して公開ルールを作成する必要があります。自動検出では、 ディレクター プールおよび フロント エンド プールの外部 Lync Server Web サービス URL に対する公開ルールも必要です。自動検出の Web 公開ルールを作成する方法の詳細については、「[Lync Server 2013 での、モビリティに合わせたリバース プロキシの構成](lync-server-2013-configuring-the-reverse-proxy-for-mobility.md)」を参照してください。

Web 公開ルールを作成するには、以下の手順を使用してください。

> [!NOTE]
> これらの手順では、Forefront Threat Management Gateway (TMG) 2010 の Standard Edition がインストール済みであること、または Internet Information Server とアプリケーション要求ルーティング処理 (IIS ARR) 拡張がインストールおよび構成済みであることが前提です。TMG または IIS ARR のどちらかを使用します。


## TMG 2010 を実行するコンピューターで Web サーバー公開ルールを作成するには

1.  \[**スタート**\] ボタンをクリックし、\[**すべてのプログラム**\] を選択します。次に、\[**Microsoft Forefront TMG**\] を選択し、\[**Forefront TMG Management**\] をクリックします。

2.  左側のウィンドウで、\[**サーバー名**\] を展開し、\[**ファイアウォール ポリシー**\] を右クリックします。次に、\[**新規作成**\] を選択し、\[**Web サイト公開ルール**\] をクリックします。

3.  \[**新しい Web 公開ルール ウィザードへようこそ**\] ページで、公開ルールの表示名 (LyncServerWebDownloadsRule など) を入力します。

4.  \[**ルール動作の選択**\] ページで \[**許可**\] を選択します。

5.  \[**公開の種類**\] ページで、\[**1 つの Web サイトまたはロード バランサーを公開する**\] をクリックします。

6.  \[**サーバー接続セキュリティ**\] ページで、\[**公開された Web サーバーまたはサーバー ファームへの接続に SSL を使用する**\] をクリックします。

7.  \[**内部公開の詳細**\] ページの \[**内部サイト名**\] ボックスに、会議コンテンツとアドレス帳コンテンツをホストする内部 Web ファームの完全修飾ドメイン名 (FQDN) を入力します。
    
    > [!NOTE]
    > 内部サーバーが Standard Edition サーバーの場合、この FQDN は Standard Edition サーバーの FQDN です。内部サーバーがフロントエンド プールの場合、この FQDN は内部 Web ファーム サーバーを負荷分散するハードウェア ロード バランサーの仮想 IP (VIP) です。TMG サーバーでは、FQDN を内部 Web サーバーの IP アドレスに解決できる必要があります。TMG サーバーで FQDN を適切な IP アドレスに解決できない場合は、[<strong>コンピューター名または IP アドレスを使用して、公開されたサーバーに接続する</strong>] チェック ボックスをオンにし、[<strong>コンピューター名またはIP アドレス</strong>] ボックスに内部 Web サーバーの IP アドレスを入力できます。その場合は、ポート 53 が TMG サーバー上で開いていること、および境界ネットワーク内にある DNS サーバーに接続できることを確認する必要があります。また、ローカル ホスト ファイル内のエントリを使用して、名前解決を行うこともできます。


8.  \[**内部公開の詳細**\] ページの \[**パス (省略可)**\] ボックスに、公開するフォルダーのパスとして「**/\*** 」と入力します。
    
    > [!NOTE]
    > Web サイトの公開ウィザードで指定できるパスは 1 つだけです。ルールのプロパティを変更すると、パスを追加できます。


9.  \[**パブリック名の詳細**\] ページの \[**要求の許可**\] で、\[**次に入力したドメイン名**\] が選択されていることを確認して、外部 Web サービス FQDN を \[**公開名**\] ボックスに入力します。

10. \[**Web リスナーの選択**\] ページで \[**新規作成**\] をクリックして、新しい Web リスナーの定義ウィザードを開きます。

11. \[**新しい Web リスナー ウィザードの開始**\] ページの \[**Web リスナー名**\] ボックスに Web リスナーの名前 (たとえば、LyncServerWebServers) を入力します。

12. \[**クライアント接続セキュリティ**\] ページで、\[**クライアントとの SSL セキュリティ保護接続を必要とする**\] を選択します。

13. \[**Web リスナーの IP アドレス**\] ページで、\[**外部**\] をクリックし、\[**IP アドレスの選択**\] をクリックします。

14. \[**外部リスナーの IP の選択**\] ページで、\[**選択したネットワークの Forefront TMG コンピューターの指定した IP アドレス**\] を選択して適切な IP アドレスを選び、\[**追加**\] をクリックします。

15. \[**リスナーの SSL 証明書**\] ページで、\[**IP アドレスごとに証明書を割り当てる**\] をクリックします。次に、外部 Web FQDN に関連付けられた IP アドレスを選択し、\[**証明書の選択**\] をクリックします。

16. \[**証明書の選択**\] ページで、ステップ 9 で指定したパブリック名に対応する証明書を選択し、\[**選択**\] をクリックします。

17. \[**認証の設定**\] ページで \[**認証なし**\] を選択します。

18. \[**シングル サインオンの設定**\] ページで、\[**次へ**\] をクリックします。

19. \[**新しい Web リスナー ウィザードの完了**\] ページで、\[**Web リスナー**\] の設定が正しいことを確認し、\[**完了**\] をクリックします。

20. \[**認証の委任**\] ページで \[**委任できません。クライアントは直接認証できます**\] を選択します。

21. \[**ユーザー セット**\] ページで、\[**次へ**\] をクリックします。

22. \[**新しい Web 公開ルール ウィザードの完了**\] ページで、Web 公開ルールの設定が正しいことを確認し、\[**完了**\] をクリックします。

23. 詳細ウィンドウで \[**適用**\] をクリックして変更を保存し、構成を更新します。

## IIS ARR を実行するコンピューターで Web サーバー公開ルールを作成するには

1.  リバース プロキシに使用する証明書を HTTPS プロトコルにバインドします。\[**スタート**\] ボタンをクリックし、\[**すべてのプログラム**\] を選びます。次に、\[**管理ツール**\] を選び、\[**インターネット インフォメーション サービス (IIS) マネージャー**\] をクリックします。
    
    > [!NOTE]
    > その他のヘルプ、スクリーン ショット、IIS ARR の展開と構成のガイダンスについては、NextHop の記事「<a href="http://go.microsoft.com/fwlink/?linkid=293391">Using IIS ARR as a Reverse Proxy for Lync Server 2013</a>」を参照してください。


2.  リバース プロキシに使用する証明書をインポートします (まだインポートしていない場合)。**インターネット インフォメーション サービス (IIS) マネージャー**のコンソールの左側でリバース プロキシ サーバー名をクリックします。コンソールの中央の \[**IIS**\] の下で、\[**サーバー証明書**\] を見つけます。\[**サーバー証明書**\] を右クリックし、\[**機能を開く**\] を選びます。

3.  コンソールの右側で、\[**インポート...**\] をクリックします。証明書のパスとファイル名を拡張子付きで入力します。または、\[**...**\] をクリックして、証明書を参照します。証明書を選び、\[**開く**\] をクリックします。秘密キーを保護するために使用するパスワードを指定します (証明書と秘密キーをエクスポートするときにパスワードを割り当てた場合)。\[**OK**\] をクリックします。証明書のインポートが成功すると、コンソールの中央にある \[**サーバー証明書**\] のエントリとしてその証明書が表示されます。

4.  HTTPS で使用する証明書を割り当てます。コンソールの左側で、IIS サーバーの \[**Default Web Site**\] を選びます。右側にある \[**バインド...**\] をクリックします。\[**サイト バインド**\] ダイアログで、\[**追加...**\] をクリックします。\[**サイト バインドの追加**\] ダイアログの \[**種類:**\] で、\[**https**\] を選びます。\[https\] を選ぶと、https に使用する証明書を選べるようになります。\[**SSL 証明書:**\] で、リバース プロキシ用にインポートした証明書を選びます。\[**OK**\] をクリックします。次に、\[**閉じる**\] をクリックします。これで、証明書が Secure Socket Layer (SSL) およびトランスポート層セキュリティ (TLS) のリバース プロキシにバインドされました。
    

    > [!IMPORTANT]
    > [サイト バインド] ダイアログを閉じるときに中間証明書が見つからないという警告が表示される場合は、公的 CA ルート証明機関の証明書およびすべての中間 CA 証明書を見つけてインポートする必要があります。手順については、証明書を要求した公的 CA にお問い合わせください。手順に従って証明書チェーンを要求し、インポートします。エッジ サーバーから証明書をエクスポートした場合は、エッジ サーバーに関連付けられているルート CA 証明書およびすべての中間 CA 証明書をエクスポートできます。ルート CA 証明書をコンピューター (ユーザー ストアと混同しないでください) の信頼されたルート証明機関ストアにインポートし、中間証明書をコンピューターの中間証明機関ストアにインポートします。



5.  コンソールの左側で、IIS サーバー名の下にある \[**サーバー ファーム**\] を右クリックし、\[**サーバー ファームの作成...**\] をクリックします。
    
    > [!NOTE]
    > [<strong>サーバー ファーム</strong>] ノードが表示されない場合は、アプリケーション要求ルーティング処理をインストールする必要があります。詳細については、「<a href="lync-server-2013-setting-up-reverse-proxy-servers.md">Lync Server 2013 のリバース プロキシ サーバーの設定</a>」を参照してください。
    
    \[**サーバー ファームの作成**\] ダイアログの \[**サーバー ファーム名**\] に、最初の URL の名前 (わかりやすく特定しやすい名前) を入力します。\[**次へ**\] をクリックします。

6.  \[**サーバーの追加**\] ダイアログの \[**サーバー アドレス**\] に、フロント エンド サーバー上の外部 Web サービスの完全修飾ドメイン名 (FQDN) を入力します。ここで例示する名前は、リバース プロキシの計画に関するセクション ( [証明書の概要 - Lync Server 2013 リバース プロキシ](lync-server-2013-certificate-summary-reverse-proxy.md)) で使用する名前と同じです。リバース プロキシの計画の際に入力する FQDN は `webext.contoso.com` です。\[**オンライン**\] の横にあるチェック ボックスをオンにします。\[**追加**\] をクリックして、この構成用の Web サーバーのプールにサーバーを追加します。
    

    > [!WARNING]
    > Lync Server では、ロード バランサー機器を使用して、HTTP と HTTPS のトラフィック用の ディレクターおよび フロント エンド サーバーをプールします。IIS ARR サーバー ファームにサーバーを追加するときは FQDN を 1 つだけ指定します。この FQDN は、非プールのサーバー構成における フロント エンド サーバーまたは ディレクター、またはサーバー プール用に構成済みのロード バランサー機器の FQDN です。HTTP および HTTPS のトラフィックの負荷分散の方法としてサポートされているのは、ロード バランサー機器を使用する方法のみです。



7.  \[**サーバーの追加**\] ダイアログで、\[**詳細設定...**\] をクリックします。構成済みの FQDN に対する要求のアプリケーション要求ルーティング処理を定義するためのダイアログが表示されます。ここでは、IIS ARR が要求を処理するときに使用するポートを再定義します。
    
    既定では、送信先の HTTP ポートを 8080 として定義する必要があります。\[次へ\] をクリックし、現在の **httpPort 80** の値を **8080** に設定します。\[次へ\] をクリックし、現在の **httpsPort 443** の値を **4443** に設定します。**weight** パラメーターは 100 のままにします。基準の統計情報があれば、必要に応じて特定のルールの重みを再定義できます。\[**終了**\] をクリックして、この部分のルール構成を完了します。

8.  すべての着信要求を自動的にサーバー ファームにルーティングするための URL 書き換え規則を IIS マネージャーで作成できることを示す \[Rewrite Rules\] ダイアログが表示される場合があります。\[**Yes**\] をクリックします。規則を手動で調整します。ただし、\[Yes\] を選ぶと初期構成が設定されます。

9.  作成したサーバー ファームの名前をクリックします。IIS マネージャーの機能ビューの \[**Server Farm**\] で、\[**Caching**\] をダブルクリックします。\[**Enable disk cache**\] の選択を解除します。右側にある \[**Apply**\] をクリックします。

10. サーバー ファームの名前をクリックします。IIS マネージャーの機能ビューの \[**Server Farm**\] で、\[**Routing Rules**\] をダブルクリックします。\[Routing Rules\] ダイアログの \[Routing\] で、\[Enable SSL offloading\] の横にあるチェック ボックスをオフにします。このチェック ボックスをオフにできない場合は、\[**Use URL Rewrite to inspect incoming requests**\] チェック ボックスをオンにします。\[**Apply**\] をクリックして、変更内容を保存します。
    

    > [!IMPORTANT]
    > プロキシのタイムアウト値は、展開ごとに異なります。展開を監視して、クライアントで最適になるように値を変更する必要があります。値は、最低で 200 に設定できます。環境で Lync モバイル クライアントをサポートしている場合、タイムアウト値が 900 である Office 365 からのプッシュ通知のタイムアウトを許可するには、値を 960 に設定する必要があります。タイムアウト値が小さすぎる場合は、値を大きくして、クライアントが切断されないようにする必要があります。また、プロキシ経由の接続が切断されず、クライアントの切断後しばらくしてからクリアされる場合は、値を小さくします。この値に適した設定を正確に判断する唯一の手段は、使用する環境で正常な状態を監視し、基準を指定することです。



11. サーバー ファームの名前をクリックします。IIS マネージャーの機能ビューの \[**Server Farm**\] で、\[**Routing Rules**\] をダブルクリックします。\[Routing Rules\] ダイアログの \[Routing\] で、\[Enable SSL offloading\] の横にあるチェック ボックスをオフにします。このチェック ボックスをオフにできない場合は、\[**Use URL Rewrite to inspect incoming requests**\] チェック ボックスをオンにします。\[**Apply**\] をクリックして、変更内容を保存します。
    

    > [!TIP]
    > リバース プロキシによる SSL オフロードはサポートされていません。



12. リバース プロキシを通過する必要のある各 URL について手順 5 ～ 11 を繰り返します。一般的な URL を次に示します。
    
      - 外部 フロント エンド サーバー Web サービス: webext.contoso.com (初期設定で構成済み)
    
      - ディレクター用の外部 ディレクター Web サービス: webdirext.contoso.com ( ディレクターが展開される場合は省略可能)
    
      - 簡易 URL での会議: meet.contoso.com
    
      - 簡易 URL でのダイヤルイン: dialin.contoso.com
    
      - Lync Autodiscover の URL: lyncdiscover.contoso.com
    
      - Office Web Apps サーバーの URL: officewebapps01.contoso.com
        

        > [!IMPORTANT]
        > Office Web Apps サーバーの URL では別の httpsPort アドレスを使用します。手順 7 で、<STRONG>httpsPort</STRONG> を <STRONG>443</STRONG>、<STRONG>httpPort</STRONG> をポート <STRONG>80</STRONG> として定義します。他の構成設定はすべて同じです。



13. コンソールの左側で、IIS サーバー名をクリックします。コンソールの中央の \[**IIS**\] で、\[**URL 書き換え**\] を見つけます。\[URL 書き換え\] をダブルクリックして、URL 書き換え規則の構成を開きます。前の手順で作成した各サーバー ファームの規則が表示されます。規則が表示されない場合は、Internet Information Server マネージャー コンソールの \[**スタート ページ**\] ノードのすぐ下にある **IIS サーバー**名をクリックしたかどうかをご確認ください。

14. \[**URL 書き換え**\] ダイアログでは、webext.contoso.com を例として使用しており、**ARR\_webext.contoso.com\_loadbalance\_SSL** が規則の完全な名前として表示されています。
    
      - 規則をダブルクリックして \[**Edit Inbound Rule**\] ダイアログを開きます。
    
      - \[**Conditions**\] ダイアログの \[**Add...**\] をクリックします。
    
      - \[**Add Condition**\] の \[**Condition input:**\] に、「**{HTTP\_HOST}** 」と入力します (入力が完了すると、条件を選ぶためのダイアログが表示されます)。\[**Check if input string:**\] で、\[**Matches the Pattern**\] を選びます。\[**Pattern input**\] に「**\*** 」と入力します。\[**Ignore case**\] を選んでください。\[**OK**\] をクリックします。
    
      - \[**Edit Inbound Rule**\] ダイアログの下までスクロールして、\[**Action**\] ダイアログを見つけます。\[**Action Type:**\] を \[**Route to Server Farm**\]、\[**Scheme:**\] を \[<strong>https://</strong>\]、\[<strong>Server farm:</strong>\] を、この規則を適用する URL に設定します。この例では、**webext.contoso.com** に設定する必要があります。\[**Path:**\] は \[**/{R:0}**\] に設定します。
    
      - \[**Apply**\] をクリックして、変更内容を保存します。\[**Back to Rules**\] をクリックして URL 書き換え規則に戻ります。

15. サーバー ファームの URL ごとに 1 つ定義した各 SSL 書き換え規則について、手順 14 を繰り返します。
    

    > [!WARNING]
    > 既定では、HTTP 規則も作成されます。HTTP 規則は、SSL 規則と同様の名前で表されます。ここで使用する例の場合、HTTP 規則の名前は <STRONG>ARR_webext.contoso.com_loadbalance</STRONG> になります。これらの規則に対する変更は無視されるため、変更は必要ありません。



## TMG 2010 で Web 公開ルールのプロパティを変更するには

1.  \[**スタート**\] ボタンをクリックし、\[**すべてのプログラム**\] をポイントします。次に、\[**Microsoft Forefront TMG**\] を選択し、\[**Forefront TMG Management**\] をクリックします。

2.  左側のウィンドウで、 **サーバー名**を展開し、\[**ファイアウォール ポリシー**\] をクリックします。

3.  詳細ウィンドウで、前の手順で作成した Web サーバー公開ルール (LyncServerExternalRule など) を右クリックし、\[**プロパティ**\] をクリックします。

4.  \[**プロパティ**\] ページで \[**送信元**\] タブをクリックして、以下を実行します。
    
      - \[**このルールを次の送信元からのトラフィックに適用する**\] ボックスの一覧の \[**任意の場所**\] をクリックし、\[**削除**\] をクリックします。
    
      - \[**追加**\] をクリックします。
    
      - \[**ネットワーク エンティティの追加**\] で、\[**ネットワーク**\] を展開し、\[**外部**\]、\[**追加**\]、\[**閉じる**\] の順にクリックします。

5.  \[**宛先**\] タブで、\[**フィールドで指定した実際のホストヘッダーの代わりに元のホスト ヘッダーを、転送する**\] チェック ボックスがオンになっていることを確認します。

6.  \[**ブリッジ**\] タブで、\[**要求を SSL ポートにリダイレクトする**\] チェック ボックスがオンになっていることを確認して、ポート \[**4443**\] を指定します。

7.  \[**パブリック名**\] タブで、簡易 URL (meet.contoso.com や dialin.contoso.com など) を追加します。

8.  \[**適用**\] をクリックして変更を保存し、\[**OK**\] をクリックします。

9.  詳細ウィンドウで \[**適用**\] をクリックして変更を保存し、構成を更新します。

## IIS ARR で Web 公開ルールのプロパティを変更するには

1.  \[**スタート**\] ボタンをクリックし、\[**すべてのプログラム**\] を選びます。次に、\[**管理ツール**\] を選び、\[**インターネット インフォメーション サービス (IIS) マネージャー**\] をクリックします。

2.  コンソールの左側で、IIS サーバー名をクリックします。

3.  コンソールの中央の \[**IIS**\] の下で、\[**URL 書き換え**\] を見つけます。\[URL 書き換え\] をダブルクリックして、URL 書き換え規則の構成を開きます。

4.  変更が必要な規則をダブルクリックします。必要に応じて、\[**Match URL**\]、\[**Conditions**\]、\[**Server Variables**\]、または \[**Action**\] を変更します。

5.  \[**Apply**\] をクリックして、変更を確定します。\[**Back to Rules**\] をクリックして他の規則を変更するか、変更が完了したら **IIS マネージャー** コンソールを閉じます。

