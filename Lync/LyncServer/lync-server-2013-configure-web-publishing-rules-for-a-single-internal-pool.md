---
title: 'Lync Server 2013: 単一の内部プールの web 公開ルールの構成'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Configure web publishing rules for a single internal pool
ms:assetid: 86ff4b2a-1ba9-46a2-a175-8b19e00a49dd
ms:mtpsurl: https://technet.microsoft.com/en-us/library/Gg429712(v=OCS.15)
ms:contentKeyID: 48184725
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: d159fd8fa4ade4cb2dee44da7fd7bbd2376b2a80
ms.sourcegitcommit: 4d6bf5c58b2c553dc1df8375ede4a9cb9eaadff2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/16/2020
ms.locfileid: "48520104"
---
# <a name="configure-web-publishing-rules-for-a-single-internal-pool-in-lync-server-2013"></a>Lync Server 2013 での単一の内部プールの web 公開ルールの構成

<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="https://msdn.microsoft.com/">

<div data-asp="https://msdn2.microsoft.com/asp">



</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**トピックの最終更新日:** 2014-07-07_

Microsoft Forefront Threat Management Gateway 2010 および Internet Information Server アプリケーション要求ルーティング (IIS ARR) は、web 公開ルールを使用して、会議 URL などの内部リソースをインターネット上のユーザーに公開します。

仮想ディレクトリの Web サービス Url に加えて、簡易 Url、LyncDiscover URL、および Office Web Apps サーバーの公開ルールも作成する必要があります。 簡易 URL ごとに、その簡易 URL をポイントするリバース プロキシ上に個々のルールを作成する必要があります。

モビリティを展開し、自動検出を使用する場合、自動検出サービスの外部 URL に対して公開ルールを作成する必要があります。 自動検出では、ディレクタープールおよびフロントエンドプールの外部 Lync Server Web サービス URL に対する公開ルールも必要になります。 自動検出のための web 公開ルールの作成の詳細については、「 [Lync Server 2013 でのモビリティのリバースプロキシの構成](lync-server-2013-configuring-the-reverse-proxy-for-mobility.md)」を参照してください。

Web 公開ルールを作成するには、以下の手順を使用してください。

<div>


> [!NOTE]  
> これらの手順では、Forefront Threat Management Gateway (TMG) 2010 の Standard Edition がインストールされているか、またはアプリケーション要求ルーティング (IIS ARR) 拡張機能を使用してインターネットインフォメーションサービスがインストールおよび構成されていることを前提としています。 TMG または IIS のどちらかを使用します。



</div>

<div>

## <a name="to-create-a-web-server-publishing-rule-on-the-computer-running-tmg-2010"></a>TMG 2010 を実行するコンピューターで Web サーバー公開ルールを作成するには

1.  [**スタート**] ボタンをクリックし、[**すべてのプログラム**] を選択します。次に、[**Microsoft Forefront TMG**] を選択し、[**Forefront TMG Management**] をクリックします。

2.  左側のウィンドウで、[**サーバー名**] を展開し、[**ファイアウォール ポリシー**] を右クリックします。次に、[**新規作成**] を選択し、[**Web サイト公開ルール**] をクリックします。

3.  [**新しい Web 公開ルール ウィザードへようこそ**] ページで、公開ルールの表示名 (LyncServerWebDownloadsRule など) を入力します。

4.  [**ルール動作の選択**] ページで [**許可**] を選択します。

5.  [**公開の種類**] ページで、[**1 つの Web サイトまたはロード バランサーを公開する**] をクリックします。

6.  [**サーバー接続セキュリティ**] ページで、[**公開された Web サーバーまたはサーバー ファームへの接続に SSL を使用する**] をクリックします。

7.  [**内部公開の詳細**] ページの [**内部サイト名**] ボックスに、会議コンテンツとアドレス帳コンテンツをホストする内部 Web ファームの完全修飾ドメイン名 (FQDN) を入力します。
    
    <div>
    

    > [!NOTE]  
    > 内部サーバーが Standard Edition サーバーの場合、この FQDN は Standard Edition サーバーの FQDN です。 内部サーバーがフロントエンド プールの場合、この FQDN は内部 Web ファーム サーバーを負荷分散するハードウェア ロード バランサーの仮想 IP (VIP) です。 TMG サーバーでは、FQDN を内部 Web サーバーの IP アドレスに解決できる必要があります。 TMG サーバーが FQDN を適切な IP アドレスに解決できない場合は、[ <STRONG>コンピューター名または ip アドレスを使用して公開されたサーバーに接続</STRONG>する] を選択し、[ <STRONG>コンピューター名また</STRONG>は ip <STRONG>アドレス</STRONG> ] ボックスに内部 web サーバーの ip アドレスを入力します。 その場合は、ポート 53 が TMG サーバー上で開いていること、および境界ネットワーク内にある DNS サーバーに接続できることを確認する必要があります。 また、ローカル ホスト ファイル内のエントリを使用して、名前解決を行うこともできます。

    
    </div>

8.  [ **内部公開の詳細** ] ページの [ **パス (省略可)** ] ボックスに、 **/\*** 公開するフォルダーのパスを入力します。
    
    <div>
    

    > [!NOTE]  
    > Web サイトの公開ウィザードで指定できるパスは 1 つだけです。ルールのプロパティを変更すると、パスを追加できます。

    
    </div>

9.  [**パブリック名の詳細**] ページの [**要求の許可**] で、[**次に入力したドメイン名**] が選択されていることを確認して、外部 Web サービス FQDN を [**公開名**] ボックスに入力します。

10. [**Web リスナーの選択**] ページで [**新規作成**] をクリックして、新しい Web リスナーの定義ウィザードを開きます。

11. [**新しい Web リスナー ウィザードの開始**] ページの [**Web リスナー名**] ボックスに Web リスナーの名前 (たとえば、LyncServerWebServers) を入力します。

12. [**クライアント接続セキュリティ**] ページで、[**クライアントとの SSL セキュリティ保護接続を必要とする**] を選択します。

13. [**Web リスナーの IP アドレス**] ページで、[**外部**] をクリックし、[**IP アドレスの選択**] をクリックします。

14. [**外部リスナーの IP の選択**] ページで、[**選択したネットワークの Forefront TMG コンピューターの指定した IP アドレス**] を選択して適切な IP アドレスを選び、[**追加**] をクリックします。

15. [**リスナーの SSL 証明書**] ページで、[**IP アドレスごとに証明書を割り当てる**] をクリックします。次に、外部 Web FQDN に関連付けられた IP アドレスを選択し、[**証明書の選択**] をクリックします。

16. [**証明書の選択**] ページで、ステップ 9 で指定したパブリック名に対応する証明書を選択し、[**選択**] をクリックします。

17. [**認証の設定**] ページで [**認証なし**] を選択します。

18. [**シングル サインオンの設定**] ページで、[**次へ**] をクリックします。

19. [**新しい Web リスナー ウィザードの完了**] ページで、[**Web リスナー**] の設定が正しいことを確認し、[**完了**] をクリックします。

20. [**認証の委任**] ページで [**委任できません。クライアントは直接認証できます**] を選択します。

21. [**ユーザー セット**] ページで、[**次へ**] をクリックします。

22. [**新しい Web 公開ルール ウィザードの完了**] ページで、Web 公開ルールの設定が正しいことを確認し、[**完了**] をクリックします。

23. 詳細ウィンドウで [**適用**] をクリックして変更を保存し、構成を更新します。

</div>

<div>

## <a name="to-create-a-web-server-publishing-rule-on-the-computer-running-iis-arr"></a>IIS ARR を実行しているコンピューターで web サーバー公開ルールを作成するには

1.  リバースプロキシに使用する証明書を HTTPS プロトコルにバインドします。 [ **スタート**] をクリックし、[ **プログラム**]、[ **管理ツール**]、[ **インターネットインフォメーションサービス (IIS) マネージャー**] の順にクリックします。
    
    <div>
    

    > [!NOTE]  
    > IIS の展開と構成に関するその他のヘルプ、スクリーンショット、およびガイダンスについては、「NextHop」の記事の「 <A href="https://go.microsoft.com/fwlink/?linkid=293391">Lync Server 2013 のリバースプロキシとしての IIS arr</A>」を参照してください。

    
    </div>

2.  リバースプロキシに対して使用する証明書をまだ作成していない場合は、インポートします。 **インターネットインフォメーションサービス (IIS) マネージャー**で、コンソールの左側のサイズのリバースプロキシサーバー名をクリックします。 コンソールの [ **IIS** ] の下で、[ **サーバー証明書**] を探します。 [ **サーバー証明書** ] を右クリックし、[ **機能を開く**] を選択します。

3.  コンソールの右側で、[ **インポート**] をクリックします。 拡張子を持つ証明書のパスとファイル名を入力するか、[ **...** ] をクリックします。 を選択して証明書を参照します。 証明書を選択し、[ **開く**] をクリックします。 秘密キーを保護するために使用するパスワードを指定します (証明書と秘密キーをエクスポートするときにパスワードを割り当てた場合)。 **[OK]** をクリックします。 証明書が正常にインポートされた場合、証明書は **サーバー証明書**のエントリとしてコンソールの中央にエントリとして表示されます。

4.  HTTPS で使用する証明書を割り当てます。 コンソールの左側で、IIS サーバーの [ **既定の Web サイト** ] を選択します。 右側の [バインド] をクリックし **ます**。 [ **サイトバインド** ] ダイアログで、[ **追加**] をクリックします。 [**種類:**] の下の [**サイトバインドの追加**] ダイアログで、[ **https**] を選択します。 Https を選択すると、https で使用する証明書を選択できるようになります。 [ **SSL 証明書:**] で、リバースプロキシ用にインポートした証明書を選択します。 **[OK]** をクリックします。 次に、[ **閉じる**] をクリックします。 これで、証明書は secure socket layer (SSL) とトランスポート層セキュリティ (TLS) のリバースプロキシにバインドされました。
    
    <div>
    

    > [!IMPORTANT]  
    > 中間証明書が存在しないバインドダイアログを閉じるときに警告が表示される場合は、パブリック CA のルート証明書証明書と任意の中間 CA 証明書を見つけてインポートする必要があります。 証明書を要求したパブリック CA の指示を参照し、指示に従って証明書チェーンを要求してインポートします。 エッジサーバーから証明書をエクスポートした場合は、ルート CA 証明書と、エッジサーバーに関連付けられているすべての中間 CA 証明書をエクスポートできます。 ルート CA 証明書をコンピューター (ユーザーストアと混同しないでください)、信頼されたルート証明機関ストアおよび中間証明書をコンピューターの中間証明機関ストアにインポートします。

    
    </div>

5.  コンソールの左側にある IIS サーバー名の下にある [ **サーバーファーム** ] を右クリックし、[ **サーバーファームの作成...**] をクリックします。
    
    <div>
    

    > [!NOTE]  
    > <STRONG>サーバーファーム</STRONG>ノードが表示されない場合は、アプリケーション要求ルーティングをインストールする必要があります。 詳細については、「 <A href="lync-server-2013-setting-up-reverse-proxy-servers.md">Lync Server 2013 用のリバースプロキシサーバーの設定</A>」を参照してください。

    
    </div>
    
    [サーバーファーム**名**の**サーバーファームの作成**] ダイアログで、最初の URL の名前 (識別用のフレンドリ名) を入力します。 [**次へ**] をクリックします。

6.  [サーバー**アドレス**の**サーバーの追加**] ダイアログボックスで、フロントエンドサーバーの外部 web サービスの完全修飾ドメイン名 (FQDN) を入力します。 ここで使用する例として使用する名前は、リバースプロキシ、 [証明書の概要-Lync Server 2013 のリバースプロキシ](lync-server-2013-certificate-summary-reverse-proxy.md)の計画セクションで使用されているものと同じです。 リバースプロキシの計画については、FQDN を入力し `webext.contoso.com` ます。 [ **オンライン** ] チェックボックスがオンになっていることを確認します。 この構成の web サーバーのプールにサーバーを追加するには、[ **追加** ] をクリックします。
    
    <div>
    

    > [!WARNING]  
    > Lync Server は、ハードウェアロードバランサーを使用して、HTTP および HTTPS トラフィック用のディレクターおよびフロントエンドサーバーをプールします。 IIS ARR Server ファームにサーバーを追加するときは、FQDN を1つだけ指定できます。 FQDN は、プールされていないサーバー構成のフロントエンドサーバーまたはディレクター、またはサーバープール用に構成されたハードウェアロードバランサーの FQDN になります。 HTTP および HTTPS トラフィックの負荷を分散するためにサポートされている唯一の方法は、ハードウェアロードバランサーを使用することです。

    
    </div>

7.  [ **サーバーの追加** ] ダイアログボックスで、[ **詳細設定**] をクリックします。 これにより、構成済みの FQDN への要求に対するアプリケーション要求ルーティングを定義するダイアログが開きます。 この目的は、IIS ARR によって要求が処理されるときに使用されるポートを再定義することです。
    
    既定では、送信先の HTTP ポートは8080として定義されている必要があります。 現在の **Httpport 80** の横にあるをクリックし、値を **8080**に設定します。 現在の **Httpsport 443** の横にあるをクリックし、値を **4443**に設定します。 **Weight**パラメーターは、100のままにします。 必要に応じて、ベースライン統計を取得すると、特定のルールの重みを再定義できます。 [ **完了** ] をクリックして、ルールの構成のこの部分を完了します。

8.  IIS マネージャーが、すべての着信要求をサーバーファームに自動的にルーティングする URL 書き換えルールを作成できることを通知するダイアログ書き換えルールが表示される場合があります。 [**はい**] をクリックします。 ルールは手動で調整しますが、[はい] を選択すると初期構成が設定されます。

9.  作成したばかりのサーバーファームの名前をクリックします。 IIS マネージャーの [機能] ビューの [ **サーバーファーム** ] で、[ **キャッシュ**] をダブルクリックします。 **ディスクキャッシュの有効化を**選択解除します。 右側の [ **適用** ] をクリックします。

10. サーバーファームの名前をクリックします。 IIS マネージャーの [機能] ビューの [ **サーバーファーム** ] で、[ **プロキシ**] をダブルクリックします。 [プロキシ設定] ページで、[ **タイムアウト (秒)** ] の値を展開に適した値に変更します。 [ **適用** ] をクリックして変更を保存します。
    
    <div>
    

    > [!IMPORTANT]  
    > プロキシタイムアウト値は、展開から展開までの数によって異なります。 クライアントにとって最適な環境を実現するために、展開を監視し、価値を変更する必要があります。 この値は、少なくとも200に設定できます。 環境で Lync モバイルクライアントをサポートしている場合は、値を960に設定して、タイムアウト値が900である Office 365 からのプッシュ通知のタイムアウトを許可する必要があります。 クライアントが切断された後に、値が低すぎる場合、または、プロキシ経由の接続が切断されてオフになっている場合は、クライアントの切断を回避するためにタイムアウト値を増やす必要があります。 環境に適したものを監視し、基準を揃えることは、この値の適切な設定がどこにあるかを判断するための唯一の正確な意味です。

    
    </div>

11. サーバーファームの名前をクリックします。 IIS マネージャーの [機能] ビューの [ **サーバーファーム** ] で、[ **ルーティングルール**] をダブルクリックします。 [ルーティングルール] ダイアログの [ルーティング] で、[SSL オフロードを有効にする] の横にあるチェックボックスをオフにします。 このチェックボックスをオフにする機能が使用できない場合は、[ **URL の書き換えを使用して受信要求を検査する**] チェックボックスをオンにします。 [ **適用** ] をクリックして変更を保存します。
    
    <div>
    

    > [!WARNING]  
    > リバースプロキシによる SSL オフロードはサポートされていません。

    
    </div>

12. リバースプロキシを通過する必要がある各 URL について、手順5-11 を繰り返します。 共通リストは次のようになります。
    
      - フロントエンドサーバー Web サービス外部: webext.contoso.com (最初のウォークスルーによって既に構成されています)
    
      - ディレクターの外部 Web サービス: webdirext.contoso.com (ディレクターが展開されている場合はオプション)
    
      - 簡単な URL の会議: meet.contoso.com
    
      - 簡単な URL のダイヤルイン: dialin.contoso.com
    
      - Lync 自動検出 URL: lyncdiscover.contoso.com
    
      - Office Web Apps サーバーの URL: officewebapps01.contoso.com
        
        <div>
        

        > [!IMPORTANT]  
        > Office Web Apps サーバーの URL では、異なる httpsPort アドレスが使用されます。 手順7では、 <STRONG>Httpsport</STRONG> を <STRONG>443</STRONG> として、 <STRONG>httpsport</STRONG> をポート <STRONG>80</STRONG>として定義します。 他のすべての構成設定は同じです。

        
        </div>

13. コンソールの左側で、IIS サーバー名をクリックします。 コンソールの中央にある [ **IIS**] で、[ **URL の書き換え**] を見つけます。 [URL の書き換え] をダブルクリックして、URL 書き換えルールの構成を開きます。 前の手順で作成した各サーバーファームのルールが表示されます。 この操作を行わない場合は、インターネットインフォメーションサービス (Iis) マネージャーコンソールで、[**スタートページ]** ノードのすぐ下にある**IIS サーバー**名をクリックしたことを確認してください。

14. 例として webext.contoso.com を使用して、[ **URL の書き換え** ] ダイアログで、表示されるルールの完全な名前は **ARR \_ webext.contoso.com \_ loadbalance \_ SSL**です。
    
      - ルールをダブルクリックして [ **受信ルールの編集** ] ダイアログを開きます。
    
      - [**追加] を**クリックします。 [ **条件** ] ダイアログ。
    
      - [条件の**入力**での**条件の追加**] に、「 **{HTTP \_ ホスト}**」と入力します。 入力すると、条件を選択できるダイアログが表示されます。 [ **入力文字列のチェック:** ] **の下で、パターンに一致するもの**を選択します。 **パターン入力**の種類 **\*** 。 **大文字と小文字は区別** されません。 **[OK]** をクリックします。
    
      - [ **受信規則の編集** ] ダイアログボックスを下にスクロールして、[ **アクション** ] ダイアログを見つけます。 **アクションの種類:** **サーバーファームにルーティング**するように設定する必要があります。 **スキーム:** **https://** に設定されている [ **サーバーファーム]:** このルールが適用される URL に設定します。 この例では、 **webext.contoso.com**に設定する必要があります。 **Path:** が **/{R: 0}** に設定されています。
    
      - [ **適用** ] をクリックして変更を保存します。 [ **ルールに戻る** ] をクリックして、URL 書き換えルールに戻ります。

15. 定義済みの各 SSL 書き換えルール (サーバーファーム URL ごとに1つずつ) について、手順14で定義されている手順を繰り返します。
    
    <div>
    

    > [!WARNING]  
    > 既定では、HTTP ルールも作成され、SSL ルールに似た名前で示されます。 現在の例では、HTTP ルールに <STRONG>ARR_webext _loadbalance</STRONG>という名前が付けられています。 これらのルールに変更を加える必要はありません。無視しても問題ありません。

    
    </div>

</div>

<div>

## <a name="to-modify-the-properties-of-the-web-publishing-rule-in-tmg-2010"></a>TMG 2010 で web 公開ルールのプロパティを変更するには

1.  [ **スタート**] をクリックし、[ **プログラム**] をポイントして、[ **Microsoft Forefront tmg**] を選択し、[ **forefront tmg Management**] をクリックします。

2.  左側のウィンドウで、**サーバー名**を展開し、[**ファイアウォール ポリシー**] をクリックします。

3.  詳細ウィンドウで、前の手順で作成した Web サーバー公開ルール (LyncServerExternalRule など) を右クリックし、[**プロパティ**] をクリックします。

4.  [**プロパティ**] ページで [**送信元**] タブをクリックして、以下を実行します。
    
      - [**このルールを次の送信元からのトラフィックに適用する**] ボックスの一覧の [**任意の場所**] をクリックし、[**削除**] をクリックします。
    
      - [**追加**] をクリックします。
    
      - [**ネットワーク エンティティの追加**] で、[**ネットワーク**] を展開し、[**外部**]、[**追加**]、[**閉じる**] の順にクリックします。

5.  [**宛先**] タブで、[**フィールドで指定した実際のホストヘッダーの代わりに元のホスト ヘッダーを、転送する**] チェック ボックスがオンになっていることを確認します。

6.  [**ブリッジ**] タブで、[**要求を SSL ポートにリダイレクトする**] チェック ボックスがオンになっていることを確認して、ポート [**4443**] を指定します。

7.  [**パブリック名**] タブで、簡易 URL (meet.contoso.com や dialin.contoso.com など) を追加します。

8.  [**適用**] をクリックして変更を保存し、[**OK**] をクリックします。

9.  詳細ウィンドウで [**適用**] をクリックして変更を保存し、構成を更新します。

</div>

<div>

## <a name="to-modify-the-properties-of-the-web-publishing-rule-in-iis-arr"></a>IIS ARR で web 公開ルールのプロパティを変更するには

1.  [ **スタート**] をクリックし、[ **プログラム**]、[ **管理ツール**]、[ **インターネットインフォメーションサービス (IIS) マネージャー**] の順にクリックします。

2.  コンソールの左側で、IIS サーバー名をクリックします。

3.  コンソールの中央にある [ **IIS**] で、[ **URL の書き換え**] を見つけます。 [URL の書き換え] をダブルクリックして、URL 書き換えルールの構成を開きます。

4.  変更する必要のあるルールをダブルクリックします。 必要に応じて、[URL の **一致**]、[ **条件**]、[ **サーバー変数** または **アクション**に合わせて変更を行います。

5.  [ **適用** ] をクリックして変更をコミットします。 [ **ルールに戻る** ] をクリックしてその他のルールを変更するか、変更が終わっている場合は **IIS マネージャー** コンソールを閉じます。

</div>

</div>

<span> </span>

</div>

</div>

</div>

