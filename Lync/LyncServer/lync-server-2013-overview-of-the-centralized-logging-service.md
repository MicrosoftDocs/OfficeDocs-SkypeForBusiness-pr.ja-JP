---
title: 'Lync Server 2013: 一元ログサービスの概要'
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
f1.keywords:
- NOCSH
TOCTitle: Overview of the Centralized Logging Service
ms:assetid: 975718a0-f3e3-404d-9453-6224e73bfdd0
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ688145(v=OCS.15)
ms:contentKeyID: 49733746
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 1460699b6516ab4e510c9715b2464ce442466faa
ms.sourcegitcommit: b693d5923d6240cbb865241a5750963423a4b33e
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/04/2020
ms.locfileid: "41755451"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/en-us/">

<div data-asp="http://msdn2.microsoft.com/asp">

# <a name="overview-of-the-centralized-logging-service-in-lync-server-2013"></a>Lync Server 2013 の一元管理されたログサービスの概要

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**最終更新日:** 2013-02-22_

一元管理のログサービスは、広範または狭い範囲のデータの収集手段を提供するように設計されています。 展開されているすべてのサーバーからデータを同時に収集したり、トレースするための特定の要素を定義したり、1台のコンピューターから、またはすべてのサーバーからすべてのデータをまとめて検索結果を返すことができます。 一元的なログサービスは、展開されているすべてのサーバーで実行されます。 一元ログサービスのアーキテクチャは、次のエージェントとサービスで構成されています。

  - *一元管理サービスエージェント*   clsagent は、コントローラーと通信し、管理者によってコントローラーによって発行されたコマンドを受け取るサービス実行可能ファイルです。 エージェントは、各 Lync Server コンピューターでサービスとして実行されます。 エージェントは、コマンドを受け取ると、そのコマンドを実行し、トレース用に定義されたコンポーネントにメッセージを送信し、トレースログをディスクに書き込みます。 また、コンピューターのトレースログを読み取り、要求された場合にトレースデータをコントローラーに返します。 ClsAgent は、 **tcp 50001**、 **Tcp 50002**、 **tcp 50003**の各ポートでコマンドをリッスンします。

  - *一元管理サービスコントローラー*   clscontroller は、Lync Server 管理シェルと clscontroller 用のコマンド実行エンジンです。 ClsAgent Lib は、開始、停止、フラッシュ、検索コマンドを ClsAgent に送信します。 検索コマンドが送信されると、結果として得られたログは Clsコントローラーライブラリに戻され、集計されます。 コントローラーでは、エージェントへのコマンドの送信、それらのコマンドの状態の受信、検索ログファイルデータの管理は、検索範囲内の任意のコンピューター上のすべてのエージェントから返され、ログデータを意味のある順番に集計する役割を担います。出力セット。 次のトピックの情報は、Lync Server 管理シェルの使用に重点を置いています。 ClsController は、Lync Server 管理シェルで利用できる機能のサブセットに制限されています。 ClsController のヘルプは、コマンドラインで、既定のディレクトリ C `ClsController` :\\Program Files\\Common Files\\Microsoft Lync Server 2013\\clscontroller に入力すると、コマンドラインから利用できます。

**ClsController と ClsAgent の通信**

![CLSController と CLSAgent の間の関係](images/JJ688145.68c90811-5cf9-4a84-95b7-ea9ffc61eac4(OCS.15).jpg "CLSController と CLSAgent の間の関係")

Windows Server のコマンドラインインターフェイスまたは Lync Server 管理シェルを使用して、コマンドを実行します。 コマンドは、ログインしているコンピューターで実行され、ローカルまたは展開内の他のコンピューターやプールに送信されます。

ClsAgent は、すべてのインデックスファイルを管理します。ローカルコンピューターにあるファイルをキャッシュします。 ClsAgent は、オプション CacheFileLocalFolders によって定義されたボリューム間で均等に分散されるように、各ボリュームの80% を消費しないようにします (つまり、ローカルキャッシュの場所と割合は、 **Set-CsClsConfiguration**コマンドレットを使用して構成できます)。 ClsAgent は、ローカルコンピューターから古いキャッシュされたイベントトレースログ (.etl) ファイルを処理する責任も担います。 2週間後 (つまり、 **Set-CsClsConfiguration**コマンドレットを使用して期間を構成できます)、これらのファイルはファイル共有にコピーされ、ローカルコンピューターから削除されます。 詳細については、「 [Set-CsClsConfiguration](https://docs.microsoft.com/powershell/module/skype/Set-CsClsConfiguration)」を参照してください。 検索要求を受信すると、検索条件を使ってキャッシュされた一連の .etl ファイルが選択され、エージェントによって管理されているインデックス内の値に基づいて検索が実行されます。

<div>


> [!NOTE]  
> ローカル コンピューターからファイル共有に移動されたファイルを ClsAgent で検索できます。ClsAgent がファイルをファイル共有に移動すると、ファイルのエージングと削除は ClsAgent で管理されません。ファイル共有内のファイルのサイズを監視し、ファイルを削除またはアーカイブするための管理タスクを定義する必要があります。



</div>

**Snooper.exe** や、テキスト ファイルを読み取ることのできるツール (**Notepad.exe** など) を含むさまざまなツールを使用して、結果のログ ファイルの読み取りと分析を行うことができます。 Snooper は Lync Server 2013 デバッグツールの一部であり、Web から[http://go.microsoft.com/fwlink/?LinkId=285257](http://go.microsoft.com/fwlink/?linkid=285257)ダウンロードできます。

OCSLogger と同様に、一元管理サービスには、追跡対象となるいくつかのコンポーネントがあり、TF\_コンポーネントや tf\_DIAG などのフラグを選択するオプションが用意されています。 一元管理サービスは、OCSLogger の [ログレベル] オプションも保持します。

コマンドラインの ClsController を介して Lync Server 管理シェルを使用する最も重要な利点は、問題スペース、カスタムフラグ、およびログレベルを対象とする、選択したプロバイダーを使用して新しいシナリオを構成して定義できることです。 ClsController で使用可能なシナリオは、実行可能ファイル用に定義されるシナリオに制限されます。

以前のバージョンでは、管理者とサポート担当者が展開内のコンピューターからトレース ファイルを収集できるようにするために OCSLogger.exe が提供されていました。OCSLogger には、長所と同時に短所も存在しました。ログは一度に 1 台のコンピューター上でしか収集できませんでした。OCSLogger のコピーを使用して複数のコンピューターにログオンすることは可能でしたが、最終的にログが複数作成され、結果を集計するのが容易ではありませんでした。

ユーザーがログの検索を要求すると、ClsController が (選択したシナリオに基づいて) 要求の送信先コンピューターを特定します。また、.etl ファイルが保存されているファイル共有に検索を送信する必要があるかどうかを判断します。検索結果が ClsController に返されると、コントローラーが結果をマージして時系列の 1 つの結果セットを作成し、ユーザーに提供します。ユーザーは、ローカル コンピューターに検索結果を保存して、以降の分析に使用できます。

ログ記録セッションを開始したら、解決しようとする問題に関連するシナリオを指定します。常に実行することのできるシナリオは 2 つあります。そのうちの 1 つは AlwaysOn シナリオにする必要があります。名前が示すとおり、このシナリオを展開内で常に実行し、すべてのコンピューター、プール、およびコンポーネントに関する情報を収集する必要があります。

<div>


> [!IMPORTANT]  
> 既定では、AlwaysOn シナリオは展開内で実行されません。 このシナリオは明示的に開始する必要があります。 開始したシナリオは明示的に停止されるまで実行され、実行状態はコンピューターを再起動しても保持されます。 シナリオの開始と停止の詳細については、「サーバー <A href="lync-server-2013-using-start-for-the-centralized-logging-service-to-capture-logs.md">2013 でログをキャプチャ</A>して lync server <A href="lync-server-2013-using-stop-for-the-centralized-logging-service.md">2013 の中央集中ログサービスの [停止</A>] を使う」を参照してください。



</div>

問題が発生した場合は、報告された問題に関連する 2 つ目のシナリオを開始します。問題を再現し、2 つ目のシナリオのログ記録を停止します。報告された問題に関連するログの検索を開始します。集計されたログのコレクションによって、展開のサイト スコープまたはグローバル スコープ内のすべてのコンピューターからのトレース メッセージを含むログ ファイルが生成されます。分析可能なデータ以上のデータが検索から返された場合は (通常、信号対ノイズ比とも呼ばれ、この場合はノイズが多すぎる状態です)、パラメーターを絞り込んで別の検索を実行します。この時点で、問題を明確にするために役立つパターンの特定を開始できます。最終的には、いくつかの絞り込み検索を実行した後で問題に関連するデータが見つかり、根本原因を特定できます。

<div>


> [!TIP]  
> Lync Server で問題のシナリオを提示された場合は、まず「問題について何を知っていますか?」というメッセージを表示します。 問題の境界を定量化すると、Lync Server の運用エンティティの一部を削除することができます。<BR>ユーザーが連絡先を検索するときに現在の結果を取得していないことがわかっているシナリオ例を検討します。 メディアコンポーネント、エンタープライズ Voip、会議、その他のコンポーネントで問題があるかどうかを調べるポイントはありません。 実際はどこに問題が存在するのか (クライアントなのか、サーバー側の問題なのか) がわからないためです。 連絡先は、ユーザーレプリケーターによって Active Directory から収集され、アドレス帳サーバー (ABServer) を介してクライアントに配信されます。 ABServer は、既定では午前 1 時 30 分に (ユーザー レプリケーターが更新内容を書き込む) RTC データベースから更新を取得してアドレス帳ファイルにまとめます。 Lync Server クライアントはランダムなスケジュールで新しいアドレス帳を取得します。 プロセスがどのように動作するかがわかっているため、ユーザーレプリケーターによって Active Directory から収集されたデータに関連する問題の可能性を検索したり、ABServer がアドレス帳ファイルを取得して作成したりすることはありません。アドレス帳ファイルをダウンロードしています。



</div>

</div>

<span> </span>

</div>

</div>

</div>

