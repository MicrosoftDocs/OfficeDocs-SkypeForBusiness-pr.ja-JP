---
title: 自動検出用のリバース プロキシの構成
TOCTitle: 自動検出用のリバース プロキシの構成
ms:assetid: 1e3c3cc2-fe55-408b-99c4-c6e0a9252689
ms:mtpsurl: https://technet.microsoft.com/ja-jp/library/JJ945619(v=OCS.15)
ms:contentKeyID: 52056551
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# 自動検出用のリバース プロキシの構成

 

_**トピックの最終更新日:** 2012-12-12_

自動検出および自動検出を使用するクライアントをサポートするには、リバース プロキシの既存の Web 公開ルールを変更するか、新しい Web 公開ルールを作成する必要があります。公開ルールの変更または新規作成は、リバース プロキシ証明書のサブジェクトの別名リストを更新するかどうかの決定に依存しません。

最初の Lync Server 2013 自動検出サービス要求に HTTPS を使用し、リバース プロキシ証明書のサブジェクトの別名リストを更新する場合は、更新したパブリック証明書をリバース プロキシの Secure Sockets Layer (SSL) リスナーに割り当てる必要があります。外部 (パブリック) 証明書への必要な更新には、lyncdiscover.\<domain\> のサブジェクトの別名 (SAN) エントリが含まれます。次に、外部 Web サービスの既存のリスナーを変更するか、外部自動検出サービス URL の新しい Web 公開ルールを作成する必要があります (たとえば、**lyncdiscover.contoso.com**)。フロント エンド プールおよびディレクター プール (ディレクターを公開している場合) の外部 Lync Server 2013 Web サービス URL の Web 公開ルールがない場合は、そのルールも公開する必要があります。

> [!NOTE]
> リバース プロキシ公開ルールとリスナーは、外部 Web サービスと自動検出サービスの両方に情報を提供できますが、それにはその両方について、リスナーに割り当てられた証明書に、必要なサブジェクト名とサブジェクトの別名が含まれている必要があります。Web リスナーおよび公開ルールの既定の構成の詳細については、「<a href="lync-server-2013-setting-up-reverse-proxy-servers.md">Lync Server 2013 のリバース プロキシ サーバーの設定</a>」を参照してください。


最初の自動検出サービス要求に HTTP を使用するので、リバース プロキシのサブジェクトの別名を更新する必要がない場合は、ポート 80 の新しい Web 公開ルールを作成または変更する必要があります。

このセクションの手順では、Microsoft Forefront Threat Management Gateway 2010 で自動検出の Web 公開ルールを作成または変更する方法について説明します。

> [!NOTE]
> これらの手順では、Forefront Threat Management Gateway (TMG) 2010 の Standard Edition がインストール済みであることを前提としています。他のリバース プロキシを使用する場合も、同様の手順を使用しますが、サードパーティ製品のドキュメントにマップする必要があります。


## 外部自動検出 URL の Web 公開ルールを作成するには

1.  \[**スタート**\] ボタンをクリックし、\[**すべてのプログラム**\] をポイントします。次に、\[**Microsoft Forefront TMG**\] をポイントし、\[**Forefront TMG Management**\] をクリックします。

2.  左側のウィンドウで、\[**サーバー名**\] を展開し、\[**ファイアウォール ポリシー**\] を右クリックします。次に、\[**新規作成**\] をポイントし、\[**Web サイト公開ルール**\] をクリックします。

3.  \[**新しい Web 公開ルール ウィザードへようこそ**\] ページで、新しい公開ルールの表示名 (たとえば、LyncDiscoveryURL) を入力します。

4.  \[**ルール動作の選択**\] ページで \[**許可**\] を選択します。

5.  \[**公開の種類**\] ページで、\[**1 つの Web サイトまたはロード バランサーを公開する**\] をクリックします。

6.  \[**サーバー接続セキュリティ**\] ページで、\[**公開された Web サーバーまたはサーバー ファームへの接続に SSL を使用する**\] をクリックします。

7.  \[**内部公開の詳細**\] ページの \[**内部サイト名**\] に、ディレクター プールの完全修飾ドメイン名 (FQDN) (たとえば、lyncdir01.contoso.local) を入力します。フロント エンド プールで外部 Web サービス URL のルールを作成している場合は、フロント エンド プールの FQDN (たとえば、lyncpool01.contoso.local) を入力します。

8.  \[**内部公開の詳細**\] ページの \[**パス (省略可)**\] に、公開するフォルダーのパスとして「**/\***」と入力し、\[**元のホスト ヘッダーを転送する**\] を選択します。

9.  \[**パブリック名の詳細**\] ページで、次の操作を行います。
    
      - \[**要求の許可**\] で、\[**次に入力したドメイン名**\] を選択します。
    
      - \[**パブリック名**\] に、「**lyncdiscover.**\<sipdomain\>」(外部自動検出サービス URL) と入力します。フロント エンド プールで外部 Web サービス URL のルールを作成している場合は、フロント エンド プールの外部 Web サービスの FQDN (たとえば、lyncwebextpool01.contoso.com) を入力します。
    
      - \[**パス**\] に「**/\***」と入力します。

10. \[**Web リスナーの選択**\] ページの \[**Web リスナー**\] で、パブリック証明書が更新されている既存の SSL リスナーを選択します。

11. \[**認証の委任**\] ページで \[**委任できません。クライアントは直接認証できます**\] を選択します。

12. \[**ユーザー セット**\] ページで、\[**すべてのユーザー**\] を選択します。

13. \[**新しい Web 公開ルール ウィザードの完了**\] ページで、Web 公開ルールの設定が正しいことを確認し、\[**完了**\] をクリックします。

14. Web 公開ルールの Forefront TMG リストで、追加した新しいルールをダブルクリックし、\[**プロパティ**\] を開きます。

15. \[**宛先**\] タブで、次の操作を行います。
    
      - \[**フィールドで指定した実際のホストヘッダーの代わりに元のホスト ヘッダーを、転送する**\] を選択します。
    
      - \[**Forefront TMG コンピューターからの要求にする**\] を選択します。

16. \[**ブリッジ**\] タブで、以下のように構成します。
    
      - \[**Web サーバー**\] を選択します。
    
      - \[**HTTP ポートに要求をリダイレクトする**\] を選択し、ポート番号の「**8080**」を入力します。
    
      - \[**SSL ポートに要求をリダイレクトする**\] を選択し、ポート番号に「**4443**」を入力します。

17. \[**OK**\] をクリックします。

18. 詳細ウィンドウで \[**適用**\] をクリックして変更を保存し、構成を更新します。

19. \[**ルールのテスト**\] をクリックし、新しいルールが適切に設定されていることを確認します。

## 既存の Web 公開ルールを変更し、外部自動検出 SAN および URL を追加するには

1.  \[**スタート**\] ボタンをクリックし、\[**すべてのプログラム**\] をポイントします。次に、\[**Microsoft Forefront TMG**\] をポイントし、\[**Forefront TMG Management**\] をクリックします。
    

    > [!IMPORTANT]
    > 使用している公開ルールおよびリスナーごとに変更を繰り返します。通常、これはフロント エンド プールを対象とした 1 つのルールおよびリスナーになります。また、オプションでは、ディレクターまたはディレクター プールの 1 つのルールとリスナーになります (これらを展開した場合)。



2.  左側のウィンドウで、\[**サーバー名**\] を展開し、\[**ファイアウォール ポリシー**\] を右クリックして、該当するルールをクリックします。\[**タスク**\] タブで、\[**選択したルールを編集します**\] をクリックします。

3.  \[**オンラインで公開する名前**\] タブの \[**このルールの適用先**\] で、\[**以下の Web サイトへの要求**\] を選択します。

4.  \[**追加**\] をクリックし、新しい自動検出サイトの名前を入力して ("lyncdiscover.contoso.com" など)、\[**OK**\] をクリックします。

5.  \[**リスナー**\] タブで、\[**証明書の選択**\] をクリックし、新しい証明書と追加された自動検出 SAN エントリを割り当てます。リスナーおよび Web 公開プロパティを閉じます。

6.  詳細ウィンドウで \[**適用**\] をクリックして変更を保存し、構成を更新します。

7.  \[**ルールのテスト**\] をクリックし、新しいルールが適切に設定されていることを確認します。

## ポート 80 の Web 公開ルールを作成するには

1.  \[**スタート**\] ボタンをクリックし、\[**すべてのプログラム**\] をポイントします。次に、\[**Microsoft Forefront TMG**\] をポイントし、\[**Forefront TMG Management**\] をクリックします。

2.  左側のウィンドウで、\[**サーバー名**\] を展開し、\[**ファイアウォール ポリシー**\] を右クリックします。次に、\[**新規作成**\] をポイントし、\[**Web サイト公開ルール**\] をクリックします。

3.  \[**新しい Web 公開ルール ウィザードへようこそ**\] ページで、新しい公開ルールの表示名 (たとえば、Lync Autodiscover (HTTP)) を入力します。

4.  \[**ルール動作の選択**\] ページで \[**許可**\] を選択します。

5.  \[**公開の種類**\] ページで、\[**1 つの Web サイトまたはロード バランサーを公開する**\] をクリックします。

6.  \[**サーバー接続セキュリティ**\] ページで、\[**公開された Web サーバーまたはサーバー ファームへの接続に、セキュリティで保護されていない接続を使用する**\] を選択します。

7.  \[**内部公開の詳細**\] ページの \[**内部サイト名**\] に、フロント エンド プールの内部 Web サービス FQDN (たとえば、lyncpool01.contoso.local) を入力します。

8.  \[**内部公開の詳細**\] ページの \[**パス (省略可)**\] に、公開するフォルダーのパスとして「**/\***」と入力し、\[\[**内部サイト名\] フィールドで指定したホスト ヘッダーの代わりに元のホスト ヘッダーを、転送する**\] を選択します。

9.  \[**パブリック名の詳細**\] ページで、次の操作を行います。
    
      - \[**要求の許可**\] で、\[**次に入力したドメイン名**\] を選択します。
    
      - \[**パブリック名**\] に、「**lyncdiscover.**\<sipdomain\>」(外部自動検出サービス URL) を入力します。
    
      - \[**パス**\] に「**/\***」と入力します。

10. \[**Web リスナーの選択**\] ページの \[**Web リスナー**\] で、Web リスナーを選択するか、新しい Web リスナーを作成するために新しい Web リスナーの定義ウィザードを使用します。

11. \[**認証の委任**\] ページで \[**委任できません。クライアントは直接認証できません**\] を選択します。

12. \[**ユーザー セット**\] ページで、\[**すべてのユーザー**\] を選択します。

13. \[**新しい Web 公開ルール ウィザードの完了**\] ページで、Web 公開ルールの設定が正しいことを確認し、\[**完了**\] をクリックします。

14. Web 公開ルールの Forefront TMG リストで、追加した新しいルールをダブルクリックし、\[**プロパティ**\] を開きます。

15. \[**ブリッジ**\] タブで、以下のように構成します。
    
      - \[**Web サーバー**\] を選択します。
    
      - \[**HTTP ポートに要求をリダイレクトする**\] を選択し、ポート番号の「**8080**」を入力します。
    
      - \[**SSL ポートに要求をリダイレクトする**\] が選択されていないことを確認します。

16. \[**OK**\] をクリックします。

17. 詳細ウィンドウで \[**適用**\] をクリックして変更を保存し、構成を更新します。

18. \[**ルールのテスト**\] をクリックし、新しいルールが適切に設定されていることを確認します。

19. 他の Web 公開ルールに外部自動検出サービス URL が定義されていないことを確認します。

## 関連項目

#### 概念

[Lync Server 2013 のリバース プロキシ サーバーの設定](lync-server-2013-setting-up-reverse-proxy-servers.md)

