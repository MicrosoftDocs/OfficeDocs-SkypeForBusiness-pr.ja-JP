---
title: 'Lync Server 2013: フロントエンド サーバー、インスタント メッセージングおよびプレゼンスのトポロジおよびコンポーネント'
TOCTitle: フロントエンド サーバー、インスタント メッセージングおよびプレゼンスのトポロジおよびコンポーネント
ms:assetid: f08ce7a1-d14e-4a54-9771-a82c870658bf
ms:mtpsurl: https://technet.microsoft.com/ja-jp/library/Gg412996(v=OCS.15)
ms:contentKeyID: 48273960
ms.date: 12/10/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Lync Server 2013 フロントエンド サーバー、インスタント メッセージングおよびプレゼンスのトポロジおよびコンポーネント

 

_**トピックの最終更新日:** 2016-12-08_

インスタント メッセージング (IM) とプレゼンスに必要なコンポーネントは、次に示すものだけです。

  - 組織のフロントエンド サーバーまたは Standard Edition サーバー。これらのサーバーでは、IM およびプレゼンス機能が常時有効になっています。

  - ロード バランサー ( Enterprise Editionフロント エンド プール がある場合)。詳細は、「[Lync Server 2013 での負荷分散の要件](lync-server-2013-load-balancing-requirements.md)」を参照してください。

## フロントエンド プール展開の計画

Lync Server 2013 では フロント エンド プール アーキテクチャが変更されており、これらの変更は フロント エンド プール の計画と管理に影響します。

すべての Enterprise Editionフロント エンド プール に少なくとも 3 台のフロントエンド サーバーを含めることをお勧めします。Lync Server では、フロント エンド プール のアーキテクチャは分散システム モデルを採用しており、各ユーザーのデータがプールに内フロントエンド サーバーに格納されます。この新しいアーキテクチャの詳細については、「[Lync Server 2013 のトポロジの変更](lync-server-2013-topology-changes.md)」を参照してください。

Enterprise Editionフロント エンド サーバー を 3 台展開したくはないが、障害復旧が必要な場合は、Lync ServerStandard Edition を使用し、プールを 2 つ作成してペアのバックアップ関係にすることをお勧めします。サーバーを 2 台だけ使用する、最適な障害復旧のソリューションです。高可用性と障害復旧のトポロジと機能の詳細については、「[Lync Server 2013 での高可用性および障害復旧の計画](lync-server-2013-planning-for-high-availability-and-disaster-recovery.md)」を参照してください。

## フロントエンド プール管理の計画

フロント エンド プール の場合は、ここで説明するガイドラインに従ってください。

## プールが機能していることの確認

フロント エンド プール の新しい分散モデルの場合、プールを機能させるためには一定数のサーバーがプールで実行されている必要があります。プールには次の 2 つの損失モデルがあります。

  - ルーティング グループ レベル クォーラム損失。特定のルーティング グループに十分な数のレプリカ サーバーがないことによって発生します。ルーティング グループとは、そのプールに所属するすべてのユーザーからなる集合です。各ルーティング グループは、プライマリ 1 台とセカンダリ 2 台という 3 台のレプリカをプールに持っています。

  - プール レベル クォーラム損失。プールで十分な数のシード サーバーが実行されていない場合に発生します。

## ルーティング グループ レベル クォーラム損失

新しい フロント エンド プール を初めて起動するときには、次の表に示すように、サーバーの 85% が実行されていることが必要です。実行されているサーバーの数がそれより少ないと、サービスが起動状態で行き詰まり、プールが起動されないことがあります。


<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>プール内のサーバーの合計数</th>
<th>プールを初めて起動させるために実行する必要があるサーバー数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>2</p></td>
<td><p>1</p></td>
</tr>
<tr class="even">
<td><p>3</p></td>
<td><p>3</p></td>
</tr>
<tr class="odd">
<td><p>4</p></td>
<td><p>3</p></td>
</tr>
<tr class="even">
<td><p>5</p></td>
<td><p>4</p></td>
</tr>
<tr class="odd">
<td><p>6</p></td>
<td><p>5</p></td>
</tr>
<tr class="even">
<td><p>7</p></td>
<td><p>5</p></td>
</tr>
<tr class="odd">
<td><p>8</p></td>
<td><p>6</p></td>
</tr>
<tr class="even">
<td><p>9</p></td>
<td><p>7</p></td>
</tr>
<tr class="odd">
<td><p>10</p></td>
<td><p>8</p></td>
</tr>
<tr class="even">
<td><p>11</p></td>
<td><p>9</p></td>
</tr>
<tr class="odd">
<td><p>12</p></td>
<td><p>10</p></td>
</tr>
</tbody>
</table>


その後もプールが起動されるたびに、サーバーの 85% が起動されている必要があります (前出の表を参照)。この数のサーバーを起動できない (ただし、プール レベル クォーラム損失にはならない数のサーバーが起動されている) 場合は、**Reset-CsPoolRegistrarState –ResetType QuorumLossRecovery** コマンドレットを使用して、プールをルーティング グループ レベル クォーラム損失から復旧させ、処理を続行させることができます。このコマンドレットの使用法の詳細については、「[Reset-CsPoolRegistrarState](https://docs.microsoft.com/en-us/powershell/module/skype/Reset-CsPoolRegistrarState)」を参照してください。

> [!NOTE]
> Lync Server は監視にプライマリ SQL データベースを使うので、プライマリ データベースをシャットダウンしてミラー データベースに切り替え、前出の表の必要な実行数に足りなくなるまで フロント エンド サーバー をシャットダウンすると、プール全体がダウンします。詳細については、「<a href="http://go.microsoft.com/fwlink/?linkid=393672">データベース ミラーリング監視サーバー</a>」を参照してください。


## プール レベル クォーラム損失

フロント エンド プール がそもそも機能するためには、プール レベル クォーラム損失になっていないことが必要です。実行中のサーバーの数が次の表に示す機能レベルを下回ると、プールに属する残りのサーバーがすべての Lync Server サービスを停止します。次の表の数はプールでバック エンド サーバーが実行されていることを前提としています。


<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>プール内のフロントエンド サーバーの合計数</th>
<th>プールを機能させるために実行する必要があるサーバーの数</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>2</p></td>
<td><p>1</p></td>
</tr>
<tr class="even">
<td><p>3 ～ 4</p></td>
<td><p>任意の 2 台</p></td>
</tr>
<tr class="odd">
<td><p>5 ～ 6</p></td>
<td><p>任意の 3 台</p></td>
</tr>
<tr class="even">
<td><p>7</p></td>
<td><p>任意の 4 台</p></td>
</tr>
<tr class="odd">
<td><p>8-9</p></td>
<td><p>最初の 7 台のうちの任意の 4 台</p></td>
</tr>
<tr class="even">
<td><p>10 ～ 12</p></td>
<td><p>最初の 9 台のうちの任意の 5 台</p></td>
</tr>
</tbody>
</table>


この表でいう最初のサーバーとは、プールが初めて起動されたとき先に立ち上げられたものから順に数えたサーバーです。該当するサーバーを確認するには、**Get-CsComputer** コマンドレットで **–PoolFqdn** オプションを使用します。このコマンドレットはサーバーをトポロジ内に出現した順に表示するので、そのリストの先頭にある方が最初のサーバーです。

## フロントエンド サーバーが 2 台のフロントエンド プール

フロントエンド サーバーが 2 台しかないフロントエンド プールを展開することはお勧めしません。それでも、そのようなプールを展開する必要がある場合は、次のガイドラインに従ってください。

  - 2 台のフロントエンド サーバーのうち 1 台が停止した場合、故障したサーバーをできるだけ早く復旧する必要があります。同様に、2 台のサーバーのうち 1 台をアップグレードする必要がある場合は、アップグレードが終わり次第、オンラインにします。

  - 何らかの理由で両方のサーバーを同時に停止する必要がある場合は、プールのダウンタイムが終わったら次のことをします。
    
      - ベスト プラクティスは、両方のフロント エンド サーバーを同時に再起動することです。
    
      - 2 台のサーバーを同時に再起動できない場合は、停止した順序とは逆の順序で復旧する必要があります。
    
      - その順序で起動できない場合は、プールを復旧する前に、次のコマンドレットを使用してください。
        
            Reset-CsPoolRegistrarState -ResetType QuorumLossRecovery -PoolFQDN <FQDN>

## プールが機能していることを確認するための追加手順

フロント エンド プール を確実に機能させておくために、他にもいくつかの要因を監視する必要があります。

  - 初めてユーザーをプールへ移動するときは、フロントエンド サーバーを少なくとも 3 台は実行しておいてください。

  - 障害復旧の目的でこのプールと別のプールの間にペアの関係を確立する場合は、データをバックアップ プールと正しく同期するために、関係を確立した後で、このプールの 3 台のフロントエンド サーバーがどこかのタイミングで同時に実行されることを確認する必要があります。プールのペアリングと障害復旧機能の詳細については、「[Lync Server 2013 での高可用性および障害復旧の計画](lync-server-2013-planning-for-high-availability-and-disaster-recovery.md)」を参照してください。

## プールのアップグレードの信頼性改善

フロント エンド プール に属するサーバーのアップグレードまたはパッチが必要な場合は、「[Lync Server 2013 でのフロントエンド サーバーのアップグレードまたは更新](lync-server-2013-upgrade-or-update-front-end-servers.md)」のワークフローに従い、次のガイドラインを順守してください。

  - あるアップグレード ドメインを別のドメインにアップグレード目的で (「[Lync Server 2013 でのフロントエンド サーバーのアップグレードまたは更新](lync-server-2013-upgrade-or-update-front-end-servers.md)」のワークフローに従って) 移行する場合は、**Get-CsPoolUpgradeReadinessState** コマンドレットを使用して、Ready 状態になることを確認します。Ready になった後に 20 分の待機時間を各アップグレード ドメイン間に追加すると、アップグレードの信頼性が高まります。この 20 分の間に **Not Ready** になったら、20 分タイマーを再起動してください。また、**Get-CsPoolFabricState** コマンドレットをこの 20 分間隔をスタートさせる前と後に実行して、ルーティング グループのプライマリとセカンダリに変化が起こらないようにしてください。

  - 最後にパッチされたアップグレード ドメインのサーバーが 1 つでも行き詰まっているか再起動しない場合は、次のアップグレード ドメインに移行しないでください。このことは、起動できないサーバーがアップグレード内に 1 台でもある場合にも当てはまります。**Get-CsPoolFabricState** を実行して、ルーティング グループのすべてが 1 台のプライマリと少なくとも 1 台のセカンダリを持つようにしてください。そうすることで、すべてのユーザーがサービスを持つかどうかが確定します。

  - サービスを持つユーザーと持たないユーザーがいる場合は、**Get-CsPoolFabricState** を –Verbose オプションを指定して実行して、レプリカが不足しているルーティング グループがないかどうかを確認します。トラブルシューティングの手始めとしてのプール全体の再起動はしないでください。このコマンドレットの詳細については、「[Get-CsPoolFabricState](https://docs.microsoft.com/en-us/powershell/module/skype/Get-CsPoolFabricState)」を参照してください。

  - Windows Fabric のインストール/アンインストールでは、\[イベント ビューア\] ウィンドウと \[パフォーマンス モニター\] ウィンドウのすべてのインスタンスが閉じていることを確認してください。

## フロントエンド プールの構成の変更

フロントエンド サーバーをプールに追加、またはプールから削除し、新しいトポロジを公開するときは、毎回、次のガイドラインに従ってください。

  - 新しいトポロジが公開された後で、プール内の各 フロント エンド サーバー を再起動する必要があります。1 台ずつ再起動してください。

  - 構成の変更中にプール全体がダウンした場合は、新しいトポロジが公開された後で次のコマンドレットを実行します。
    
        Reset-CsPoolRegistrarState -PoolFQDN <PoolFQDN> -ResetType ServiceReset

フロントエンド サーバーが故障し、数日以内に交換できそうにない場合は、そのサーバーをトポロジから削除します。再び使用できるようになったときに、新しいフロントエンド サーバーをトポロジに追加します。

