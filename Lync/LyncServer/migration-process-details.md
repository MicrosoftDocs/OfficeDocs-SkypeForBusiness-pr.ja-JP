---
title: 移行のプロセス - 詳細
TOCTitle: 移行のプロセス - 詳細
ms:assetid: ca7e352c-9bde-47d9-8273-5cf2fdfdfe7e
ms:mtpsurl: https://technet.microsoft.com/ja-jp/library/JJ205264(v=OCS.15)
ms:contentKeyID: 48273597
ms.date: 12/10/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# 移行のプロセス - 詳細

 

_**トピックの最終更新日:** 2016-12-08_

ここでは、 Lync Server 2010、グループ チャット、または Office Communications Server 2007 R2  グループ チャットを、 Lync Server 2013、 常設チャット サーバーに移行するための前提条件と詳細な手順を説明します。

## 移行の前提条件

Lync Server 2010、グループ チャット、または Office Communications Server 2007 R2  グループ チャットを、 Lync Server 2013  常設チャット サーバーに移行する前に以下の前提条件が満たされていることを確認してください。

1.  少なくとも 1 つの Lync Server 2013 プールを展開します。複数の Lync Server 2013 プールがある場合は、どの Lync Server 2013 プールを新しい Lync Server 2013  常設チャット サーバー プールのホーム プールにするのかを決定します。

2.  Lync Server 2013、 常設チャット サーバー プールをインストールします。インストールされたプールは空になります (カテゴリ、ルーム、アドインは存在しません)。以前のカテゴリ、ルーム、またはアドインを移行する前に、 Lync Server 2013、 常設チャット サーバー展開に新しいルーム、カテゴリ、またはアドインを作成することができます。
    

    > [!IMPORTANT]
    > 新しくアイテムを作成した場合、それらのアイテムは、移行しようとしている以前のアイテムと競合する可能性があることに注意してください。名前が競合しないようにします。競合すると、新しく作成したアイテムは、移行時に以前のデータによって上書きされます。



## 移行のソース データの準備

移行のソース データを適切に準備するには、以下の手順を行います。

1.  Lync Server 2010、グループ チャット、または Office Communications Server 2007 R2  グループ チャットのソース データベースをバックアップします。 SQL Server のバックアップについての詳細は、「バックアップの概要 (SQL Server)」( [http://go.microsoft.com/fwlink/?linkid=254851\&clcid=0x411](http://go.microsoft.com/fwlink/?linkid=254851%26clcid=0x411)) を参照してください。
    

    > [!IMPORTANT]
    > Active Directory ドメイン サービス は同一である必要があります。移行の条件として、異なる展開 (具体的には、異なる Active Directory フォレスト) のプールには移行できません。



2.  Lync Server 2010、グループ チャット、または Office Communications Server 2007 R2  グループ チャットのチャット ルームとカテゴリの構成を調査します。既存の旧展開でのカテゴリ、ルーム、アドインへの変更は、 グループ チャット管理ツールによって行います。
    

    > [!TIP]
    > Lync Server 2013、 常設チャット サーバー展開でのカテゴリ、ルーム、アドインへの変更は、 Lync Server コントロール パネルまたは Windows PowerShell コマンドレットによって行います。

    
    旧システムを移行用に準備するには、以下の手順を行います。
    
    1.  常設チャット サーバーは、カテゴリを多階層的な構造ではなく単一のレベルでサポートします。移行後、サブカテゴリには親カテゴリの名前をすべて含む接頭辞が付加されます。結果として生成される構造が要件に合うように、既存のカテゴリ構造を平らに単純化しておくこともできます。
    
    2.  ルート カテゴリの **マネージャー**を確認します。このレベルにマネージャーが存在する場合、そのユーザーは、移行後、 **すべてのルームのマネージャー**として追加されます。これが自身の組織にとっての要件に合わない場合は、ルート カテゴリからこのようなマネージャーを削除する必要があります。
    
    3.  ルーム名の長さを確認します。移行後はカテゴリ構造が単純化されるため、子カテゴリ内のルームにはすべての親カテゴリ名が接頭辞として付加されます。名前は、親カテゴリの名前も含めて 256 文字までに制限されます。ルーム名の長さを確認し、長過ぎる場合には短くする必要があります。
    
    4.  Lync Server 2013 では、カテゴリで \[**招待**\] 設定が True に設定されている場合、そのカテゴリ内のルームは招待を True とするか False とするかを選択できます。一方、カテゴリの招待設定が False に設定されている場合、そのカテゴリ内のルームの招待は無効となります。特定のカテゴリの下にルームを存在させる場合は、移行前に、旧バージョンの Lync Server  グループ チャット サーバーで招待設定をリセットする必要があります。これを行わない場合、移行時に、 Lync Server 2013 は警告を表示し、既定値である False をルームに設定します。
    
    5.  チャット ルームでファイルを使用していた場合は、移行後に、ファイルを新しい 常設チャット ファイル ストアに手動でコピー (XCOPY) する必要があります。ツールではこれは行われません。
    
    6.  フェデレーション ユーザーが存在する場合、またはフェデレーション ユーザーを含むルームが存在する場合は、 常設チャット サーバーがフェデレーションをサポートしないという点に注意してください。フェデレーション ユーザーを含むルームは移行されますが、そのユーザー自体は、フェデレーション アクセスがサポートされないため、コンテンツにアクセスできるようになりません。
    
    7.  移行しないルームを特定し、無効としてマークを付けます。
    
    8.  チャット ルームのコンテンツを移行するかどうかの基準となる日付を特定します。たとえば、2010 年 1 月 1 日以前のメッセージは古いため、または移行に適さないため、それらのメッセージは移行しないと設定することができます。

## 移行の実行

旧バージョンの グループ チャット サーバーを移行するには、以下の手順を行います。

1.  Lync Server 2010、グループ チャット、 Office Communications Server 2007 R2  グループ チャット、または Lync Server 2013、 常設チャット サーバーのサービスをシャットダウンします。すべてのサービスを停止する必要があるため、これは十分なダウンタイムが確保できるときに行うように計画してください。また、前に説明したとおり、現在の グループ チャット データベースを必ずバックアップします。

2.  Windows PowerShell**Export-CsPersistentChatData** コマンドレットを RBAC 役割の 常設チャット管理者 (CsPersistentChatAdministrator) のメンバーとして実行します。エクスポート/インポート コマンドレットについての詳細は、「[Lync Server 2013 での Windows PowerShell コマンドレットを使用した常設チャット サーバー構成のトラブルシューティング](lync-server-2013-troubleshooting-persistent-chat-server-configuration-using-windows-powershell-cmdlets.md)」を参照してください。
    
    エクスポートされた内容を検査します。

3.  インポートの準備の前に、 Lync Server 2013、 常設チャット サーバーのサービスをシャットダウンします。すべてのサービスを停止する必要があるため、これは十分なダウンタイムが確保できるときに行うように計画してください。

4.  移行の前に、 Lync Server 2013 展開でカテゴリ、ルーム、またはアドインを作成した場合は、 常設チャット データベースのバックアップを実行します。エクスポート/インポート プロセスは旧データを Lync Server 2013 展開にマージすることができますが、予期しない上書きが発生したとき (名前の競合が発生してしまった場合など) のためにデータベースをバックアップしておくことをお勧めします。

5.  Windows PowerShell**Import-CsPersistentChatData** コマンドレット (インポート ツール) を **WhatIf** コマンドを付けて実行し、 常設チャット サーバー プールの バック エンド サーバーに移行データを投入してみます。この処理では、簡略化された管理モデルに対応するためにいくつかの変換が行われます。エラーや警告が表示された場合はそれらを修正します。

6.  常設チャット サーバーの Windows PowerShell**Import-CsPersistentChatData** コマンドレットを、RBAC 役割の 常設チャット管理者 (CsPersistentChatAdministrator) のメンバーとして実行します。エクスポート/インポート コマンドレットについての詳細は、「[Lync Server 2013 での Windows PowerShell コマンドレットを使用した常設チャット サーバー構成のトラブルシューティング](lync-server-2013-troubleshooting-persistent-chat-server-configuration-using-windows-powershell-cmdlets.md)」を参照してください。

7.  アップロードされたファイルのすべて (フォルダー全体) を新しい Lync Server 2013、 常設チャットのファイル ストアにコピー (XCOPY) する必要があります。
    

    > [!IMPORTANT]
    > Lync 2013 (クライアント) はチャット ルームでのファイルのアップロードまたは表示をサポートしていません。旧クライアントを使用すれば、引き続きルームでファイルを投稿したり表示したりすることができます。



8.  Lync Server 2010、グループ チャット、または Office Communications Server 2007 R2  グループ チャット検索サーバー URI を Lync Server 2013、 常設チャット サーバーの連絡先オブジェクトに移植します。 Lync 2010 グループ チャットまたは Office Communicator 2007 R2  グループ チャットのクライアントが、移行後にクライアント側での構成変更を一切行わずに最新の Lync 2013、 常設チャット (クライアント) に接続する必要がある場合は、以下の手順が必須です。
    
      - ocschat@*\<domainName\>*.com という検索サーバー ユーザー アカウントを削除します。これは、Lync Server 2010、グループ チャットの検索サーバーを指すために使用されていました。後でプールをアンインストールし、信頼済みエントリを削除することができます。
    
      - 以前のエンドポイント ( 常設チャット サーバーの連絡先オブジェクト) を、同じ SIP URI を使って Windows PowerShell コマンドレット **New-CsPersistentChatEndpoint** を実行して作成します。これにより、サービスが再開したときに旧クライアントが正常に機能します。
    
    必須の移行プロセスはここまでで完了です。これで、 Lync 2010 グループ チャット (クライアント) または Office Communicator 2007 R2グループ チャット (クライアント) は新しい 常設チャット サーバー プールに透過的に接続できます。
    
    この他に追加として、 Lync Server 2010、グループ チャットまたは Office Communications Server 2007 R2グループ チャットを廃止する以下の手順を行います。

9.  新しい 常設チャット サーバー プールのすべてのコンピューターの電源を入れ、 常設チャット サーバーのサービスを開始します。

10. Lync Server コントロール パネルおよび Windows PowerShell コマンドレットを使用してデータが正常に移行されたことを確認します。

11. Lync 2010 グループ チャットまたは Office Communicator 2007 R2グループ チャットを グループ チャット サーバー プールのコンピューターからアンインストールします。

12. 信頼されたアプリケーションおよび信頼されたアプリケーション プールを Windows PowerShell コマンドレットを使用して削除します。この処理は、対象のアイテムを 中央管理ストアから削除し、関連付けられている信頼済みサービス エントリ (TSE) を Active Directory から削除します。またこの手順は、 トポロジ ビルダーを使用しても実行できます (ここにも、信頼されたアプリケーション/プールの専用ノードがあります)。

13. これで、新しいクライアントから 常設チャット サーバーの機能を有効にすることができます。 常設チャット サーバーの有効化についての詳細は、「[Lync Server 2013 での常設チャット サーバーの展開](lync-server-2013-deploying-persistent-chat-server.md)」を参照してください。
    

    > [!IMPORTANT]
    > Lync Server 2013 では複数の 常設チャット サーバー プールがサポートされます。ただし、サポートされる移行は、1 つの Lync 2010 グループ チャットまたは Office Communications Server 2007 R2&nbsp; グループ チャット プールから 1 つの Lync Server 2013、 常設チャット サーバー プールへの移行です。規制のニーズ (たとえば、データを特定の場所内に保持するなど) を満たすために、新しい 常設チャット サーバー プールを展開に追加することができます。


