---
title: 'Lync Server 2013: 常設チャット サーバーのフェールオーバー'
TOCTitle: 常設チャット サーバーのフェールオーバー
ms:assetid: 2cd79ffd-fee6-44ce-96cf-b98bf25e2690
ms:mtpsurl: https://technet.microsoft.com/ja-jp/library/JJ204772(v=OCS.15)
ms:contentKeyID: 48271548
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Lync Server 2013 での常設チャット サーバーのフェールオーバー

 

_**トピックの最終更新日:** 2014-02-05_

常設チャット サーバーのフェールオーバーは、主に手動プロセスとして設計されています。

フェールオーバー手順は、セカンダリのデータ センターが稼働しているが、プライマリの 常設チャット データベースが配置されている 常設チャット サーバー サービスが完全に利用できなくなったと仮定して説明します。たとえば、次のような状況を想定しています。

  - 常設チャット サーバー プライマリ データベースおよび 常設チャット サーバー ミラー データベースが停止している。

  - Lync Serverフロント エンド サーバーが停止している。

操作は 2 つの基本手順に基づいて行われます。

  - プライマリ 常設チャット データベース (mgc) を回復する。

  - 新しいプライマリ データベースのミラーリングを確立する。

常設チャットのコンプライアンス データベース (mgccomp) はフェールオーバーされません。このデータベースの内容は一時的なものであり、コンプライアンス アダプターがデータを処理するときに削除されます。データ損失を回避するためには、常設チャット管理者がアダプター出力を適切に管理する必要があります。

## 常設チャット サーバーをフェールオーバーするには

1.  常設チャット サーバーのバックアップ ログ配布データベースからログ配布を削除します。
    
    1.  SQL Server Management Studio を使用して、常設チャット サーバーのバックアップ mgc データベースが配置されているデータベース インスタンスに接続します。
    
    2.  マスター データベースに対するクエリ ウィンドウを開きます。
    
    3.  次のコマンドを使用して、ログ配布を削除します。
        
            exec sp_delete_log_shipping_secondary_database mgc

2.  バックアップ共有から、バックアップ サーバーのコピー先フォルダーへ、コピーしていないバックアップ ファイルをコピーします。

3.  セカンダリ データベースに、適用していないトランザクション ログ バックアップを順番に適用します。詳細については、「トランザクション ログのバックアップの復元 (Transact-SQL)」(http://go.microsoft.com/fwlink/?linkid=247428\&clcid=0x411) を参照してください。

4.  バックアップ mgc データベースをオンラインにします。手順 1b. で開いたクエリ ウィンドウを使用して、次の手順を実行します。
    
    1.  mgc データベースへのすべての接続を終了します (接続がある場合)。
        
        1.  **exec sp\_who2** を実行して、mgc データベースへの接続を識別します。
        
        2.  **kill \<spid\>** を実行して、これらの接続を切断します。
    
    2.  データベースをオンラインにします。
        
        1.  **restore database mgc with recovery** を実行します。

5.  Lync Server 管理シェルでコマンド **Set-CsPersistentChatState -Identity "service:atl-cs-001.litwareinc.com" –PoolState FailedOver** を使用すると、mgc バックアップ データベースにフェールオーバーできます。atl-cs-001.litwareinc.com の部分には、常設チャット プールの完全修飾ドメイン名を指定します。
    
    mgc バックアップ データベースがプライマリ データベースとして動作するようになります。

6.  プライマリ データベースとして動作しているバックアップ データベースに対して高可用性のミラーを確立するには、Lync Server 管理シェルで **Install-CsMirrorDatabase** コマンドレットを使用します。バックアップ データベース インスタンスをプライマリ データベースとして使用し、バックアップ ミラー データベース インスタンスをミラー インスタンスとして使用します。これは、セットアップ時にプライマリ データベースに対して最初に構成したミラーと同じものではありません。詳細については、「[Lync Server 2013 でのバックエンド サーバーの高可用性を実現するための SQL ミラーリングの展開](lync-server-2013-deploying-sql-mirroring-for-back-end-server-high-availability.md)」の「Lync Server 管理シェル コマンドレットを使用した SQL ミラーリングの設定」を参照してください。

7.  常設チャット サーバーのアクティブ サーバーを設定します。Lync Server コマンド シェルから **Set-CsPersistentChatActiveServer** コマンドレットを使用して、アクティブ サーバーの一覧を設定します。
    

    > [!IMPORTANT]
    > すべてのアクティブ サーバーは、新しいプライマリ データベースと同じデータ センター内、またはデータベースへの接続が低待機時間/高帯域幅であるデータ センター内に配置する必要があります。

    
    この時点で、常設チャット サーバー プライマリ データベースから 常設チャット サーバー バックアップ データベースへのフェールオーバーは完了です。

