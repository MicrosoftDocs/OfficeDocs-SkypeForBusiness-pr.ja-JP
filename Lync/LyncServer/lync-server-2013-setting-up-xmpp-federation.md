---
title: 'Lync Server 2013: XMPP フェデレーションのセットアップ'
TOCTitle: XMPP フェデレーションのセットアップ
ms:assetid: 5fda6cb7-8d4d-495d-90c7-601f1036e085
ms:mtpsurl: https://technet.microsoft.com/ja-jp/library/JJ204939(v=OCS.15)
ms:contentKeyID: 48272286
ms.date: 05/19/2016
mtps_version: v=OCS.15
ms.translationtype: HT
---

# Lync Server 2013 XMPP フェデレーションのセットアップ

 

_**トピックの最終更新日:** 2012-12-03_

XMPP プロキシをエッジ サーバーに展開するには、エッジ サーバーを XMPP フェデレーション用に構成する必要があります。これを行うには、以下の手順を実行します。

## XMPP フェデレーションのセットアップ

1.  Lync Server 展開ウィザードがインストールされているコンピューターに、Domain Admins グループおよび RTCUniversalServerAdmins グループのメンバーとしてログオンします。

2.  フロントエンド サーバーで、Lync Server 展開ウィザードを開きます。\[Lync Server システムのインストールまたは更新\] をクリックして、\[Lync Server コンポーネントのセットアップまたは削除\] をクリックします。\[再実行\] をクリックします。

3.  \[Lync Server コンポーネントのセットアップ\] で、\[次へ\] をクリックします。概要画面に、実行された処理が表示されます。展開が完了したら、\[ログの表示\] をクリックして、利用可能なログ ファイルを表示します。\[完了\] をクリックして、展開を完了します。

4.  エッジ サーバーで、Lync Server 展開ウィザードを開きます。\[Lync Server システムのインストールまたは更新\] をクリックして、\[Lync Server コンポーネントのセットアップまたは削除\] をクリックします。\[再実行\] をクリックします。

5.  \[Lync Server コンポーネントのセットアップ\] で、\[次へ\] をクリックします。概要画面に、実行された処理が表示されます。展開が完了したら、\[ログの表示\] をクリックして、利用可能なログ ファイルを表示します。\[完了\] をクリックして、展開を完了します。

6.  エッジ サーバーで、展開ウィザードの \[手順 3: 証明書の要求、インストール、または割り当て\] の横にある \[再実行\] をクリックします。
    

    > [!TIP]
    > エッジ サーバーを初めて展開する場合は、[再実行] ではなく [実行] と表示されます。



7.  \[利用可能な証明書タスク\] ページで、\[新しい証明書要求を作成する\] をクリックします。

8.  \[証明書の要求\] ページで、\[外部エッジ証明書\] をクリックします。

9.  \[証明書要求の送信方法\] ページで、\[要求を準備して後で送信する\] チェック ボックスをオンにします。

10. \[証明書要求ファイル\] ページで、要求を保存するファイルの完全なパスと名前を入力します (c:\\cert\_exernal\_edge.cer など)。

11. \[別の証明書テンプレートの指定\] ページで、既定の WebServer テンプレート以外のテンプレートを使用するには、\[選択した証明機関に別の証明書テンプレートを使用する\] チェック ボックスをオンにします。

12. \[名前およびセキュリティの設定\] ページで、次の操作を行います。
    
    1.  \[フレンドリ名\] に、証明書の表示名を入力します。
    
    2.  \[ビット長\] で、ビット長を指定します (通常は既定値の 2048)。
    
    3.  \[証明書の秘密キーをエクスポート可能としてマークする\] チェック ボックスがオンになっていることを確認します。

13. \[組織情報\] ページで、組織の名前と組織単位 (部、課など) を入力します。

14. \[地理情報\] ページで、場所情報を指定します。

15. \[サブジェクト名/サブジェクト代替名\] ページに、ウィザードによって自動的に設定される情報が表示されます。追加のサブジェクト代替名が必要な場合は、次の 2 つの手順でこれを指定します。

16. \[サブジェクト代替名 (SAN) の SIP ドメイン設定\] ページで、ドメインのチェック ボックスをオンにして、サブジェクトの別名の一覧に sip. \<SIP ドメイン\> エントリを追加します。

17. \[追加のサブジェクト代替名の構成\] ページで、必要な追加のサブジェクトの別名を指定します。
    

    > [!TIP]
    > XMPP プロキシがインストールされている場合は、既定でドメイン名 (contoso.com など) が SAN エントリに設定されています。別のエントリが必要な場合は、この手順で追加します。



18. \[要求の概要\] ページで、要求を生成するために使用する証明書情報を確認します。

19. コマンドの実行が完了したら、ログを表示するか、または \[次へ\] をクリックして続行します。

20. \[証明書要求ファイル\] ページで、\[表示\] をクリックして生成済みの証明書の署名要求 (CSR) ファイルを表示するか、または \[完了\] をクリックして証明書ウィザードを終了します。

21. 要求ファイルをコピーして、公的証明機関に送信します。

22. パブリック証明書の受信、インポート、および割り当てを行った後、エッジ サーバー サービスを停止して再起動する必要があります。これは、Lync Server 管理コンソールで次のコマンドを入力して行います。
    
        Stop-CsWindowsService

       &nbsp;
    
        Start-CsWindowsService

23. XMPP フェデレーション用に DNS を構成するには、外部 DNS に "\_xmpp-server.\_tcp.\<ドメイン名\>" という SRV レコードを追加します。この SRV レコードは、エッジ サーバーのアクセス エッジ FQDN に解決されます。ポート値は 5269 です。さらに、アクセス エッジ サーバーの IP アドレスを指す "A" ホスト レコード (たとえば、xmpp.contoso.com) を構成します。
    

    > [!IMPORTANT]
    > 複数のサイトにエッジ プールがある場合は、XMPP フェデレーション用に複数の SRV レコードを追加することをお勧めします。組織内のすべてのエッジ プールの SRV レコードを追加し、それらの SRV レコードそれぞれに異なる優先順位を指定します。すべてのエッジ プールが実行中の場合、XMPP 要求は第 1 優先順位のエッジ プールによってすべて処理されますが、そのエッジ プールがダウンした場合、XMPP フェデレーション機能を回復するために新しい SRV レコードを追加する必要はありません。



24. フロントエンドで Lync Server 管理シェルを開き、次のコマンドを入力することによって、すべてのユーザーを有効にする新しい外部アクセス ポリシーを構成します。
    
        New-CsExternalAccessPolicy -Identity <name of policy to create.  If site scope, prepend with 'site:'> -EnableFederationAcces $true -EnablePublicCloudAccess $true

       &nbsp;
    
        New-CsExternalAccessPolicy -Identity FedPic -EnableFederationAcces $true -EnablePublicCloudAccess $true

       &nbsp;
    
        Get-CsUser | Grant-CsExternalAccessPolicy -PolicyName FedPic
    
    次のように入力して、外部ユーザーの XMPP アクセスを有効にします。
    
        Set-CsExternalAccessPolicy -Identity <name of the policy being used> EnableXmppAccess $true

       &nbsp;
    
        Set-CsExternalAccessPolicy -Identity FedPic -EnableXmppAccess $true

25. XMPP プロキシが展開されている エッジ サーバーで、コマンド プロンプトまたは Windows PowerShell™ コマンドライン インターフェイスを開き、次のように入力します。
    
        Netstat -ano | findstr 5269

       &nbsp;
    
        Netstat -ano | findstr 23456
    
    コマンド **netstat –ano** はネットワーク統計コマンドで、パラメーター **–ano** は、netstat にすべての接続およびリッスン ポートが表示されること、アドレスとポートが数値形式で表示されること、および所有プロセス ID が各接続に関連付けられていることを要求します。文字 **|** は次のコマンド **findstr**、つまり文字列の検索へのパイプを定義します。findstr にパラメーターとして渡される数値 5269 と 23456 は、netstart の出力で文字列 5269 と 23456 を検索するよう findstr に指示します。XMPP が正しく構成されている場合、コマンドの結果によって エッジ サーバーの外部 (ポート 5269) と内部 (ポート 23456) 両方のインターフェイスでリッスンが実行されて接続が確立されます。
    
    コマンドで、5269 および 23456 の確立されたポートまたはリッスン ポートが返されない場合は、次のことを確認します。

## XMPP フェデレーションのトラブルシューティング

1.  XMPP プロキシが実行されているかどうかを確認するには、次の手順に従います。

2.  ローカル管理者のグループのメンバーとして、XMPP プロキシ サービスを実行しているエッジ サーバーにログオンします。

3.  \[**スタート**\] をクリックし、\[**すべてのプログラム**\]、\[**管理ツール**\] をクリックし、\[**サービス**\] をクリックします。

4.  \[サービス\] で、Lync Server XMPP 翻訳ゲートウェイ プロキシを探します。サービスは \[**開始**\] 状態である必要があります。開始していない場合は、ツール バーの \[**開始**\] アイコンをクリックします。アイコンは、緑色の右向き矢印として表示されます。

5.  サービスが \[**開始**\] に変更されたことを確認します。正常に開始された場合は、\[**サービス**\] を終了して続行します。
    
    サービスが正常に開始しなかった場合は、\[管理ツール\] から \[イベント ビューアー\] を開き、\[**アプリケーションとサービス ログ**\] の \[**Lync Server**\] 部分でエラーと警告を参照します。

6.  **Lync Server XMPP 翻訳ゲートウェイ** サービスが実行されたら、前に使用した netstat コマンドを再確認します。確立されたセッションまたはリッスンしているセッションが表示されない場合は、トポロジ ビルダーで **XMPP フェデレーション ルート**が正しく構成されていることを確認します。

7.  トポロジ ビルダーがインストールされているコンピューターに、Domain Admins グループおよび RTCUniversalServerAdmins グループのメンバーとしてログオンします。

8.  トポロジ ビルダーを以下の手順で起動します。\[**スタート**\]、\[**すべてのプログラム**\]、\[**Microsoft Lync Server 2013**\]、\[**Lync Server トポロジ ビルダー**\] の順にクリックします。

9.  トポロジ ビルダーで、XMPP フェデレーション ルートのサイトを選択し、\[**XMPP フェデレーション**\] の \[**サイトのフェデレーション ルートの割り当て**\] に エッジ サーバーまたは エッジ プールが選択した XMPP フェデレーション ルート割り当てとして表示されていることを確認します。
    
    ルート割り当てが正しくないか設定されていない場合は、サイトを右クリックし、\[**プロパティの編集**\] をクリックします。XMPP フェデレーションのチェック ボックスをオンにし、適切な エッジ サーバーまたは エッジ プールを選択します。

10. トポロジを公開します。詳細については、「[Lync Server 2013 でのトポロジの公開](lync-server-2013-publish-your-topology.md)」を参照してください。
    

    > [!TIP]
    > 必須ではなく通常は不要ですが、エッジ サーバーの再起動が必要な場合があります。



11. 前に使用した netstat プロセスを使用して、エッジ サーバーがポート 5269 とポート 23456 でリッスンしているか、セッションを確立したことを確認します。

12. 必要なセッションがまだ表示されない場合は、イベント ビューアーで、通信の問題について考えられる原因を確認します。

## 関連項目

#### タスク

[Lync Server 2013 での XMPP 構成の例 - Google Talk との XMPP フェデレーション](lync-server-2013-example-xmpp-configuration-–-xmpp-federation-with-google-talk.md)  

#### その他のリソース

[Lync Server 2013 での組織の XMPP フェデレーション パートナーの管理](lync-server-2013-manage-xmpp-federated-partners-for-your-organization.md)

