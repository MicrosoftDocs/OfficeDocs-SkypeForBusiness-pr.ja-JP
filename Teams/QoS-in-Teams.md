---
title: Microsoft Teams でサービスの品質 (QoS) を実施する
author: LolaJacobsen
ms.author: lolaj
manager: Serdars
ms.topic: article
ms.service: msteams
ms.reviewer: vkorlep, siunies
audience: admin
description: Microsoft Teams でサービスの品質 (QoS) のために組織のネットワークを準備する方法について説明します。
localization_priority: Normal
search.appverid: MET150
f1.keywords:
- CSH
ms.custom:
- ms.teamsadmincenter.meetingsettings.qos
- ms.teamsadmincenter.meetingsettings.network.qosmarkers
- seo-marvel-apr2020
ms.collection:
- M365-collaboration
appliesto:
- Microsoft Teams
ms.openlocfilehash: ef2fca810a7125c4150ff4de2c3eea8fd7970d2e
ms.sourcegitcommit: 90939ad992e65f840e4c2e7a6d18d821621319b4
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/09/2020
ms.locfileid: "45085283"
---
# <a name="implement-quality-of-service-qos-in-microsoft-teams"></a><span data-ttu-id="210f9-103">Microsoft Teams でサービスの品質 (QoS) を実装する</span><span class="sxs-lookup"><span data-stu-id="210f9-103">Implement Quality of Service (QoS) in Microsoft Teams</span></span>

<span data-ttu-id="210f9-104">Microsoft Teams の QoS (Quality of Service) を使うと、ネットワークの遅延 (音声やビデオのストリームなど) に影響を受けやすいリアルタイムのネットワークトラフィックを、重要度の低いトラフィック (ダウンロードした新しいアプリをダウンロードするなど) にすることができます (追加では大きな問題はありません)。</span><span class="sxs-lookup"><span data-stu-id="210f9-104">Quality of Service (QoS) in Microsoft Teams is a way to allow real-time network traffic that is sensitive to network delays (for example, voice or video streams) to "cut in line" in front of traffic that is less sensitive (like downloading a new app, where an extra second to download isn't a big deal).</span></span> <span data-ttu-id="210f9-105">QoS は、リアルタイムストリーム内のすべてのパケット (Windows グループポリシーオブジェクトと、ポートベースのアクセス制御リストと呼ばれるルーティング機能を使用します) を識別してマークします。これにより、ネットワークでは、音声、ビデオ、スクリーン共有がネットワーク帯域幅の専用部分を提供します。</span><span class="sxs-lookup"><span data-stu-id="210f9-105">QoS identifies and marks all packets in real-time streams (using Windows Group Policy Objects and a routing feature called Port-based Access Control Lists, more about those is below) which then helps your network to give voice, video, and screen share streams a dedicated portion of network bandwidth.</span></span>

<span data-ttu-id="210f9-106">大規模なユーザーグループをサポートしていて、次に説明するいずれかの問題が発生している場合は、おそらく QoS を実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="210f9-106">If you're supporting a large group of users and they're experiencing any of the problems described below, you probably need to implement QoS.</span></span> <span data-ttu-id="210f9-107">ユーザー数の少ない小規模企業は、QoS を必要としない場合もありますが、役に立ちます。</span><span class="sxs-lookup"><span data-stu-id="210f9-107">A small business with few users may not need QoS, but even there it should be helpful.</span></span>

<span data-ttu-id="210f9-108">QoS の形式がないと、音声とビデオで次の品質の問題が発生する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="210f9-108">Without some form of QoS, you might see the following quality issues in voice and video:</span></span>

- <span data-ttu-id="210f9-109">ジッター–さまざまな料金で受信するメディアパケット。通話に単語または音節が含まれていない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="210f9-109">Jitter – media packets arriving at different rates, which can result in missing words or syllables in calls</span></span>
- <span data-ttu-id="210f9-110">パケット損失–パケットが破棄されると、音声品質が低下し、音声認識が困難になることもあります。</span><span class="sxs-lookup"><span data-stu-id="210f9-110">Packet loss – packets dropped, which can also result in lower voice quality and hard to understand speech</span></span>
- <span data-ttu-id="210f9-111">遅延ラウンドトリップ時間 (RTT) –移動先へのアクセスに時間がかかるメディアパケットによって、会話中に2当事者間で顕著な遅延が発生し、ユーザーが互いに話すことができるようになります。</span><span class="sxs-lookup"><span data-stu-id="210f9-111">Delayed round trip time (RTT) – media packets taking a long time to reach their destinations, which results in noticeable delays between two parties in a conversation, causing people to talk over each other</span></span>

<span data-ttu-id="210f9-112">これらの問題に対処するための最も複雑な方法は、内部とインターネットの両方でデータ接続のサイズを大きくすることです。</span><span class="sxs-lookup"><span data-stu-id="210f9-112">The least complex way to address these issues is to increase the size of the data connections, both internally and out to the internet.</span></span> <span data-ttu-id="210f9-113">多くの場合、費用がかかる場合があるため、QoS は帯域幅を追加する代わりに、使用しているリソースをより効果的に管理する手段となります。</span><span class="sxs-lookup"><span data-stu-id="210f9-113">Since that is often cost-prohibitive, QoS provides a way to more effectively manage the resources you have instead of adding bandwidth.</span></span> <span data-ttu-id="210f9-114">品質の問題を解決するには、最初に QoS を使用し、必要に応じて帯域幅のみを追加することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="210f9-114">To address quality issues, we recommend that you first use QoS, then add bandwidth only where necessary.</span></span>

<span data-ttu-id="210f9-115">Qos を有効にするために、qos の優先順位をサポートしていないパスの部分は、通話、ビデオ、画面共有の品質を低下させる可能性があるため、組織全体で一貫した QoS 設定を適用します。</span><span class="sxs-lookup"><span data-stu-id="210f9-115">For QoS to be effective, you'll apply consistent QoS settings throughout your organization, because any part of the path that fails to support your QoS priorities can degrade the quality of calls, video, and screen sharing.</span></span> <span data-ttu-id="210f9-116">これには、すべてのユーザーの Pc またはデバイス、ネットワークスイッチ、インターネットへのルーター、および Teams サービスへの設定の適用が含まれます。</span><span class="sxs-lookup"><span data-stu-id="210f9-116">This includes applying settings to all user PCs or devices, network switches, routers to the internet, and the Teams service.</span></span>

<span data-ttu-id="210f9-117">_図1組織のネットワークと Microsoft 365 または Office 365 サービスの間の関係_</span><span class="sxs-lookup"><span data-stu-id="210f9-117">_Figure 1. The relationship between an organization's networks and Microsoft 365 or Office 365 services_</span></span>

<span data-ttu-id="210f9-118">![ネットワークとサービス間の関係を示す図](media/Qos-in-Teams-Image1.png "組織のネットワークと Microsoft 365 または Office 365 サービスの間の関係: オンプレミスのネットワークとデバイスは、相互接続ネットワークに接続されます。これは、Microsoft 365 または Office 365 クラウドの音声と電話会議サービスに接続します。")</span><span class="sxs-lookup"><span data-stu-id="210f9-118">![Illustration of the relationship between networks and services](media/Qos-in-Teams-Image1.png "The relationship between an organization's networks and Microsoft 365 or Office 365 services: on-premises network and devices connect with an interconnect network, which in turn connects with Microsoft 365 or Office 365 Cloud Voice and Audio Conferencing services.")</span></span>

## <a name="qos-implementation-checklist"></a><span data-ttu-id="210f9-119">QoS の実装のチェックリスト</span><span class="sxs-lookup"><span data-stu-id="210f9-119">QoS implementation checklist</span></span>

<span data-ttu-id="210f9-120">高レベルでは、次の操作を実行して QoS を実装します。</span><span class="sxs-lookup"><span data-stu-id="210f9-120">At a high level, do the following to implement QoS:</span></span>

1. [<span data-ttu-id="210f9-121">ネットワークの準備ができていることを確認する</span><span class="sxs-lookup"><span data-stu-id="210f9-121">Make sure your network is ready</span></span>](#make-sure-your-network-is-ready)

1. [<span data-ttu-id="210f9-122">QoS の実装方法を選択する</span><span class="sxs-lookup"><span data-stu-id="210f9-122">Select a QoS implementation method</span></span>](#select-a-qos-implementation-method)

1. [<span data-ttu-id="210f9-123">各メディアの種類の初期ポート範囲を選ぶ</span><span class="sxs-lookup"><span data-stu-id="210f9-123">Choose initial port ranges for each media type</span></span>](#choose-initial-port-ranges-for-each-media-type)

1. <span data-ttu-id="210f9-124">QoS 設定を実装します。</span><span class="sxs-lookup"><span data-stu-id="210f9-124">Implement QoS settings:</span></span>
   1. <span data-ttu-id="210f9-125">GPO を使って[クライアントデバイスのポート範囲とマークを設定](QoS-in-Teams-clients.md)するクライアント</span><span class="sxs-lookup"><span data-stu-id="210f9-125">On clients using a GPO to [set client device port ranges and markings](QoS-in-Teams-clients.md)</span></span>
   2. <span data-ttu-id="210f9-126">ルーター (製造元のマニュアルを参照)、または他のネットワークデバイスを参照してください。</span><span class="sxs-lookup"><span data-stu-id="210f9-126">On routers (see the manufacturer documentation) or other network devices.</span></span> <span data-ttu-id="210f9-127">これには、ポートベースの Acl が含まれている場合や、QoS キューと DSCP マーキングのいずれかを定義している場合があります。</span><span class="sxs-lookup"><span data-stu-id="210f9-127">This may include port-based ACLs or simply defining the QoS queues and DSCP markings, or all of these.</span></span>

      > [!IMPORTANT]
      > <span data-ttu-id="210f9-128">これらの QoS ポリシーは、クライアントソースポートと、発信元と送信先の IP アドレスを "any" として実装することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="210f9-128">We recommend implementing these QoS policies using the client source ports and a source and destination IP address of “any.”</span></span> <span data-ttu-id="210f9-129">これにより、内部ネットワーク上の受信および送信メディアの両方のトラフィックがキャッチされます。</span><span class="sxs-lookup"><span data-stu-id="210f9-129">This will catch both incoming and outgoing media traffic on the internal network.</span></span>  

   3. [<span data-ttu-id="210f9-130">Teams 会議でメディアトラフィックを処理する方法を設定する</span><span class="sxs-lookup"><span data-stu-id="210f9-130">Set how you want to handle media traffic for Teams meetings</span></span>](meeting-settings-in-teams.md#set-how-you-want-to-handle-real-time-media-traffic-for-teams-meetings)

5. <span data-ttu-id="210f9-131">ネットワーク上のチームトラフィックを分析して、 [QoS の実装を検証](#validate-your-qos-implementation)します。</span><span class="sxs-lookup"><span data-stu-id="210f9-131">[Validate your QoS implementation](#validate-your-qos-implementation) by analyzing Teams traffic on the network.</span></span>

<span data-ttu-id="210f9-132">QoS を実装する準備ができたら、次のガイドラインを念頭に置いてください。</span><span class="sxs-lookup"><span data-stu-id="210f9-132">As you prepare to implement QoS, keep the following guidelines in mind:</span></span>

- <span data-ttu-id="210f9-133">Microsoft 365 への最短パス</span><span class="sxs-lookup"><span data-stu-id="210f9-133">The shortest path to Microsoft 365 is best</span></span>
- <span data-ttu-id="210f9-134">ポートを閉じると音質が低下する</span><span class="sxs-lookup"><span data-stu-id="210f9-134">Closing ports will only lead to quality degradation</span></span>
- <span data-ttu-id="210f9-135">プロキシなどの障害物はお勧めしません。</span><span class="sxs-lookup"><span data-stu-id="210f9-135">Any obstacles in between, such as proxies, aren't recommended</span></span>
- <span data-ttu-id="210f9-136">ホップ数を制限します。</span><span class="sxs-lookup"><span data-stu-id="210f9-136">Limit the number of hops:</span></span>
  - <span data-ttu-id="210f9-137">クライアントからネットワークエッジへ-3 ~ 5 ホップ</span><span class="sxs-lookup"><span data-stu-id="210f9-137">Client to network edge – 3 to 5 hops</span></span>
  - <span data-ttu-id="210f9-138">ISP から Microsoft ネットワークエッジ–3ホップ</span><span class="sxs-lookup"><span data-stu-id="210f9-138">ISP to Microsoft network edge – 3 hops</span></span>
  - <span data-ttu-id="210f9-139">Microsoft ネットワークエッジから最終的な送信先への関連性がない</span><span class="sxs-lookup"><span data-stu-id="210f9-139">Microsoft network edge to final destination – irrelevant</span></span>

<span data-ttu-id="210f9-140">ファイアウォールのポートを構成する方法については、「 [Office 365 の URL と IP 範囲](office-365-urls-ip-address-ranges.md)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="210f9-140">For information about configuring firewall ports, go to [Office 365 URLs and IP ranges](office-365-urls-ip-address-ranges.md).</span></span>


## <a name="make-sure-your-network-is-ready"></a><span data-ttu-id="210f9-141">ネットワークの準備ができていることを確認する</span><span class="sxs-lookup"><span data-stu-id="210f9-141">Make sure your network is ready</span></span>

<span data-ttu-id="210f9-142">QoS の実装を検討している場合は、帯域幅要件とその他の[ネットワーク要件](prepare-network.md)を既に決定しておく必要があります。</span><span class="sxs-lookup"><span data-stu-id="210f9-142">If you're considering a QoS implementation, you should already have determined your bandwidth requirements and other [network requirements](prepare-network.md).</span></span> 
  
<span data-ttu-id="210f9-143">ネットワーク全体でのトラフィック渋滞は、メディアの品質に大きく影響します。</span><span class="sxs-lookup"><span data-stu-id="210f9-143">Traffic congestion across a network will greatly impact media quality.</span></span> <span data-ttu-id="210f9-144">帯域幅の不足は、パフォーマンスの低下を招き、ユーザーエクスペリエンスが低下します。</span><span class="sxs-lookup"><span data-stu-id="210f9-144">A lack of bandwidth leads to performance degradation and a poor user experience.</span></span> <span data-ttu-id="210f9-145">Teams の導入と使用量が増加するにつれて、レポート作成、[ユーザーごとの通話分析](use-call-analytics-to-troubleshoot-poor-call-quality.md)、[通話品質ダッシュボード (CQD)](turning-on-and-using-call-quality-dashboard.md)を使用して問題を特定し、QoS と選択的な帯域幅の追加機能を使って調整を行います。</span><span class="sxs-lookup"><span data-stu-id="210f9-145">As Teams adoption and usage grows, use reporting, [per-user call analytics](use-call-analytics-to-troubleshoot-poor-call-quality.md), and [Call Quality Dashboard (CQD)](turning-on-and-using-call-quality-dashboard.md) to identify problems and then make adjustments using QoS and selective bandwidth additions.</span></span>

### <a name="vpn-considerations"></a><span data-ttu-id="210f9-146">VPN に関する考慮事項</span><span class="sxs-lookup"><span data-stu-id="210f9-146">VPN considerations</span></span>

<span data-ttu-id="210f9-147">QoS は、呼び出し元間のすべてのリンクに実装されている場合にのみ動作します。</span><span class="sxs-lookup"><span data-stu-id="210f9-147">QoS only works as expected when implemented on all links between callers.</span></span> <span data-ttu-id="210f9-148">内部ネットワークで QoS を使用していて、ユーザーが遠隔地からサインインしている場合は、内部の管理されたネットワーク内でのみ優先順位を付けることができます。</span><span class="sxs-lookup"><span data-stu-id="210f9-148">If you use QoS on an internal network and a user signs in from a remote location, you can only prioritize within your internal, managed network.</span></span> <span data-ttu-id="210f9-149">リモートの場所は仮想プライベートネットワーク (VPN) を実装することによって管理された接続を受け取ることができますが、VPN の本質的にはパケットのオーバーヘッドが追加され、リアルタイムトラフィックで遅延が発生します。</span><span class="sxs-lookup"><span data-stu-id="210f9-149">Although remote locations can receive a managed connection by implementing a virtual private network (VPN),  a VPN inherently adds packet overhead and creates delays in real-time traffic.</span></span> <span data-ttu-id="210f9-150">VPN 経由のリアルタイム通信トラフィックを実行しないようにすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="210f9-150">We  recommend that you avoid running real-time communications traffic over a VPN.</span></span>

<span data-ttu-id="210f9-151">世界中の管理されたリンクを含むグローバル組織では、これらのリンクの帯域幅が LAN と比較して制限されているため、QoS を強くお勧めします。</span><span class="sxs-lookup"><span data-stu-id="210f9-151">In a global organization with managed links that span continents, we strongly recommend QoS because bandwidth for those links is limited in comparison to the LAN.</span></span>

## <a name="introduction-to-qos-queues"></a><span data-ttu-id="210f9-152">QoS キューの概要</span><span class="sxs-lookup"><span data-stu-id="210f9-152">Introduction to QoS queues</span></span>

<span data-ttu-id="210f9-153">QoS を提供するには、ネットワークデバイスがトラフィックを分類するための手段を持っている必要があります。また、音声やビデオを他のネットワークトラフィックと区別できなければなりません。</span><span class="sxs-lookup"><span data-stu-id="210f9-153">To provide QoS, network devices must have a way to classify traffic and must be able to distinguish voice or video from other network traffic.</span></span>

<span data-ttu-id="210f9-154">ネットワークトラフィックがルーターに入ったら、トラフィックはキューに入れられます。</span><span class="sxs-lookup"><span data-stu-id="210f9-154">When network traffic enters a router, the traffic is placed into a queue.</span></span> <span data-ttu-id="210f9-155">QoS ポリシーが構成されていない場合は、1つのキューしかありません。すべてのデータは、同じ優先度で最初のデータとして扱われます。</span><span class="sxs-lookup"><span data-stu-id="210f9-155">If a QoS policy isn't configured, there is only one queue, and all data is treated as first-in, first-out with the same priority.</span></span> <span data-ttu-id="210f9-156">つまり、ボイストラフィック (遅延に非常に敏感) は、わずか数秒の遅延が問題となるトラフィックが遅れている可能性があります。</span><span class="sxs-lookup"><span data-stu-id="210f9-156">That means voice traffic (which is very sensitive to delays) might get stuck behind traffic where a delay of a few extra milliseconds wouldn't be a problem.</span></span>

<span data-ttu-id="210f9-157">QoS を実装するときは、いくつかの輻輳管理機能 (Cisco の優先キューイング、[クラスベースの加重公平な待ち行列 (cbの](https://www.cisco.com/en/US/docs/ios/12_0t/12_0t5/feature/guide/cbwfq.html#wp17641)場合) など) と、輻輳回避機能 ([加重ランダムの早い検出 (wred)](https://en.wikipedia.org/wiki/Weighted_random_early_detection)など) を使って複数のキューを定義します。</span><span class="sxs-lookup"><span data-stu-id="210f9-157">When you implement QoS, you define multiple queues using one of several congestion management features (such as Cisco’s priority queuing and [Class-Based Weighted Fair Queueing (CBWFQ)](https://www.cisco.com/en/US/docs/ios/12_0t/12_0t5/feature/guide/cbwfq.html#wp17641)) and congestion avoidance features (such as [weighted random early detection (WRED)](https://en.wikipedia.org/wiki/Weighted_random_early_detection)).</span></span>

<span data-ttu-id="210f9-158">_図2QoS キューの例_</span><span class="sxs-lookup"><span data-stu-id="210f9-158">_Figure 2. Examples of QoS queues_</span></span>

<span data-ttu-id="210f9-159">![QoS キューと帯域幅区分の図](media/Qos-in-Teams-Image2.png "利用可能な帯域幅の合計は、複数のキュー (オーディオ、ビデオ、その他のトラフィック) で分割されます。これには、さまざまな優先順位が割り当てられています。")</span><span class="sxs-lookup"><span data-stu-id="210f9-159">![Illustration of QoS queues and bandwidth division](media/Qos-in-Teams-Image2.png "Total available bandwidth is divided among multiple queues—audio, video, and other traffic—that have been assigned different priorities.")</span></span>

<span data-ttu-id="210f9-160">簡単な例としては、QoS によってデータネットワーク内に仮想 "相乗りレーン" が作成されるため、データの種類によっては遅延が発生しないことがあります。</span><span class="sxs-lookup"><span data-stu-id="210f9-160">A simple analogy is that QoS creates virtual "carpool lanes" in your data network so some types of data never or rarely encounter a delay.</span></span> <span data-ttu-id="210f9-161">これらのレーンを作成した後は、組織のユーザーに対してビジネスレベルのエクスペリエンスを提供しながら、相対的なサイズを調整して、より効率的に接続の帯域幅を管理することができます。</span><span class="sxs-lookup"><span data-stu-id="210f9-161">Once you create those lanes, you can adjust their relative size and much more effectively manage the connection bandwidth you have, while still delivering business-grade experiences for your organization's users.</span></span>

## <a name="select-a-qos-implementation-method"></a><span data-ttu-id="210f9-162">QoS の実装方法を選択する</span><span class="sxs-lookup"><span data-stu-id="210f9-162">Select a QoS implementation method</span></span>

<span data-ttu-id="210f9-163">ネットワークのルーターでアクセス制御リスト (Acl) を使用して、ポートベースのタグを使って QoS を実装することができます。</span><span class="sxs-lookup"><span data-stu-id="210f9-163">You could implement QoS via port-based tagging, using Access Control Lists (ACLs) on your network's routers.</span></span> <span data-ttu-id="210f9-164">ポートベースのタグ付けは、Windows、Mac、および Linux の混合環境で動作するため、最も信頼できる方法です。</span><span class="sxs-lookup"><span data-stu-id="210f9-164">Port-based tagging is the most reliable method because it works in mixed Windows, Mac, and Linux environments and is the easiest to implement.</span></span> <span data-ttu-id="210f9-165">モバイルクライアントでは、DSCP 値を使ってトラフィックをマークするメカニズムは用意されていないため、この方法が必要になります。</span><span class="sxs-lookup"><span data-stu-id="210f9-165">Mobile clients don't provide a mechanism to mark traffic by using DSCP values, so they will require this method.</span></span>  

<span data-ttu-id="210f9-166">ポートベースのタグ付けを使用すると、ネットワークのルーターは受信パケットを調べます。また、特定のポートまたはポートの範囲を使ってパケットが着信した場合は、特定のメディアの種類として識別[DSCP](https://tools.ietf.org/html/rfc2474)し、それをその種類のキューに入れて、他のデバイスがそのトラフィックの種類を認識してキューの優先順位を上げる</span><span class="sxs-lookup"><span data-stu-id="210f9-166">Using port-based tagging, your network's router examines an incoming packet, and if the packet arrived using a certain port or range of ports, it identifies it as a certain media type and puts it in the queue for that type, adding a predetermined [DSCP](https://tools.ietf.org/html/rfc2474) mark to the IP Packet header so other devices can recognize its traffic type and give it priority in their queue.</span></span>

<span data-ttu-id="210f9-167">これは、すべてのプラットフォームで機能しますが、WAN edge でトラフィックをマークするだけで、管理のオーバーヘッドが生じます。</span><span class="sxs-lookup"><span data-stu-id="210f9-167">Although this works across platforms, it only marks traffic at the WAN edge (not all the way to the client machine) and creates management overhead.</span></span> <span data-ttu-id="210f9-168">この方法を実装する手順については、ルーター製造元から提供されているドキュメントを参照してください。</span><span class="sxs-lookup"><span data-stu-id="210f9-168">You should refer to the documentation provided by the router manufacturer for instructions on implementing this method.</span></span>

### <a name="insert-dscp-markers"></a><span data-ttu-id="210f9-169">DSCP マーカーを挿入する</span><span class="sxs-lookup"><span data-stu-id="210f9-169">Insert DSCP markers</span></span>

<span data-ttu-id="210f9-170">また、グループポリシーオブジェクト (GPO) を使ってクライアントデバイスが、特定の種類のトラフィック (ボイスなど) であることを示す DSCP マーカーを IP パケットヘッダーに挿入することで、QoS を実装することもできます。</span><span class="sxs-lookup"><span data-stu-id="210f9-170">You could also implement QoS by using a Group Policy Object (GPO) to direct client devices to insert a DSCP marker in IP packet headers identifying it as particular type of traffic (for example, voice).</span></span> <span data-ttu-id="210f9-171">ルーターなどのネットワークデバイスでは、これを認識して、トラフィックを個別の優先度の高いキューに配置するように構成することができます。</span><span class="sxs-lookup"><span data-stu-id="210f9-171">Routers and other network devices can be configured to recognize this and put the traffic in a separate, higher-priority queue.</span></span>

<span data-ttu-id="210f9-172">このシナリオは完全に有効ですが、ドメインに参加している Windows クライアントに対してのみ機能します。</span><span class="sxs-lookup"><span data-stu-id="210f9-172">Although this scenario is entirely valid, it will only work for domain-joined Windows clients.</span></span> <span data-ttu-id="210f9-173">ドメインに参加していないデバイスでは、DSCP タグ付けは有効になりません。</span><span class="sxs-lookup"><span data-stu-id="210f9-173">Any device that isn't a domain-joined Windows client won't be enabled for DSCP tagging.</span></span> <span data-ttu-id="210f9-174">Mac OS などのクライアントでは、ハードコーディングされたタグがあり、常にトラフィックがタグ付けされます。</span><span class="sxs-lookup"><span data-stu-id="210f9-174">Clients such as Mac OS have hard-coded tags and will always tag traffic.</span></span>

<span data-ttu-id="210f9-175">正側では、GPO を使用して DSCP マーキングを制御することで、ドメインに参加しているすべてのコンピューターが同じ設定を受け取り、管理者だけがそれらを管理できるようになります。</span><span class="sxs-lookup"><span data-stu-id="210f9-175">On the plus side, controlling the DSCP marking via GPO ensures that all domain-joined computers receive the same settings and that only an administrator can manage them.</span></span> <span data-ttu-id="210f9-176">GPO を使うことができるクライアントは、元のデバイスでタグ付けされ、設定されたネットワークデバイスでは、DSCP コードによってリアルタイムストリームを認識し、適切な優先順位を付けることができます。</span><span class="sxs-lookup"><span data-stu-id="210f9-176">Clients that can use GPO will be tagged on the originating device, and then configured network devices can recognize the real-time stream by the DSCP code and give it an appropriate priority.</span></span>

### <a name="best-practice"></a><span data-ttu-id="210f9-177">ベストプラクティス</span><span class="sxs-lookup"><span data-stu-id="210f9-177">Best practice</span></span>

<span data-ttu-id="210f9-178">可能であれば、エンドポイントとポートベースの Acl での DSCP マーキングをルーターで組み合わせることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="210f9-178">We recommend a combination of DSCP markings at the endpoint and port-based ACLs on routers, if possible.</span></span> <span data-ttu-id="210f9-179">グループポリシーオブジェクトを使用してほとんどのクライアントをキャッチし、さらにポートベースの DSCP タグを使用することで、モバイル、Mac、その他のクライアントでも QoS 処理を行うことができます (少なくとも部分的に)。</span><span class="sxs-lookup"><span data-stu-id="210f9-179">Using a Group Policy object to catch the majority of clients, and also using port-based DSCP tagging will ensure that mobile, Mac, and other clients will still get QoS treatment (at least partially).</span></span>

<span data-ttu-id="210f9-180">[DSCP マーキング] は、likened が配信されるまでの時間と、迅速な配信のために最適な並べ替えを行うことができるようにする郵送の頻度を示す切手にすることができます。</span><span class="sxs-lookup"><span data-stu-id="210f9-180">DSCP markings can be likened to postage stamps that indicate to postal workers how urgent the delivery is and how best to sort it for speedy delivery.</span></span> <span data-ttu-id="210f9-181">リアルタイムメディアストリームに優先順位を設定するようにネットワークを構成すると、紛失したパケットや遅延したパケットが大幅に減少します。</span><span class="sxs-lookup"><span data-stu-id="210f9-181">Once you've configured your network to give priority to real-time media streams, lost packets and late packets should diminish greatly.</span></span>

<span data-ttu-id="210f9-182">ネットワーク内のすべてのデバイスが同じ分類、マーキング、優先順位を使用している場合は、各トラフィックの種類で使用されるキューに割り当てられているポート範囲のサイズを変更することによって、遅延、破棄されたパケット、ジッタを削減または除去することができます。</span><span class="sxs-lookup"><span data-stu-id="210f9-182">Once all devices in the network are using the same classifications, markings, and priorities, it's possible to reduce or eliminate delays, dropped packets, and jitter by changing the size of the port ranges assigned to the queues used for each traffic type.</span></span> <span data-ttu-id="210f9-183">Teams の観点から見ると、最も重要な構成手順は、パケットの分類とマーク付けですが、エンドツーエンドの QoS を成功させるには、基になるネットワーク構成にアプリケーションの構成を慎重に合わせる必要があります。</span><span class="sxs-lookup"><span data-stu-id="210f9-183">From the Teams perspective, the most important configuration step is the classification and marking of packets, but for end-to-end QoS to be successful you also need to carefully align the application's configuration with the underlying network configuration.</span></span> <span data-ttu-id="210f9-184">QoS が完全に実装されたら、継続的な管理は、組織のニーズと実際の使用状況に基づいて、各トラフィックの種類に割り当てられたポート範囲を調整することになります。</span><span class="sxs-lookup"><span data-stu-id="210f9-184">Once QoS is fully implemented, ongoing management is a question of adjusting the port ranges assigned to each traffic type based on your organization's needs and actual usage.</span></span>

## <a name="choose-initial-port-ranges-for-each-media-type"></a><span data-ttu-id="210f9-185">各メディアの種類の初期ポート範囲を選ぶ</span><span class="sxs-lookup"><span data-stu-id="210f9-185">Choose initial port ranges for each media type</span></span>

<span data-ttu-id="210f9-186">DSCP 値は、対応して構成されたネットワークに、パケットまたはストリームを割り当てるための優先順位を示します。 DSCP マークがクライアントとネットワーク自体のどちらで割り当てられているかは、ACL 設定に基づいて判断されます。</span><span class="sxs-lookup"><span data-stu-id="210f9-186">The DSCP value tells a correspondingly configured network what priority to give a packet or stream, whether the DSCP mark is assigned by clients or the network itself based on ACL settings.</span></span> <span data-ttu-id="210f9-187">各メディアワークロードは、固有の固有の DSCP 値を取得します (他のサービスによっては、ワークロードで DSCP マーキング、チームを共有することはできません)。また、各メディアの種類に対して定義され、個別のポート範囲を使うことができます。</span><span class="sxs-lookup"><span data-stu-id="210f9-187">Each media workload gets its own unique DSCP value (other services might allow workloads to share a DSCP marking, Teams does not) and a defined and separate port range used for each media type.</span></span> <span data-ttu-id="210f9-188">その他の環境には既存の QoS 戦略がある場合があります。これは、ネットワークワークロードの優先順位を決定するのに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="210f9-188">Other environments might have an existing QoS strategy in place, which will help you determine the priority of network workloads.</span></span>

<span data-ttu-id="210f9-189">さまざまなリアルタイムストリーミングワークロードのポート範囲の相対サイズによって、そのワークロード専用の使用可能な帯域幅の合計の比率が設定されます。</span><span class="sxs-lookup"><span data-stu-id="210f9-189">The relative size of the port ranges for different real-time streaming workloads sets the proportion of the total available bandwidth dedicated to that workload.</span></span> <span data-ttu-id="210f9-190">以前のお客様に戻るには、"Air Mail" スタンプ付きの文字が、最も近い空港から1時間以内に実行されることがあります。また、"一括メール" マークとマークされた小さいパッケージでは、1日のうち、一連のトラックで陸を通過するまで待機することができます。</span><span class="sxs-lookup"><span data-stu-id="210f9-190">To return to our earlier postal analogy: a letter with an "Air Mail" stamp might get taken within an hour to the nearest airport, while a small package marked "Bulk Mail" mark can wait for a day before traveling over land on a series of trucks.</span></span>

<span data-ttu-id="210f9-191">_推奨される初期ポート範囲_</span><span class="sxs-lookup"><span data-stu-id="210f9-191">_Recommended initial port ranges_</span></span>

|<span data-ttu-id="210f9-192">メディア トラフィックの種類</span><span class="sxs-lookup"><span data-stu-id="210f9-192">Media traffic type</span></span>| <span data-ttu-id="210f9-193">クライアントのソース ポートの範囲</span><span class="sxs-lookup"><span data-stu-id="210f9-193">Client source port range</span></span> |<span data-ttu-id="210f9-194">プロトコル</span><span class="sxs-lookup"><span data-stu-id="210f9-194">Protocol</span></span>|<span data-ttu-id="210f9-195">DSCP 値</span><span class="sxs-lookup"><span data-stu-id="210f9-195">DSCP value</span></span>|<span data-ttu-id="210f9-196">DSCP クラス</span><span class="sxs-lookup"><span data-stu-id="210f9-196">DSCP class</span></span>|
|:--- |:--- |:--- |:--- |:--- |
|<span data-ttu-id="210f9-197">オーディオ</span><span class="sxs-lookup"><span data-stu-id="210f9-197">Audio</span></span>| <span data-ttu-id="210f9-198">50,000–50,019</span><span class="sxs-lookup"><span data-stu-id="210f9-198">50,000–50,019</span></span>|<span data-ttu-id="210f9-199">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="210f9-199">TCP/UDP</span></span>|<span data-ttu-id="210f9-200">46</span><span class="sxs-lookup"><span data-stu-id="210f9-200">46</span></span>|<span data-ttu-id="210f9-201">完全優先転送 (EF)</span><span class="sxs-lookup"><span data-stu-id="210f9-201">Expedited Forwarding (EF)</span></span>|
|<span data-ttu-id="210f9-202">ビデオ</span><span class="sxs-lookup"><span data-stu-id="210f9-202">Video</span></span>| <span data-ttu-id="210f9-203">50,020–50,039</span><span class="sxs-lookup"><span data-stu-id="210f9-203">50,020–50,039</span></span>|<span data-ttu-id="210f9-204">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="210f9-204">TCP/UDP</span></span>|<span data-ttu-id="210f9-205">34</span><span class="sxs-lookup"><span data-stu-id="210f9-205">34</span></span>|<span data-ttu-id="210f9-206">相対的優先転送 (AF41)</span><span class="sxs-lookup"><span data-stu-id="210f9-206">Assured Forwarding (AF41)</span></span>|
|<span data-ttu-id="210f9-207">アプリケーション/画面共有</span><span class="sxs-lookup"><span data-stu-id="210f9-207">Application/Screen Sharing</span></span>| <span data-ttu-id="210f9-208">50,040–50,059</span><span class="sxs-lookup"><span data-stu-id="210f9-208">50,040–50,059</span></span>|<span data-ttu-id="210f9-209">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="210f9-209">TCP/UDP</span></span>|<span data-ttu-id="210f9-210">才</span><span class="sxs-lookup"><span data-stu-id="210f9-210">18</span></span>|<span data-ttu-id="210f9-211">相対的優先転送 (AF21)</span><span class="sxs-lookup"><span data-stu-id="210f9-211">Assured Forwarding (AF21)</span></span>|
||||||

<span data-ttu-id="210f9-212">これらの設定を使用する場合は、次の点に注意してください。</span><span class="sxs-lookup"><span data-stu-id="210f9-212">Be aware of the following when you use these settings:</span></span>

- <span data-ttu-id="210f9-213">今後、ExpressRoute の実装を計画していて、QoS を実装していない場合は、このガイダンスに従うことをお勧めします。これにより、DSCP 値が送信者と受信者と同じになるようにすることをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="210f9-213">If you plan to implement ExpressRoute in the future and haven't yet implemented QoS, we recommend that you follow the guidance so that DSCP values are the same from sender to receiver.</span></span>
- <span data-ttu-id="210f9-214">モバイルクライアントやチームデバイスを含むすべてのクライアントは、これらのポート範囲を使用します。また、これらのソースポート範囲を使用する、実装するすべての DSCP ポリシーが影響を受けます。</span><span class="sxs-lookup"><span data-stu-id="210f9-214">All clients, including mobile clients and Teams devices, will use these port ranges and will be affected by any DSCP policy you implement that uses these source port ranges.</span></span> <span data-ttu-id="210f9-215">動的なポートを引き続き使用するクライアントは、ブラウザーベースのクライアント (つまり、参加者がブラウザーを使って会議に参加できるクライアント) だけです。</span><span class="sxs-lookup"><span data-stu-id="210f9-215">The only clients that will continue to use dynamic ports are the browser-based clients (that is, those clients that let participants join meetings by using their browsers).</span></span>
- <span data-ttu-id="210f9-216">Mac クライアントでは、同じポート範囲を使用しますが、オーディオ (EF) とビデオ (AF41) にはハードコーディングされた値も使用されます。</span><span class="sxs-lookup"><span data-stu-id="210f9-216">Although the Mac client uses the same port ranges, it also uses hard-coded values for audio (EF) and video (AF41).</span></span> <span data-ttu-id="210f9-217">これらの値は構成できません。</span><span class="sxs-lookup"><span data-stu-id="210f9-217">These values are not configurable.</span></span>
- <span data-ttu-id="210f9-218">ユーザーエクスペリエンスを向上させるために、後でポート範囲を調整する必要がある場合は、ポート範囲を重ねて、互いに隣り合っている必要があります。</span><span class="sxs-lookup"><span data-stu-id="210f9-218">If you later need to adjust the port ranges to improve user experience, the port ranges can not overlap and should be adjacent to each other.</span></span>

## <a name="migrate-qos-to-teams"></a><span data-ttu-id="210f9-219">QoS を Teams に移行する</span><span class="sxs-lookup"><span data-stu-id="210f9-219">Migrate QoS to Teams</span></span>

<span data-ttu-id="210f9-220">QoS タグとポート範囲など、以前に Skype for Business Online を展開した後に Teams を展開している場合、チームは既存の構成を尊重し、Skype for Business クライアントと同じポート範囲とタグ付けを使用します。</span><span class="sxs-lookup"><span data-stu-id="210f9-220">If you've previously deployed Skype for Business Online, including QoS tagging and port ranges, and are now deploying Teams, Teams will respect the existing configuration and will use the same port ranges and tagging as the Skype for Business client.</span></span> <span data-ttu-id="210f9-221">ほとんどの場合、追加の構成は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="210f9-221">In most cases, no additional configuration will be needed.</span></span>

> [!NOTE]
> <span data-ttu-id="210f9-222">グループポリシーによってアプリケーション名の QoS タグ付けを使用している場合は、アプリケーション名として Teams.exe を追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="210f9-222">If you're using Application Name QoS tagging via Group Policy, you must add Teams.exe as the application name.</span></span>


## <a name="managing-source-ports-in-the-teams-admin-center"></a><span data-ttu-id="210f9-223">Teams 管理センターでソースポートを管理する</span><span class="sxs-lookup"><span data-stu-id="210f9-223">Managing source ports in the Teams admin center</span></span>

<span data-ttu-id="210f9-224">Teams では、さまざまなワークロードによって使用される QoS ソースポートを、必要に応じて動的に管理し、調整する必要があります。</span><span class="sxs-lookup"><span data-stu-id="210f9-224">In Teams, QoS source ports used by the different workloads should be actively managed, and adjusted as necessary.</span></span> <span data-ttu-id="210f9-225">「[各メディアの種類の初期ポート範囲を選択](#choose-initial-port-ranges-for-each-media-type)する」の表を参照すると、ポート範囲は調整できますが、DSCP マーキングは構成できません。</span><span class="sxs-lookup"><span data-stu-id="210f9-225">Referring to the table in [Choose initial port ranges for each media type](#choose-initial-port-ranges-for-each-media-type), the port ranges are adjustable, but the DSCP markings are not configurable.</span></span> <span data-ttu-id="210f9-226">これらの設定を実装した後は、特定のメディアの種類に必要なポートの数が増加するか、少なくなることがあります。</span><span class="sxs-lookup"><span data-stu-id="210f9-226">Once you have implemented these settings, you may find that more or fewer ports are needed for a given media type.</span></span> <span data-ttu-id="210f9-227">[ユーザーごとの通話分析](use-call-analytics-to-troubleshoot-poor-call-quality.md)と[通話品質ダッシュボード (CQD)](turning-on-and-using-call-quality-dashboard.md)を使用して、Teams が実装された後、定期的に、必要に応じて、ポート範囲を調整することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="210f9-227">[Per-user call analytics](use-call-analytics-to-troubleshoot-poor-call-quality.md) and [Call Quality Dashboard (CQD)](turning-on-and-using-call-quality-dashboard.md) should be used in making a decision to adjust port ranges after Teams has been implemented, and periodically as needs change.</span></span>

> [!NOTE]
> <span data-ttu-id="210f9-228">Skype for Business Online のソースポート範囲と DSCP マーキングに基づいて既に QoS を構成している場合は、同じ構成が Teams に適用され、マッピングに対するクライアントやネットワークの変更は必要ありませんが、[チームで使用する範囲を設定](meeting-settings-in-teams.md#set-how-you-want-to-handle-real-time-media-traffic-for-teams-meetings)して、Skype For business online 用に構成されたものと一致させる必要があります。</span><span class="sxs-lookup"><span data-stu-id="210f9-228">If you've already configured QoS based on source port ranges and DSCP markings for Skype for Business Online, the same configuration will apply to Teams and no further client or network changes to the mapping will be required, though you may have to [set the ranges used in Teams](meeting-settings-in-teams.md#set-how-you-want-to-handle-real-time-media-traffic-for-teams-meetings) to match what was configured for Skype for Business Online.</span></span>

<span data-ttu-id="210f9-229">以前にオンプレミスの Skype for Business Server を展開したことがある場合は、QoS ポリシーを再調査して、確認した [ポート範囲] の設定と一致するように調整する必要があります。これにより、チームの品質ユーザーエクスペリエンスが提供されます。</span><span class="sxs-lookup"><span data-stu-id="210f9-229">If you’ve previously deployed Skype for Business Server on-premises, you may need to re-examine your QoS policies and adjust them to match port range settings you've verified provide a quality user experience for Teams.</span></span>

## <a name="validate-your-qos-implementation"></a><span data-ttu-id="210f9-230">QoS の実装を検証する</span><span class="sxs-lookup"><span data-stu-id="210f9-230">Validate your QoS implementation</span></span>

<span data-ttu-id="210f9-231">QoS を有効にするには、グループポリシーオブジェクトによって設定された DSCP 値が、通話の両端に存在している必要があります。</span><span class="sxs-lookup"><span data-stu-id="210f9-231">For QoS to be effective, the DSCP value set by the Group Policy object needs to be present at both ends of a call.</span></span> <span data-ttu-id="210f9-232">チームクライアントによって生成されたトラフィックを分析することで、チームの作業負荷トラフィックがネットワーク内を移動したときに、DSCP 値が変更または削除されないことを確認できます。</span><span class="sxs-lookup"><span data-stu-id="210f9-232">By analyzing the traffic generated by the Teams client, you can verify that the DSCP value isn’t changed or stripped out when the Teams workload traffic moves through the network.</span></span>

<span data-ttu-id="210f9-233">可能であれば、ネットワークの出口ポイントでトラフィックをキャプチャします。</span><span class="sxs-lookup"><span data-stu-id="210f9-233">Preferably, you capture traffic at the network egress point.</span></span> <span data-ttu-id="210f9-234">スイッチまたはルータでポートミラーリングを使用して、この問題を解決することができます。</span><span class="sxs-lookup"><span data-stu-id="210f9-234">You can use port mirroring on a switch or router to help with this.</span></span>


## <a name="related-topics"></a><span data-ttu-id="210f9-235">関連項目</span><span class="sxs-lookup"><span data-stu-id="210f9-235">Related topics</span></span>

[<span data-ttu-id="210f9-236">ビデオ : ネットワーク計画</span><span class="sxs-lookup"><span data-stu-id="210f9-236">Video: Network Planning</span></span>](https://aka.ms/teams-networking)

[<span data-ttu-id="210f9-237">Microsoft Teams 用に組織のネットワークを準備する</span><span class="sxs-lookup"><span data-stu-id="210f9-237">Prepare your organization's network for Microsoft Teams</span></span>](prepare-network.md)

[<span data-ttu-id="210f9-238">チームクライアントでの QoS の実装</span><span class="sxs-lookup"><span data-stu-id="210f9-238">Implement QoS in the Teams client</span></span>](QoS-in-Teams-clients.md)
