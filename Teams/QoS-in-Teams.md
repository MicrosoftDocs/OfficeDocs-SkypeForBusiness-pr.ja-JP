---
title: "Microsoft Teams でのサービスの品質 (QoS)"
author: rmw2890
ms.author: MyAdvisor
manager: Serdars
ms.date: 02/16/2018
ms.topic: article
ms.service: msteams
description: "Microsoft Teams でのサービスの品質 (QoS) のために組織のネットワークを準備する"
MS.collection: Strat_MT_TeamsAdmin
ms.openlocfilehash: 61bebd64c7d1478c16e114631b696dee2bf59625
ms.sourcegitcommit: 85105cb4e42ae8eb6e7e76eaf6d4dd5b9568cf41
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/19/2018
---
<a name="quality-of-service-qos-in-microsoft-teams"></a><span data-ttu-id="08001-103">Microsoft Teams でのサービスの品質 (QoS)</span><span class="sxs-lookup"><span data-stu-id="08001-103">Quality of Service (QoS) in Microsoft Teams</span></span>
==========================================
<span data-ttu-id="08001-104">このガイドでは、Teams でのサービスの品質 (QoS) のために組織のネットワークを準備する手順について説明します。</span><span class="sxs-lookup"><span data-stu-id="08001-104">This guide will help you prepare your organization's network for Quality of Service (QoS) in Teams.</span></span>


<span data-ttu-id="08001-105">サービスの品質 (QoS) は、ネットワーク トラフィックの特定の種類を優先順位付けすることができるメカニズムです。</span><span class="sxs-lookup"><span data-stu-id="08001-105">Quality of Service (QoS) is a mechanism that lets you prioritize certain types of network traffic.</span></span> <span data-ttu-id="08001-106">Teams などのリアルタイム通信サービスのトラフィックを優先順位付けすることは、ビジネス グレードのユーザー エクスペリエンスを実現するために重要です。</span><span class="sxs-lookup"><span data-stu-id="08001-106">Prioritizing the traffic for real-time communications services such as Teams is important in order to deliver a business-grade user experience.</span></span> <span data-ttu-id="08001-107">QoS が本当に効果を生じるようにするには、パス内に QoS をサポートできない部分があると、通話全体の品質が低下する可能性があるため、エンドツーエンド (クラウドへの PC、ネットワーク スイッチ、およびルーター) で QoS に対応した接続が構成されている必要があります。</span><span class="sxs-lookup"><span data-stu-id="08001-107">For QoS to be truly effective, a QoS-capable connection must be configured end-to-end (PC, network switches, and routers to the cloud), because any part in the path that fails to support QoS could degrade the quality of the entire call.</span></span>


![組織のネットワークと Office 365 サービスとの間の関係を示すダイアグラムのスクリーンショット。](media/Qos-in-Teams-Image1.png)

 

<span data-ttu-id="08001-109">多くの場合、相互接続のネットワークは、管理下にないネットワークで、インターネット接続になります。</span><span class="sxs-lookup"><span data-stu-id="08001-109">In most cases, the interconnect network will be an unmanaged network, an internet connection.</span></span> <span data-ttu-id="08001-110">エンドツーエンドの QoS に対処するために利用できる 1 つのオプションは [ExpressRoute](https://azure.microsoft.com/documentation/articles/expressroute-introduction/) です。</span><span class="sxs-lookup"><span data-stu-id="08001-110">One option available to address end-to-end QoS is [ExpressRoute](https://azure.microsoft.com/documentation/articles/expressroute-introduction/).</span></span> <span data-ttu-id="08001-111">QoS を自分たちによる制御が届くネットワークの部分に、すなわちオンプレミス ネットワークに実装することを推奨します。</span><span class="sxs-lookup"><span data-stu-id="08001-111">It is our recommendation to still implement QoS on the portions of the network you have control over, namely your on-premises network.</span></span> <span data-ttu-id="08001-112">これにより、展開全体にわたってリアルタイムの通信のワークロードの品質が向上し、既存の展開内のチョーク ポイントを軽減します。</span><span class="sxs-lookup"><span data-stu-id="08001-112">This will increase the quality of real time communication workloads throughout your deployment and will alleviate choke points in your existing deployment.</span></span> 

## <a name="objectives"></a><span data-ttu-id="08001-113">目的</span><span class="sxs-lookup"><span data-stu-id="08001-113">Objectives</span></span> 

<span data-ttu-id="08001-114">このガイドは、Teams のリアルタイム通信トラフィック、すなわち音声やビデオに対する優先順位を設定する方法に焦点をあてて説明します。</span><span class="sxs-lookup"><span data-stu-id="08001-114">This guide will focus on how to prioritize Teams real-time communications traffic, namely voice and video.</span></span> <span data-ttu-id="08001-115">その他の種類のトラフィックもニーズに基づいて優先順位を設定することができます。</span><span class="sxs-lookup"><span data-stu-id="08001-115">Other types of traffic can also be prioritized based on your needs.</span></span>

<span data-ttu-id="08001-116">トラフィックの優先順位を設定する方法は複数ありますが、DSCP (Differentiated Services Code Point) のマーキングを使用する方法が最も一般的です。</span><span class="sxs-lookup"><span data-stu-id="08001-116">There are multiple ways to prioritize traffic, but the most common is by using differentiated services code point (DSCP) markings.</span></span> <span data-ttu-id="08001-117">このマーキングはポート範囲に基づいて適用されますが、グループ ポリシー オブジェクトを介しても適用されます。</span><span class="sxs-lookup"><span data-stu-id="08001-117">They can be applied based on port ranges but also via Group Policy objects.</span></span> <span data-ttu-id="08001-118">このドキュメントでは、これらの両方について取り上げます。</span><span class="sxs-lookup"><span data-stu-id="08001-118">We will cover both in this document.</span></span>

<span data-ttu-id="08001-119">グループ ポリシー オブジェクト (GPO) を介して DSCP マーキングを制御することにより、ドメイン参加のコンピューターが正しい設定を受け取り、それらの設定が管理者のみによって管理できるようになります。</span><span class="sxs-lookup"><span data-stu-id="08001-119">Controlling the DSCP marking via Group Policy objects (GPO) ensures that domain-joined computers receive the correct settings and that these settings can only be managed by an administrator.</span></span> 

<span data-ttu-id="08001-120">QoS が機能するのは、呼び出し先と呼び出し元を接続するすべてのリンクに実装した場合のみであることを理解することが重要です。</span><span class="sxs-lookup"><span data-stu-id="08001-120">It’s important to understand that QoS only works when implemented on all links connecting caller to callee.</span></span> <span data-ttu-id="08001-121">内部ネットワークで QoS を使用しているときにユーザーがリモートの場所からサインインする場合、管理された内部ネットワーク内でのみ優先順位付けをすることができます。</span><span class="sxs-lookup"><span data-stu-id="08001-121">If we use QoS on the internal network and a user signs in from a remote location, we can only prioritize within our internal, managed, network.</span></span> <span data-ttu-id="08001-122">リモートの場所でも VPN を実装することによって管理された接続の受信ができますが、VPN 経由でリアルタイム通信のトラフィックを実行することは推奨されません。</span><span class="sxs-lookup"><span data-stu-id="08001-122">While remote locations could receive a managed connection by implementing a VPN, it is not recommended to run real-time communications traffic over the VPN.</span></span>

> [!NOTE]
> <span data-ttu-id="08001-123">最大のユーザー エクスペリエンスを実現するために、リモート ユーザーに接続された VPN に対して分割トンネリングを実装することを推奨します</span><span class="sxs-lookup"><span data-stu-id="08001-123">Our recommendation is to implement split tunneling for VPN connected remote users to maximize the user experience.</span></span> <span data-ttu-id="08001-124">詳細については、「[Deploy-Guidance-VPN Split Tunnel (展開ガイダンス - VPN 分割トンネル)](https://myadvisor.fasttrack.microsoft.com/CloudVoice/Downloads?SelectedIDs=5_1_0_9 )」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="08001-124">See the document [Deploy-Guidance-VPN Split Tunnel](https://myadvisor.fasttrack.microsoft.com/CloudVoice/Downloads?SelectedIDs=5_1_0_9 ) for more information.</span></span>

<span data-ttu-id="08001-125">大陸間にまたがる管理されたリンクがあるグローバル組織では、QoS は帯域幅がローカル ネットワーク (LAN) と比較して制限的であるため、強く推奨されます。</span><span class="sxs-lookup"><span data-stu-id="08001-125">In a global organization with managed links spanning continents, QoS is highly recommended since the bandwidth is limited in comparisons to the local network (LAN).</span></span>

## <a name="quality-of-service"></a><span data-ttu-id="08001-126">サービスの品質</span><span class="sxs-lookup"><span data-stu-id="08001-126">Managing Quality of Service</span></span>

<span data-ttu-id="08001-127">ネットワーク上のアプリケーションに対して保証されたレベルのサービスを提供するために、基本となるネットワーク デバイスに異なる種類のトラフィックを分類する手段が存在する必要があります。</span><span class="sxs-lookup"><span data-stu-id="08001-127">In order to provide a guaranteed level of service for an application on the network, the underlying network devices must have a way to classify different types of traffic.</span></span> <span data-ttu-id="08001-128">例として、音声に対して優れた処理がされることが求められている場合には、ルーターは音声トラフィックと通常の Web 閲覧トラフィックを区別できる必要があります。</span><span class="sxs-lookup"><span data-stu-id="08001-128">A router, for example, must be able to distinguish between voice traffic and normal web browsing traffic, if there is an expectation that voice receives better treatment.</span></span> 

<span data-ttu-id="08001-129">DiffServ (Differentiated Services) は、IPv4/IPv6 パケットのヘッダーのサービスの種類 (ToS) フィールドに基づく優先順位で、どのトラフィックがネットワーク デバイスによって処理されるかについてのフレームワークを提供します。</span><span class="sxs-lookup"><span data-stu-id="08001-129">Differentiated Services (DiffServ) provides a framework in which traffic is treated by network devices with priorities based on the type of services (ToS) field in the header of an IPv4/IPv6 packet.</span></span> <span data-ttu-id="08001-130">DiffServ フィールドのうち最も重要な 6 ビットは、DSCP (Differentiated Services Code Point) として知られています。</span><span class="sxs-lookup"><span data-stu-id="08001-130">The six most significant bits of the DiffServ field is known as the Differentiated Services Code Point, or DSCP.</span></span> <span data-ttu-id="08001-131">このフレームワークを使用すると、トラフィックが特定の種類のトラフィックの (音声) として分類され、マーキング (101110、または十進数で 46) されるようになり、それらのマーキングをネットワーク デバイスが処理することで、トラフィックはそれに従った優先順位 (この例では完全優先転送) が設定されます。</span><span class="sxs-lookup"><span data-stu-id="08001-131">Using this framework, traffic can be classified as a particular type of traffic (voice), and then marked (101110, or 46 in decimal), such that when network devices process these markings, the traffic can be prioritized accordingly (Expedited Forwarding, in this example).</span></span>

<span data-ttu-id="08001-132">ネットワーク トラフィックがルーターに入ると、トラフィックはキューに配置されますが、設定されている QoS がない場合は、存在するキューは基本的に 1 つだけで、データは先入れ先出しで処理されます。このため、(遅延による影響を強く受けやすい) 音声トラフィックは、オンライン ストリーミング サービスからのトラフィックの背後でスタック状態になる可能性があります。</span><span class="sxs-lookup"><span data-stu-id="08001-132">When network traffic enters a router, the traffic is placed into a queue – if there is no QoS in place, essentially there is only one queue, and data is treated as first-in, first-out. That means voice traffic (which is very sensitive to delays) could get stuck behind traffic from online streaming services.</span></span> <span data-ttu-id="08001-133">QoS を実装するときに、異なる輻輳管理機能 (Cisco のプライオリティ キューイング (PQ) およびクラスベースの重み付け均等化キューイング (CBWFQ) など) と輻輳回避機能 (重み付けランダム早期検出 (WRED) など) で、複数のキューを定義することができます。</span><span class="sxs-lookup"><span data-stu-id="08001-133">When implementing QoS, multiple queues can be defined, with different congestion management features (such as Cisco’s Priority Queuing (PQ) and Class Based Weighted Fair Queue (CBWFQ)) and congestion avoidance features (such as Weighted Random Early Detection (WRED)).</span></span>

![Teams の QoS キューを示す図のスクリーンショット。](media/Qos-in-Teams-Image2.png)

<span data-ttu-id="08001-135">図 1: 視覚化された QoS キュー</span><span class="sxs-lookup"><span data-stu-id="08001-135">Figure 1: QoS queues visualized</span></span>

<span data-ttu-id="08001-136">これらの要素が配備されると、基本となる管理されたネットワークが、どのようにトラフィックを分類、マーキング、優先順位付けすればよいか理解できるようになるため、予測できる品質のサービスが提供できるようになります。</span><span class="sxs-lookup"><span data-stu-id="08001-136">Once these pieces are in place, a predictable quality of service can be delivered, as the underlying managed network now understands how to classify, mark and prioritize traffic.</span></span> <span data-ttu-id="08001-137">Teams の観点から、最も重要な構成項目は、パケットの分類とマーキングです。ただし、エンドツーエンドの QoS を正常に機能するようにするための基本となるネットワーク構成と、アプリケーションの構成を整合させるために、慎重な計画が必要になります。</span><span class="sxs-lookup"><span data-stu-id="08001-137">From the Teams perspective, the most important configuration item is the classification and marking of packets – but careful planning is involved to align the application’s configuration with the underlying network configuration for end-to-end QoS to be successful.</span></span>

## <a name="qos-scenarios"></a><span data-ttu-id="08001-138">QoS シナリオ</span><span class="sxs-lookup"><span data-stu-id="08001-138">QoS scenarios</span></span>

<span data-ttu-id="08001-139">Teams のために QoS を実装する場合の、次の 4 つの開始シナリオについて説明します。</span><span class="sxs-lookup"><span data-stu-id="08001-139">When implementing QoS for Teams, we’ve based our guidance on four starting scenarios:</span></span>

1.  <span data-ttu-id="08001-140">Teams を展開済みまたは展開中で、ポート ベースのタグ付けを介した QoS の実装を計画しています。</span><span class="sxs-lookup"><span data-stu-id="08001-140">You’ve deployed or are deploying Teams and are planning on implementing QoS via Port Based Tagging.</span></span> <span data-ttu-id="08001-141">ポート ベースのタグ付けは、すべてのプラットフォームにわたり一貫して機能するため最も信頼性の高い方法であるとともに、実装するのが最も簡単です。</span><span class="sxs-lookup"><span data-stu-id="08001-141">Port Based Tagging is the most reliable method since it works universally throughout all platforms and is the easiest to implement.</span></span> 

2.  <span data-ttu-id="08001-142">Teams を展開済みまたは展開中で、グループ ポリシー オブジェクトのタグ付けを介した QoS の実装を計画しています。</span><span class="sxs-lookup"><span data-stu-id="08001-142">You’ve deployed or are deploying Teams and are planning to implement QoS via Group Policy Object tagging.</span></span> <span data-ttu-id="08001-143">これは、シナリオ 1 と組み合わせて使用される場合があります。</span><span class="sxs-lookup"><span data-stu-id="08001-143">This is sometimes used in combination with scenario 1.</span></span> <span data-ttu-id="08001-144">このシナリオは完全に有効であり、以下で説明されていますが、ドメイン参加の Windows クライアントに対してのみ機能することを理解することが重要です。</span><span class="sxs-lookup"><span data-stu-id="08001-144">While this scenario is entirely valid and described below, it is important to understand this will only work for Domain Joined Windows Clients.</span></span> <span data-ttu-id="08001-145">ドメイン参加のクライアントではないデバイスはすべて、QoS\DSCP のタグ付けに対して有効になりません。</span><span class="sxs-lookup"><span data-stu-id="08001-145">Any device that is not a Windows Domain Joined Client will not be enabled for QoS\DSCP Tagging.</span></span> 

3.  <span data-ttu-id="08001-146">Skype for Business Online を QoS のタグ付けとともに展開済みで、現在は Teams を展開中です。</span><span class="sxs-lookup"><span data-stu-id="08001-146">You have Skype for Business Online deployed including QoS Tagging and are now deploying Teams.</span></span> <span data-ttu-id="08001-147">この状況に該当する場合は、Teams は既存の構成を優先して、Skype for Business クライアントのものと同じポート範囲とタグ付けを使用します。</span><span class="sxs-lookup"><span data-stu-id="08001-147">If this is you, Teams will respect the existing configuration and will use the same port ranges and tagging as the Skype for Business client.</span></span> <span data-ttu-id="08001-148">追加の構成は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="08001-148">No additional configuration should be needed.</span></span> 
    > [!NOTE]
    > <span data-ttu-id="08001-149">グループ ポリシーを介したアプリケーション名 QoS のタグ付けを使用している場合、“Teams.exe” をアプリケーション名として追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="08001-149">If you're using Application Name QoS tagging via Group Policy you should add “Teams.exe” as Application Name.</span></span>
4.  <span data-ttu-id="08001-150">Teams を展開済みまたは展開中で、カスタム ポート範囲を備えたポート ベースのタグ付けを介して QoS を実装しようと考えています。</span><span class="sxs-lookup"><span data-stu-id="08001-150">You’ve deployed or are deploying Teams and want to implement QoS via port-based tagging with a custom port range.</span></span>

## <a name="recommended-differentiated-services-code-point-dscp-markings"></a><span data-ttu-id="08001-151">推奨される DSCP (Differentiated Services Code Point) のマーキング</span><span class="sxs-lookup"><span data-stu-id="08001-151">Recommended differentiated services code point (DSCP) markings</span></span>

<span data-ttu-id="08001-152">最初の手順は、DSCP 値での、一意の重複しないポート範囲を利用したトラフィック フローの分類 (音声やビデオなど) です。</span><span class="sxs-lookup"><span data-stu-id="08001-152">The first step is to classify the traffic flows (such as audio and video) by leveraging the unique, non-overlapping port ranges with a DSCP-value.</span></span> <span data-ttu-id="08001-153">ここで割り当てられた DSCP 値により、(ネットワーク構成に基づいて) ネットワークを通過するトラフィックの優先順位が決められます。</span><span class="sxs-lookup"><span data-stu-id="08001-153">The DSCP value assigned here will determine the priority of the traffic going through the network (based on the network configuration).</span></span> <span data-ttu-id="08001-154">各ワークロードは、独自の DSCP 値を取得します。一部の顧客において、同じ値を音声やビデオに設定している可能性がありますが、その場合に設定されるネットワーク内の優先順位は同じになります。</span><span class="sxs-lookup"><span data-stu-id="08001-154">Each workload gets its own DSCP value, although some customers might set the same value on voice and video, giving them the same priority in the network.</span></span> 

<span data-ttu-id="08001-155">どの DSCP 値を使用するかは、ワークロードの優先順位付けがどのようになっているかに依存します。</span><span class="sxs-lookup"><span data-stu-id="08001-155">What DSCP value to use depends on how a workload is prioritized.</span></span> <span data-ttu-id="08001-156">たとえば、ビジネスの要件により、アプリケーション共有をビデオと同じレベルの優先順位で取り扱うよう指示される可能性があります (さらにこれに関しては、ビデオと同じ DSCP 値でマーキングされます)。</span><span class="sxs-lookup"><span data-stu-id="08001-156">For example, business requirements could dictate that application sharing is to be treated with the same level of priority as video (and as such, marked with the same DSCP-value as video).</span></span> <span data-ttu-id="08001-157">その他の環境には、既存の QoS 戦略が配備済みである可能性があります。</span><span class="sxs-lookup"><span data-stu-id="08001-157">Other environments might have an existing QoS strategy in place already.</span></span> 

<span data-ttu-id="08001-158">以下の表 1 には、Teams を ExpressRoute で利用する場合に必須となる DSCP マーキングが示されています。</span><span class="sxs-lookup"><span data-stu-id="08001-158">Table 1 below shows the required DSCP markings when utilizing Teams with ExpressRoute.</span></span> <span data-ttu-id="08001-159">これは自分の環境で何を使用するべきかがわからない顧客にとって便利な開始地点となります。</span><span class="sxs-lookup"><span data-stu-id="08001-159">This could serve as a good starting point for customers unsure what to use in their own environment.</span></span> <span data-ttu-id="08001-160">詳細については、「[ExpressRoute QoS の要件](https://docs.microsoft.com/azure/expressroute/expressroute-qos)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="08001-160">To learn more, read [ExpressRoute QoS requirements](https://docs.microsoft.com/azure/expressroute/expressroute-qos).</span></span>


| <span data-ttu-id="08001-161">クライアントの送信元ポート</span><span class="sxs-lookup"><span data-stu-id="08001-161">Client source port</span></span>|<span data-ttu-id="08001-162">プロトコル</span><span class="sxs-lookup"><span data-stu-id="08001-162">Protocol</span></span>|<span data-ttu-id="08001-163">メディアのカテゴリ</span><span class="sxs-lookup"><span data-stu-id="08001-163">Media category</span></span>|<span data-ttu-id="08001-164">共通の DSCP 値</span><span class="sxs-lookup"><span data-stu-id="08001-164">Common DSCP value</span></span>|<span data-ttu-id="08001-165">DSCP クラス</span><span class="sxs-lookup"><span data-stu-id="08001-165">DSCP class</span></span>|
|---------|---------|---------|---------|---------|
| <span data-ttu-id="08001-166">50,000 ～ 50,019</span><span class="sxs-lookup"><span data-stu-id="08001-166">50,000 – 50,019</span></span>|<span data-ttu-id="08001-167">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="08001-167">TCP/UDP</span></span>|<span data-ttu-id="08001-168">音声</span><span class="sxs-lookup"><span data-stu-id="08001-168">Audio</span></span>|<span data-ttu-id="08001-169">46</span><span class="sxs-lookup"><span data-stu-id="08001-169">4-6</span></span>|<span data-ttu-id="08001-170">完全優先転送 (EF)</span><span class="sxs-lookup"><span data-stu-id="08001-170">Expedited Forwarding (EF)</span></span>|
| <span data-ttu-id="08001-171">50,020 ～ 50,039</span><span class="sxs-lookup"><span data-stu-id="08001-171">50,020 – 50,039</span></span>|<span data-ttu-id="08001-172">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="08001-172">TCP/UDP</span></span>|<span data-ttu-id="08001-173">ビデオ</span><span class="sxs-lookup"><span data-stu-id="08001-173">Video</span></span>|<span data-ttu-id="08001-174">34</span><span class="sxs-lookup"><span data-stu-id="08001-174">3-4</span></span>|<span data-ttu-id="08001-175">相対的優先転送 (AF41)</span><span class="sxs-lookup"><span data-stu-id="08001-175">Assured Forwarding (AF41)</span></span>|
| <span data-ttu-id="08001-176">50,040 ～ 50,059</span><span class="sxs-lookup"><span data-stu-id="08001-176">50,040 – 50,059</span></span>|<span data-ttu-id="08001-177">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="08001-177">TCP/UDP</span></span>|<span data-ttu-id="08001-178">アプリケーション/デスクトップ共有とファイル転送</span><span class="sxs-lookup"><span data-stu-id="08001-178">Application/Desktop Sharing and File Transfer</span></span>|<span data-ttu-id="08001-179">18</span><span class="sxs-lookup"><span data-stu-id="08001-179">18</span></span>|<span data-ttu-id="08001-180">クラス セレクター (CS3)</span><span class="sxs-lookup"><span data-stu-id="08001-180">Class Selector (CS3)</span></span>|

<span data-ttu-id="08001-181">表 1: DSCP マーキング</span><span class="sxs-lookup"><span data-stu-id="08001-181">Table 1: DSCP markings</span></span>

<span data-ttu-id="08001-182">表 1 の情報を使用するときに理解する必要があるいくつかの注意事項を次に示します。</span><span class="sxs-lookup"><span data-stu-id="08001-182">Here are some caveats to understand when you use the information in Table 1:</span></span>

- <span data-ttu-id="08001-183">ファイル共有とアプリケーション共有は、同じ送信元ポート範囲を使用しています。そのためポート ベースのタグ付けを使用するときには同じ DSCP マーキングを使用することになります。</span><span class="sxs-lookup"><span data-stu-id="08001-183">File sharing and application sharing use the same source port range – and as such, would use the same DSCP markings when using Port Based Tagging.</span></span> <span data-ttu-id="08001-184">これにより、*両方の*モダリティ (対話型または既定) にどの優先順位が該当するものか判別される必要があります。</span><span class="sxs-lookup"><span data-stu-id="08001-184">Because of this, it should be determined which priority is most applicable to *both* modalities (Interactive or Default).</span></span>
    
- <span data-ttu-id="08001-185">将来的に ExpressRoute を実装する計画がある場合で、QoS がまだ実装されていない場合に推奨されるのは、上記の指示に従って DSCP 値が送信者と受信者で同じであるようにすることです。</span><span class="sxs-lookup"><span data-stu-id="08001-185">If there’s a plan to implement ExpressRoute in the future and QoS has not yet been implemented, the recommendation is to follow the guidance given above so that DSCP values are the same from sender to receiver.</span></span> 
    
## <a name="source-ports-used-by-teams"></a><span data-ttu-id="08001-186">Teams によって使用されるソース ポート</span><span class="sxs-lookup"><span data-stu-id="08001-186">Source ports used by Teams</span></span>

<span data-ttu-id="08001-187">Teams では、QoS は異なるワークロードで使用される送信元ポートに基づいて構成される必要があります。</span><span class="sxs-lookup"><span data-stu-id="08001-187">In Teams, QoS should be configured based on the source ports used by the different workloads.</span></span> <span data-ttu-id="08001-188">サーバー側とクライアント側の両方のポート範囲はこの時点では構成可能ではありません。</span><span class="sxs-lookup"><span data-stu-id="08001-188">Both server-side and client-side port ranges are non-configurable at this point.</span></span> 

<span data-ttu-id="08001-189">QoS を展開するには、関連付けられている QoS DSCP マーキングとともに、表 2 に示されているクライアントの送信元ポート範囲を使用します。</span><span class="sxs-lookup"><span data-stu-id="08001-189">To deploy QoS, use the client source port ranges listed in Table 2, with their associated QoS DSCP markings.</span></span>

| <span data-ttu-id="08001-190">クライアントの送信元ポート</span><span class="sxs-lookup"><span data-stu-id="08001-190">Client source port</span></span>|<span data-ttu-id="08001-191">プロトコル</span><span class="sxs-lookup"><span data-stu-id="08001-191">Protocol</span></span>|<span data-ttu-id="08001-192">メディアのカテゴリ</span><span class="sxs-lookup"><span data-stu-id="08001-192">Media category</span></span>|<span data-ttu-id="08001-193">共通の DSCP 値</span><span class="sxs-lookup"><span data-stu-id="08001-193">Common DSCP value</span></span>|<span data-ttu-id="08001-194">DSCP クラス</span><span class="sxs-lookup"><span data-stu-id="08001-194">DSCP class</span></span>|
|---------|---------|---------|---------|---------|
| <span data-ttu-id="08001-195">50,000 ～ 50,019</span><span class="sxs-lookup"><span data-stu-id="08001-195">50,000 – 50,019</span></span>|<span data-ttu-id="08001-196">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="08001-196">TCP/UDP</span></span>|<span data-ttu-id="08001-197">音声</span><span class="sxs-lookup"><span data-stu-id="08001-197">Audio</span></span>|<span data-ttu-id="08001-198">46</span><span class="sxs-lookup"><span data-stu-id="08001-198">4-6</span></span>|<span data-ttu-id="08001-199">完全優先転送 (EF)</span><span class="sxs-lookup"><span data-stu-id="08001-199">Expedited Forwarding (EF)</span></span>|
| <span data-ttu-id="08001-200">50,020 ～ 50,039</span><span class="sxs-lookup"><span data-stu-id="08001-200">50,020 – 50,039</span></span>|<span data-ttu-id="08001-201">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="08001-201">TCP/UDP</span></span>|<span data-ttu-id="08001-202">ビデオ</span><span class="sxs-lookup"><span data-stu-id="08001-202">Video</span></span>|<span data-ttu-id="08001-203">34</span><span class="sxs-lookup"><span data-stu-id="08001-203">3-4</span></span>|<span data-ttu-id="08001-204">相対的優先転送 (AF41)</span><span class="sxs-lookup"><span data-stu-id="08001-204">Assured Forwarding (AF41)</span></span>|
| <span data-ttu-id="08001-205">50,040 ～ 50,059</span><span class="sxs-lookup"><span data-stu-id="08001-205">50,040 – 50,059</span></span>|<span data-ttu-id="08001-206">TCP/UDP</span><span class="sxs-lookup"><span data-stu-id="08001-206">TCP/UDP</span></span>|<span data-ttu-id="08001-207">アプリケーション/デスクトップ共有とファイル転送</span><span class="sxs-lookup"><span data-stu-id="08001-207">Application/Desktop Sharing and File Transfer</span></span>|<span data-ttu-id="08001-208">18</span><span class="sxs-lookup"><span data-stu-id="08001-208">18</span></span>|<span data-ttu-id="08001-209">クラス セレクター (CS3)</span><span class="sxs-lookup"><span data-stu-id="08001-209">Class Selector (CS3)</span></span>|

<span data-ttu-id="08001-210">表 2: クライアントの送信元ポートの範囲</span><span class="sxs-lookup"><span data-stu-id="08001-210">Table 2: Client source port ranges</span></span>

> [!NOTE]
> <span data-ttu-id="08001-211">既に Skype for Business Online で送信元ポートの範囲に基づいて QoS を構成済みの場合、同じ構成が Teams に適用され、追加で変更を行う必要はありません。</span><span class="sxs-lookup"><span data-stu-id="08001-211">If you've already configured QoS based on source port ranges for Skype for Business Online, the same configuration will apply to Teams and no further changes are required.</span></span> <span data-ttu-id="08001-212">Skype for Business Server (オンプレミス) を展開済みの場合は、QoS ポリシーを再設計する必要があります。</span><span class="sxs-lookup"><span data-stu-id="08001-212">If you’ve deployed Skype for Business Server (on premises), you will need to redesign your QoS Policies.</span></span>

## <a name="setting-differentiated-services-code-point-dscp-markings"></a><span data-ttu-id="08001-213">DSCP (Differentiated Services Code Point) のマーキングの設定</span><span class="sxs-lookup"><span data-stu-id="08001-213">Setting differentiated services code point (DSCP) markings</span></span>

<span data-ttu-id="08001-214">トラフィックを分類するために適切な DSCP マーキングを設定するための手段は複数あります。</span><span class="sxs-lookup"><span data-stu-id="08001-214">There are multiple approaches to setting the proper DSCP markings for traffic classification.</span></span>

- <span data-ttu-id="08001-215">エンドポイントでの DSCP マーキング: これはエンドポイント自体が適切なマーキングを提供するので、一般的に優先して使用されるオプションです。</span><span class="sxs-lookup"><span data-stu-id="08001-215">DSCP marking at the endpoint: This is the preferred option in general, as the endpoint itself is providing the proper markings.</span></span> <span data-ttu-id="08001-216">現在、このオプションは GPO を使用することによって実行されますが、ドメイン参加の Windows クライアントでのみ可能です。</span><span class="sxs-lookup"><span data-stu-id="08001-216">Currently this could be done by using a GPO, but this is only possible on domain-joined Windows clients.</span></span> <span data-ttu-id="08001-217">Mac OSX またはモバイル クライアントでは、トラフィックを DSCP 値でマーキングするメカニズムは利用できません。</span><span class="sxs-lookup"><span data-stu-id="08001-217">Mac OSX or mobile clients, for example, do not provide a mechanism to mark traffic with DSCP values.</span></span>

- <span data-ttu-id="08001-218">ルーターで ACL を使用するポート ベース: これは Windows と Mac の異種環境でよく見られる一般的なオプションです。</span><span class="sxs-lookup"><span data-stu-id="08001-218">Port-based using ACLs on routers: This is a very common option encountered in heterogeneous environments of Windows and Mac.</span></span> <span data-ttu-id="08001-219">このシナリオでは、各モダリティで定義された送信元ポートの範囲に基づいて、ネットワーク チームがトラフィックを (通常はワイド エリア ネットワーク (WAN) 上の) イングレス/エグレス ルーターでマーキングします。</span><span class="sxs-lookup"><span data-stu-id="08001-219">In this scenario, the network team marks the traffic at the ingress/egress routers (typically on the Wide Area Network (WAN)) based on the source port ranges defined for each modality.</span></span> <span data-ttu-id="08001-220">このオプションは異なるプラットフォームにわたって機能しますが、マーキングを行うのは WAN エッジにおいてのみで、クライアント マシンに到達するまでの経路全体ではなく、管理オーバーヘッドが発生します。</span><span class="sxs-lookup"><span data-stu-id="08001-220">While this works across platforms, it only marks at the WAN edge – not all the way to the client machine – and incurs management overhead.</span></span>
    
- <span data-ttu-id="08001-221">クライアントでの DSCP マーキングと、ルーターでのポートベースの ACL の組み合わせ。</span><span class="sxs-lookup"><span data-stu-id="08001-221">A combination of DSCP markings on the client and port-based ACLs on routers.</span></span>
    
<span data-ttu-id="08001-222">可能な場合は、これらの両方の組み合わせで、クライアントの大多数を捕らえるために GPO を使用すること、およびモバイル クライアント、Mac その他のクライアントが確実に (部分的な) QoS 処理を施されるようにするためにポート ベースの DSCP タグ付けも使用することを推奨します。</span><span class="sxs-lookup"><span data-stu-id="08001-222">If possible, we recommend a combination of both, to use a GPO to catch the majority of clients, and to also use port based DSCP tagging to ensure mobile clients, Mac and other clients will still get a (partial) QoS treatment.</span></span>

<span data-ttu-id="08001-223">Teams クライアントでの事前設定された送信元ポート範囲に対する DSCP 値の設定は、グループ ポリシー内のポリシーベースの QoS を使用して行うことができます。</span><span class="sxs-lookup"><span data-stu-id="08001-223">Setting the DSCP value for the pre-defined source port range in the Teams client can be done using policy-based QoS within Group Policy.</span></span> <span data-ttu-id="08001-224">次の表で使用するポート範囲は、各ワークロードのポリシーを作成するための表で指定されたポート範囲です。</span><span class="sxs-lookup"><span data-stu-id="08001-224">The following table uses the port ranges specified in the table to create a policy for each workload.</span></span>

| <span data-ttu-id="08001-225">クライアントのトラフィックの種類</span><span class="sxs-lookup"><span data-stu-id="08001-225">Client traffic type</span></span>|<span data-ttu-id="08001-226">ポート範囲の開始</span><span class="sxs-lookup"><span data-stu-id="08001-226">Port range start</span></span>|<span data-ttu-id="08001-227">ポート範囲の終了</span><span class="sxs-lookup"><span data-stu-id="08001-227">Port range end</span></span>|<span data-ttu-id="08001-228">DSCP 値</span><span class="sxs-lookup"><span data-stu-id="08001-228">DSCP value</span></span>|
|---------|---------|---------|--------|
| <span data-ttu-id="08001-229">音声</span><span class="sxs-lookup"><span data-stu-id="08001-229">Audio</span></span>|<span data-ttu-id="08001-230">50000</span><span class="sxs-lookup"><span data-stu-id="08001-230">50000</span></span>|<span data-ttu-id="08001-231">50019</span><span class="sxs-lookup"><span data-stu-id="08001-231">50019</span></span>|<span data-ttu-id="08001-232">46</span><span class="sxs-lookup"><span data-stu-id="08001-232">4-6</span></span>|
| <span data-ttu-id="08001-233">ビデオ</span><span class="sxs-lookup"><span data-stu-id="08001-233">Video</span></span>|<span data-ttu-id="08001-234">50020</span><span class="sxs-lookup"><span data-stu-id="08001-234">50020</span></span>|<span data-ttu-id="08001-235">50039</span><span class="sxs-lookup"><span data-stu-id="08001-235">50039</span></span>|<span data-ttu-id="08001-236">34</span><span class="sxs-lookup"><span data-stu-id="08001-236">3-4</span></span>|
| <span data-ttu-id="08001-237">アプリケーション共有</span><span class="sxs-lookup"><span data-stu-id="08001-237">Application sharing</span></span>|<span data-ttu-id="08001-238">50040</span><span class="sxs-lookup"><span data-stu-id="08001-238">50040</span></span>|<span data-ttu-id="08001-239">50059</span><span class="sxs-lookup"><span data-stu-id="08001-239">50059</span></span>|<span data-ttu-id="08001-240">18</span><span class="sxs-lookup"><span data-stu-id="08001-240">18</span></span>|
| <span data-ttu-id="08001-241">ファイル転送</span><span class="sxs-lookup"><span data-stu-id="08001-241">File transfer</span></span>|<span data-ttu-id="08001-242">50040</span><span class="sxs-lookup"><span data-stu-id="08001-242">50040</span></span>|<span data-ttu-id="08001-243">50059</span><span class="sxs-lookup"><span data-stu-id="08001-243">50059</span></span>|<span data-ttu-id="08001-244">18</span><span class="sxs-lookup"><span data-stu-id="08001-244">18</span></span>|

<span data-ttu-id="08001-245">表 3: トラフィックの種類ごとのポート範囲</span><span class="sxs-lookup"><span data-stu-id="08001-245">Table 3: Port ranges by traffic type</span></span>

<span data-ttu-id="08001-246">注: Teams によって設定されたポート範囲は変更や改変をすることはできません。</span><span class="sxs-lookup"><span data-stu-id="08001-246">Note: The port ranges set by Teams cannot be changed or altered.</span></span> <span data-ttu-id="08001-247">最新の情報については、https://support.microsoft.com/ kb/2409256 で確認してください。</span><span class="sxs-lookup"><span data-stu-id="08001-247">Please review this page for the latest information: https://support.microsoft.com/ kb/2409256</span></span>

<span data-ttu-id="08001-248">ポート範囲が決定したら、次の手順はグループ ポリシー オブジェクト (GPO) 内でポリシー ベースの QoS 設定を構成することです。</span><span class="sxs-lookup"><span data-stu-id="08001-248">Once the port ranges have been determined, the next step is to configure the policy-based QoS settings within a Group Policy Object (GPO).</span></span> <span data-ttu-id="08001-249">それらの手順の詳細については、[TechNet](https://technet.microsoft.com/library/jj205371(v=ocs.15).aspx) をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="08001-249">Details for these steps can be found on [TechNet](https://technet.microsoft.com/library/jj205371(v=ocs.15).aspx).</span></span> 

<span data-ttu-id="08001-250">作成した新しいポリシーは、グループ ポリシーがクライアント コンピューター上で更新されるまで有効になりません。</span><span class="sxs-lookup"><span data-stu-id="08001-250">The new policies you have created won’t take effect until Group Policy has been refreshed on your client computers.</span></span> <span data-ttu-id="08001-251">グループ ポリシーは定期的に自動更新されますが、グループ ポリシーを更新する必要がある各コンピューター上で次のコマンドを実行すると、即座に強制的に更新することができます。</span><span class="sxs-lookup"><span data-stu-id="08001-251">Although Group Policy periodically refreshes on its own, you can force an immediate refresh by running the following command on each computer where Group Policy needs to be refreshed:</span></span>

        gpudate.exe /force

<span data-ttu-id="08001-252">このコマンドは、管理者の資格情報のもとで実行されているコマンド ウィンドウから実行できます。</span><span class="sxs-lookup"><span data-stu-id="08001-252">This command can be run from any command window that is running under administrator credentials.</span></span> <span data-ttu-id="08001-253">管理者の資格情報のもとでコマンド ウィンドウを開くには、[**スタート**] メニューをクリックし、[**コマンド プロンプト**] を右クリックして、[**管理者として実行**] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="08001-253">To open a command window, click **Start**, right-click **Command Prompt**, and then click **Run as administrator**.</span></span>

## <a name="verifying-the-dscp-markings-in-gpo"></a><span data-ttu-id="08001-254">GPO での DSCP マーキングの確認</span><span class="sxs-lookup"><span data-stu-id="08001-254">Verifying the DSCP markings in GPO</span></span>

<span data-ttu-id="08001-255">GPO からの値が設定されていることを確認するには、次の手順を実行してください。</span><span class="sxs-lookup"><span data-stu-id="08001-255">To verify that the values from the GPO has been set, please perform the following steps:</span></span>

1.  <span data-ttu-id="08001-256">gpresult を使用して、GPO からの設定がローカル PC で受け取られていることを確認します。</span><span class="sxs-lookup"><span data-stu-id="08001-256">Use gpresult to verify that the settings from the GPO has been received by the local PC.</span></span> <span data-ttu-id="08001-257">gpresult /R >gp.txt により、レポートが生成されて、gp.txt というテキスト ファイルに送信されます。</span><span class="sxs-lookup"><span data-stu-id="08001-257">gpresult /R >gp.txt will generate a report and send it to a text file, gp.txt.</span></span>

    ![gpresult コマンドを実行する管理者コマンド プロンプトのスクリーンショット。](media/Qos-in-Teams-Image3.png)

    <span data-ttu-id="08001-259">図 2: Applied Group Policy Objects (適用されたグループ ポリシー オブジェクト) の確認</span><span class="sxs-lookup"><span data-stu-id="08001-259">Figure 2: Verify Applied Group Policy Objects</span></span>
    > [!NOTE]
    > <span data-ttu-id="08001-260">または、gpresult /H gp.html を実行して、同じデータをよりユーザー フレンドリな HTML レポートに生成することもできます。</span><span class="sxs-lookup"><span data-stu-id="08001-260">Alternatively, you can run gpresult /H gp.html to produce the same data in more user-friendly HTML report.</span></span> 
2.  <span data-ttu-id="08001-261">生成されたファイルで Applied Group Policy Objects の見出しを探して、適用されたポリシーのリストに以前作成した GPO の名前があることを確認します。</span><span class="sxs-lookup"><span data-stu-id="08001-261">In the generated file look for the heading: Applied Group Policy Objects and verify that the names of the GPO’s created earlier is in the list of applied policies.</span></span> 

3.  <span data-ttu-id="08001-262">レジストリ エディタを開いて、次に移動します。</span><span class="sxs-lookup"><span data-stu-id="08001-262">Open the registry editor and navigate to:</span></span>

    <span data-ttu-id="08001-263">HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\QoS\\</span><span class="sxs-lookup"><span data-stu-id="08001-263">HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\QoS\\</span></span>

    <span data-ttu-id="08001-264">以下の表 3 に示されているレジストリ値を確認します。</span><span class="sxs-lookup"><span data-stu-id="08001-264">Verify the registry values listed in Table 3 below.</span></span>
    
    | <span data-ttu-id="08001-265">名前</span><span class="sxs-lookup"><span data-stu-id="08001-265">Name</span></span> | <span data-ttu-id="08001-266">種類</span><span class="sxs-lookup"><span data-stu-id="08001-266">Type</span></span> | <span data-ttu-id="08001-267">データ</span><span class="sxs-lookup"><span data-stu-id="08001-267">Data</span></span>|
    |---------|---------|---------
    | <span data-ttu-id="08001-268">Application Name</span><span class="sxs-lookup"><span data-stu-id="08001-268">Application Name</span></span>|<span data-ttu-id="08001-269">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="08001-269">REG_SZ</span></span>|<span data-ttu-id="08001-270">Teams.exe</span><span class="sxs-lookup"><span data-stu-id="08001-270">Teams.exe</span></span>|
    | <span data-ttu-id="08001-271">DSCP Value</span><span class="sxs-lookup"><span data-stu-id="08001-271">DSCP Value</span></span>|<span data-ttu-id="08001-272">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="08001-272">REG_SZ</span></span>|<span data-ttu-id="08001-273">46</span><span class="sxs-lookup"><span data-stu-id="08001-273">4-6</span></span>|
    | <span data-ttu-id="08001-274">Local IP</span><span class="sxs-lookup"><span data-stu-id="08001-274">Second Reflexive Local IP</span></span>|<span data-ttu-id="08001-275">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="08001-275">REG_SZ</span></span>|*|
    | <span data-ttu-id="08001-276">Local IP Prefix Length</span><span class="sxs-lookup"><span data-stu-id="08001-276">Local IP Prefix Length</span></span>|<span data-ttu-id="08001-277">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="08001-277">REG_SZ</span></span>|*|
    | <span data-ttu-id="08001-278">Local Port</span><span class="sxs-lookup"><span data-stu-id="08001-278">Local Port</span></span>|<span data-ttu-id="08001-279">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="08001-279">REG_SZ</span></span>|<span data-ttu-id="08001-280">50000-50019</span><span class="sxs-lookup"><span data-stu-id="08001-280">50000-50019</span></span>|
    | <span data-ttu-id="08001-281">プロトコル</span><span class="sxs-lookup"><span data-stu-id="08001-281">Protocol</span></span>|<span data-ttu-id="08001-282">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="08001-282">REG_SZ</span></span>|*|
    | <span data-ttu-id="08001-283">Remote IP</span><span class="sxs-lookup"><span data-stu-id="08001-283">Remote IP</span></span>|<span data-ttu-id="08001-284">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="08001-284">REG_SZ</span></span>|*|
    | <span data-ttu-id="08001-285">Remote Ip Prefix</span><span class="sxs-lookup"><span data-stu-id="08001-285">Remote Ip Prefix</span></span>|<span data-ttu-id="08001-286">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="08001-286">REG_SZ</span></span>|*|
    | <span data-ttu-id="08001-287">Remote Port</span><span class="sxs-lookup"><span data-stu-id="08001-287">Remote Port</span></span>|<span data-ttu-id="08001-288">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="08001-288">REG_SZ</span></span>|*|
    | <span data-ttu-id="08001-289">Throttle Rate</span><span class="sxs-lookup"><span data-stu-id="08001-289">Throttle Rate</span></span>|<span data-ttu-id="08001-290">REG_SZ</span><span class="sxs-lookup"><span data-stu-id="08001-290">REG_SZ</span></span>|<span data-ttu-id="08001-291">-1</span><span class="sxs-lookup"><span data-stu-id="08001-291">$1</span></span>|
    
    <span data-ttu-id="08001-292">表 3: QoS の Windows レジストリ値</span><span class="sxs-lookup"><span data-stu-id="08001-292">Table 3: Windows registry values for QoS</span></span>

4.  <span data-ttu-id="08001-293">現在使用しているクライアントに対して Application Name が正しいことを確認し、DSCP Value と Local Port が GPO の設定を反映していることを確認します。</span><span class="sxs-lookup"><span data-stu-id="08001-293">Verify that the Application Name is correct for the client you are using, and verify that both DSCP value and Local Port reflect the settings in the GPO.</span></span>

## <a name="validating-qos-analyzing-teams-traffic-on-the-network"></a><span data-ttu-id="08001-294">QoS の確認: ネットワーク上の Teams トラフィックの分析</span><span class="sxs-lookup"><span data-stu-id="08001-294">Validating QoS: Analyzing Teams traffic on the network</span></span>

<span data-ttu-id="08001-295">GPO によって設定された DSCP 値は、QoS が効力を生じるようにするために、呼び出し先から呼び出し元に提示される必要があります。</span><span class="sxs-lookup"><span data-stu-id="08001-295">The DSCP value set by the GPO needs to be present from caller to callee in order for QoS to be affective.</span></span> <span data-ttu-id="08001-296">Teams クライアントによって生成されたトラフィックを見ることによって、ネットワークを横断するときに DSCP が変更されていないか、またはストリップ化されていないかを確認することができます。</span><span class="sxs-lookup"><span data-stu-id="08001-296">By looking at the traffic generated by the Teams client we can verify that the DSCP is not changed or stripped out when traversing the network.</span></span> 

<span data-ttu-id="08001-297">望ましいのは、ネットワークのエグレス ポイントでトラフィックをキャプチャすることです。</span><span class="sxs-lookup"><span data-stu-id="08001-297">Preferably we would capture traffic at the network egress point.</span></span> <span data-ttu-id="08001-298">ネットワーク上のトラフィックのキャプチャを支援するために、ポート ミラーリングをスイッチまたはルーターで使用できます。</span><span class="sxs-lookup"><span data-stu-id="08001-298">Port mirroring can be used on a switch or router to aid in capturing traffic on the network.</span></span> 

### <a name="looking-at-network-traffic-using-network-monitor"></a><span data-ttu-id="08001-299">ネットワーク モニターを使用してネットワーク トラフィックを見る</span><span class="sxs-lookup"><span data-stu-id="08001-299">Looking at network traffic using Network Monitor</span></span>

<span data-ttu-id="08001-300">ネットワーク モニターはネットワーク トラフィックを分析するために Microsoft からダウンロードできるツールです。</span><span class="sxs-lookup"><span data-stu-id="08001-300">Network Monitor is a tool you can download from Microsoft to analyze network traffic.</span></span> <span data-ttu-id="08001-301">[ネットワーク モニター 3.4](https://www.microsoft.com/download/4865) をダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="08001-301">Download [Network Monitor 3.4](https://www.microsoft.com/download/4865).</span></span>

<span data-ttu-id="08001-302">ネットワーク モニターを実行している PC をポート ミラーリングが構成済みのポートに接続し、パケットのキャプチャを開始します。</span><span class="sxs-lookup"><span data-stu-id="08001-302">Connect to PC running network monitor to the port that has been configured for port mirroring and start capturing packets.</span></span> <span data-ttu-id="08001-303">Skype for Business クライアントを使用して通話を発信します。</span><span class="sxs-lookup"><span data-stu-id="08001-303">Make a call using the Skype for Business client.</span></span> <span data-ttu-id="08001-304">通話を切る前に必ずメディアが確立されている状態にします。</span><span class="sxs-lookup"><span data-stu-id="08001-304">Make sure media is established before hanging up the call.</span></span> <span data-ttu-id="08001-305">通話を発信した PC の送信元 IP に一致する、キャプチャが作成した表示フィルターを停止し、DSCP 値 46 (16 進数で 0xb8) を検索条件として定義することによってフィルターを絞り込みます。</span><span class="sxs-lookup"><span data-stu-id="08001-305">Stop the capture create a Display Filter that matches the source IP of the PC that made the call and refine the filter by defining DSCP value 46 (hex 0xb8) as search criteria:</span></span>

<span data-ttu-id="08001-306">Source == "192.168.137.201" AND IPv4.DifferentiatedServicesField == 0xb8</span><span class="sxs-lookup"><span data-stu-id="08001-306">Source == "192.168.137.201" AND IPv4.DifferentiatedServicesField == 0xb8</span></span> 

![適用するフィルターを示している、ネットワーク モニターの表示フィルター ダイアログ ボックスのスクリーンショット。](media/Qos-in-Teams-Image4.png)


<span data-ttu-id="08001-308">[**Apply**] をクリックして、フィルターをアクティブ化します。</span><span class="sxs-lookup"><span data-stu-id="08001-308">Click **Apply** to activate the filter.</span></span> <span data-ttu-id="08001-309">[**Frame Summary**] ウィンドウで、最初の UDP パケットを選択して [Frame Details] を表示します。</span><span class="sxs-lookup"><span data-stu-id="08001-309">In the **Frame Summary** window, select the first UDP packet and look at the Frame Details:</span></span>

![DSCP 設定を強調表示している、ネットワーク モニターの [Frame Details] ダイアログ ボックスのスクリーンショット。](media/Qos-in-Teams-Image5.png)

<span data-ttu-id="08001-311">IPv4 を展開して、DSCP 行の最後の値を見ます。</span><span class="sxs-lookup"><span data-stu-id="08001-311">Expand IPv4 and look at the value at the end of the DSCP line.</span></span> <span data-ttu-id="08001-312">この例では、DSCP 値は 46 に設定されています。使用される送信元ポートが 50019 で、ワークロードが音声ということがわかりますので、この値は正しいことになります。</span><span class="sxs-lookup"><span data-stu-id="08001-312">In this example we see that the DSCP value is set to 46 which is correct since the source port used is 50019 which tells us that the workload is voice.</span></span> 

<span data-ttu-id="08001-313">GPO によってマーキングされている各ワークロードについて確認を繰り返します。</span><span class="sxs-lookup"><span data-stu-id="08001-313">Repeat the verification for each workload that has been marked by the GPO.</span></span> 

> [!NOTE]
> <span data-ttu-id="08001-314">マーキングがピアツーピアのトラフィックに対しても受け入れられることを確認します。</span><span class="sxs-lookup"><span data-stu-id="08001-314">Verify that markings are honored for peer-to-peer traffic as well.</span></span> <span data-ttu-id="08001-315">これは、2 つのクライアントにネットワーク モニターをインストールして、それら 2 つのクライアントの間で通話することによって実行できます。</span><span class="sxs-lookup"><span data-stu-id="08001-315">This can be done by installing Network Monitor on two clients and placing calls between the two clients.</span></span> <span data-ttu-id="08001-316">クライアント間のメディアのトラフィック フローを、上記と同じ方法で確認します。</span><span class="sxs-lookup"><span data-stu-id="08001-316">Look at the media traffic flowing between clients in the same manner as described above.</span></span>

### <a name="sample-filters-to-use-for-network-monitor-or-wireshark"></a><span data-ttu-id="08001-317">ネットワーク モニターまたは Wireshark のために使用するフィルターの例</span><span class="sxs-lookup"><span data-stu-id="08001-317">Sample filters to use for Network Monitor or Wireshark</span></span>

|<span data-ttu-id="08001-318">使用方法</span><span class="sxs-lookup"><span data-stu-id="08001-318">Usage</span></span>  |<span data-ttu-id="08001-319">フィルターの例</span><span class="sxs-lookup"><span data-stu-id="08001-319">Sample filter</span></span>  |
|---------|---------|
|<span data-ttu-id="08001-320">音声 (注: 多重化はオフにする必要があります)</span><span class="sxs-lookup"><span data-stu-id="08001-320">Voice (note: muxing must be turned off)</span></span>     |   <span data-ttu-id="08001-321">udp.port==3479 AND Ipv4.DifferentiatedServicesField.DSCP==46</span><span class="sxs-lookup"><span data-stu-id="08001-321">udp.port==3479 AND Ipv4.DifferentiatedServicesField.DSCP==46</span></span>      |
|<span data-ttu-id="08001-322">ビデオ</span><span class="sxs-lookup"><span data-stu-id="08001-322">Video</span></span>     | <span data-ttu-id="08001-323">udp.port==3480 AND Ipv4.DifferentiatedServicesField.DSCP==34</span><span class="sxs-lookup"><span data-stu-id="08001-323">udp.port==3480 AND Ipv4.DifferentiatedServicesField.DSCP==34</span></span>        |
|<span data-ttu-id="08001-324">画面共有</span><span class="sxs-lookup"><span data-stu-id="08001-324">Screen sharing</span></span>     |  <span data-ttu-id="08001-325">udp.port==3481 AND Ipv4.DifferentiatedServicesField.DSCP==18</span><span class="sxs-lookup"><span data-stu-id="08001-325">udp.port==3481 AND Ipv4.DifferentiatedServicesField.DSCP==18</span></span>       |

### <a name="filter-media-traffic-from-microsoft-relays-requires-azure-expressroutehttpsazuremicrosoftcomservicesexpressroute"></a><span data-ttu-id="08001-326">フィルター: Microsoft リレーからのメディアのトラフィック ([Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/) が必要です)</span><span class="sxs-lookup"><span data-stu-id="08001-326">Filter: Media traffic from Microsoft relays (requires [Azure ExpressRoute](https://azure.microsoft.com/services/expressroute/))</span></span>

<span data-ttu-id="08001-327">ip.src は {52.114.188.0/22 52.114.220.0/22 52.114.124.0/22 52.114.60.0/22} 、および (udp.srcport が {3479 3480 3481} または (udp.srcport ge 50000 と udp.srcport lt 60000))</span><span class="sxs-lookup"><span data-stu-id="08001-327">ip.src in {52.114.188.0/22 52.114.220.0/22 52.114.124.0/22 52.114.60.0/22} and (udp.srcport in {3479 3480 3481} or (udp.srcport ge 50000 and udp.srcport lt 60000))</span></span>

### <a name="filter-media-traffic-to-microsoft-relays"></a><span data-ttu-id="08001-328">フィルター: Microsoft リレーへのメディアのトラフィック</span><span class="sxs-lookup"><span data-stu-id="08001-328">Filter: Media traffic to Microsoft relays</span></span>

<span data-ttu-id="08001-329">ip.dst は {52.114.188.0/22 52.114.220.0/22 52.114.124.0/22 52.114.60.0/22} 、および (udp.dstport が {3479 3480 3481} または (udp.dstport ge 50000 と udp.dstport lt 60000))</span><span class="sxs-lookup"><span data-stu-id="08001-329">ip.dst in {52.114.188.0/22 52.114.220.0/22 52.114.124.0/22 52.114.60.0/22} and (udp.dstport in {3479 3480 3481} or (udp.dstport ge 50000 and udp.dstport lt 60000))</span></span>


<span data-ttu-id="08001-330">Microsoft リレーからのトラフィック、および Microsoft リレーへのトラフィックを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="08001-330">You should see traffic to and from the Microsoft relays.</span></span> <span data-ttu-id="08001-331">次のセクションで示されるように、Wireshark の IP レイヤー上で DSCP マーキングをチェックすることができます。</span><span class="sxs-lookup"><span data-stu-id="08001-331">You can check DSCP markings on the IP layer in Wireshark, as shown in the next section.</span></span>

### <a name="expected-dscp-markings"></a><span data-ttu-id="08001-332">必要とされる DSCP マーキング</span><span class="sxs-lookup"><span data-stu-id="08001-332">Expected DSCP markings</span></span>

<span data-ttu-id="08001-333">オーディオ ストリーム: 46</span><span class="sxs-lookup"><span data-stu-id="08001-333">Audio streams: 46</span></span>

<span data-ttu-id="08001-334">ビデオ ストリーム: 34</span><span class="sxs-lookup"><span data-stu-id="08001-334">Video streams: 34</span></span>

<span data-ttu-id="08001-335">データ ストリーム: 18</span><span class="sxs-lookup"><span data-stu-id="08001-335">Data streams: 18</span></span>

### <a name="filter-dscp-condition-to-network"></a><span data-ttu-id="08001-336">フィルター: ネットワークに対する DSCP 条件</span><span class="sxs-lookup"><span data-stu-id="08001-336">Filter: DSCP condition to network</span></span>

<span data-ttu-id="08001-337">ip.dsfield.dscp は {46 34 18}</span><span class="sxs-lookup"><span data-stu-id="08001-337">ip.dsfield.dscp in {46 34 18}</span></span>



### <a name="looking-at-network-traffic-using-wireshark"></a><span data-ttu-id="08001-338">Wireshark を使用したネットワーク トラフィックの確認</span><span class="sxs-lookup"><span data-stu-id="08001-338">Looking at network traffic using Wireshark</span></span>

<span data-ttu-id="08001-339">Wireshark、https://www.wireshark.org/、は強力なツールで、より詳細な分析のために、ネットワーク データをフィルターして記録することができます。</span><span class="sxs-lookup"><span data-stu-id="08001-339">Wireshark, https://www.wireshark.org/, is a powerful tool that allows us to filter and record network data for further analysis.</span></span> <span data-ttu-id="08001-340">Wireshark を実行している PC をポート ミラーリングが構成済みのポートに接続し、パケットのキャプチャを開始します。</span><span class="sxs-lookup"><span data-stu-id="08001-340">Connect a PC running Wireshark to the port that has been configured for port mirroring and start capturing packets.</span></span> <span data-ttu-id="08001-341">Teams クライアントを使用して通話を発信します。</span><span class="sxs-lookup"><span data-stu-id="08001-341">Make a call using the Teams client.</span></span> <span data-ttu-id="08001-342">通話を切る前に必ずメディアが確立されている状態にします。</span><span class="sxs-lookup"><span data-stu-id="08001-342">Make sure media is established before hanging up the call.</span></span>

<span data-ttu-id="08001-343">パケット トレースを停止して、Teams クライアントがインストールされている PC の送信元 IP (例: *ip.src_host == 192.168.137.201*) のみを表示し、音声に対して指定されている範囲 50,000 ～ 50,019 から送信元ポートを使用するパッケージを検索するフィルターを作成します。</span><span class="sxs-lookup"><span data-stu-id="08001-343">Stop the packet trace and create a filter that only displays the source IP of the PC where the Teams client is installed, for example, *ip.src_host == 192.168.137.201* and looks for packages that use a source port from the range specified for voice, 50,000 – 50,019:</span></span>

![フィルターが設定された Wireshark のスクリーンショット。](media/Qos-in-Teams-Image6.png)
 

<span data-ttu-id="08001-345">パッケージをマーキングして、パケットの詳細ペインでインターネット プロトコル バージョン 4 (IPV4) のヘッダーを展開します。</span><span class="sxs-lookup"><span data-stu-id="08001-345">Mark the package and expand the Internet Protocol Version 4 (IPV4) header in the packet detail pane:</span></span>

![Differentiated Services Codepoint 設定が強調表示された Wireshark のスクリーンショット。](media/Qos-in-Teams-Image7.png)
 

<span data-ttu-id="08001-347">*Differentiated Services Codepoint* の値が特定のワークロードの値 (この場合は音声の 46 (バイナリで 101110) という値) と一致することを確認します。</span><span class="sxs-lookup"><span data-stu-id="08001-347">Verify that the value for *Differentiated Services Codepoint* match the value for the specific workload, in this case 46 (binary 101110) for voice.</span></span>

<span data-ttu-id="08001-348">GPO によってマーキングされている各ワークロードについて確認を繰り返します。</span><span class="sxs-lookup"><span data-stu-id="08001-348">Repeat the verification for each workload that has been marked by the GPO.</span></span>

> [!NOTE]
> <span data-ttu-id="08001-349">マーキングがピアツーピアのトラフィックで受け入れられることを確認します。</span><span class="sxs-lookup"><span data-stu-id="08001-349">Verify that markings are honored for peer-to-peer traffic.</span></span> <span data-ttu-id="08001-350">これは、2 つのクライアントに WireShark またはネットワーク モニターをインストールして、それら 2 つのクライアントの間で通話することによって実行できます。</span><span class="sxs-lookup"><span data-stu-id="08001-350">This can be done by installing WireShark or Network Monitor on two clients and placing calls between the two clients.</span></span> <span data-ttu-id="08001-351">クライアント間のメディアのトラフィック フローを、上記と同じ方法で確認します。</span><span class="sxs-lookup"><span data-stu-id="08001-351">Look at the media traffic flowing between clients in the same manner as described above.</span></span>

## <a name="summary"></a><span data-ttu-id="08001-352">概要</span><span class="sxs-lookup"><span data-stu-id="08001-352">Summary</span></span>

<span data-ttu-id="08001-353">サービスの品質は、Teams でビジネス クラスのエクスペリエンスを提供するための 1 つの重要な鍵となります。</span><span class="sxs-lookup"><span data-stu-id="08001-353">Quality of Service is an important piece of the puzzle when providing business-class experiences with Teams.</span></span> <span data-ttu-id="08001-354">ただし、QoS が効力を発揮するのは適切に管理されているネットワーク上のみであることを常に認識していることが重要です。</span><span class="sxs-lookup"><span data-stu-id="08001-354">However, it is important to always remember that QoS is only effective on properly managed networks.</span></span> <span data-ttu-id="08001-355">このようにすることで、展開チームがネットワーキング チームと緊密に連携して、確実に適切な情報がネットワーク レイヤーで渡され、理想的にはエンド ツー エンドで管理されるようにします。</span><span class="sxs-lookup"><span data-stu-id="08001-355">As such, the deployment team must work very closely with the networking teams to ensure the proper information is passed at the network layer, ideally managed from end-to-end.</span></span>

