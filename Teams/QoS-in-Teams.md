---
title: Microsoft Teams でサービスの品質 (QoS) を実施する
author: rmw2890
ms.author: Rowille
manager: Serdars
ms.date: 12/17/2018
ms.topic: article
ms.service: msteams
ms.reviewer: rowille
description: Microsoft Teams でのサービスの品質 (QoS) のために組織のネットワークを準備する
localization_priority: Normal
search.appverid: MET150
f1keywords: ms.teamsadmincenter.meetingsettings.qos
MS.collection:
- Teams_ITAdmin_PracticalGuidance
- M365-collaboration
appliesto:
- Microsoft Teams
ms.openlocfilehash: bc8f7cf66d13f78b685505d41e9e5b1342931923
ms.sourcegitcommit: fa7d93551f65b2e23f9407e10a33282f71982e85
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/29/2019
ms.locfileid: "33470646"
---
# <a name="implement-quality-of-service-qos-in-microsoft-teams"></a>マイクロソフトのチームでのサービス品質 (QoS) を実装します。

この資料は、組織のネットワークのサービス品質 (QoS) マイクロソフトのチームのための準備に役立ちます。 大規模なユーザー グループをサポートしている場合、下記の問題のいずれかで発生している可能性があります、QoS を実装する必要があります。 小規模企業でいくつかのユーザー必要はありませんが QoS、ですが、でもあることが役に立つ。

QoS は、カットの行には (と同じようにダウンロードするのには追加の 2 番目が大きな問題をされていない、新しいアプリケーションをダウンロードするには) 重要度の低いトラフィックの前にするにはネットワークの遅延に敏感である (音声またはビデオのストリーム) のようなリアルタイムのネットワーク トラフィックを許可する方法です。 QoS を識別し、(Windows のグループ ポリシー オブジェクト、およびポート ベースのアクセス制御リスト、詳細の下にあるものと呼ばれるルーティング機能を使用して) リアルタイムのストリーム内のすべてのパケットをマークし、音声、ビデオ、および画面共有のストリームを提供するネットワークを支援する、ネットワーク帯域幅の部分を専用です。

QoS のフォームの一部をなしには、音声およびビデオの次の品質の問題を参照してください可能性があります。

- ジッター: メディア パケットの到着率が異なる、単語または音節の呼び出しが不足しているが発生することができます。
- パケット損失: 削除すると、パケットも発生することが音声の品質が低いと強い音声を理解します。
- 往復時間 (RTT) – メディア パケットが、宛先に到達するのに時間がかかっての遅延その結果は互いの上で会話する人の原因との会話で 2 つの当事者間の遅延が顕著です。

これらの問題に対処する最も単純な方法は、データ接続のサイズを大きくには、両方内部や、インターネットにします。 多くの場合コストが膨大であるために、QoS は新しいリソースを追加する代わりにリソースをより効果的に管理する手段を提供します。 完全に品質問題を解決する、実装間で QoS を使用して、絶対に必要な場合にのみ接続を追加します。

有効にする qos は、QoS 優先順位をサポートするために失敗したパスの任意の部分が低下する可能性があるために、一貫した QoS 設定 (すべてのユーザーの Pc、ネットワーク スイッチ、およびルーターは、インターネットを含む)、組織では、エンド ツー エンドを適用する必要がある、通話、ビデオ、および画面の品質を共有します。

_図 1 です。組織のネットワークおよび Office 365 のサービス間の関係_

![組織のネットワークおよび Office 365 のサービス間の関係: オンプレミス ネットワークとデバイスは、Office 365 のクラウドの音声および電話会議サービスに接続する、相互接続ネットワークに接続します。](media/Qos-in-Teams-Image1.png)

ほとんどの場合、ネットワーク、企業のクラウドへの接続をすることはできません確実に QoS オプションを設定するのには、管理されていないネットワークとなります。 エンド ・ ツー ・ エンドの QoS に対応する利用可能な 1 つの選択肢は[Azure ExpressRoute](https://azure.microsoft.com/documentation/articles/expressroute-introduction/)、ですが、まだ、設置型のネットワーク上で QoS を実装することをお勧めします。 展開全体にわたってワークロードをリアルタイム通信の品質が向上し、チョークを軽減します。

## <a name="verify-your-network-is-ready"></a>ネットワークが準備ができていることを確認します。

QoS の実装を検討する場合は既にが決まったら、帯域幅の要件およびその他の[ネットワークの要件](prepare-network.md)です。 マイクロソフト チームの帯域幅の計算は複雑で、これを支援するため、電卓が作成されました。 計算機にアクセスするには、MyAdvisor では、[ネットワークの計画](https://aka.ms/bwcalc/)に移動します。
  
  ネットワーク間でトラフィックの輻輳は、メディアの品質に著しい影響を与えます。 帯域幅の不足は、パフォーマンスが低下し、ユーザー エクスペリエンスの低下につながります。 チームの導入と使用率が増大すると、レポート作成[分析機能の呼び出し、および品質のダッシュ ボードを呼び出す](difference-between-call-analytics-and-call-quality-dashboard.md)問題を特定し、QoS および選択的な帯域幅の追加機能を使用して調整を使用します。

### <a name="vpn-considerations"></a>VPN に関する考慮事項

QoS は、呼び出し元との間のすべてのリンクに実装されているときにのみ機能します。 内部ネットワーク上で QoS を使用する場合は、ユーザーがリモートの場所からサインインすることができますのみ優先順位を設定、管理された内部ネットワーク内で。 リモート ・ サイトでは、仮想プライベート ネットワーク (VPN) を実装することにより管理されている接続を受信できる、VPN は本質的にパケットのオーバーヘッドを追加し、リアルタイムのトラフィックの遅延を作成します。 リアルタイム通信トラフィックを VPN 経由で実行しないようにすることをお勧めします。

> [!NOTE]
> リモート ユーザーが VPN 接続では、ユーザー エクスペリエンスの品質を最大化するための分割トンネリングを実装しなければなりません。 ドキュメントの[展開-ガイド-VPN のスプリット トンネル](https://myadvisor.fasttrack.microsoft.com/CloudVoice/Downloads?SelectedIDs=5_1_0_9 )MyAdvisor から利用可能な詳細です。

大陸にまたがる管理のリンクを持つグローバル組織では、強くお勧め QoS それらのリンクの帯域幅は、LAN と比較すると限られているためです。

## <a name="introduction-to-qos-queues"></a>QoS キューの概要

QoS を提供するには、ネットワーク デバイスがトラフィックを分類する方法が必要し、音声またはビデオに他のネットワーク トラフィックを区別できる必要があります。

ネットワーク トラフィックが、ルーターを入力すると、トラフィックは、キューに格納されます。 QoS ポリシーが設定されていない場合は、キューの 1 つだけとして最初に、すべてのデータが扱われる優先順位が同じには、先入れ先出しします。 つまり、音声トラフィックの遅延に非常に機密性の高い) 立ち往生トラフィックの背後にあるいくつかの余分なミリ秒の遅延が問題になることはありません。

複数のキューを使用して輻輳管理などの機能 (Cisco のキューの優先度クラスに基づく重み付け公平なキューイング[CBWFQ](https://www.cisco.com/en/US/docs/ios/12_0t/12_0t5/feature/guide/cbwfq.html#wp17641)) と輻輳回避機能のいくつかのいずれかのような初期の段階でランダムな重み付けを定義する QoS を実装する場合検出[WRED](https://en.wikipedia.org/wiki/Weighted_random_early_detection))。

_図 2 になります。QoS キューの例_

![キューを複数に分割されている使用可能な帯域幅の合計: オーディオ、ビデオ、およびその他のトラフィック、異なる優先度が割り当てられている]。(media/Qos-in-Teams-Image2.png "キューを複数に分割されている使用可能な帯域幅の合計: オーディオ、ビデオ、およびその他のトラフィック、異なる優先度が割り当てられている")。

単純な例では、QoS が仮想作成、データの「カープール レーン」による遅延がデータの種類によってことがはありませんまたはごくまれに発生するためのネットワークです。 これらのレーンを作成するの相対サイズを調整しても、組織のユーザーのビジネス ・ クラスの経験を提供しながら、ある接続の帯域幅を効率的に管理できます。

## <a name="select-a-qos-implementation-method"></a>QoS の実装方法を選択します。

アクセス制御リスト (Acl) を使用して、ネットワークのルーターでポート ベースのタグ付けを使用して、QoS を実装する可能性があります。 ポート ベースのタグ付けは、最も信頼性の高い方法 Windows と Mac の混在環境での動作を実装する最も簡単な方法です。 モバイル クライアントでは、このメソッドが必要なため、DSCP 値を使用してトラフィックをマークするのにはメカニズムを提供しません。  

このメソッドを使用すると、ネットワークのルーター、着信パケットを検査して特定のポートまたはポートの範囲を使用して、パケットが到着する場合特定のメディアの種類として識別されその種類、ip アドレスを事前に設定された[DSCP](https://tools.ietf.org/html/rfc2474)マーキングを追加するためにキューに入れますパケット ヘッダーその他のデバイスが、トラフィックの種類を認識し、キューの優先順位を与えるようにします。

トラフィック (クライアント コンピューター) には全部は WAN の端でのみこのプラットフォーム間で動作しますが、マークし、管理のオーバーヘッドを作成します。 このメソッドを実装する方法についてルーターの製造元によって提供されるマニュアルを参照してください。

* * *

トラフィック (たとえば、[音声]) の特定の型としてそれを識別する IP パケットのヘッダーで DSCP のマーカーを挿入するのには、クライアント デバイスに指示するのには、グループ ポリシー オブジェクト (GPO) を使用して実装されている QoS を実装することもできます。 これを認識し、別の優先順位の高いキューに配置され、トラフィックは、ルーターおよびその他のネットワーク デバイスを構成できます。

このシナリオでは完全に有効な Windows クライアントをドメインに参加しているはのみ動作します。 DSCP の Windows ドメインに参加しているクライアントではない任意のデバイスを有効にしないタグ付けします。 Mac OS のようなクライアントでは、タグがハード コーディングされているし、トラフィックは常にタグを付けます。

横のプラス側では、DSCP マーキングの GPO を使用して制御することにより、すべてのドメインに参加しているコンピューターに同じ設定が表示されることと、管理者だけがそれらを管理できることをします。 GPO を使用できるクライアントは、元のデバイスでは、タグは、構成されているネットワーク デバイスが DSCP コードによって、リアルタイムのストリームを認識し、適切な優先度を付けます。

* * *

可能な場合は、エンドポイントとのルーターのポート ベースの Acl に DSCP マーキングの組み合わせを推奨します。 DSCP のタグ付けをポート ・ ベースを使用しているクライアントのほとんどをキャッチする、グループ ポリシー オブジェクトを使用して、その携帯、Mac、およびその他のクライアントがまだ取得 QoS 処理 (少なくとも部分的に) を確認します。

DSCP マーキングは、郵便配達人の配信は、緊急度と高速な配信のためにソートする最善の方法を示す切手をチューニングします。 リアルタイム メディア ストリームへの優先順位を設定するには、ネットワークを構成した後失われるパケットは、パケットの遅延が大幅に減少するはずです。

ネットワーク内のすべてのデバイスが同一の分類、マーキング、および優先度を使用して後を軽減または排除することが遅延、パケットのドロップ、および変位トラフィックの種類ごとに使用されるキューに割り当てられたポートの範囲のサイズを変更することによって。 チームの観点からの最も重要な構成手順は、クラス分けと、パケットのマーキングが成功するためのエンド ・ ツー ・ エンドの QoS にもする必要しますが、基になるネットワークの構成とアプリケーションの構成を慎重に配置します。 QoS が完全に実装されると、継続的な管理は、組織のニーズと実際の使用状況に基づいてトラフィックの種類ごとに割り当てられたポートの範囲を調整することの質問です。

## <a name="choose-initial-port-ranges-for-each-media-type"></a>メディア タイプごとに、最初のポートの範囲を選択します。

DSCP 値は、クライアントまたはネットワーク自体の ACL の設定によって、DSCP のマークが割り当てられているかどうかに、同じように構成されているネットワーク パケットまたはストリームするための優先度を指示します。 各メディアの作業負荷は、それぞれ独自の DSCP 値を取得 (その他のサービスは、DSCP マーキングを共有するためのワークロードを使用する可能性があります、チームがない) とメディアの種類ごとに使用される定義され、別のポートの範囲です。 他の環境は、既存の QoS 戦略を実施してネットワークのワークロードの優先順位を決定する際に役立つがあります。

リアルタイム ストリーミング ワークロードを別のポート範囲の相対的なサイズでは、その作業負荷を専用利用可能な帯域幅の合計の割合を設定します。 以前のバージョン番号との類似性に戻るには:「Air メール」、スタンプで文字可能性があります取得は 1 時間以内に近くの空港では、中に取られたコンパクトなパッケージには、「迷惑メール」マークは、一連トラックの陸上移動する前に 1 日を待つことがマークされています。

次の表は、ExpressRoute、チーム用の必須の DSCP マーキングとワークロードのキューに関連付けられているポートを示します。 これらの範囲は可能性がありますではないことを確認して、自分の環境で使用するどのようなお客様にとっての開始点として機能します。 詳細については、「[ExpressRoute QoS の要件](https://docs.microsoft.com/azure/expressroute/expressroute-qos)」をご覧ください。

_最初のポートの範囲を推奨_

|メディア トラフィックの種類| クライアント ソース ポートの範囲 |プロトコル|DSCP 値|DSCP クラス|
|:--- |:--- |:--- |:--- |:--- |
|オーディオ| 50,000 – 50,019|TCP/UDP|46|完全優先転送 (EF)|
|ビデオ| 50,020 – 50,039|TCP/UDP|34|相対的優先転送 (AF41)|
|アプリケーションと画面の共有| 50,040-50,059|TCP/UDP|18|相対的優先転送 (AF21)|
||||||

これらの設定を使用する場合、次の対応になります。

- ExpressRoute の今後の実装を計画してまだ QoS を実装していない場合は、DSCP 値が受信機に送信元から同じになるよう、ガイダンスに従うことをお勧めします。
- モバイル クライアントやチームのデバイスを含む、すべてのクライアントは、これらのポート範囲を使用し、いずれ DSCP のポリシーを実装するソース ポート範囲を使用する影響を受けます。 引き続き動的ポートを使用する唯一のクライアントは、ブラウザー ベースのクライアント (つまり、参加者のブラウザーを使用してミーティングに参加できるようにこれらのクライアント) です。
- Mac クライアントは、同じポート範囲を使用するがも、(EF) のオーディオおよびビデオ (AF41) の値をハードコーディングを使用します。 これらの値は構成可能ではありません。
- ユーザー エクスペリエンスを向上させるためにポートの範囲を調整する必要が後で、ポートの範囲は重ねることはできませんし、互いに隣接する必要があります。

## <a name="migrate-qos-to-teams"></a>QoS をチームに移行します。

QoS のタグ付けを含むビジネス オンライン、およびポートの範囲、Skype を展開していたチームを配置するようになりましたと、チームは既存の構成設定が反映され、、同じポート範囲とビジネス クライアント用の Skype としてタグ付けを使用します。 ほとんどの場合、追加の構成は必要ありません。

> [!NOTE]
> グループ ポリシーを使用してタグ付けアプリケーション名の QoS を使用する場合は、アプリケーション名として Teams.exe を追加する必要があります。

## <a name="qos-implementation-steps"></a>QoS の実装手順

非常に高いレベルで QoS を実装する手順が必要です。

1. [ネットワークが準備ができていることを確認します。](#verify-your-network-is-ready)
2. [QoS の実装方法を選択します。](#select-a-qos-implementation-method)
3. [メディア タイプごとに、最初のポートの範囲を選択します。](#choose-initial-port-ranges-for-each-media-type)
4. QoS の設定を実装します。
   1. クライアントでは、[クライアント デバイスのポート範囲とマーキングを設定](QoS-in-Teams-clients.md)する GPO を使用しました。
   2. 上 (製造元のマニュアルを参照してください)、ルーターまたはその他のネットワーク デバイスです。 ポート ベースの Acl がありますまたは単に QoS キューと DSCP マーキング、またはこれらのすべてを定義します。

      > [!IMPORTANT]
      > クライアントの発信元ポートと「すべて」の発信元と宛先の IP アドレスを使用してこれらの QoS ポリシーを実装することをお勧めします。 内部ネットワークでこのメディアを受信および送信トラフィックの両方をキャッチします。  

   3. [チーム管理](meeting-settings-in-teams.md#set-how-you-want-to-handle-real-time-media-traffic-for-teams-meetings)センター
5. チーム ネットワーク上のトラフィックを分析して[QoS の実装の検証](#validate-the-qos-implementation)をします。

QoS を実装するために準備するときは、次のガイドラインに留意してください。

- Office 365 への最短パスをお勧めします。
- ポートを閉じるだけにつながる品質が低下します。
- 中間プロキシなど、障害物がない、お勧めできません。
- ホップの数を制限するには。
  - ネットワーク エッジ: 3 ~ 5 のホップするクライアントです。
  - ISP に Microsoft ネットワークのエッジ – 3 ホップ
  - 最終的な宛先-無関係に Microsoft ネットワークのエッジ

ファイアウォールのポートを構成する方法については、「 [Office 365 の URL と IP 範囲](office-365-urls-ip-address-ranges.md)」をご覧ください。

## <a name="managing-source-ports-in-the-teams-admin-center"></a>チームの管理センターでの送信元ポートを管理します。

チームは、さまざまなワークロードで使用されている QoS 送信元のポートする必要があります積極的に管理され、必要に応じて調整します。 [メディア タイプごとにオプションを指定して最初のポートの範囲](#choose-initial-port-ranges-for-each-media-type)の表を参照して、ポートの範囲は調整可能なが、DSCP マーキングが可能ではありません。 これらの設定を実装すると、指定されたメディアの種類のまたはより少ないポートが必要である場合があります。 意思決定後、チームが実装されているし、定期的にニーズの変化に応じて、ポートの範囲を調整するには、[分析機能の呼び出しと呼び出し品質のダッシュ ボード](difference-between-call-analytics-and-call-quality-dashboard.md)を使用してください。

> [!NOTE]
> チームおよびそれ以上のクライアントに同じ設定が適用されますソース ポートの範囲と Skype のオンライン ビジネスの DSCP マーキングに基づく QoS を既に構成した場合、またはネットワークのマッピングの変更が必要、[に設定した範囲がチーム管理センターで使用されている](meeting-settings-in-teams.md#set-how-you-want-to-handle-real-time-media-traffic-for-teams-meetings)ビジネス オンラインの Skype の構成が一致します。

以前展開した Skype ビジネス サーバー設置型、QoS ポリシーを再検査し、チームの品質のユーザー エクスペリエンスを提供することを確認するポート範囲の設定を一致するように、必要に応じて調整する必要があります。

## <a name="validate-the-qos-implementation"></a>QoS の実装を検証します。

QoS を有効にする、DSCP の値によって、グループ ポリシー オブジェクト セットは、呼び出しの両端に存在している必要があります。 DSCP 値が変更またはチームの作業負荷のトラフィックの移動を走査するときに削除されていないを確認するチームのクライアントによって生成されるトラフィックを分析することでネットワークを経由します。

可能であれば、ネットワークの出口ポイントへのトラフィックをキャプチャします。 これを支援するには、スイッチまたはルーターのポートのミラーリングを使用します。

### <a name="use-network-monitor-to-verify-dscp-values"></a>DSCP 値を確認するのにはネットワーク モニターを使用して

ネットワーク モニターは、ネットワーク トラフィックを分析するのには[マイクロソフトからダウンロード](https://www.microsoft.com/download/4865)をすることができますツールです。

1. PC では、ネットワーク モニターを実行して、ポートのミラーリングとパケットをキャプチャ開始のように構成されたポートに接続します。

2. チームのクライアントを使用して呼び出しを実行します。 呼び出しを切断する前にメディアが確立されたことを確認します。

3. キャプチャを停止します。

4. [**ディスプレイ フィルター** ] フィールドで、呼び出しを行った PC のソース IP アドレスを使用し、検索条件として DSCP 値 (16 進コードは 0xb8 という) 46 を定義することで次の例に示すようにフィルターを絞り込みます。

    Source == "192.168.137.201" AND IPv4.DifferentiatedServicesField == 0xb8

    ![を適用するフィルターを示すネットワーク モニターで [ディスプレイ フィルター] ダイアログ ボックスのスクリーン ショットです]。(media/Qos-in-Teams-Image4.png "を適用するフィルターを示すネットワーク モニターで [ディスプレイ フィルター] ダイアログ ボックスのスクリーン ショットです")。

5. フィルターを有効に**適用**] を選択します。

6. **フレームの概要**ウィンドウで、最初に UDP パケットを選択します。

7. **フレームの詳細**ウィンドウで、IPv4] ボックスの一覧のアイテムを展開し、 **DSCP**で始まる行の末尾の値に注意してください。

    ![DSCP 設定を強調表示、ネットワーク モニターのフレームの詳細] ダイアログ ボックスのスクリーン ショットです]。(media/Qos-in-Teams-Image5.png "DSCP 設定を強調表示、ネットワーク モニターのフレームの詳細] ダイアログ ボックスのスクリーン ショットです")。

この例では、DSCP 値は 46 に設定されます。 これは、正しいために使用するソース ポートは、50019、音声のワークロードがあることを示します。

GPO によってマーキングされている各ワークロードについて確認を繰り返します。

## <a name="more-information"></a>詳細情報

[ビデオ : ネットワーク計画](https://aka.ms/teams-networking)

[Microsoft Teams 用に組織のネットワークを準備する](prepare-network.md)

[ExpressRoute QoS 要件](https://docs.microsoft.com/azure/expressroute/expressroute-qos)
