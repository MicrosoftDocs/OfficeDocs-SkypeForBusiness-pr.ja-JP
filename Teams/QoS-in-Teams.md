---
title: マイクロソフトのチーム - マイクロソフトのチームでの QoS
author: rmw2890
ms.author: MyAdvisor
manager: Serdars
ms.date: 04/23/2018
ms.topic: article
ms.service: msteams
ms.reviewer: rowille
description: Microsoft Teams でのサービスの品質 (QoS) のために組織のネットワークを準備する
MS.collection: Strat_MT_TeamsAdmin
appliesto:
- Microsoft Teams
ms.openlocfilehash: 884055dce490b9db8fd31f6e52042a4315633e00
ms.sourcegitcommit: f942232d43fc4ad56b34dd400fdb4bca39013f5f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/26/2018
---
# <a name="quality-of-service-qos-in-microsoft-teams"></a>Microsoft Teams でのサービスの品質 (QoS)

この資料は、組織のネットワークのサービス品質 (QoS) マイクロソフトのチームのための準備に役立ちます。
QoS は、特定の種類のネットワーク トラフィックの優先順位を使用するメカニズムです。 チームなどのリアルタイム通信サービスのトラフィックの優先順位付けすることは、ビジネス クラスのユーザー エクスペリエンスを実現するのには重要です。 真に効果的な QoS では、QoS をサポートするために失敗したパスの任意の部分には、呼び出し全体の品質が低下する可能性があるため (PC、ネットワーク スイッチ、およびクラウドへのルーター) の端に端からの QoS に対応した接続を構成する必要があります。

![組織のネットワークおよび Office 365 のサービス間の関係: オンプレミス ネットワークとデバイスは、Office 365 のクラウドの音声および電話会議サービスに接続する、相互接続ネットワークに接続します]。(media/Qos-in-Teams-Image1.png "組織のネットワークおよび Office 365 のサービス間の関係: オンプレミス ネットワークとデバイスは、Office 365 のクラウドの音声および電話会議サービスに接続する、相互接続ネットワークに接続します")。

_図 1 です。組織のネットワークおよび Office 365 のサービス間の関係_
 

ほとんどの場合は、相互接続ネットワークを管理されていないネットワークのインターネット接続となります。 エンド ・ ツー ・ エンドの QoS に対応する利用可能なオプションの 1 つは、 [Azure の ExpressRoute](https://azure.microsoft.com/documentation/articles/expressroute-introduction/)です。 まだ QoS を実装することをお勧め、つまり、オンプレミス ネットワーク経由でのコントロールがあるネットワークの部分にします。 展開全体の負荷をリアルタイム通信の品質が向上され、既存の展開でチョーク ポイントを軽減します。 


## <a name="prioritize-teams-network-traffic-for-qos"></a>QoS のチームのネットワーク トラフィックを優先順位を付ける 

チームのリアルタイム通信トラフィックを優先順位を設定する方法についてこの資料で説明、音声、ビデオ。 他の種類のトラフィックは、お客様のニーズに基づいて優先順位を付けることができますもします。

トラフィックの優先順位を設定する方法は複数ありますが、DSCP (Differentiated Services Code Point) のマーキングを使用する方法が最も一般的です。 適用できるように「タグ付き」) ベースのポート範囲にし、グループ ポリシー オブジェクトを使用していますいます。 この資料では、両方の操作を説明します。 ドメインに参加しているものだけでなく、すべてのデバイスの動作するためにポートの範囲に基づくタグ付け機能を使用することをお勧めします。

グループ ポリシー オブジェクトを使用して DSCP マーキングを制御することにより、ドメインに参加しているコンピューターが適切な設定を受信して、管理者だけがそれらを管理できることをします。
 
呼び出し元を呼び出し先に接続するすべてのリンクに実装されているときに、QoS をのみ動作するかを理解する重要です。 内部ネットワーク上で QoS を使用する場合は、ユーザーがリモートの場所からサインインすることができますのみ優先順位を管理、内部ネットワーク内で。 リモート ・ サイトでは、仮想プライベート ネットワーク (VPN) を実装することにより管理されている接続を受信できる、リアルタイム通信トラフィックを VPN 経由で実行しないようにすることお勧めします。

> [!NOTE]
> 分割トンネリング VPN に接続されているリモート ・ ユーザーのユーザー エクスペリエンスの品質を最大化を実装することをお勧めします。 詳細については、MyAdvisor から[分割トンネルの VPN の展開のガイダンス](https://myadvisor.fasttrack.microsoft.com/CloudVoice/Downloads?SelectedIDs=5_1_0_9 )のドキュメントをダウンロードします。

大陸にまたがる管理のリンクを持つグローバル組織では、QoS は強くお勧めそれらのリンクの帯域幅は、LAN と比較すると限られているためです。

## <a name="qos-queues"></a>QoS キュー

ネットワーク上のアプリケーション サービスの保証のレベルを提供するには、異なる種類のトラフィックを分類する方法が基盤となるネットワーク デバイスに必要です。 場合は、組織が他のトラフィック上で音声トラフィックの優先順位を与えるしようとすると、ルーター (たとえば) を音声トラフィックと通常の web 参照のトラフィックとを区別することにする必要があります。 

差別化サービス (DiffServ) では、トラフィックが IPv4 と IPv6 パケットのヘッダー内のサービス (ToS) フィールドの種類に基づいてネットワーク デバイスが別の優先順位を指定は、フレームワークを提供します。 DiffServ フィールドの 6 つの最上位ビットは、差別化されたサービス コード ポイント、または DSCP です。 このフレームワークを使用すると、トラフィック トラフィック (たとえば、音声) の特定の種類に分類してできるし (101110、または音声トラフィックの 10 進数で 46)、ようにマークのトラフィックは、ネットワーク デバイスは、これらのマーキングを処理するときに (それに応じて優先順位付け。完全優先転送、次の使用例で)。

トラフィックがキューに配置されるネットワーク トラフィックには、ルーターが入る、-は QoS の場所で、基本的には、キューが 1 つだけとして最初に、データを扱う場合は、先入れ先出しします。つまり、オンラインのストリーミング サービスからトラフィックの背後にある音声トラフィックの遅延に非常に機密性の高い) に残ってしまう可能性があります。 別の輻輳管理などの機能 (Cisco のキューの優先度クラスに基づく重み付け公平キュー [CBWFQ]) と輻輳の回避などの機能 (ランダムな重み付けの早期検出 [を使用して、複数のキューを定義するには QoS を実装する場合WRED])。

![キューを複数に分割されている使用可能な帯域幅の合計: オーディオ、ビデオ、およびその他のトラフィック、異なる優先度が割り当てられている]。(media/Qos-in-Teams-Image2.png "キューを複数に分割されている使用可能な帯域幅の合計: オーディオ、ビデオ、およびその他のトラフィック、異なる優先度が割り当てられている")。

_図 2 になります。QoS キューのビジュアル化_

これらの要素があると後、基になるマネージ ネットワークは今すぐ分類、マーク、およびトラフィックの優先順位を設定する方法を理解しているために、予測可能な QoS を提供することができます。 チームの観点からの最も重要な構成手順は、クラス分けと、パケットのマーキングが成功するためのエンド ・ ツー ・ エンドの QoS にもする必要しますが、基になるネットワークの構成とアプリケーションの構成を慎重に配置します。

## <a name="teams-qos-scenarios"></a>チームの QoS のシナリオ

チームの QoS を実装するためのガイダンスは、4 つのシナリオに基づいています。

*  **シナリオ 1:** チームを配置するサーバーを展開したら、や、ポート ベースのタグ付けを使用して QoS を実装することを計画します。 ポート ベースのタグ付けは、最も信頼性の高いメソッドでは、すべてのプラットフォーム全体にわたって広く動作し、実装することが容易です。  

*  **シナリオ 2:** チームを配置するサーバーを展開したら、や、グループ ポリシー オブジェクトへのタグ付けを使用して QoS を実装する計画です。 これは、シナリオ 1 と組み合わせて使用される場合があります。 このシナリオでは完全に有効なそれが、ドメインに参加している Windows クライアントに対してのみ動作を理解する重要です。 DSCP の Windows ドメインに参加しているクライアントではない任意のデバイスを有効にしないタグ付けします。

*  **シナリオ 3:** 展開して、Skype のビジネス オンライン、QoS がタグ付けを含む、そのチームを配置するようになりました。 この状況に該当する場合は、Teams は既存の構成を優先して、Skype for Business クライアントのものと同じポート範囲とタグ付けを使用します。 ほとんどの場合、追加の構成は必要ありません。 
 
    > [!NOTE]
    > グループ ポリシーを使用してタグ付けアプリケーション名の QoS を使用する場合は、アプリケーション名として Teams.exe を追加する必要があります。

*  **シナリオ 4:** チームを配置するサーバーを展開したら、や、ポート ベースのカスタムのポート範囲を使用してタグ付けを使用して QoS を実装します。

## <a name="recommended-dscp-markings"></a>推奨 DSCP マーキング

(オーディオ、ビデオなど) のトラフィック フローを分類するのには、重複しない一意のポート範囲に DSCP 値を割り当てることによっては、まず。 ここで割り当てられている DSCP 値は、ネットワーク構成に基づいて、ネットワークを通過するトラフィックの優先順位を決定します。 各作業負荷を取得独自の DSCP 値は必ずしも一意の値: 一部のお客様は、音声およびビデオのワークロードに対して同じ値を設定可能性がありますネットワーク上の同一の優先順位を与えます。  

DSCP 値を使用するのには、ワークロードの優先順位を設定する方法によって異なります。 などのビジネス要件がアプリケーションに与えることを決定する可能性がありますビデオと同じ優先順位を共有 (しそのため、ビデオと同じ DSCP 値を使用)。 他の環境は、既存の QoS 戦略を実施してネットワークのワークロードの優先順位を決定する際に役立つがあります。 

ExpressRoute でチームを使用する場合に必要な DSCP マーキングを表 1 に示します。 これらのマーキングは可能性がありますではないことを確認して、自分の環境で使用するどのようなお客様にとっての開始点として機能します。 詳細については、「[ExpressRoute QoS の要件](https://docs.microsoft.com/azure/expressroute/expressroute-qos)」をご覧ください。


_表 1 です。DSCP マーキング_
    
| クライアント ソース ポートの範囲 |プロトコル|メディアのカテゴリ|DSCP 値|DSCP クラス|
|---------|---------|---------|---------|---------|
| 50,000 – 50,019|TCP/UDP|音声|46|完全優先転送 (EF)|
| 50,020 – 50,039|TCP/UDP|ビデオ|34|相対的優先転送 (AF41)|
| 50,040-50,059|TCP/UDP|アプリケーション/デスクトップ共有|18|相対的優先転送 (AF21)|

表 1 の情報を使用するときに理解する必要があるいくつかの注意事項を次に示します。
    
-  ExpressRoute の今後の実装を計画してまだ QoS を実装していない場合は、DSCP 値が受信機に送信元から同じになるようは、表 1 のガイダンスに従うことをお勧めします。 

-  モバイル クライアントやチームのデバイスを含む、すべてのクライアントは、これらのポート範囲を使用し、いずれ DSCP のポリシーを実装するソース ポート範囲を使用する影響を受けます。 引き続き動的ポートを使用する唯一のクライアントは、ブラウザー ベースのクライアント (つまり、参加者のブラウザーを使用してミーティングに参加できるようにこれらのクライアント) です。

-  Mac クライアントは、同じポート範囲を使用して、Mac クライアントはまた (EF) のオーディオおよびビデオ (AF41) の値をハードコーディングを使用します。 これらの値は構成可能ではありません。
 
    
## <a name="source-ports-used-by-teams"></a>Teams によって使用されるソース ポート

Teams では、QoS は異なるワークロードで使用される送信元ポートに基づいて構成される必要があります。 どちらのサーバー側とクライアント側のポートの範囲は、現在の設定ができます。 

表 2 に記載されているクライアント ソース ポートの範囲に注意してくださいし、関連付けられている QoS の DSCP マーキングを使用してください。

_表 2 になります。クライアント ソース ポートの範囲_

| クライアント ソース ポートの範囲 |プロトコル|メディアのカテゴリ|DSCP 値|DSCP クラス|
|---------|---------|---------|---------|---------|
| 50,000 – 50,019|TCP/UDP|音声|46|完全優先転送 (EF)|
| 50,020 – 50,039|TCP/UDP|ビデオ|34|相対的優先転送 (AF41)|
| 50,040-50,059|TCP/UDP|アプリケーション/デスクトップ共有|18|相対的優先転送 (AF21)|

これらの QoS ポリシーを実装するための推奨される方法は、「すべて」の発信元と宛先の IP アドレスにクライアントの送信元ポートを使用するには 内部ネットワークでこのメディアを受信および送信トラフィックの両方をキャッチします。 

> [!NOTE]
> ソース ポート範囲に基づいて Skype のオンライン ビジネスの QoS を既に構成した場合は、チームに同じ設定が適用され、さらに変更が必要ないです。 ビジネス サーバー設置型の Skype を展開した場合は、QoS ポリシーの設計を変更する必要があります。

## <a name="setting-dscp-markings"></a>DSCP マーキングを設定します。

トラフィックの分類の適切な DSCP マーキングを設定するのには複数の方法があります。

-  **エンドポイントの DSCP マーキング:** だ一般的に希望のオプションでは、エンドポイント自体には、適切なマーキングが用意されています。 これを実行して、グループ ポリシー オブジェクトを使用して、現在、Windows のドメインに参加しているクライアントでのみ使用できます。 モバイル クライアントでは、DSCP 値を使用してトラフィックをマークするためのメカニズムを提供しません。 以外を構成することはできません&ndash;タグのトラフィック、Mac OS などのクライアントに Windows クライアントをドメインに参加しているハード コーディングされたタグがあり、前述のようにトラフィックをタグは常にします。

-  **ポート ベースの DSCP がルーターにアクセス制御リスト (Acl) を使用してタグ付け:** これは、Windows と Mac の異機種混在環境で発生した非常に一般的なオプションです。 このシナリオでは、ネットワーク チームは、各モダリティに対して定義されているソース ポートの範囲に基づいて (通常は WAN 上にある) の入口/出口となるルーターでのトラフィックをマークします。 WAN エッジへのトラフィックにのみマークこのプラットフォーム間で動作しますが、-がクライアント コンピューターにないこと、したがって管理のオーバーヘッドが発生し、。
    
-  **エンドポイントとルーターのポート ベースの Acl に DSCP マーキングの組み合わせ:** この組み合わせは、お客様の環境で可能な場合はお勧めします。 グループ ポリシー オブジェクトを使用して、クライアントのほとんどをキャッチしてタグを付けるようにすること、モバイル、Mac、およびその他のクライアントがまだ QoS 処理 (少なくとも部分的に) ポート ベースの DSCP を使用しても。
    
チーム クライアントで定義済みのソースのポート範囲の DSCP 値を設定するのには、グループ ポリシー内のポリシー ベースの QoS を使用できます。 各ワークロードのポリシーを作成するのにには、表 3 に指定されたポート範囲を使用します。

_表 3。種類のトラフィックをポート範囲_
| クライアントのトラフィックの種類|ポート範囲の開始|ポート範囲の終了|DSCP 値|
|---------|---------|---------|--------|
| 音声|50000|50019|46|
| ビデオ|50020|50039|34|
| アプリケーション共有|50040|50059|18|

> [!NOTE]
> チームが設定するポートの範囲は変更できません。 最新情報については、[このサポートの記事](https://support.microsoft.com/kb/2409256)を確認してください。 

ポートの範囲を特定したら、次に、グループ ポリシー オブジェクト内でポリシー ・ ベースの QoS 設定を構成するのには。 次の手順の詳細については、[この TechNet の記事](https://technet.microsoft.com/library/jj205371(v=ocs.15).aspx)を参照しています。 

クライアント コンピューターにグループ ポリシーを更新するまでは、作成した新しいポリシーを有効になります。 グループ ポリシーは、独自に定期的に更新されたが即時更新を強制することができます。

### <a name="force-group-policy-refresh"></a>フォースのグループ ポリシーの更新

1. グループ ポリシーを更新する各コンピューターでは、コマンド コンソールを開きます。 コマンド コンソールを管理者として実行するように設定されていることを確認します。

2. コマンド プロンプトで次のように入力します。
```
    gpudate.exe /force
```

## <a name="verify-dscp-markings-in-the-group-policy-object"></a>グループ ポリシー オブジェクト内の DSCP マーキングを確認します。

グループ ポリシー オブジェクトの値が設定されていることを確認するには、次の手順を実行します。

1.  コマンド コンソールを開きます。 コマンド コンソールを管理者として実行するように設定されていることを確認します。

2.  コマンド プロンプトで次のように入力します。 
    ```
    gpresult /R >gp.txt
    ```

    レポートを生成、gp.txt をという名前のテキスト ファイルに送信します。 代わりに、gp.html という名前の読みやすい html 形式のレポートで同じデータを生成するのには次のコマンドを入力します。
    ```
    gpresult /H >gp.html
    ```
 
   ![Gpresult コマンドを実行しているコンソール ・ ウィンドウのスクリーン ショットです]。(media/Qos-in-Teams-Image3.png "Gpresult コマンドを実行しているコンソール ・ ウィンドウのスクリーン ショットです")。

3.  、生成されたファイルで**適用されたグループ ポリシー オブジェクト**の見出しを検索し、以前に作成したグループ ポリシー オブジェクトの名前に適用されたポリシーの一覧であることを確認します。 

4.  レジストリ エディターを開きとに移動します。

    HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\Windows\QoS\

    表 3 に記載されているレジストリ エントリの値を確認します。

    _表 3。QoS の Windows のレジストリ エントリの値_
    
    | 名前 | 種類 | データ|
    |---------|---------|---------
    | Application Name|REG_SZ|Teams.exe|
    | DSCP Value|REG_SZ|46|
    | Local IP|REG_SZ|*|
    | Local IP Prefix Length|REG_SZ|*|
    | Local Port|REG_SZ|50000-50019|
    | プロトコル|REG_SZ|*|
    | Remote IP|REG_SZ|*|
    | リモート IP プレフィックス|REG_SZ|*|
    | Remote Port|REG_SZ|*|
    | Throttle Rate|REG_SZ|-1|
    
5.  アプリケーション名のエントリの値が使用しているクライアントに対して適切であることを確認し、DSCP 値とローカル ・ ポートの両方のエントリに、グループ ポリシー オブジェクトの設定が反映されていることを確認します。

## <a name="validate-qos-by-analyzing-teams-traffic-on-the-network"></a>チーム ネットワーク上のトラフィックを分析して QoS を検証します。

DSCP 値は、QoS を有効にするために呼び出し先が呼び出し元から存在するグループ ポリシー オブジェクトの要件を設定します。 チーム クライアントによって生成されるトラフィックを見ると、DSCP 値が変更またはチームの作業負荷のトラフィックがネットワークを通過するときに削除されていないを確認できます。 

可能であれば、ネットワークの出口ポイントへのトラフィックをキャプチャします。 これを支援するには、スイッチまたはルーターのポートのミラーリングを使用します。

### <a name="use-network-monitor-to-verify-dscp-values"></a>DSCP 値を確認するのにはネットワーク モニターを使用して

ネットワーク モニターは、ネットワーク トラフィックを分析するのには[マイクロソフトからダウンロード](https://www.microsoft.com/download/4865)をすることができますツールです。

1.  PC では、ネットワーク モニターを実行して、ポートのミラーリングとパケットをキャプチャ開始のように構成されたポートに接続します。 

2.  ビジネス クライアント用の Skype を使用して呼び出しを実行します。 呼び出しを切断する前にメディアが確立されたことを確認します。 

3.  キャプチャを停止します。

4. [**ディスプレイ フィルター** ] フィールドで、呼び出しを行った PC のソース IP アドレスを使用し、検索条件として DSCP 値 (16 進コードは 0xb8 という) 46 を定義することで次の例に示すようにフィルターを絞り込みます。

    Source == "192.168.137.201" AND IPv4.DifferentiatedServicesField == 0xb8 

    ![を適用するフィルターを示すネットワーク モニターで [ディスプレイ フィルター] ダイアログ ボックスのスクリーン ショットです]。(media/Qos-in-Teams-Image4.png "を適用するフィルターを示すネットワーク モニターで [ディスプレイ フィルター] ダイアログ ボックスのスクリーン ショットです")。

5.  フィルターを有効に**適用**] を選択します。

6.  **フレームの概要**ウィンドウで、最初に UDP パケットを選択します。

7.  **フレームの詳細**ウィンドウで、IPv4] ボックスの一覧のアイテムを展開し、 **DSCP**で始まる行の末尾の値に注意してください。 

    ![DSCP 設定を強調表示、ネットワーク モニターのフレームの詳細] ダイアログ ボックスのスクリーン ショットです]。(media/Qos-in-Teams-Image5.png "DSCP 設定を強調表示、ネットワーク モニターのフレームの詳細] ダイアログ ボックスのスクリーン ショットです")。

この例では、DSCP 値は 46 に設定されます。 これは、正しいために使用するソース ポートは、50019、音声のワークロードがあることを示します。 

GPO によってマーキングされている各ワークロードについて確認を繰り返します。 
