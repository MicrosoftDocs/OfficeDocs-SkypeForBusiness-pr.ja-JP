---
title: Microsoft Teams 用にネットワークを準備する|  ポート ファイアウォールの要件
author: lanachin
ms.author: v-lanac
manager: serdars
ms.topic: article
audience: admin
ms.service: msteams
ms.reviewer: dearbeen
description: このガイダンスを使用して、Teams の展開とロールアウト用にネットワークを準備します
localization_priority: Normal
search.appverid: MET150
f1.keywords:
- CSH
ms.custom: Teams-upgrade-guidance
ms.collection:
- Teams_ITAdmin_JourneyFromSfB
- M365-collaboration
appliesto:
- Microsoft Teams
ms.openlocfilehash: d58613bc3455d5467e9e6c6589f73d498c6e1e3b
ms.sourcegitcommit: 5d64e30a1984a4b1d9ff36e2e1721cb4bbf9e450
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 03/17/2020
ms.locfileid: "42706907"
---
# <a name="prepare-your-network-for-upgrading-to-teams"></a>Teams にアップグレードするためにネットワークを準備する

![技術準備段階が協調表示されたアップグレード行程図](media/upgrade-banner-tech-readiness.png "技術準備段階が強調表示された、アップグレード行程の各段階")

この記事は、ユーザーの準備段階と並行して実行されるアクティビティである、アップグレードが行われる技術準備段階の一部です。 続行する前に、以前のステージでこれらのアクティビティが完了していることを確認してください。

- [プロジェクトの関係者をリスト化した](upgrade-enlist-stakeholders.md)
- [プロジェクトの対象範囲を定義した](https://aka.ms/SkypetoTeams-Scope)
- [Skype for Business と Teams の共存と相互運用を理解した](https://aka.ms/SkypeToTeams-Coexist)
- [アップグレードの手順を選択した](upgrade-and-coexistence-of-skypeforbusiness-and-teams.md)

> [!Tip]
> Teams でのネットワークの活用方法と優れたネットワーク接続のための最適な計画を立てる方法については、次のセッションをご覧ください: [Teams のネットワーク計画](https://aka.ms/teams-networking)

オーディオ、ビデオ、または会議を展開している場合は、その機能を利用できるようにネットワークを最適化するための追加の手順を実行することができます。 Teams では、オーディオとビデオの技術 (コーデック) が使用されています。そのため、ほとんどのネットワーク条件で対応できます。 最適かつ一貫性のあるパフォーマンスを確保するために、Teams 用にネットワークを準備する必要があります。

![品質にかかわる 3 つの構成要素を取り上げた図](media/evaluate-my-environment-image1.png "品質の 3 つの構成要素と、サービス管理が 3 つの構成要素すべてにどのように重なるかを示す図。ネットワークに重点を置いています。")

## <a name="why-should-you-prepare-your-network"></a>ネットワークの準備をする理由について

実行する手順を確認する前に、チームのパフォーマンスに与える影響を理解し、ユーザーのしあわせ度と満足度を高めることが重要です。 ユーザーがネットワーク品質を認識するときに影響する可能性があるものとして、次の 3 つの主要なリスク領域があります。

- 利用可能な帯域幅が不十分

- ファイアウォールおよびプロキシによるブロック

- ジッターやパケット損失などのネットワーク障害

以下で説明する手順は、展開がこれらのいずれかの要因によって影響を受けるかどうかを判断するのに役立ち、解決に向けて役立ちます。 ネットワークを準備していないと、不満のあるユーザーや、コストが高くなる臨時の修正が発生する可能性があります。 Teams 用にネットワークと組織を準備することで、成功の可能性を大幅に高めることができます。

<!--ENDOFSECTION-->

## <a name="bandwidth-planning"></a>帯域幅の計画

Microsoft Teams を使用すると、最高のオーディオ、ビデオ、およびコンテンツのエクスペリエンスをネットワークの状態に関係なく共有できます。 可変コーデックを使用すると、限られた帯域幅の環境で最小限の影響でメディアをネゴシエートできます。 しかし帯域幅が問題にならない場合は、最大 1080 p のビデオ解像度、最大 30 fps のビデオと 15 fps コンテンツの、ハイファイ オーディオなど、エクスペリエンスを品質に合わせて最適化できます。

[!INCLUDE [Bandwidth requirements](includes/bandwidth-requirements.md)]

### <a name="local-internet-egress"></a>ローカルのインターネット エグレス

多くのネットワークは、ハブおよびスポーク トポロジを使用するよう設計されたものです。 このトポロジでは、インターネットのトラフィックは通常、インターネットに出現 (エグレス) する前に、 WAN を横断して中央データセンターに到達します。 これは多くの場合、総コストを削減する目的で、ネットワーク セキュリティ デバイスを一元化するために行われます。

WAN でのバックホーリングのトラフィックは待機時間を増大させ、品質とユーザー エクスペリエンスに悪影響をおよぼします。 Microsoft Teams は Microsoft の大規模なグローバルネットワークで実行されるため、多くの場合、ユーザーに近いネットワークピアリングの場所があります。 ユーザーの場所に近いローカルのインターネット ポイントから出て、音声に最適化されたネットワークにできるだけ早く入ることにより、ユーザーはより良質なパフォーマンスを得る可能性が高くなります。 一部の負荷については、最も近いフロントエンド サーバーにトラフィックを送信するために DNS 要求が使用されます。 このような場合は、ローカルの出口ポイントを使うときに、ローカルの DNS 解決とペアリングされていることが重要です。

Microsoft のグローバルネットワークへのネットワークパスを最適化すると、パフォーマンスが向上し、最終的にユーザーに最適なエクスペリエンスが提供されます。 詳細については、「[Getting the best connectivity and performance in Office 365](https://techcommunity.microsoft.com/t5/Office-365-Blog/Getting-the-best-connectivity-and-performance-in-Office-365/ba-p/124694)」のブログ投稿をご覧ください。

Microsoft Teams 内でリアルタイムのメディアを使用して最適なエクスペリエンスを実現するには、Office 365 のネットワーク要件を満たしている必要があります。 詳細については、「[Skype for Business Online におけるメディアの品質とネットワーク接続性のパフォーマンス](/SkypeForBusiness/optimizing-your-network/media-quality-and-network-connectivity-performance)」をご覧ください。

2 つの重要なネットワーク セグメント (クライアントから Microsoft Edge、Customer Edge から Microsoft Edge) については、以下の要件を満たしている必要があります。

|**値** |**クライアントから Microsoft Edge** |**Customer Edge から Microsoft Edge** |
|---|---|---|
|**遅延 (一方向)** |50 ミリ秒未満 |30 ミリ秒未満 |
|**遅延 (ラウンド トリップ時間または RTT)** |100 ミリ秒未満 |60 ミリ秒未満 |
|**バースト パケット損失** |200 ミリ秒間隔で 10% 未満 |200 ミリ秒間隔で 1% 未満 |
|**パケット損失** |15 秒間隔で 1% 未満 |15 秒間隔で 0.1% 未満 |
|**パケット到着間隔ジッター** |15 秒間隔で 30 ミリ秒未満 |15 秒間隔で 15 ミリ秒未満 |
|**パケットの並べ替え** |< 順序が適切でないパケットが 0.05% |< 順序が適切でないパケットが 0.01% |

両方のネットワーク セグメントをテストするために、[ネットワーク評価ツール](https://go.microsoft.com/fwlink/?linkid=855799)を使用することができます。 このツールは、クライアント PC に直接展開したり、お客様のネットワーク エッジに接続された PC に展開したりすることができます。 ツールに含まれているドキュメントは限定的ですが、ツールの使用についてのより詳細なドキュメントは「[Network Readiness Assessment (ネットワークの準備状況の評価)](https://go.microsoft.com/fwlink/?linkid=855800)」にあります。 このネットワーク準備評価を実行することにより、ネットワークの準備状況を確認して、Microsoft Teams などのリアルタイムメディアアプリケーションを実行することができます。

> [!NOTE]
> これは Skype for Business を正常に展開するために推奨していた Network Readiness Assessment と同じです。

### <a name="vpn"></a>VPN

VPN は多くの組織に対して、価値のあるサービスを提供します。 残念ながら、通常は、リアルタイムメディアをサポートするように設計されていないか、構成されていません。 一部の VPN は、UDP をサポートしていない可能性もあります。 Vpn は、既に暗号化されているメディアトラフィックの上に、暗号化の追加レイヤーを導入することもあります。 さらに、VPN デバイスを介したヘアピン型トラフィックが原因で、Teams サービスへの接続が効率的ではない可能性もあります。 さらに、チームが必要とする予測される負荷に対応するために、キャパシティの観点から設計されるとは限りません。

Teams トラフィックのために VPN をバイパスする代替パスを提供することをお勧めします。 これは*スプリット トンネル VPN* として一般に知られています。 [トンネリングの分割とは、Office 365 のトラフィックが VPN を通過せず、直接 Office 365 に接続することを意味します。 この変更によって品質は良好になりますが、VPN デバイスと組織のネットワークからの負荷を軽減するという第2のメリットも提供されます。

スプリット トンネルを実行するには、構成の詳細について、VPN ベンダーに相談してください。

### <a name="wi-fi"></a>Wi-Fi

Wi-fi ネットワークは、VPN と同じように設計されていないか、リアルタイムメディアをサポートするように構成されていないことがあります。 Teams をサポートするために Wi-Fi ネットワークのための計画を立てたり、最適化を行うことは、高品質の展開を実現するための重要な考慮事項です。

Wi-Fi ネットワークの最適化には、いくつかの要素が関係します。

- Wi-Fi ネットワーク上でメディア トラフィックが確実に優先されるように QoS または Wi-Fi マルチメディア (WMM) を実装すること。

- W-Fi バンドとアクセス ポイントの配置の計画と最適化。 アクセス ポイントの配置に応じて、2.4 GHz 帯で十分なエクスペリエンスが提供される可能性がありますが、アクセス ポイントは、多くの場合にその帯域で動作するその他のコンシューマー デバイスによって影響を受けます。 5 GHz 帯は、その密度により、リアルタイム メディアにより適していますが、十分なカバレッジを得るためにより多くのアクセスポイントを必要とします。 エンドポイントも、その帯をサポートしており、それらの帯を利用できるように構成されている必要があります。

- デュアル バンドの Wi-Fi ネットワークが展開されている場合は、バンド ステアリングの実装を検討してください。 _バンド ステアリング_は Wi-Fi ベンダーによって実装された技術で、デュアル バンド クライアントが 5 GHz 帯を使用するように仕向けます。

- 同じチャネルのアクセス ポイントがお互いに近すぎる場合、信号のオーバーラップや意図しない競合が発生して、ユーザーのエクスペリエンスが低下する可能性があります。 互いに隣接するアクセスポイントが重なっていないチャネル上にあることを確認します。

各無線ベンダーは、その無線ソリューションを展開する場合の推奨事項をそれぞれ持っています。 詳細なガイダンスについては、ご利用のベンダーに相談することをお勧めします。

<!--ENDOFSECTION-->

## <a name="firewall-and-proxy-requirements"></a>ファイアウォールおよびプロキシの要件

Microsoft Teams は、Microsoft Online Services に接続します。そのためにインターネット接続が必要になります。 Teams が正しく機能するために、TCP ポート 80 と 443 をクライアントからインターネット向けに開くことと、UDP ポート 3478 から 3481 までをクライアントからインターネットに向けて開くことが必要です。 TCP ポートは、SharePoint Online、Exchange Online、および Teams Chat サービスなどの Web ベースのコンテンツに接続するために使用されます。 プラグインとコネクタも、これらの TCP ポートを介して接続します。 4 つの UDP ポートは、オーディオおよびビデオなどのメディアのために使用され、それらのフローが正常に行われるようにします。

これらのポートを開くことは、高い信頼性を確保しながら Teams を展開するために不可欠です。 これらポートのブロックはサポートされていないため、メディアの品質に影響します。

所属する組織で、これらのポートが開かれる対象となる正確な IP アドレス範囲とドメインを指定することが必要な場合、これらのポートに対するターゲット IP 範囲とドメインを制限することができます。 正確なポート、プロトコル、IP 範囲のリストについては、「[Office 365 の URL と IP アドレスの範囲](https://docs.microsoft.com/office365/enterprise/urls-and-ip-address-ranges)」をご覧ください。 ターゲットの IP アドレス範囲とドメインを制限する場合は、変更されている可能性があるため、ポートと範囲のリストを常に最新の状態に維持する必要があります。 変更が生じたときに更新される、[こちらの RSS フィード](https://go.microsoft.com/fwlink/p/?linkid=236301)を購読できます。 また、 [Skype For Business ネットワーク評価ツール](https://www.microsoft.com/download/details.aspx?id=53885)を定期的に実行して、すべてのポートを開くかどうかをテストすることをお勧めします。 このツールの機能の詳細については、次のセクションをご覧ください。

プロキシ サーバーが展開されている場合は、すべての Teams サービスについてプロキシ サーバーをバイパスすることをお勧めします。 プロキシを使っても機能する場合もありますが、UDP の代わりに TCP を使うようにメディアが強制されているため、音質が低下する可能性があります。 プロキシ サーバーとバイパスの詳細については、「[Office 365 の URL と IP アドレスの範囲](https://docs.microsoft.com/MicrosoftTeams/office-365-urls-ip-address-ranges)」を参照してください。

<!--ENDOFSECTION-->

## <a name="additional-network-considerations"></a>ネットワークに関する追加の考慮事項

### <a name="external-name-resolution"></a>外部の名前解決

Teams を実行するすべてのクライアント コンピューターが外部 DNS クエリを解決して、Office 365 によって提供されるサービスを検出できることを確認してください。

### <a name="nat-pool-size"></a>NAT プール サイズ

複数のユーザーやデバイスがネットワークアドレス変換 (NAT) またはポートアドレス変換 (PAT) を使用して Office 365 にアクセスする場合、各パブリックルーティング可能な IP アドレスの背後に隠れているデバイスがサポートされている番号を超えないようにする必要があります。

このリスクを軽減するには、適切なパブリック IP アドレスを NAT プールに割り当ててポート枯渇を回避します。 ポート枯渇は、Office 365 サービスに接続するときに発生するエンド ユーザーやデバイスの問題の原因となります。 詳細については、[Office 365 の NAT サポート](https://docs.microsoft.com/office365/enterprise/nat-support-with-office-365)をご覧ください。

### <a name="intrusion-detection-and-prevention-guidance"></a>侵入検知/防御のガイダンス

送信接続の追加のセキュリティ レイヤーとして環境に侵入検知/防御システムが配備されている場合は、Office 365 URL を送信先として含んでいるトラフィックがすべてホワイトリストに記載されていることを確認してください。

## <a name="test-the-network"></a>ネットワークのテスト

計画とネットワークの準備 (帯域幅のアップグレード、ファイアウォールでのポートのオープンなど) が完了したら、ネットワークのパフォーマンスをテストする必要があります。 このテストの結果により、Teams の実装を成功させるために必要なネットワーク最適化や修復が明確になります。

[Skype for Business Network Assessment Tool](https://www.microsoft.com/download/details.aspx?id=53885) をダウンロードし、ネットワークが Teams に対応しているかどうかをテストできます。 このツールが提供する 2 つの機能により、すべての正しいポートが開かれているかどうかと、ネットワーク障害についてのテストを実施できます。

このツールは、ダウンロードしてインストールした後、C:\Program Files (x86)\Microsoft Skype for Business ネットワーク評価ツールに入っています。 ツールの使用方法についての詳細なガイドである Usage.docx は、そのディレクトリに含まれています。

### <a name="test-for-opened-ports"></a>開いているポートをテストする

コマンド プロンプト ウィンドウを開き、**cd C:\Program Files (x86)\Microsoft Skype for Business Network Assessment Tool** と入力して Network Assessment Tool ディレクトリに移動します。 コマンド プロンプトで、**networkassessmenttool.exe /connectivitycheck** と入力して開いているポートのテストを開始します。

チェックを実行した後、ツールは、"検証が完了しました" というメッセージまたはブロックされたポートに関するレポートを表示します。 また、Connectivity_results.txt というファイルが生成されます。このファイルには、ツールからの出力が含まれます。出力は、%userprofile%\\appdata\\local\\microsoft skype for business network assessment tool\\ ディレクトリに格納されます。

ポートが開かれ、正しく機能していることを確認するために、接続チェックを定期的に実行することをお勧めします。

### <a name="test-for-network-impairments"></a>ネットワーク障害のテスト

ユーザー満足度を高めるには、ネットワーク上の障害を抑える必要があります。 最も一般的なネットワーク障害としては、遅延 (待ち時間)、パケット損失、ジッターがあります。

- **遅延**: これは、IP パケットがネットワーク上のポイント A からポイント B に到達するまでにかかる時間です。 このネットワーク伝達遅延は、さまざまなルーターの間の追加のオーバーヘッドを含めて、2 つのポイントの間の物理的な距離と光速度に関連しています。 遅延は、一方向またはラウンド トリップ時間として測定されます。

- **パケット損失**: これは、指定した時間帯に失ったパケットの割合として定義されることがよくあります。 パケット損失は、オーディオの品質に直接影響を与えます。ほとんど影響を及ぼすことのない小規模のパケット損失から、音声が完全に途切れる原因となる連続したバースト損失まで存在します。

- **パケット到着間隔ジッターまたは単純なジッター:** 連続するパケット間の遅延の平均変動です。 Skype for Business などの最新の VoIP ソフトウェアは、多くの場合、バッファリングによって一定レベルのジッターに対応できます。 これは、参加者がジッターの影響に気付くほど、ジッターがバッファリングを超える場合に限定されます。

これらの障害の最大値については、「[メディアの品質とネットワーク接続性のパフォーマンス](/SkypeForBusiness/optimizing-your-network/media-quality-and-network-connectivity-performance)」で取り上げられています。 これらの障害をテストするときは、以下の 2 つの異なるセグメントを区別します。

- *エッジ セグメント*は、ルーターが存在するセグメントです。 各地域のインターネットに接続している、直近の論理ネットワーク セグメントです。 ほとんどの場合、これはルーターの接続ポイントです。境界ネットワーク (別名、*DMZ*、*非武装地帯*、*スクリーン サブネット*) の場合もあります。 ルーター以外のデバイスに影響を与えるトラフィックは、このセグメントとインターネットの間で行われることはありません。

- *クライアント セグメント*は、クライアントが存在する論理ネットワーク セグメントです。

Network Assessment Tool を使用して、両方のセグメントをテストする必要があります。 セグメントをテストするには、コマンド プロンプトで対象ディレクトリに移動し、**networkassessmenttool.exe** と入力します。 結果は Results.tsv というファイルに書き込まれます。各セグメントの[要件](/SkypeForBusiness/optimizing-your-network/media-quality-and-network-connectivity-performance)と結果を比較できます。

高品質の展開を行うには、両方のセグメントが要件を満たしている必要があります。 ネットワークのパフォーマンスを適切に示すために、このツールを1時間に複数回実行することをお勧めします。

<!--ENDOFSECTION-->

## <a name="network-remediation"></a>ネットワークの修復

帯域幅の計画、ポートのテスト、ネットワーク要件のテストの結果によって、Teams を展開する前に現在のネットワークを修復する必要があると示される場合、次の複数の方法で修復を実行することができます。

- 帯域幅が不十分な場合は、接続をアップグレードして、Office 365 へのトラフィックのフローが妨げられないようにします。

- ポートがブロックされた場合は、ファイアウォールのルールを変更して、ポートのテストをやり直します。

- ネットワーク障害の場合は、必ず根本原因の分析を実行します。

サービスの品質 (QoS) を使うと、トラフィックの優先順位付けと分離によって障害を克服できます。 一部の組織では、帯域幅の問題を解決するために QoS を展開したり、トラフィック フロー量を制限したりします。 これにより品質が向上することはなく、新しい問題が発生する可能性があります。 根本原因分析は、ネットワーク障害が要件を超えたときに常に行う必要があります。 QoS を解決策として使うことができます。 詳しくは、「[Microsoft Teams でのサービスの品質](qos-in-teams.md)」を参照してください。

>[!NOTE]
>多くのネットワークは時間の経過とともに、アップグレード、拡張、その他のビジネス上の要件によって、進展します。 自分のサービス管理計画の一部として、これらの領域の保守管理のための運用プロセスが確立されていることを確認します。

<table>
<tr><td><img src="media/audio_conferencing_image7.png" alt="An icon depicting a decision point"/> <br/>判断ポイント</td><td><ul><li>すべてのネットワーク セグメントと組織の場所で、適切なネットワーク評価を完了する責任があるのは誰ですか?</li></ul></td></tr>
<tr><td><img src="media/audio_conferencing_image9.png" alt="An icon depicting the next steps"/><br/>次のステップ</td><td><ul><li>詳細なネットワーク評価を実行して、Microsoft Teams の展開に向けたネットワークの準備ができていることを確認できます。 </li><li>各ネットワーク セグメントのネットワーク準備状況の評価結果に基づいてネットワークの修復を実行します。</li></ul></td></tr>
</table>

<!--ENDOFSECTION-->

## <a name="key-takeaways"></a>主要な考慮事項

このガイダンスから得られる主な考慮事項を示します。 次を実行する必要があります。

- TCP ポート 80 と 443 を開きます。Teams を使用するクライアントからの送信に対応します。

- TCP ポート 3478 から 3481 までを開きます。Teams を使用するクライアントからの送信に対応します。

- Teams を展開するために十分な帯域幅があることを確認します。

- [Network Assessment Tool](https://www.microsoft.com/download/details.aspx?id=53885) を実行して、エッジ セグメントとクライアント セグメントの両方から「[メディアの品質とネットワーク接続性のパフォーマンス](/SkypeForBusiness/optimizing-your-network/media-quality-and-network-connectivity-performance)」に記載されている要件を満たしていることを確認します。

## <a name="related-topics"></a>関連項目

[ビデオ : ネットワーク計画](https://aka.ms/teams-networking)
