---
title: Microsoft Teams のネットワークを準備する | ポートファイアウォールの要件
author: lanachin
ms.author: v-lanac
manager: serdars
ms.topic: article
audience: admin
ms.service: msteams
ms.reviewer: dearbeen
description: このガイダンスを使用して、チームの展開とロールアウトのためにネットワークを準備する
localization_priority: Normal
search.appverid: MET150
f1.keywords:
- CSH
ms.custom: Teams-upgrade-guidance
ms.collection:
- Teams_ITAdmin_JourneyFromSfB
- M365-collaboration
appliesto:
- Microsoft Teams
ms.openlocfilehash: ec47733accfe9973887cd9f3f7019ac368e8e970
ms.sourcegitcommit: ed3d7ebb193229cab9e0e5be3dc1c28c3f622c1b
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 02/06/2020
ms.locfileid: "41837217"
---
![テクニカルレディネスステージを強調したアップグレードの図](media/upgrade-banner-tech-readiness.png "技術的な準備段階に重点を置いたアップグレードの段階")

この記事は、アップグレードが行われる技術準備段階の一部であり、ユーザーの準備段階と並行して実行されるアクティビティです。 続行する前に、以前のステージでこれらのアクティビティが完了していることを確認してください。

- [プロジェクトの関係者をリスト化した](upgrade-enlist-stakeholders.md)
- [プロジェクトの対象範囲を定義した](https://aka.ms/SkypetoTeams-Scope)
- [Skype for Business と Teams の共存と相互運用を理解した](https://aka.ms/SkypeToTeams-Coexist)
- [アップグレードの手順を選択した](upgrade-and-coexistence-of-skypeforbusiness-and-teams.md)

> [!Tip]
> チームでネットワークを活用する方法と、最適なネットワーク接続の最適な計画方法については、次のセッションを参照してください。 [Teams ネットワーク計画](https://aka.ms/teams-networking)

# <a name="prepare-your-network-for-upgrading-to-teams"></a>Teams にアップグレードするためにネットワークを準備する

オーディオ、ビデオ、または会議を展開している場合は、その機能を利用できるようにネットワークを最適化するための追加の手順を実行することができます。 Teams では、オーディオとビデオの技術 (コーデック) が使用されています。そのため、ほとんどのネットワーク条件で対応できます。 最適かつ一貫性のあるパフォーマンスを確保するために、Teams 用にネットワークを準備する必要があります。

![品質の3つの構成要素について説明した図](media/evaluate-my-environment-image1.png "品質の3つのコンポーネントと、サービス管理が3つのコンポーネントすべてにどのように重なっているかを説明する図。ネットワークにフォーカスがある状態。")

## <a name="why-should-you-prepare-your-network"></a>なぜネットワークを準備する必要があるのでしょうか。

実行する手順を確認する前に、チームのパフォーマンスに与える影響を理解し、ユーザーのしあわせ度と満足度を高めることが重要です。 次の3つの主なリスク領域は、ユーザーがネットワークの品質を感じる方法に影響を与える可能性があります

- 利用可能な帯域幅が不足しています

- ファイアウォールとプロキシブロック

- ジッタ、パケット損失などのネットワーク障害

以下で説明する手順は、展開がこれらのいずれかの要因によって影響を受けるかどうかを判断するのに役立ち、解決に向けて役立ちます。 ネットワークを準備していないと、不満のあるユーザーや、臨時の修正が発生する可能性があります。 チームのネットワークと組織を準備することで、成功の可能性を大幅に高めることができます。

<!--ENDOFSECTION-->

## <a name="bandwidth-planning"></a>帯域幅の計画

Microsoft Teams を使用すると、最高のオーディオ、ビデオ、およびコンテンツのエクスペリエンスをネットワークの状態に関係なく共有できます。 可変コーデックを使用すると、限られた帯域幅の環境で最小限の影響でメディアをネゴシエートできます。 しかし帯域幅が問題にならない場合は、最大 1080 p のビデオ解像度、最大 30 fps のビデオと 15 fps コンテンツの、ハイファイ オーディオなど、エクスペリエンスを品質に合わせて最適化できます。

[!INCLUDE [Bandwidth requirements](includes/bandwidth-requirements.md)]

### <a name="local-internet-egress"></a>ローカルのインターネット エグレス

多くのネットワークは、ハブおよびスポーク トポロジを使用するよう設計されたものです。 このトポロジでは、インターネットのトラフィックは通常、インターネットに出現 (エグレス) する前に、 WAN を横断して中央データセンターに到達します。 これは多くの場合、総コストを削減する目的で、ネットワーク セキュリティ デバイスを一元化するために行われます。

WAN でのバックホーリングのトラフィックは待機時間を増大させ、品質とユーザー エクスペリエンスに悪影響をおよぼします。 Microsoft Teams は Microsoft の大規模なグローバル ネットワーク上で実行されるため、多くの場合、ユーザーに近いネットワーク ピアリングの場所が存在します。 ユーザーの場所に近いローカルのインターネット ポイントから出て、音声に最適化されたネットワークにできるだけ早く入ることにより、ユーザーはより良質なパフォーマンスを得る可能性が高くなります。 一部の負荷については、最も近いフロントエンド サーバーにトラフィックを送信するために DNS 要求が使用されます。 そのような場合、ローカル エグレス ポイントを使用するときにローカル DNS 解決と組み合わせることが重要です。

Microsoft のグローバル ネットワークへのネットワークパスを最適化すると、パフォーマンスが改善され、最終的にユーザーのための最高のエクスぺリエンスが提供されます。 詳細については、「[Getting the best connectivity and performance in Office 365](https://techcommunity.microsoft.com/t5/Office-365-Blog/Getting-the-best-connectivity-and-performance-in-Office-365/ba-p/124694)」のブログ投稿をご覧ください。

Microsoft Teams 内でリアルタイムのメディアを使用して最適なエクスペリエンスを実現するには、Office 365 のネットワーク要件を満たしている必要があります。 詳細については、「[Skype for Business Online におけるメディアの品質とネットワーク接続性のパフォーマンス](/SkypeForBusiness/optimizing-your-network/media-quality-and-network-connectivity-performance)」をご覧ください。

この2つのネットワークセグメント (クライアントと microsoft edge の間のクライアント) は、次の要件を満たしている必要があります。

|**値** |**クライアントから Microsoft Edge** |**Customer Edge から Microsoft Edge** |
|---|---|---|
|**遅延 (一方向)** |< 50 ミリ秒 |< 30 ミリ秒 |
|**待機時間 (ラウンドトリップ時間、または RTT)** |< 100 ミリ秒 |< 60 ミリ秒 |
|**バースト パケット損失** |200秒間隔で <10% |200秒間隔で <1% |
|**パケット損失** |15秒間隔で <1% |15秒間隔で <0.1% |
|**パケット間の着信のジッター** |15秒間隔で <30 ミリ秒 |15秒間隔で <15 ミリ秒 |
|**パケットの並べ替え** |< 順序が適切でないパケットが 0.05% |< 順序が適切でないパケットが 0.01% |

両方のネットワーク セグメントをテストするために、[ネットワーク評価ツール](https://go.microsoft.com/fwlink/?linkid=855799)を使用することができます。 このツールは、クライアント PC に直接展開したり、お客様のネットワーク エッジに接続された PC に展開したりすることができます。 ツールに含まれているドキュメントは限定的ですが、ツールの使用についてのより詳細なドキュメントは「[Network Readiness Assessment (ネットワークの準備状況の評価)](https://go.microsoft.com/fwlink/?linkid=855800)」にあります。 このネットワークの準備状況の評価を実行することによって、Microsoft Teams などのリアルタイム メディア アプリケーションを実行するためのネットワークの準備状況を検証することができます。

> [!NOTE]
> これは、Skype for Business を正常に展開することを検討しているお客様によって実行されることをお勧めしているネットワークの準備評価と同じです。

### <a name="vpn"></a>VPN

VPN は多くの組織に対して、価値のあるサービスを提供します。 残念ながら、通常は、リアルタイムメディアをサポートするように設計されていないか、構成されていません。 一部の VPN は、UDP をサポートしていない可能性もあります。 Vpn は、既に暗号化されているメディアトラフィックの上に、暗号化の追加レイヤーを導入することもあります。 さらに、VPN デバイス経由のヘアピンによるトラフィックが原因で、Teams サービスへの接続が効率的でない場合があります。 さらに、チームが必要とする予測される負荷に対応するために、キャパシティの観点から設計されるとは限りません。

Teams トラフィックのために VPN をバイパスする代替パスを提供することをお勧めします。 これは、一般的に*分割トンネル VPN*と呼ばれます。 [トンネリングの分割とは、Office 365 のトラフィックが VPN を通過せず、直接 Office 365 に接続することを意味します。 この変更は、品質に良い影響をおよぼしますが、二次的な利点として、VPN デバイスおよび組織のネットワークの負荷を低減します。

スプリット トンネルを実行するには、構成の詳細について、VPN ベンダーに相談してください。

### <a name="wi-fi"></a>Wi-Fi

Wi-fi ネットワークは、VPN と同じように設計されていないか、リアルタイムメディアをサポートするように構成されていないことがあります。 チームをサポートするための Wi-fi ネットワークの計画または最適化は、高品質な展開を行うための重要な考慮事項です。

Wi-fi ネットワークを最適化するためには、いくつかの要因があります。

- Wi-Fi ネットワーク上でメディア トラフィックが確実に優先されるように QoS または Wi-Fi マルチメディア (WMM) を実装すること。

- Wi-fi バンドとアクセスポイントの配置の計画と最適化 2.4 GHz の範囲は、アクセスポイントの配置によっては適切なエクスペリエンスを提供する場合がありますが、アクセスポイントは、その範囲内で動作する他のコンシューマーデバイスによって影響を受けることがあります。 5 GHz 帯は、その密度により、リアルタイム メディアにより適していますが、十分なカバレッジを得るためにより多くのアクセスポイントを必要とします。 エンドポイントも、その帯をサポートしており、それらの帯を利用できるように構成されている必要があります。

- デュアルバンド Wi-fi ネットワークが展開されている場合は、バンドステアリングの実装を検討してください。 _バンドステアリング_は、wi-fi ベンダーによって実装される手法で、デュアルバンドクライアントが 5 GHz の範囲を使用するようにします。

- 同じチャネルのアクセスポイントが近すぎると、シグナルの重複が発生し、意図せず競合する可能性があり、その結果、ユーザーにとって悪い操作が発生する可能性があります。 互いに隣接するアクセスポイントが重なっていないチャネル上にあることを確認します。

各無線ベンダーは、その無線ソリューションを展開する場合の推奨事項をそれぞれ持っています。 詳細なガイダンスについては、ご利用のベンダーに相談することをお勧めします。

<!--ENDOFSECTION-->

## <a name="firewall-and-proxy-requirements"></a>ファイアウォールとプロキシの要件

Microsoft Teams は、Microsoft オンラインサービスに接続し、そのためにインターネット接続が必要です。 Teams を正しく機能させるには、クライアントからインターネットへの TCP ポート80および443、および UDP ポート 3478 ~ 3481 をクライアントからインターネットに開く必要があります。 TCP ポートは、SharePoint Online、Exchange Online、Teams チャットサービスなどの web ベースのコンテンツに接続するために使用されます。 プラグインとコネクタも、これらの TCP ポートを経由して接続します。 この4つの UDP ポートは、オーディオやビデオなどのメディアに使用され、適切に流れるようにします。

これらのポートを開くことは、信頼性の高いチーム展開のために不可欠です。 このポートのブロックはサポートされていないため、メディアの品質に影響します。

組織で、これらのポートを開く正確な IP アドレス範囲とドメインを指定する必要がある場合は、これらのポートのターゲット IP 範囲とドメインを制限することができます。 正確なポート、プロトコル、IP 範囲の一覧については、「 [Office 365 の url と ip アドレスの範囲](https://docs.microsoft.com/office365/enterprise/urls-and-ip-address-ranges)」を参照してください。 ターゲット IP アドレス範囲とドメインを制限する場合は、変更されている可能性があるため、ポートと範囲の一覧を常に最新の状態に維持する必要があります。 変更が発生したときに、[この RSS フィード](https://go.microsoft.com/fwlink/p/?linkid=236301)を購読して更新することができます。 また、 [Skype For Business ネットワーク評価ツール](https://www.microsoft.com/download/details.aspx?id=53885)を定期的に実行して、すべてのポートを開くかどうかをテストすることをお勧めします。 このツールの機能の詳細については、次のセクションをご覧ください。

展開されているプロキシサーバーの場合は、すべての Teams サービスについてプロキシサーバーをバイパスすることをお勧めします。 プロキシを使っても機能する場合もありますが、UDP の代わりに TCP を使うようにメディアが強制されているため、音質が低下する可能性があります。 プロキシサーバーとバイパスの詳細については、「 [Office 365 の url と IP アドレスの範囲](https://docs.microsoft.com/MicrosoftTeams/office-365-urls-ip-address-ranges)」を参照してください。

<!--ENDOFSECTION-->

## <a name="additional-network-considerations"></a>ネットワークに関する追加の考慮事項

### <a name="external-name-resolution"></a>外部の名前解決

Teams クライアントを実行しているすべてのクライアントコンピューターが外部 DNS クエリを解決し、Office 365 によって提供されるサービスを検出できることを確認します。

### <a name="nat-pool-size"></a>NAT プールサイズ

複数のユーザーやデバイスがネットワークアドレス変換 (NAT) またはポートアドレス変換 (PAT) を使用して Office 365 にアクセスする場合、各パブリックルーティング可能な IP アドレスの背後に隠れているデバイスがサポートされている番号を超えないようにする必要があります。

このリスクを軽減するには、ポートの枯渇を防ぐため、適切なパブリック IP アドレスが NAT プールに割り当てられていることを確認します。 ポート枯渇は、Office 365 サービスに接続するときに発生するエンドユーザーやデバイスの問題の原因となります。 詳細については、[Office 365 の NAT サポート](https://docs.microsoft.com/office365/enterprise/nat-support-with-office-365)をご覧ください。

### <a name="intrusion-detection-and-prevention-guidance"></a>侵入検知と予防のガイダンス

お使いの環境に、発信接続用のセキュリティレイヤーが追加された侵入検出システムまたはアタック防止システムが導入されている場合は、Office 365 Url が含まれているすべてのトラフィックをその送信先としてホワイトリストにしてください。

## <a name="test-the-network"></a>ネットワークをテストする

計画とネットワークの準備 (帯域幅のアップグレード、ファイアウォールでのポートのオープンなど) が完了したら、ネットワークのパフォーマンスをテストする必要があります。 このテストの結果により、Teams の実装を成功させるために必要なネットワーク最適化または修復の詳細がわかりやすく示されます。

[Skype For Business ネットワーク評価ツール](https://www.microsoft.com/download/details.aspx?id=53885)をダウンロードして、自分のネットワークが Teams に対応しているかどうかをテストすることができます。 このツールは、2つの機能を備えています。これは、すべての正しいポートが開かれているかどうかをテストし、ネットワーク障害のテストを行うことができます。

ツールをダウンロードしてインストールした後は、「C:\Program Files (x86) \Microsoft Skype for Business のネットワーク評価ツール」で見つけることができます。 このツールの使用方法に関する詳細なガイドがそのディレクトリに含まれています。

### <a name="test-for-opened-ports"></a>開いているポートをテストする

コマンドプロンプトウィンドウを開き、 **cd C:\Program files (x86) \Microsoft**を入力してネットワーク評価ツールのディレクトリに移動します。 Skype For Business ネットワーク評価ツール コマンドプロンプトで、networkassessmenttool/connectivitycheck を入力して、開いているポートのテストを開始し**ます。**

チェックを実行した後、ツールは、"検証が完了しました" というメッセージまたはブロックされたポートに関するレポートを表示します。 また、ツールからの出力を含む Connectivity_results .txt という名前のファイルを生成し、% userprofile\\% appdata\\local\\microsoft skype for business ネットワーク評価ツール\\ディレクトリに保存します。

ポートが開かれ、正しく機能していることを確認するために、接続チェックを定期的に実行することをお勧めします。

### <a name="test-for-network-impairments"></a>ネットワーク障碍のテスト

ユーザーの満足度を高めるために、ネットワーク上の障害を制限する必要があります。 最も一般的なネットワーク障害としては、遅延 (待ち時間)、パケット損失、ジッタがあります。

- **待ち時間:** これは、IP パケットがネットワーク上のポイント A からポイント B に到達するまでにかかる時間です。 このネットワーク伝播遅延は、さまざまなルーターの間の追加のオーバーヘッドを含めて、2つのポイントとライトの速度の間の物理的な距離に関連しています。 待ち時間は、一方向またはラウンドトリップの時間として測定されます。

- **パケット損失**: これは、特定の時間帯に失われるパケットの割合として定義されることがよくあります。 パケット損失は、オーディオの品質に直接影響を与えます。これは、音声が完全に途切れることを引き起こすバックツーバックのバースト損失に影響を及ぼすことなく、個々の損失の小さいパケットに影響します。

- **パケット間の着信のジッターまたは単なるジッター:** これは、連続するパケット間の遅延の平均変更です。 Skype for Business などの最新の VoIP ソフトウェアは、多くの場合、バッファリングによって一定レベルのジッターに対応できます。 これは、ジッタがジッターの効果に気付くというバッファリングを超える場合に限られます。

これらの障碍の最大値については、「[メディアの品質とネットワーク接続性のパフォーマンス](/SkypeForBusiness/optimizing-your-network/media-quality-and-network-connectivity-performance)」を参照してください。 このような障碍をテストするときは、2つの異なるセグメントを区別します。

- *エッジセグメント*とは、ルーターが存在するセグメントのことです。 これは、各地域でインターネットに接続されている最も近い論理ネットワークセグメントです。 ほとんどの場合、これはルータの接続ポイント、または境界ネットワーク ( *dmz*、*非武装地帯*、*スクリーンサブネット*とも呼ばれます) になります。 ルーター以外のデバイスに影響を与えるトラフィックは、このセグメントとインターネットの間で行われることはありません。

- *クライアントセグメント*は、クライアントが存在する論理ネットワークセグメントです。

ネットワーク評価ツールを使用して、両方のセグメントをテストする必要があります。 セグメントをテストするには、ディレクトリに移動し、コマンドプロンプトで**networkassessmenttool**と入力します。 結果は、.tsv という名前のファイルに書き込まれ、各セグメントの[要件](/SkypeForBusiness/optimizing-your-network/media-quality-and-network-connectivity-performance)と比較できます。

どちらのセグメントも、高品質の展開の要件を満たしている必要があることに注意してください。 ネットワークのパフォーマンスを適切に示すために、このツールを1時間に複数回実行することをお勧めします。

<!--ENDOFSECTION-->

## <a name="network-remediation"></a>ネットワークの修復

帯域幅計画、ポートテスト、またはネットワーク要件のテストの結果が、Teams を展開する前に現在のネットワークに修復が必要であることを示している場合は、次の方法で実行できます。

- 帯域幅が不十分な場合は、接続をアップグレードして、Office 365 へのトラフィックが unhindered に流れるようにします。

- ブロックされたポートの場合は、ファイアウォールルールを変更して、ポートを再テストします。

- ネットワーク障碍の場合は、常に根本原因分析を実行します。

QoS (Quality of service) を使うと、トラフィックの優先順位付けと分離を行うことができます。 一部の組織では、帯域幅の問題を解決するために QoS を展開したり、トラフィックフローの量を制限したりすることを選択します。 これにより品質が向上することはなく、新しい問題が発生する可能性があります。 根本原因分析は、ネットワーク障碍が要件を超えたときに常に行われる必要があります。 QoS は解決策として使うことができます。 詳細については、「 [Microsoft Teams のサービス品質](qos-in-teams.md)」を参照してください。

>[!NOTE]
>多くのネットワークは時間の経過とともに、アップグレード、拡張、その他のビジネス上の要件によって、進展します。 自分のサービス管理計画の一部として、これらの領域の保守管理のための運用プロセスが確立されていることを確認します。

<table>
<tr><td><img src="media/audio_conferencing_image7.png" alt="An icon depicting a decision point"/> <br/>判断ポイント</td><td><ul><li>すべてのネットワークセグメントと組織の場所で、適切なネットワーク評価を完了する責任は誰ですか?</li></ul></td></tr>
<tr><td><img src="media/audio_conferencing_image9.png" alt="An icon depicting the next steps"/><br/>次のステップ</td><td><ul><li>詳細なネットワーク評価を実行して、Microsoft Teams の展開に向けたネットワークの準備ができていることを確認することができます。 </li><li>各ネットワークセグメントのネットワーク準備評価の結果に基づいてネットワークの修復を実行します。</li></ul></td></tr>
</table>

<!--ENDOFSECTION-->

## <a name="key-takeaways"></a>重要なポイント

以下は、このガイダンスの主要なポイントです。 しなきゃいけません：

- チームを使用するクライアントから送信された TCP ポート80および443を開きます。

- Teams を使用するクライアントから送信された UDP ポート 3478 ~ 3481 を開きます。

- チームの展開に十分な帯域幅があることを確認します。

- [ネットワーク評価ツール](https://www.microsoft.com/download/details.aspx?id=53885)を実行して、エッジセグメントとクライアントセグメントの両方からの[メディアの品質とネットワーク接続性のパフォーマンス](/SkypeForBusiness/optimizing-your-network/media-quality-and-network-connectivity-performance)について説明されている要件を満たしていることを確認します。

## <a name="related-topics"></a>関連項目

[ビデオ : ネットワーク計画](https://aka.ms/teams-networking)
