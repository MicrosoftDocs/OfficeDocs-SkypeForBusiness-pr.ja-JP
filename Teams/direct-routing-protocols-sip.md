---
title: 電話システムのダイレクト ルーティング
author: CarolynRowe
ms.author: crowe
manager: serdars
ms.date: 01/28/2019
ms.topic: article
ms.service: msteams
audience: admin
ms.collection:
- Teams_ITAdmin_Help
- M365-voice
ms.reviewer: nmurav
search.appverid: MET150
description: ダイレクトルーティングプロトコル
appliesto:
- Microsoft Teams
ms.openlocfilehash: 6ab2203544e1d0e4d8679a4ad8107c2048e5b3b8
ms.sourcegitcommit: 89106cfda0d900d8be541943b7d1537bc69ed57f
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/16/2019
ms.locfileid: "40065677"
---
# <a name="direct-routing---sip-protocol"></a>ダイレクトルーティング-SIP プロトコル

この記事では、ダイレクトルーティングでセッション開始プロトコル (SIP) を実装する方法について説明します。 セッションボーダーコントローラー (SBC) と SIP プロキシの間でトラフィックを適切にルーティングするには、一部の SIP パラメーターに特定の値を指定する必要があります。 この記事は、オンプレミスの SBC と SIP プロキシサービス間の接続を構成する責任を負うボイス管理者を対象としています。

## <a name="processing-the-incoming-request-finding-the-tenant-and-user"></a>着信要求の処理: テナントとユーザーの検索

着信時に SIP プロキシは、通話の宛先となっているテナントを検索し、このテナント内の特定のユーザーを検索する必要があります。 テナント管理者は、複数のテナントで、(たとえば、+ 1001 のような) ない番号を構成する場合があります。 このため、数値の参照を実行する特定のテナントを見つけることが重要です。このような番号は、複数の Office 365 テナントでは同じではない場合があるためです。  

このセクションでは、SIP プロキシでテナントとユーザーを検索し、着信接続の SBC の認証を実行する方法について説明します。

着信時の SIP Invite メッセージの例を次に示します。

| パラメーター名 | 値の例 | 
| :---------------------  |:---------------------- |
| 要求-URI | Sip:+18338006777@sip.pstnhub.microsoft.com SIP/2.0 を招待する |
| ヘッダー経由 | Via: SIP/2.0/TLS sbc1: 5058; alias; branch = z9hG4bKac2121518978 | 
| 最大転送ヘッダー | 最大転送:68 |
| ヘッダーから | ヘッダーの差出人: <sip: 7168712781@sbc1 の場合、トランスポート = udp; タグ = 1c747237679 |
| ヘッダーへ | 宛先: sip:+183338006777@sbc1.adatum.biz | 
| CSeq ヘッダー | CSeq: 1 INVITE | 
| 連絡先のヘッダー | 連絡先: <sip: 68712781@sbc1 adatum、transport = tls> | 

SIP プロキシは、招待状の受信時に次の手順を実行します。

1. 証明書を確認します。 最初の接続では、直接ルーティングサービスは、連絡先ヘッダーに示されている FQDN 名を受け取り、表示されている証明書の共通名またはサブジェクトの代替名と一致させます。 SBC 名は、次のいずれかのオプションと一致する必要があります。

   - オプション1。 連絡先ヘッダーに表示される完全な FQDN 名は、記載されている証明書の共通名/サブジェクトの別名と一致する必要があります。  

   - オプション2。 連絡先ヘッダーに表示される FQDN 名のドメイン部分 (たとえば、FQDN 名 sbc1.adatum.biz) は、一般的な名前/サブジェクトの代替名 (* adatum.biz など) のワイルドカード値と一致する必要があります。

2. 連絡先ヘッダーに示されている完全な FQDN 名を使用して、テナントを検索してみてください。  

   連絡先ヘッダー (sbc1.adatum.biz) の FQDN 名が、Office 365 テナントで DNS 名として登録されているかどうかを確認します。 見つかった場合、ユーザーの参照は、ドメイン名として SBC FQDN が登録されているテナントで実行されます。 見つからない場合は、手順3が適用されます。   

3. 手順3は、手順2に失敗した場合にのみ適用されます。 

   連絡先ヘッダーに表示されている FQDN からホスト部分 (adatum.biz) を削除し、この名前が Office 365 テナントで DNS 名として登録されているかどうかを確認します。 見つかった場合、ユーザー検索はこのテナントで実行されます。 見つからなかった場合は、通話は失敗します。

4. 要求-URI に示されている電話番号を使用して、手順2または3で検出されたテナント内の番号の逆引き参照を実行します。 表示されている電話番号と、前の手順で見つけたテナント内のユーザー SIP URI を照合します。

5. トランクの設定を適用します。 この SBC のテナント管理者によって設定されたパラメーターを見つけます。

   Microsoft は、Microsoft SIP プロキシとペアリングされた SBC の間でサードパーティの SIP プロキシまたはユーザーエージェントサーバーを使用することをサポートしていません。これにより、ペアリングされた SBC によって作成された要求 URI を変更する可能性があります。

   1つの SBC が多くのテナント (搬送業者シナリオ) に連結されているシナリオに必要な2つの参照 (手順2と 3) の要件については、この記事の後半で説明します。

### <a name="detailed-requirements-for-contact-header-and-request-uri"></a>連絡先ヘッダーと要求 URI の詳細要件

#### <a name="contact-header"></a>連絡先のヘッダー

Microsoft SIP プロキシへのすべての着信通話について、連絡先ヘッダーは、次のように URI hostname の SBC FQDN とペアリングされている必要があります。

書式: Contact: <sip: SBC; transport = tls> の電話または sip address@FQDN 

この名前は、表示されている証明書の [共通名] または [サブジェクト代替名] フィールドにも含まれている必要があります。 Microsoft は、証明書の [共通名] または [サブジェクト代替名] フィールドで、名前のワイルドカード値を使用することをサポートしています。   

ワイルドカードのサポートについては、 [RFC 2818 の「3.1」を参照](https://tools.ietf.org/html/rfc2818#section-3.1)してください。 具体的には：

*"名前にはワイルドカード文字\*を含めることができます。これは、単一のドメイン名コンポーネントまたはコンポーネントフラグメントと一致すると見なされます。たとえば、a.com \*は foo.a.com に一致しますが、bar.foo.a.com は検索されません。\*foo.com は、bar.com ではなく、と一致します。 "*

SIP メッセージに表示されたコンタクトヘッダーの複数の値が SBC によって送信される場合は、コンタクトヘッダーの最初の値の FQDN 部分だけが使用されます。

#### <a name="request-uri"></a>要求-URI 

すべての着信通話について、要求-URI は、電話番号をユーザーに照合するために使われます。   

現在、電話番号には、次の例に示すように、プラス記号 (+) が含まれている必要があります。 

```
INVITE sip:+18338006777@sip.pstnhub.microsoft.com SIP /2.0
```

## <a name="contact-and-record-route-headers-considerations"></a>連絡先とレコード-ルートヘッダーに関する考慮事項

SIP プロキシは、新しいダイアログ内のクライアントトランザクション (Bye または再招待など) に対して次のホップ FQDN を計算する必要があります。また、SIP オプションに返信するときにも使用できます。 連絡先またはレコード-ルートのいずれかが使用されます。 

RFC 3261 によれば、連絡先ヘッダーは、新しいダイアログで発生する可能性があるすべての要求で必要です。 レコードルーティングが必要になるのは、プロキシがダイアログで将来の要求のパスを維持したい場合のみです。 

Microsoft は、次の理由で連絡先ヘッダーのみを使用することをお勧めします。

- RFC 3261 ごとに記録-ルートは、プロキシが今後の要求のパスをダイアログでそのままにしたい場合に使用されます。これは、すべてのトラフィックが Microsoft SIP プロキシとペアリングされた SBC の間にある場合には重要ではありません。 SBC と Microsoft SIP プロキシの間に中継プロキシサーバーを使用する必要はありません。

- Microsoft SIP プロキシでは、送信 ping オプションを送信するときに、連絡先ヘッダーのみを使用します (レコードルーティングではありません)。 2つ (連絡先およびレコードルーティング) ではなく、1つのパラメーター (連絡先) のみを構成すると、管理が簡単になります。

SIP プロキシでは次のホップを計算するために、次のものが使用されます。

- 優先度1。 トップレベルのレコードルーティング。 トップレベルのレコードルートに FQDN 名または IP アドレスが含まれている場合は、FQDN 名または IP を使って、送信中のダイアログに発信する接続を作成します。

- 優先度2 連絡先ヘッダー。 レコードルーティングが存在しない場合、SIP プロキシは、送信接続を行う連絡先ヘッダーの値を検索します。 (これは推奨される構成です)

連絡先とレコードの両方が使用されている場合、SBC 管理者はその値を同一に保つ必要があります。これにより、管理のオーバーヘッドが発生します。 

### <a name="use-of-fqdn-name-in-contact-or-record-route"></a>連絡先またはレコードルーティングでの FQDN の使用

IP アドレスの使用は、レコードルーティングまたは連絡先ではサポートされていません。 サポートされている唯一のオプションは FQDN です。これは、共通名または SBC 証明書のサブジェクト代替名のいずれかに一致する必要があります (証明書のワイルドカード値はサポートされています)。

- IP アドレスがレコードルーティングまたは連絡先に表示される場合、証明書のチェックは失敗し、通話は失敗します。

- FQDN が、表示されている証明書の共通またはサブジェクトの代替名の値と一致しない場合、通話は失敗します。 

## <a name="inbound-call-sip-dialog-description"></a>着信通話: SIP ダイアログの説明

次の表は、非表示モードとバイパスモードでのコールフローの相違点と類似点をまとめたものです。

| パラメーター名 | 非バイパスモード | バイパスモード
| :---------------------  |:---------------------- |:----------------|
| 183のメディア候補と200メッセージの受信者 | メディアプロセッサ | クライアント | 
| SBC が受け取ることができる183メッセージの数 | セッションあたり1回 | 多数 | 
| 通話は、仮応答で行うことができます (183) | はい | はい |
| 仮応答なしで通話を発信できます (183) | はい | はい |

###  <a name="non-media-bypass-flow"></a>メディア以外のバイパスフロー

Teams ユーザーは、同時に複数のエンドポイントを持つことができます。 たとえば、Windows クライアントの Teams、iPhone クライアントの teams、チーム電話 (Teams Android クライアント) などです。 各エンドポイントは、次のように HTTP rest を通知する可能性があります。

-   通話の進行状況– SIP プロキシによって SIP メッセージ180に変換されます。 180メッセージの受信時に、SBC はローカル呼び出しを生成する必要があります。

-   メディアの回答– SIP プロキシによって、セッション記述プロトコル (SDP) でメディア候補を使ってメッセージ183に変換されます。 183メッセージを受信するときに、SBC は SDP メッセージで受信したメディアの候補に接続することを想定しています。 メディアの応答が生成されないことがあります。また、終了点が「承諾されました」というメッセージで応答する可能性があることに注意してください。

-   通話受付– SIP プロキシによって SDP と SIP メッセージ200に変換されます。 200メッセージの受信時に、SBC は、指定された SDP 候補者との間でメディアを送受信することを前提としています。

#### <a name="multiple-endpoints-ringing-with-provisional-answer"></a>複数のエンドポイントが暫定応答で呼び出される

1.  SBC からの最初の招待状を受け取る際、SIP プロキシは "SIP SIP/2.0 100 試行中" というメッセージを送信し、すべてのエンドユーザーエンドポイントに着信通話を通知します。 

2.  通知が表示されると、各エンドポイントが SIP プロキシへの "通話の進行状況" メッセージの呼び出しと送信を開始します。 Teams ユーザーは複数のエンドポイントを持つことができるため、SIP プロキシは複数の通話進行状況メッセージを受信することがあります。

3.  クライアントから受信したすべての通話進行状況メッセージについて、SIP プロキシは通話の進行状況メッセージを SIP メッセージ "SIP SIP/2.0 180 試行中" に変換します。 このようなメッセージを送信する間隔は、通話コントローラーから受信するメッセージの間隔によって定義されます。 次の図では、SIP プロキシによって生成される 2 180 メッセージがあります。 これらのメッセージは、ユーザーの2つのチームエンドポイントから送信されます。 各クライアントには、一意のタグ ID があります。  別のエンドポイントからのすべてのメッセージは、個別のセッションになります ([宛先] フィールドの "tag" パラメーターは異なります)。 ただし、次の図に示すように、エンドポイントではメッセージ180が生成されず、直ちに183メッセージが送信されることがあります。

4.  エンドポイントのメディア候補の IP アドレスでメディア応答メッセージが生成されると、SIP プロキシによって「SIP 183 セッションの進行状況」というメッセージが表示されます。これは、メディアプロセッサから SDP によって置き換えられたクライアントから SDP へのメッセージです。 次の図では、Fork 2 のエンドポイントが呼び出しに応答しました。 トランクがバイパスされない場合、183 SIP メッセージは1回だけ生成されます (Ring ボットまたはクライアントエンドポイントのいずれか)。 183は、既存のフォークに到着したり、新しいフォークを開始したりする場合があります。

5.  通話受付メッセージは、通話を受け付けるエンドポイントの最終的な候補と共に送信されます。 通話受付メッセージが SIP メッセージ200に変換されます。 

![複数のエンドポイントが暫定応答で呼び出されている図](media/direct-routing-protocols-1.png)

#### <a name="multiple-endpoints-ringing-without-provisional-answer"></a>複数のエンドポイントが暫定応答なしで呼び出される

1.  SBC からの最初の招待状を受け取る際、SIP プロキシは "SIP SIP/2.0 100 試行中" というメッセージを送信し、すべてのエンドユーザーエンドポイントに着信通話を通知します。 

2.  通知が表示されると、各エンドポイントが SIP プロキシに "通話の進行状況" というメッセージを受信して送信します。 Teams ユーザーは複数のエンドポイントを持つことができるため、SIP プロキシは複数の通話進行状況メッセージを受信することがあります。

3.  クライアントから受信したすべての通話進行状況メッセージについて、SIP プロキシは通話の進行状況メッセージを SIP メッセージ "SIP SIP/2.0 180 試行中" に変換します。  メッセージの送信間隔は、通話コントローラーからのメッセージを受信する間隔によって定義されます。 下の図では、SIP プロキシによって生成される 2 180 メッセージがあります。これは、ユーザーが3つのチームクライアントにログインし、各クライアントが通話の進行状況を送信することを意味します。 各メッセージは個別のセッションになります ("To" フィールドのパラメーター "タグ" は異なります)。

4.  通話受付メッセージは、通話を受け付けるエンドポイントの最終的な候補と共に送信されます。 通話受付メッセージが SIP メッセージ200に変換されます。 

![複数のエンドポイントが暫定応答なしで呼び出されていることを示す図](media/direct-routing-protocols-2.png)

### <a name="media-bypass-flow"></a>メディアバイパスのフロー

メディアのバイパスシナリオでは、同じメッセージ (100 試行、180、183) が使用されます。 

次のスキーマは、バイパスの呼び出しフローの例を示しています。 メディア候補は、さまざまなエンドポイントから取得できます。 

![複数のエンドポイントが暫定応答で呼び出されている図](media/direct-routing-protocols-3.png)

## <a name="replaces-option"></a>[置換] オプション

SBC は、置き換えによる招待をサポートしている必要があります。

## <a name="size-of-sdp-considerations"></a>SDP のサイズに関する考慮事項

ダイレクトルーティングインターフェイスでは、1500バイトを超える SIP メッセージが送信されることがあります。  SDP のサイズは主にこれによって発生します。 ただし、SBC の背後に UDP トランクが含まれている場合は、そのメッセージが Microsoft SIP プロキシからトランクに転送された場合に、そのメッセージが拒否されることがあります。 Microsoft は、メッセージを UDP trunks に送信するときに、SBC の SDP の一部の値を除去することをお勧めします。 たとえば、氷の候補や使用されていないコーデックは削除することができます。

## <a name="call-transfer"></a>通話転送

ダイレクトルーティングでは、次の2つの方法で通話転送できます。

- オプション1。 SIP プロキシプロセスは、クライアントをローカルで参照し、RFC 3892 のセクション7.1 で説明されているように Referee として動作します。

  このオプションを使用すると、SIP プロキシは転送を終了し、新しい招待を追加します。 


- オプション2。 SIP プロキシは、SBC を参照し、Transferor して機能し、RFC 5589 のセクション6で説明します。

  このオプションを使うと、SIP プロキシは SBC を参照し、SBC は完全にトランスファーを処理します。

SIP プロキシは、SBC によって報告される機能に基づいて、このメソッドを選択します。 SBC が、"参照" というメソッドをサポートしていることを示している場合、SIP プロキシは、通話転送に対してオプション2を使用します。

次に示すのは、参照メソッドがサポートされているというメッセージを送信する SBC の例です。

```
ALLOW: INVITE, OPTIONS, INFO, BYE, CANCEL, ACK, PRACK, UPDATE, REFER, SUBSCRIBE, NOTIFY
```

サポートされているメソッドとして参照することが SBC で示されていない場合は、ダイレクトルーティングはオプション1を使用します (SIP プロキシは Referee として機能します)。 SBC は、通知方法をサポートしていることも通知する必要があります。

参照メソッドがサポートされていないことを示す SBC の例:

```
ALLOW: INVITE, ACK, CANCEL, BYE, INFO, NOTIFY, PRACK, UPDATE, OPTIONS
```

### <a name="sip-proxy-processes-refer-from-the-client-locally-and-acts-as-a-referee"></a>SIP プロキシプロセスはクライアントからローカルに参照され、Referee として機能します。

SBC で、参照方法がサポートされていないことを示している場合、SIP プロキシは Referee として機能します。 

クライアントから取得された参照要求は、SIP プロキシで終了します。 (クライアントからの参照要求は、次の図の "Dave への着信転送" として表示されます。  詳細については、「 [RFC 3892](https://www.ietf.org/rfc/rfc3892.txt)のセクション7.1」を参照してください。 

![複数のエンドポイントが暫定応答で呼び出されている図](media/direct-routing-protocols-4.png)

### <a name="sip-proxy-send-the-refer-to-the-sbc-and-acts-as-a-transferor"></a>SIP プロキシは、SBC を参照し、Transferor して機能します。

これは、通話転送に推奨される方法であり、メディアをスキップするデバイスには必須です。 SBC がハンドルを処理できない場合の通話転送は、メディアバイパスモードではサポートされていません。 

標準は、RFC 5589 のセクション6で説明されています。 関連する Rfc は次のとおりです。

- [セッション開始プロトコル (SIP) 通話コントロール転送](https://tools.ietf.org/html/rfc5589)

- [セッション開始プロトコル (SIP) "の置き換え" のヘッダー](https://tools.ietf.org/html/rfc3891)

- [セッション開始プロトコル (SIP) "参照先" メカニズム](https://tools.ietf.org/html/rfc3892)

このオプションは、SIP プロキシが Transferor して機能していることを前提としており、SBC への参照メッセージを送信します。 SBC は Transferee として機能し、「振替用の新しいキャンペーンを生成する」を処理します。 次の2つの場合が考えられます。

- 通話は、外部 PSTN 参加者に転送されます。 
- この通話は、1つの Teams ユーザーから、SBC を介して同じテナント内の別の Teams ユーザーに転送されます。 

お客による通話が SBC を通じて別の Teams ユーザーに転送された場合は、SBC は、参照メッセージで受け取った情報を使って、転送先 (Teams ユーザー) に新しい招待 (新しいダイアログを開始) を発行することを想定しています。 

要求のトランザクションの To/Transferor は fields を内部で設定するには、SIP プロキシは、この情報を参照先/参照先のヘッダー内に伝える必要があります。 

Sip プロキシは、sip プロキシ FQDN で構成される sip URI として、ホスト名と、次のいずれかのどちらかで構成される sip URI として表示されます。

- 転送先が電話番号の場合の URI のユーザー名部分に含まれる電子電話番号 (164)、または

- x-m パラメーターと x-t パラメーターで、完全転送ターゲットの MRI とテナント ID をそれぞれエンコードします。 

参照ヘッダーは、次の表に示すように、transferor は MRI、または transferor はテナント ID やその他の転送コンテキストパラメーターと共に、transferor は MRI がエンコードされた SIP URI です。

| パラメーター | 値 | 説明 |  
|:---------------------  |:---------------------- |:---------------------- |
| x-m | MRI | CC によって設定された transferor は transfer target の完全な MRI |
| x-t | テナント ID | CC で入力された x-t テナント ID オプションのテナント Id |
| x-ti | Transferor は関連付け Id | Transferor への通話の関連付け Id |
| x-tt | ターゲット呼び出しの URI を転送する | エンコードされた通話置換 URI |

この場合、参照ヘッダーのサイズは最大で400のシンボルにすることができます。 SBC は、400シンボルまでのサイズのメッセージ参照をサポートしている必要があります。

![複数のエンドポイントが暫定応答で呼び出されている図](media/direct-routing-protocols-5.png)

## <a name="session-timer"></a>セッションタイマー

SIP プロキシは、バイパス以外の通話に対してセッションタイマーをサポートしますが、通話をバイパスすることはできません。 SBC でのセッションタイマーの使用は必須ではありません。

##  <a name="use-of-request-uri-parameter-userphone"></a>要求-URI パラメーター user = phone を使用する

SIP プロキシは要求の URI を解析し、パラメーター user = phone が存在する場合、サービスは要求の URI を電話番号として処理し、ユーザーに対して番号を照合します。 パラメーターが存在しない場合、SIP プロキシはヒューリスティックを適用して要求 URI のユーザーの種類 (電話番号または SIP アドレス) を決定します。

通話のセットアッププロセスを簡略化するために、常に user = phone パラメーターを適用することをお勧めします。

## <a name="history-info-header"></a>履歴-情報ヘッダー

History-Info ヘッダーは、retargeting SIP 要求に使用され、要求履歴情報をキャプチャするための標準的なメカニズムであり、ネットワークとエンドユーザーにさまざまなサービスを提供します。 詳細については、「 [RFC 4244 –セクション1.1」](http://www.ietf.org/rfc/rfc4244.txt)を参照してください。 Microsoft 電話システムの場合、このヘッダーは、Simulring と着信の転送シナリオで使用されます。  

送信する場合、履歴情報は次のように有効になります。

- SIP プロキシは、関連付けられた電話番号を含むパラメーターを、PSTN コントローラーに送信される履歴情報ヘッダーを構成する個別の履歴情報エントリに挿入します。  電話番号パラメーターを持つエントリのみを使用して、PSTN コントローラーは新しい履歴情報ヘッダーを再作成し、SIP プロキシ経由で SIP トランクプロバイダーに渡します。

- [履歴-情報] ヘッダーは、同時呼び出しと着信転送ケースに追加されます。

- 履歴-情報ヘッダーは、通話転送ケースには追加されません。

- 再構築された History-Info ヘッダーの個々の履歴エントリには、URI のホスト部分として設定された Direct Routing FQDN (sip.pstnhub.microsoft.com) と組み合わせた電話番号パラメーターが提供されています。"user = phone" のパラメーターは、SIP URI の一部として追加されます。  電話のコンテキストパラメーターを除き、元の履歴情報ヘッダーに関連付けられたその他のすべてのパラメーターは、再構築された履歴情報ヘッダーから渡されます。  SIP トランクプロバイダーは信頼されるピアであるため、非公開のエントリ (RFC 4244 のセクション3.3 で定義されているメカニズムによって決定される) は、として転送されることに注意してください。

- 受信履歴-情報は無視されます。

SIP プロキシによって送信される履歴情報ヘッダーの形式は、次のようになります。

```
<sip:UserB@sip.pstnhub.microsoft.com?Privacy=history&Reason=SIP%3B\cause%3D486>;index=1.2,
```

通話が何度もリダイレクトされた場合は、すべてのリダイレクトに関する情報が時系列順に適切な理由で含まれています。


ヘッダーの例:

```
History-info: 
<sip:+14257123456@sip.pstnhub.microsoft.com;user=phone?Reason=SIP;cause=302;text=”Move Temporarily”>;index=1
<sip:+14257123457@sip.pstnhub.microsoft.com;user=phone?Reason=SIP;cause=496;text=”User Busy”>;index=1.1
```

履歴情報は、必須の TLS メカニズムによって保護されます。 

## <a name="sbc-connection-to-direct-routing-and-failover-mechanism"></a>ルーティングとフェールオーバーのメカニズムを直接制御するための SBC 接続

[ダイレクトルーティングの計画](direct-routing-plan.md#failover-mechanism-for-sip-signaling)での SIP シグナリングのセクションフェールオーバーメカニズムをご覧ください。

## <a name="retry-after"></a>再試行後

直接ルーティングデータセンターがビジー状態の場合、サービスは、SBC に1秒間隔の後に再試行メッセージを送信できます。 SBC は、招待に応答して再試行ヘッダー付きの503メッセージを受信すると、その接続を終了して、次に利用可能な Microsoft datacenter を試す必要があります。 

## <a name="ice-restart-media-bypass-call-transferred-to-an-endpoint-that-does-not-support-media-bypass"></a>ICE Restart: メディアのバイパスをサポートしていないエンドポイントに転送されたメディアバイパス通話

SBC は[、RFC 5245、セクション 9.1.1.1](https://tools.ietf.org/html/rfc5245#section-9.1.1.1)の説明に従って、ICE 再起動をサポートしている必要があります。

直接ルーティングでの再起動は、RFC の次の段落に従って実装されます。

*ICE を再起動するには、エージェントは、ufrag でメディアストリームの ice-pwd と ice-を両方とも変更する必要があります。 1つのオファーでセッションレベルの属性を使用することは許されますが、それ以降のプランでは、メディアレベルの属性として同じ ice-pwd または ufrag を提供する必要があることに注意してください。 これはパスワードの変更ではなく、表示の変更のみで、ICE 再起動は発生しません。*

*エージェントは、このメディアストリームの SDP 内の残りのフィールドを設定します (セクション4.3 を参照してください)。 したがって、一連の候補には、そのストリームの以前の候補者の一部、またはすべてが含まれている可能性があります。また、「4.1.1」で説明されているように、完全に新しい候補セットを収集することもできます。*

通話がメディアバイパスで初めて確立された場合に、通話が Skype for Business クライアントに転送されると、直接ルーティングはメディアプロセッサを挿入する必要があります。これは、メディアをバイパスする Skype for Business クライアントで直接ルーティングを使用できないためです。 ダイレクトルーティングでは、ice-pwd と ice-ufrag を変更して、reinvite で新しいメディア候補を提供することで、氷の再起動プロセスを開始します。 


